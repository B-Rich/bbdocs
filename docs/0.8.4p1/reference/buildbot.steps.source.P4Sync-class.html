<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>buildbot.steps.source.P4Sync</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://buildbot.net/trac">BuildBot 0.8.4p1</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="buildbot-module.html">Package&nbsp;buildbot</a> ::
        <a href="buildbot.steps-module.html">Package&nbsp;steps</a> ::
        <a href="buildbot.steps.source-module.html">Module&nbsp;source</a> ::
        Class&nbsp;P4Sync
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="buildbot.steps.source.P4Sync-class.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== CLASS DESCRIPTION ==================== -->
<h1 class="epydoc">Class P4Sync</h1><p class="nomargin-top"><span class="codelink"><a href="buildbot.steps.source-pysrc.html#P4Sync">source&nbsp;code</a></span></p>
<pre class="base-tree">
   <a href="buildbot.process.buildstep.BuildStep-class.html">process.buildstep.BuildStep</a> --+        
                                 |        
<a href="buildbot.process.buildstep.LoggingBuildStep-class.html">process.buildstep.LoggingBuildStep</a> --+    
                                     |    
                                <a href="buildbot.steps.source.Source-class.html">Source</a> --+
                                         |
                                        <strong class="uidshort">P4Sync</strong>
</pre>

<hr />
<p>This is a partial solution for using a P4 source repository. You are 
  required to manually set up each build slave with a useful P4 
  environment, which means setting various per-slave environment variables,
  and creating a P4 client specification which maps the right files into 
  the slave's working directory. Once you have done that, this step merely 
  performs a 'p4 sync' to update that workspace with the newest files.</p>
  <p>Each slave needs the following environment:</p>
  <ul>
    <li>
      PATH: the 'p4' binary must be on the slave's PATH
    </li>
    <li>
      P4USER: each slave needs a distinct user account
    </li>
    <li>
      P4CLIENT: each slave needs a distinct client specification
    </li>
  </ul>
  <p>You should use 'p4 client' (?) to set up a client view spec which maps
  the desired files into $SLAVEBASE/$BUILDERBASE/source .</p>

<!-- ==================== INSTANCE METHODS ==================== -->
<a name="section-InstanceMethods"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Instance Methods</span></td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="buildbot.steps.source.P4Sync-class.html#__init__" class="summary-sig-name">__init__</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">p4port</span>,
        <span class="summary-sig-arg">p4user</span>,
        <span class="summary-sig-arg">p4passwd</span>,
        <span class="summary-sig-arg">p4client</span>,
        <span class="summary-sig-arg">**kwargs</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="buildbot.steps.source-pysrc.html#P4Sync.__init__">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="buildbot.steps.source.P4Sync-class.html#computeSourceRevision" class="summary-sig-name">computeSourceRevision</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">changes</span>)</span><br />
      Each subclass must implement this method to do something more precise
      than -rHEAD every time.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="buildbot.steps.source-pysrc.html#P4Sync.computeSourceRevision">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="startVC"></a><span class="summary-sig-name">startVC</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">branch</span>,
        <span class="summary-sig-arg">revision</span>,
        <span class="summary-sig-arg">patch</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="buildbot.steps.source-pysrc.html#P4Sync.startVC">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
  <tr>
    <td colspan="2" class="summary">
    <p class="indent-wrapped-lines"><b>Inherited from <code><a href="buildbot.steps.source.Source-class.html">Source</a></code></b>:
      <code><a href="buildbot.steps.source.Source-class.html#commandComplete">commandComplete</a></code>,
      <code><a href="buildbot.steps.source.Source-class.html#describe">describe</a></code>,
      <code><a href="buildbot.steps.source.Source-class.html#setDefaultWorkdir">setDefaultWorkdir</a></code>,
      <code><a href="buildbot.steps.source.Source-class.html#setStepStatus">setStepStatus</a></code>,
      <code><a href="buildbot.steps.source.Source-class.html#start">start</a></code>
      </p>
    <p class="indent-wrapped-lines"><b>Inherited from <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html">process.buildstep.LoggingBuildStep</a></code></b>:
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#addLogFile">addLogFile</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#checkDisconnect">checkDisconnect</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#createSummary">createSummary</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#evaluateCommand">evaluateCommand</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#getText">getText</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#getText2">getText2</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#interrupt">interrupt</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#maybeGetText2">maybeGetText2</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#setStatus">setStatus</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#setupLogfiles">setupLogfiles</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#startCommand">startCommand</a></code>
      </p>
    <p class="indent-wrapped-lines"><b>Inherited from <code><a href="buildbot.process.buildstep.BuildStep-class.html">process.buildstep.BuildStep</a></code></b>:
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#acquireLocks">acquireLocks</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#addCompleteLog">addCompleteLog</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#addFactoryArguments">addFactoryArguments</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#addHTMLLog">addHTMLLog</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#addLog">addLog</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#addLogObserver">addLogObserver</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#addURL">addURL</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#failed">failed</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#finished">finished</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#getLog">getLog</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#getProperty">getProperty</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#getSlaveName">getSlaveName</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#getStepFactory">getStepFactory</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#releaseLocks">releaseLocks</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#runCommand">runCommand</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#setBuild">setBuild</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#setBuildSlave">setBuildSlave</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#setProgress">setProgress</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#setProperty">setProperty</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#setupProgress">setupProgress</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#slaveVersion">slaveVersion</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#slaveVersionIsOlderThan">slaveVersionIsOlderThan</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#startStep">startStep</a></code>
      </p>
    </td>
  </tr>
</table>
<!-- ==================== CLASS VARIABLES ==================== -->
<a name="section-ClassVariables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Class Variables</span></td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="name"></a><span class="summary-name">name</span> = <code title="'p4sync'"><code class="variable-quote">'</code><code class="variable-string">p4sync</code><code class="variable-quote">'</code></code>
    </td>
  </tr>
  <tr>
    <td colspan="2" class="summary">
    <p class="indent-wrapped-lines"><b>Inherited from <code><a href="buildbot.steps.source.Source-class.html">Source</a></code></b>:
      <code><a href="buildbot.steps.source.Source-class.html#branch">branch</a></code>,
      <code><a href="buildbot.steps.source.Source-class.html#flunkOnFailure">flunkOnFailure</a></code>,
      <code><a href="buildbot.steps.source.Source-class.html#haltOnFailure">haltOnFailure</a></code>,
      <code><a href="buildbot.steps.source.Source-class.html#notReally">notReally</a></code>,
      <code><a href="buildbot.steps.source.Source-class.html#renderables">renderables</a></code>
      </p>
    <p class="indent-wrapped-lines"><b>Inherited from <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html">process.buildstep.LoggingBuildStep</a></code></b>:
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#cmd">cmd</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#logfiles">logfiles</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#parms">parms</a></code>,
      <code><a href="buildbot.process.buildstep.LoggingBuildStep-class.html#progressMetrics">progressMetrics</a></code>
      </p>
    <p class="indent-wrapped-lines"><b>Inherited from <code><a href="buildbot.process.buildstep.BuildStep-class.html">process.buildstep.BuildStep</a></code></b>:
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#alwaysRun">alwaysRun</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#doStepIf">doStepIf</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#flunkOnWarnings">flunkOnWarnings</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#locks">locks</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#useProgress">useProgress</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#warnOnFailure">warnOnFailure</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#warnOnWarnings">warnOnWarnings</a></code>
      </p>
    </td>
  </tr>
</table>
<!-- ==================== INSTANCE VARIABLES ==================== -->
<a name="section-InstanceVariables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Instance Variables</span></td>
</tr>
  <tr>
    <td colspan="2" class="summary">
    <p class="indent-wrapped-lines"><b>Inherited from <code><a href="buildbot.process.buildstep.BuildStep-class.html">process.buildstep.BuildStep</a></code></b>:
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#build">build</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#progress">progress</a></code>,
      <code><a href="buildbot.process.buildstep.BuildStep-class.html#step_status">step_status</a></code>
      </p>
    </td>
  </tr>
</table>
<!-- ==================== METHOD DETAILS ==================== -->
<a name="section-MethodDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Method Details</span></td>
</tr>
</table>
<a name="__init__"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">__init__</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">p4port</span>,
        <span class="sig-arg">p4user</span>,
        <span class="sig-arg">p4passwd</span>,
        <span class="sig-arg">p4client</span>,
        <span class="sig-arg">**kwargs</span>)</span>
    <br /><em class="fname">(Constructor)</em>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="buildbot.steps.source-pysrc.html#P4Sync.__init__">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>workdir</code></strong> - local directory (relative to the Builder's root) where the tree 
          should be placed</li>
        <li><strong class="pname"><code>mode</code></strong> - the kind of VC operation that is desired:
          <ul>
            <li>
              'update': specifies that the checkout/update should be 
              performed directly into the workdir. Each build is performed 
              in the same directory, allowing for incremental builds. This 
              minimizes disk space, bandwidth, and CPU time. However, it 
              may encounter problems if the build process does not handle 
              dependencies properly (if you must sometimes do a 'clean 
              build' to make sure everything gets compiled), or if source 
              files are deleted but generated files can influence test 
              behavior (e.g. python's .pyc files), or when source 
              directories are deleted but generated files prevent CVS from 
              removing them. When used with a patched checkout, from a 
              previous buildbot try for instance, it will try to 
              &quot;revert&quot; the changes first and will do a clobber if
              it is unable to get a clean checkout. The behavior is 
              SCM-dependent.
            </li>
            <li>
              'copy': specifies that the source-controlled workspace should
              be maintained in a separate directory (called the 'copydir'),
              using checkout or update as necessary. For each build, a new 
              workdir is created with a copy of the source tree (rm -rf 
              workdir; cp -R -P -p copydir workdir). This doubles the disk 
              space required, but keeps the bandwidth low (update instead 
              of a full checkout). A full 'clean' build is performed each 
              time.  This avoids any generated-file build problems, but is 
              still occasionally vulnerable to problems such as a CVS 
              repository being manually rearranged (causing CVS errors on 
              update) which are not an issue with a full checkout.
            </li>
            <li>
              'clobber': specifies that the working directory should be 
              deleted each time, necessitating a full checkout for each 
              build. This insures a clean build off a complete checkout, 
              avoiding any of the problems described above, but is 
              bandwidth intensive, as the whole source tree must be pulled 
              down for each build.
            </li>
            <li>
              'export': is like 'clobber', except that e.g. the 'cvs 
              export' command is used to create the working directory. This
              command removes all VC metadata files (the CVS/.svn/{arch} 
              directories) from the tree, which is sometimes useful for 
              creating source tarballs (to avoid including the metadata in 
              the tar file). Not all VC systems support export.
            </li>
          </ul></li>
        <li><strong class="pname"><code>alwaysUseLatest</code></strong> - whether to always update to the most recent available sources for
          this build.
          <p>Normally the Source step asks its Build for a list of all 
          Changes that are supposed to go into the build, then computes a 
          'source stamp' (revision number or timestamp) that will cause 
          exactly that set of changes to be present in the checked out 
          tree. This is turned into, e.g., 'cvs update -D timestamp', or 
          'svn update -r revnum'. If alwaysUseLatest=True, bypass this 
          computation and always update to the latest available sources for
          each build.</p>
          <p>The source stamp helps avoid a race condition in which someone
          commits a change after the master has decided to start a build 
          but before the slave finishes checking out the sources. At best 
          this results in a build which contains more changes than the 
          buildmaster thinks it has (possibly resulting in the wrong person
          taking the blame for any problems that result), at worst is can 
          result in an incoherent set of sources (splitting a non-atomic 
          commit) which may not build at all.</p></li>
        <li><strong class="pname"><code>retry</code></strong> - if provided, VC update failures are re-attempted up to REPEATS 
          times, with DELAY seconds between each attempt. Some users have 
          slaves with poor connectivity to their VC repository, and they 
          say that up to 80% of their build failures are due to transient 
          network failures that could be handled by simply retrying a 
          couple times.</li>
    </ul></dd>
    <dt>Overrides:
        <a href="buildbot.process.buildstep.BuildStep-class.html#__init__">process.buildstep.BuildStep.__init__</a>
    </dt>
  </dl>
</td></tr></table>
</div>
<a name="computeSourceRevision"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">computeSourceRevision</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">changes</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="buildbot.steps.source-pysrc.html#P4Sync.computeSourceRevision">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Each subclass must implement this method to do something more precise 
  than -rHEAD every time. For version control systems that use 
  repository-wide change numbers (SVN, P4), this can simply take the 
  maximum such number from all the changes involved in this build. For 
  systems that do not (CVS), it needs to create a timestamp based upon the 
  latest Change, the Build's treeStableTimer, and an optional 
  self.checkoutDelay value.</p>
  <dl class="fields">
    <dt>Overrides:
        <a href="buildbot.steps.source.Source-class.html#computeSourceRevision">Source.computeSourceRevision</a>
        <dd><em class="note">(inherited documentation)</em></dd>
    </dt>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://buildbot.net/trac">BuildBot 0.8.4p1</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Sun Jun 19 00:18:08 2011
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
