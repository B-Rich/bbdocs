<html lang="en">
<head>
<title>BuildBot Manual - 0.8.4p1</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="BuildBot Manual - 0.8.4p1">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This is the BuildBot manual for Buildbot version 0.8.4p1.

Copyright (C) 2005, 2006, 2009, 2010 Brian Warner

Copying and distribution of this file, with or without
modification, are permitted in any medium without royalty
provided the copyright notice and this notice are preserved.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
<!-- GA-TRACKING-START -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-12313843-4");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
<!-- GA-TRACKING-END -->
</head>
<body>
<h1 class="settitle">BuildBot Manual - 0.8.4p1</h1>
   <div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">BuildBot</a>
<li><a name="toc_Introduction" href="#Introduction">1 Introduction</a>
<ul>
<li><a href="#History-and-Philosophy">1.1 History and Philosophy</a>
<li><a href="#System-Architecture">1.2 System Architecture</a>
<ul>
<li><a href="#BuildSlave-Connections">1.2.1 BuildSlave Connections</a>
<li><a href="#Buildmaster-Architecture">1.2.2 Buildmaster Architecture</a>
<li><a href="#Status-Delivery-Architecture">1.2.3 Status Delivery Architecture</a>
</li></ul>
<li><a href="#Control-Flow">1.3 Control Flow</a>
</li></ul>
<li><a name="toc_Installation" href="#Installation">2 Installation</a>
<ul>
<li><a href="#Buildbot-Components">2.1 Buildbot Components</a>
<li><a href="#Requirements">2.2 Requirements</a>
<ul>
<li><a href="#Common-Requirements">2.2.1 Common Requirements</a>
<li><a href="#Buildmaster-Requirements">2.2.2 Buildmaster Requirements</a>
</li></ul>
<li><a href="#Installing-the-code">2.3 Installing the code</a>
<li><a href="#Running-Buildbot_0027s-Tests-_0028optional_0029">2.4 Running Buildbot's Tests (optional)</a>
<li><a href="#Creating-a-buildmaster">2.5 Creating a buildmaster</a>
<li><a href="#Upgrading-an-Existing-Buildmaster">2.6 Upgrading an Existing Buildmaster</a>
<ul>
<li><a href="#Upgrading-a-Buildmaster-to-Buildbot_002d0_002e7_002e6">2.6.1 Upgrading a Buildmaster to Buildbot-0.7.6</a>
<li><a href="#Upgrading-a-Buildmaster-to-Buildbot_002d0_002e8_002e0">2.6.2 Upgrading a Buildmaster to Buildbot-0.8.0</a>
<li><a href="#Upgrading-a-Buildmaster-to-Later-Versions">2.6.3 Upgrading a Buildmaster to Later Versions</a>
</li></ul>
<li><a href="#Creating-a-buildslave">2.7 Creating a buildslave</a>
<ul>
<li><a href="#Buildslave-Options">2.7.1 Buildslave Options</a>
<li><a href="#Other-Buildslave-Configuration">2.7.2 Other Buildslave Configuration</a>
</li></ul>
<li><a href="#Upgrading-an-Existing-Buildslave">2.8 Upgrading an Existing Buildslave</a>
<ul>
<li><a href="#Upgrading-a-Buildslave-to-Buildbot_002dslave_002d0_002e8_002e1">2.8.1 Upgrading a Buildslave to Buildbot-slave-0.8.1</a>
</li></ul>
<li><a href="#Launching-the-daemons">2.9 Launching the daemons</a>
<li><a href="#Logfiles">2.10 Logfiles</a>
<li><a href="#Shutdown">2.11 Shutdown</a>
<li><a href="#Maintenance">2.12 Maintenance</a>
<li><a href="#Troubleshooting">2.13 Troubleshooting</a>
<ul>
<li><a href="#Starting-the-buildslave">2.13.1 Starting the buildslave</a>
<li><a href="#Connecting-to-the-buildmaster">2.13.2 Connecting to the buildmaster</a>
</li></ul>
<li><a href="#Contrib-Scripts">2.14 Contrib Scripts</a>
</li></ul>
<li><a name="toc_Concepts" href="#Concepts">3 Concepts</a>
<ul>
<li><a href="#Version-Control-Systems">3.1 Version Control Systems</a>
<ul>
<li><a href="#Generalizing-VC-Systems">3.1.1 Generalizing VC Systems</a>
<li><a href="#Source-Tree-Specifications">3.1.2 Source Tree Specifications</a>
<li><a href="#How-Different-VC-Systems-Specify-Sources">3.1.3 How Different VC Systems Specify Sources</a>
<li><a href="#Attributes-of-Changes">3.1.4 Attributes of Changes</a>
</li></ul>
<li><a href="#Scheduling-Builds">3.2 Scheduling Builds</a>
<li><a href="#BuildSet">3.3 BuildSet</a>
<li><a href="#BuildRequest">3.4 BuildRequest</a>
<li><a href="#Builder">3.5 Builder</a>
<li><a href="#Build">3.6 Build</a>
<li><a href="#Users">3.7 Users</a>
<ul>
<li><a href="#Doing-Things-With-Users">3.7.1 Doing Things With Users</a>
<li><a href="#Email-Addresses">3.7.2 Email Addresses</a>
<li><a href="#IRC-Nicknames">3.7.3 IRC Nicknames</a>
<li><a href="#Live-Status-Clients">3.7.4 Live Status Clients</a>
</li></ul>
<li><a href="#Build-Properties">3.8 Build Properties</a>
</li></ul>
<li><a name="toc_Configuration" href="#Configuration">4 Configuration</a>
<ul>
<li><a href="#Config-File-Format">4.1 Config File Format</a>
<li><a href="#Predefined-Config-File-Symbols">4.2 Predefined Config File Symbols</a>
<li><a href="#Testing-the-Config-File">4.3 Testing the Config File</a>
<li><a href="#Loading-the-Config-File">4.4 Loading the Config File</a>
<li><a href="#Reloading-the-Config-File-_0028reconfig_0029">4.5 Reloading the Config File (reconfig)</a>
<li><a href="#Global-Configuration">4.6 Global Configuration</a>
<ul>
<li><a href="#Database-Specification">4.6.1 Database Specification</a>
<li><a href="#Multi_002dmaster-mode">4.6.2 Multi-master mode</a>
<li><a href="#Site-Definition">4.6.3 Site Definition</a>
<li><a href="#Log-Handling">4.6.4 Log Handling</a>
<li><a href="#Data-Lifetime">4.6.5 Data Lifetime</a>
<li><a href="#Merging-Build-Requests-_0028global-option_0029">4.6.6 Merging Build Requests (global option)</a>
<li><a href="#Prioritizing-Builders">4.6.7 Prioritizing Builders</a>
<li><a href="#Setting-the-PB-Port-for-Slaves">4.6.8 Setting the PB Port for Slaves</a>
<li><a href="#Defining-Global-Properties">4.6.9 Defining Global Properties</a>
<li><a href="#Debug-Options">4.6.10 Debug Options</a>
<li><a href="#Metrics-Options">4.6.11 Metrics Options</a>
</li></ul>
<li><a href="#Change-Sources">4.7 Change Sources</a>
<ul>
<li><a href="#Choosing-a-Change-Source">4.7.1 Choosing a Change Source</a>
<li><a href="#Configuring-Change-Sources">4.7.2 Configuring Change Sources</a>
<li><a href="#Mail_002dparsing-ChangeSources">4.7.3 Mail-parsing ChangeSources</a>
<ul>
<li><a href="#Subscribing-the-Buildmaster">4.7.3.1 Subscribing the Buildmaster</a>
<li><a href="#Using-Maildirs">4.7.3.2 Using Maildirs</a>
<li><a href="#Parsing-Email-Change-Messages">4.7.3.3 Parsing Email Change Messages</a>
<li><a href="#CVSMaildirSource">4.7.3.4 CVSMaildirSource</a>
<li><a href="#SVNCommitEmailMaildirSource">4.7.3.5 SVNCommitEmailMaildirSource</a>
<li><a href="#BzrLaunchpadEmailMaildirSource">4.7.3.6 BzrLaunchpadEmailMaildirSource</a>
</li></ul>
<li><a href="#PBChangeSource">4.7.4 PBChangeSource</a>
<ul>
<li><a href="#Mercurial-Hook">4.7.4.1 Mercurial Hook</a>
<li><a href="#Bzr-Hook">4.7.4.2 Bzr Hook</a>
</li></ul>
<li><a href="#P4Source">4.7.5 P4Source</a>
<li><a href="#BonsaiPoller">4.7.6 BonsaiPoller</a>
<li><a href="#SVNPoller">4.7.7 SVNPoller</a>
<li><a href="#Bzr-Poller">4.7.8 Bzr Poller</a>
<li><a href="#GitPoller">4.7.9 GitPoller</a>
<li><a href="#GerritChangeSource">4.7.10 GerritChangeSource</a>
<li><a href="#Change-Hooks-_0028HTTP-Notifications_0029">4.7.11 Change Hooks (HTTP Notifications)</a>
<li><a href="#GoogleCodeAtomPoller">4.7.12 GoogleCodeAtomPoller</a>
<li><a href="#Change-Source-Index">4.7.13 Change Source Index</a>
</li></ul>
<li><a href="#Schedulers">4.8 Schedulers</a>
<ul>
<li><a href="#Configuring-Schedulers">4.8.1 Configuring Schedulers</a>
<li><a href="#Change-Filters">4.8.2 Change Filters</a>
<li><a href="#SingleBranchScheduler">4.8.3 SingleBranchScheduler</a>
<li><a href="#AnyBranchScheduler">4.8.4 AnyBranchScheduler</a>
<li><a href="#Dependent-Scheduler">4.8.5 Dependent Scheduler</a>
<li><a href="#Periodic-Scheduler">4.8.6 Periodic Scheduler</a>
<li><a href="#Nightly-Scheduler">4.8.7 Nightly Scheduler</a>
<li><a href="#Try-Schedulers">4.8.8 Try Schedulers</a>
<li><a href="#Triggerable-Scheduler">4.8.9 Triggerable Scheduler</a>
<li><a href="#Scheduler-Index">4.8.10 Scheduler Index</a>
</li></ul>
<li><a href="#Buildslaves">4.9 Buildslaves</a>
<ul>
<li><a href="#Master_002dslave-TCP-Keepalive">4.9.1 Mater-slave TCP keepalive</a>
<li><a href="#When-Buildslaves-Go-Missing">4.9.2 When Buildslaves Go Missing</a>
<li><a href="#Latent-Buildslaves">4.9.3 Latent Buildslaves</a>
<ul>
<li><a href="#Amazon-Web-Services-Elastic-Compute-Cloud-_0028_0022AWS-EC2_0022_0029">4.9.3.1 Amazon Web Services Elastic Compute Cloud ("AWS EC2")</a>
<li><a href="#Libvirt">4.9.3.2 Libvirt</a>
<li><a href="#Dangers-with-Latent-Buildslaves">4.9.3.3 Dangers with Latent Buildslaves</a>
<li><a href="#Writing-New-Latent-Buildslaves">4.9.3.4 Writing New Latent Buildslaves</a>
</li></ul>
</li></ul>
<li><a href="#Builders">4.10 Builders</a>
<ul>
<li><a href="#Builder-Configuration">4.10.1 Builder Configuration</a>
<li><a href="#Merging-Build-Requests">4.10.2 Merging Build Requests</a>
<li><a href="#Prioritizing-Builds">4.10.3 Prioritizing Builds</a>
</li></ul>
<li><a href="#Build-Factories">4.11 Build Factories</a>
<ul>
<li><a href="#BuildFactory">4.11.1 BuildFactory</a>
<li><a href="#GNUAutoconf">4.11.2 GNUAutoconf</a>
<li><a href="#BasicBuildFactory">4.11.3 BasicBuildFactory</a>
<li><a href="#BasicSVN">4.11.4 BasicSVN</a>
<li><a href="#QuickBuildFactory">4.11.5 QuickBuildFactory</a>
<li><a href="#CPAN">4.11.6 CPAN</a>
<li><a href="#Distutils">4.11.7 Distutils</a>
<li><a href="#Trial-_0028Factory_0029">4.11.8 Trial</a>
<li><a href="#Build-Factory-Index">4.11.9 Build Factory Index</a>
</li></ul>
<li><a href="#Build-Steps">4.12 Build Steps</a>
<ul>
<li><a href="#Common-Parameters">4.12.1 Common Parameters</a>
<li><a href="#Using-Build-Properties">4.12.2 Using Build Properties</a>
<ul>
<li><a href="#Property">4.12.2.1 Property</a>
<li><a href="#WithProperties">4.12.2.2 WithProperties</a>
<li><a href="#Common-Build-Properties">4.12.2.3 Common Build Properties</a>
</li></ul>
<li><a href="#Source-Checkout">4.12.3 Source Checkout</a>
<ul>
<li><a href="#CVS">4.12.3.1 CVS</a>
<li><a href="#SVN">4.12.3.2 SVN</a>
<li><a href="#Darcs">4.12.3.3 Darcs</a>
<li><a href="#Mercurial">4.12.3.4 Mercurial</a>
<li><a href="#Bzr">4.12.3.5 Bzr</a>
<li><a href="#P4">4.12.3.6 P4</a>
<li><a href="#Git">4.12.3.7 Git</a>
<li><a href="#BitKeeper">4.12.3.8 BitKeeper</a>
<li><a href="#Repo">4.12.3.9 Repo</a>
<li><a href="#Monotone">4.12.3.10 Monotone</a>
</li></ul>
<li><a href="#ShellCommand">4.12.4 ShellCommand</a>
<ul>
<li><a href="#Using-ShellCommands">4.12.4.1 Using ShellCommands</a>
<li><a href="#Configure">4.12.4.2 Configure</a>
<li><a href="#Compile">4.12.4.3 Compile</a>
<li><a href="#Visual-C_002b_002b">4.12.4.4 Visual C++</a>
<li><a href="#Test">4.12.4.5 Test</a>
<li><a href="#TreeSize">4.12.4.6 TreeSize</a>
<li><a href="#PerlModuleTest">4.12.4.7 PerlModuleTest</a>
<li><a href="#Testing-with-mysql_002dtest_002drun">4.12.4.8 Testing with mysql-test-run</a>
<li><a href="#SetProperty">4.12.4.9 SetProperty</a>
<li><a href="#SubunitShellCommand">4.12.4.10 SubunitShellCommand</a>
</li></ul>
<li><a href="#Slave-Filesystem-Steps">4.12.5 Slave Filesystem Steps</a>
<ul>
<li><a href="#RemoveDirectory">4.12.5.1 RemoveDirectory</a>
</li></ul>
<li><a href="#Python-BuildSteps">4.12.6 Python BuildSteps</a>
<ul>
<li><a href="#BuildEPYDoc">4.12.6.1 BuildEPYDoc</a>
<li><a href="#PyFlakes">4.12.6.2 PyFlakes</a>
<li><a href="#PyLint">4.12.6.3 PyLint</a>
<li><a href="#Trial">4.12.6.4 Trial</a>
<li><a href="#RemovePYCs">4.12.6.5 RemovePYCs</a>
</li></ul>
<li><a href="#Transferring-Files">4.12.7 Transferring Files</a>
<li><a href="#Transferring-Strings">4.12.8 Transferring Strings</a>
<li><a href="#Running-Commands-on-the-Master">4.12.9 Running Commands on the Master</a>
<li><a href="#Setting-Properties">4.12.10 Setting Properties</a>
<li><a href="#Triggering-Schedulers">4.12.11 Triggering Schedulers</a>
<li><a href="#Miscellaneous-BuildSteps">4.12.12 Miscellaneous BuildSteps</a>
<ul>
<li><a href="#HLint">4.12.12.1 HLint</a>
</li></ul>
<li><a href="#Writing-New-BuildSteps">4.12.13 Writing New BuildSteps</a>
<ul>
<li><a href="#Writing-BuildStep-Constructors">4.12.13.1 Writing BuildStep Constructors</a>
<li><a href="#BuildStep-LogFiles">4.12.13.2 BuildStep LogFiles</a>
<li><a href="#Reading-Logfiles">4.12.13.3 Reading Logfiles</a>
<li><a href="#Adding-LogObservers">4.12.13.4 Adding LogObservers</a>
<li><a href="#BuildStep-URLs">4.12.13.5 BuildStep URLs</a>
</li></ul>
<li><a href="#Build-Step-Index">4.12.14 Build Step Index</a>
</li></ul>
<li><a href="#Interlocks">4.13 Interlocks</a>
<li><a href="#Status-Targets">4.14 Status Targets</a>
<ul>
<li><a href="#WebStatus">4.14.1 WebStatus</a>
<ul>
<li><a href="#Buildbot-Web-Resources">4.14.1.1 Buildbot Web Resources</a>
<li><a href="#WebStatus-Configuration-Parameters">4.14.1.2 WebStatus Configuration Parameters</a>
<li><a href="#Change-Hooks">4.14.1.3 Change Hooks</a>
</li></ul>
<li><a href="#MailNotifier">4.14.2 MailNotifier</a>
<li><a href="#IRC-Bot">4.14.3 IRC Bot</a>
<li><a href="#PBListener">4.14.4 PBListener</a>
<li><a href="#StatusPush">4.14.5 StatusPush</a>
<li><a href="#HttpStatusPush">4.14.6 HttpStatusPush</a>
<li><a href="#GerritStatusPush">4.14.7 GerritStatusPush</a>
<li><a href="#Writing-New-Status-Plugins">4.14.8 Writing New Status Plugins</a>
<li><a href="#Status-Target-Index">4.14.9 Status Target Index</a>
</li></ul>
<li><a href="#Configuration-Index">4.15 Configuration Index</a>
</li></ul>
<li><a name="toc_Customization" href="#Customization">5 Customization</a>
<ul>
<li><a href="#Writing-Change-Sources">5.1 Writing Change Sources</a>
<ul>
<li><a href="#Writing-a-Change-Source">5.1.1 Writing a Change Source</a>
<li><a href="#Writing-a-Change-Poller">5.1.2 Writing a Change Poller</a>
</li></ul>
</li></ul>
<li><a name="toc_Command_002dline-Tools" href="#Command_002dline-Tools">6 Command-line Tools</a>
<ul>
<li><a href="#buildbot">6.1 buildbot</a>
<ul>
<li><a href="#Administrator-Tools">6.1.1 Administrator Tools</a>
<ul>
<li><a href="#create_002dmaster">6.1.1.1 create-master</a>
<li><a href="#start-_0028buildbot_0029">6.1.1.2 start</a>
<li><a href="#stop-_0028buildbot_0029">6.1.1.3 stop</a>
<li><a href="#sighup">6.1.1.4 sighup</a>
</li></ul>
<li><a href="#Developer-Tools">6.1.2 Developer Tools</a>
<ul>
<li><a href="#statuslog">6.1.2.1 statuslog</a>
<li><a href="#statusgui">6.1.2.2 statusgui</a>
<li><a href="#try">6.1.2.3 try</a>
</li></ul>
<li><a href="#Other-Tools">6.1.3 Other Tools</a>
<ul>
<li><a href="#sendchange">6.1.3.1 sendchange</a>
<li><a href="#debugclient">6.1.3.2 debugclient</a>
</li></ul>
<li><a href="#_002ebuildbot-config-directory">6.1.4 .buildbot config directory</a>
</li></ul>
<li><a href="#buildslave">6.2 buildslave</a>
<ul>
<li><a href="#create_002dslave">6.2.1 create-slave</a>
<li><a href="#start-_0028buildslave_0029">6.2.2 start</a>
<li><a href="#stop-_0028buildslave_0029">6.2.3 stop</a>
</li></ul>
</li></ul>
<li><a name="toc_Resources" href="#Resources">7 Resources</a>
<li><a name="toc_Developer-Information" href="#Developer-Information">8 Developer Information</a>
<ul>
<li><a href="#Buildmaster-Service-Hierarchy">8.1 Buildmaster Service Hierarchy</a>
<li><a href="#Access-to-Configuration">8.2 Access to Configuration</a>
<li><a href="#Utilities">8.3 Utilities</a>
<ul>
<li><a href="#buildbot_002eutil_002ebbcollections">8.3.1 buildbot.util.bbcollections</a>
<li><a href="#buildbot_002eutil_002eeventual">8.3.2 buildbot.util.eventual</a>
<li><a href="#buildbot_002eutil_002ejson">8.3.3 buildbot.util.json</a>
</li></ul>
<li><a href="#The-Database">8.4 The Database</a>
<ul>
<li><a href="#Database-Schema">8.4.1 Database Schema</a>
<li><a href="#Changing-the-Schema">8.4.2 Changing the Schema</a>
</li></ul>
<li><a href="#Log-File-Format">8.5 Log File Format</a>
<li><a href="#Web-Status">8.6 Web Status</a>
<ul>
<li><a href="#Jinja-Web-Templates">8.6.1 Jinja Web Templates</a>
<li><a href="#Web-Authorization-Framework">8.6.2 Web Authorization Framework</a>
</li></ul>
<li><a href="#Obfuscating-Passwords">8.7 Obfuscating Passwords</a>
<li><a href="#Master_002dSlave-API">8.8 Master-Slave API</a>
<li><a href="#Twisted-Idioms">8.9 Twisted Idioms</a>
<ul>
<li><a href="#Helpful-Twisted-Classes">8.9.1 Helpful Twisted Classes</a>
</li></ul>
<li><a href="#Buildbot-Tests">8.10 Buildbot Tests</a>
<ul>
<li><a href="#Toward-Better-Buildbot-Tests">8.10.1 Toward Better Buildbot Tests</a>
<li><a href="#Keeping-State-in-Tests">8.10.2 Keeping State in Tests</a>
<li><a href="#Better-Debugging-through-Monkeypatching">8.10.3 Better Debugging through Monkeypatching</a>
</li></ul>
<li><a href="#String-Encodings">8.11 String Encodings</a>
<li><a href="#Metrics">8.12 Metrics</a>
<ul>
<li><a href="#Metric-Events">8.12.1 Metric Events</a>
<li><a href="#Metric-Handlers">8.12.2 Metric Handlers</a>
<li><a href="#Metric-Watchers">8.12.3 Metric Watchers</a>
<li><a href="#Metric-Helpers">8.12.4 Metric Helpers</a>
</li></ul>
<li><a href="#Developer-Class-Index">8.13 Developer Class Index</a>
</li></ul>
<li><a name="toc_Index" href="#Index">Index</a>
</li></ul>
</div>



<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Introduction">Introduction</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#dir">(dir)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">BuildBot</h2>

<p>This is the BuildBot manual for Buildbot version 0.8.4p1.

   <p>Copyright (C) 2005, 2006, 2009, 2010 Brian Warner

   <p>Copying and distribution of this file, with or without
modification, are permitted in any medium without royalty
provided the copyright notice and this notice are preserved.

<ul class="menu">
<li><a accesskey="1" href="#Introduction">Introduction</a>:                 What the BuildBot does. 
<li><a accesskey="2" href="#Installation">Installation</a>:                 Installing and setting up a Builbot system
<li><a accesskey="3" href="#Concepts">Concepts</a>:                     What goes on in the buildbot's little mind. 
<li><a accesskey="4" href="#Configuration">Configuration</a>:                Controlling the buildbot. 
<li><a accesskey="5" href="#Customization">Customization</a>:                Customizing Buildbot with subclasses
<li><a accesskey="6" href="#Command_002dline-Tools">Command-line Tools</a>:           The 'buildbot' and 'buildslave' utilities
<li><a accesskey="7" href="#Resources">Resources</a>:                    Getting help
<li><a accesskey="8" href="#Developer-Information">Developer Information</a>:        Stuff Buildbot hackers should know
<li><a accesskey="9" href="#Index">Index</a>:                        Concept Index
</ul>

<div class="node">
<a name="Introduction"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installation">Installation</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Introduction</h2>

<p><a name="index-introduction-1"></a>
The BuildBot is a system to automate the compile/test cycle required by most
software projects to validate code changes. By automatically rebuilding and
testing the tree each time something has changed, build problems are
pinpointed quickly, before other developers are inconvenienced by the
failure. The guilty developer can be identified and harassed without human
intervention. By running the builds on a variety of platforms, developers
who do not have the facilities to test their changes everywhere before
checkin will at least know shortly afterwards whether they have broken the
build or not. Warning counts, lint checks, image size, compile time, and
other build parameters can be tracked over time, are more visible, and
are therefore easier to improve.

   <p>The overall goal is to reduce tree breakage and provide a platform to
run tests or code-quality checks that are too annoying or pedantic for
any human to waste their time with. Developers get immediate (and
potentially public) feedback about their changes, encouraging them to
be more careful about testing before checkin.

   <p>Features:

     <ul>
<li>run builds on a variety of slave platforms
<li>arbitrary build process: handles projects using C, Python, whatever
<li>minimal host requirements: python and Twisted
<li>slaves can be behind a firewall if they can still do checkout
<li>status delivery through web page, email, IRC, other protocols
<li>track builds in progress, provide estimated completion time
<li>flexible configuration by subclassing generic build process classes
<li>debug tools to force a new build, submit fake Changes, query slave status
<li>released under the GPL
</ul>

<ul class="menu">
<li><a accesskey="1" href="#History-and-Philosophy">History and Philosophy</a>
<li><a accesskey="2" href="#System-Architecture">System Architecture</a>
<li><a accesskey="3" href="#Control-Flow">Control Flow</a>
</ul>

<div class="node">
<a name="History-and-Philosophy"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#System-Architecture">System Architecture</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction">Introduction</a>

</div>

<h3 class="section">1.1 History and Philosophy</h3>

<p><a name="index-Philosophy-of-operation-2"></a>
The Buildbot was inspired by a similar project built for a development
team writing a cross-platform embedded system. The various components
of the project were supposed to compile and run on several flavors of
unix (linux, solaris, BSD), but individual developers had their own
preferences and tended to stick to a single platform. From time to
time, incompatibilities would sneak in (some unix platforms want to
use <code>string.h</code>, some prefer <code>strings.h</code>), and then the tree
would compile for some developers but not others. The buildbot was
written to automate the human process of walking into the office,
updating a tree, compiling (and discovering the breakage), finding the
developer at fault, and complaining to them about the problem they had
introduced. With multiple platforms it was difficult for developers to
do the right thing (compile their potential change on all platforms);
the buildbot offered a way to help.

   <p>Another problem was when programmers would change the behavior of a
library without warning its users, or change internal aspects that
other code was (unfortunately) depending upon. Adding unit tests to
the codebase helps here: if an application's unit tests pass despite
changes in the libraries it uses, you can have more confidence that
the library changes haven't broken anything. Many developers
complained that the unit tests were inconvenient or took too long to
run: having the buildbot run them reduces the developer's workload to
a minimum.

   <p>In general, having more visibility into the project is always good,
and automation makes it easier for developers to do the right thing. 
When everyone can see the status of the project, developers are
encouraged to keep the tree in good working order. Unit tests that
aren't run on a regular basis tend to suffer from bitrot just like
code does: exercising them on a regular basis helps to keep them
functioning and useful.

   <p>The current version of the Buildbot is additionally targeted at
distributed free-software projects, where resources and platforms are
only available when provided by interested volunteers. The buildslaves
are designed to require an absolute minimum of configuration, reducing
the effort a potential volunteer needs to expend to be able to
contribute a new test environment to the project. The goal is for
anyone who wishes that a given project would run on their favorite
platform should be able to offer that project a buildslave, running on
that platform, where they can verify that their portability code
works, and keeps working.

<div class="node">
<a name="System-Architecture"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Control-Flow">Control Flow</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#History-and-Philosophy">History and Philosophy</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction">Introduction</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">1.2 System Architecture</h3>

<p>The Buildbot consists of a single <code>buildmaster</code> and one or more
<code>buildslaves</code>, connected in a star topology. The buildmaster
makes all decisions about what, when, and how to build. It sends
commands to be run on the build slaves, which simply execute the
commands and return the results. (certain steps involve more local
decision making, where the overhead of sending a lot of commands back
and forth would be inappropriate, but in general the buildmaster is
responsible for everything).

   <p>The buildmaster is usually fed <code>Changes</code> by some sort of version control
system (see <a href="#Change-Sources">Change Sources</a>), which may cause builds to be run. As the
builds are performed, various status messages are produced, which are then sent
to any registered Status Targets (see <a href="#Status-Targets">Status Targets</a>).

<!-- @image{FILENAME, WIDTH, HEIGHT, ALTTEXT, EXTENSION} -->
   <div class="block-image"><img src="images/overview.png" alt="Overview Diagram"></div>

   <p>The buildmaster is configured and maintained by the &ldquo;buildmaster
admin&rdquo;, who is generally the project team member responsible for
build process issues. Each buildslave is maintained by a &ldquo;buildslave
admin&rdquo;, who do not need to be quite as involved. Generally slaves are
run by anyone who has an interest in seeing the project work well on
their favorite platform.

<ul class="menu">
<li><a accesskey="1" href="#BuildSlave-Connections">BuildSlave Connections</a>
<li><a accesskey="2" href="#Buildmaster-Architecture">Buildmaster Architecture</a>
<li><a accesskey="3" href="#Status-Delivery-Architecture">Status Delivery Architecture</a>
</ul>

<div class="node">
<a name="BuildSlave-Connections"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Buildmaster-Architecture">Buildmaster Architecture</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#System-Architecture">System Architecture</a>

</div>

<h4 class="subsection">1.2.1 BuildSlave Connections</h4>

<p>The buildslaves are typically run on a variety of separate machines,
at least one per platform of interest. These machines connect to the
buildmaster over a TCP connection to a publically-visible port. As a
result, the buildslaves can live behind a NAT box or similar
firewalls, as long as they can get to buildmaster. The TCP connections
are initiated by the buildslave and accepted by the buildmaster, but
commands and results travel both ways within this connection. The
buildmaster is always in charge, so all commands travel exclusively
from the buildmaster to the buildslave.

   <p>To perform builds, the buildslaves must typically obtain source code
from a CVS/SVN/etc repository. Therefore they must also be able to
reach the repository. The buildmaster provides instructions for
performing builds, but does not provide the source code itself.

   <div class="block-image"><img src="images/slaves.png" alt="BuildSlave Connections"></div>

<div class="node">
<a name="Buildmaster-Architecture"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Status-Delivery-Architecture">Status Delivery Architecture</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BuildSlave-Connections">BuildSlave Connections</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#System-Architecture">System Architecture</a>

</div>

<h4 class="subsection">1.2.2 Buildmaster Architecture</h4>

<p>The Buildmaster consists of several pieces:

   <div class="block-image"><img src="images/master.png" alt="BuildMaster Architecture"></div>

     <ul>
<li>Change Sources, which create a Change object each time something is
modified in the VC repository. Most ChangeSources listen for messages
from a hook script of some sort. Some sources actively poll the
repository on a regular basis. All Changes are fed to the Schedulers.

     <li>Schedulers, which decide when builds should be performed. They collect
Changes into BuildRequests, which are then queued for delivery to
Builders until a buildslave is available.

     <li>Builders, which control exactly <em>how</em> each build is performed
(with a series of BuildSteps, configured in a BuildFactory). Each
Build is run on a single buildslave.

     <li>Status plugins, which deliver information about the build results
through protocols like HTTP, mail, and IRC.

   </ul>

   <p>Each Builder is configured with a list of BuildSlaves that it will use
for its builds. These buildslaves are expected to behave identically:
the only reason to use multiple BuildSlaves for a single Builder is to
provide a measure of load-balancing.

   <p>Within a single BuildSlave, each Builder creates its own SlaveBuilder
instance. These SlaveBuilders operate independently from each other. 
Each gets its own base directory to work in. It is quite common to
have many Builders sharing the same buildslave. For example, there
might be two buildslaves: one for i386, and a second for PowerPC. 
There may then be a pair of Builders that do a full compile/test run,
one for each architecture, and a lone Builder that creates snapshot
source tarballs if the full builders complete successfully. The full
builders would each run on a single buildslave, whereas the tarball
creation step might run on either buildslave (since the platform
doesn't matter when creating source tarballs). In this case, the
mapping would look like:

<pre class="example">     Builder(full-i386)  -&gt;  BuildSlaves(slave-i386)
     Builder(full-ppc)   -&gt;  BuildSlaves(slave-ppc)
     Builder(source-tarball) -&gt; BuildSlaves(slave-i386, slave-ppc)
</pre>
   <p>and each BuildSlave would have two SlaveBuilders inside it, one for a
full builder, and a second for the source-tarball builder.

   <p>Once a SlaveBuilder is available, the Builder pulls one or more
BuildRequests off its incoming queue. (It may pull more than one if it
determines that it can merge the requests together; for example, there
may be multiple requests to build the current HEAD revision). These
requests are merged into a single Build instance, which includes the
SourceStamp that describes what exact version of the source code
should be used for the build. The Build is then randomly assigned to a
free SlaveBuilder and the build begins.

   <p>The behaviour when BuildRequests are merged can be customized, see <a href="#Merging-Build-Requests">Merging Build Requests</a>.

<div class="node">
<a name="Status-Delivery-Architecture"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Buildmaster-Architecture">Buildmaster Architecture</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#System-Architecture">System Architecture</a>

</div>

<h4 class="subsection">1.2.3 Status Delivery Architecture</h4>

<p>The buildmaster maintains a central Status object, to which various
status plugins are connected. Through this Status object, a full
hierarchy of build status objects can be obtained.

   <div class="block-image"><img src="images/status.png" alt="Status Delivery"></div>

   <p>The configuration file controls which status plugins are active. Each
status plugin gets a reference to the top-level Status object. From
there they can request information on each Builder, Build, Step, and
LogFile. This query-on-demand interface is used by the html.Waterfall
plugin to create the main status page each time a web browser hits the
main URL.

   <p>The status plugins can also subscribe to hear about new Builds as they
occur: this is used by the MailNotifier to create new email messages
for each recently-completed Build.

   <p>The Status object records the status of old builds on disk in the
buildmaster's base directory. This allows it to return information
about historical builds.

   <p>There are also status objects that correspond to Schedulers and
BuildSlaves. These allow status plugins to report information about
upcoming builds, and the online/offline status of each buildslave.

<div class="node">
<a name="Control-Flow"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#System-Architecture">System Architecture</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction">Introduction</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">1.3 Control Flow</h3>

<p>A day in the life of the buildbot:

     <ul>
<li>A developer commits some source code changes to the repository. A hook
script or commit trigger of some sort sends information about this
change to the buildmaster through one of its configured Change
Sources. This notification might arrive via email, or over a network
connection (either initiated by the buildmaster as it &ldquo;subscribes&rdquo;
to changes, or by the commit trigger as it pushes Changes towards the
buildmaster). The Change contains information about who made the
change, what files were modified, which revision contains the change,
and any checkin comments.

     <li>The buildmaster distributes this change to all of its configured
Schedulers. Any &ldquo;important&rdquo; changes cause the &ldquo;tree-stable-timer&rdquo;
to be started, and the Change is added to a list of those that will go
into a new Build. When the timer expires, a Build is started on each
of a set of configured Builders, all compiling/testing the same source
code. Unless configured otherwise, all Builds run in parallel on the
various buildslaves.

     <li>The Build consists of a series of Steps. Each Step causes some number
of commands to be invoked on the remote buildslave associated with
that Builder. The first step is almost always to perform a checkout of
the appropriate revision from the same VC system that produced the
Change. The rest generally perform a compile and run unit tests. As
each Step runs, the buildslave reports back command output and return
status to the buildmaster.

     <li>As the Build runs, status messages like &ldquo;Build Started&rdquo;, &ldquo;Step
Started&rdquo;, &ldquo;Build Finished&rdquo;, etc, are published to a collection of
Status Targets. One of these targets is usually the HTML &ldquo;Waterfall&rdquo;
display, which shows a chronological list of events, and summarizes
the results of the most recent build at the top of each column. 
Developers can periodically check this page to see how their changes
have fared. If they see red, they know that they've made a mistake and
need to fix it. If they see green, they know that they've done their
duty and don't need to worry about their change breaking anything.

     <li>If a MailNotifier status target is active, the completion of a build
will cause email to be sent to any developers whose Changes were
incorporated into this Build. The MailNotifier can be configured to
only send mail upon failing builds, or for builds which have just
transitioned from passing to failing. Other status targets can provide
similar real-time notification via different communication channels,
like IRC.

   </ul>

<div class="node">
<a name="Installation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Concepts">Concepts</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">2 Installation</h2>

<ul class="menu">
<li><a accesskey="1" href="#Buildbot-Components">Buildbot Components</a>
<li><a accesskey="2" href="#Requirements">Requirements</a>
<li><a accesskey="3" href="#Installing-the-code">Installing the code</a>
<li><a accesskey="4" href="#Running-Buildbot_0027s-Tests-_0028optional_0029">Running Buildbot's Tests (optional)</a>
<li><a accesskey="5" href="#Creating-a-buildmaster">Creating a buildmaster</a>
<li><a accesskey="6" href="#Upgrading-an-Existing-Buildmaster">Upgrading an Existing Buildmaster</a>
<li><a accesskey="7" href="#Creating-a-buildslave">Creating a buildslave</a>
<li><a accesskey="8" href="#Upgrading-an-Existing-Buildslave">Upgrading an Existing Buildslave</a>
<li><a accesskey="9" href="#Launching-the-daemons">Launching the daemons</a>
<li><a href="#Logfiles">Logfiles</a>
<li><a href="#Shutdown">Shutdown</a>
<li><a href="#Maintenance">Maintenance</a>
<li><a href="#Troubleshooting">Troubleshooting</a>
<li><a href="#Contrib-Scripts">Contrib Scripts</a>
</ul>

<div class="node">
<a name="Buildbot-Components"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Requirements">Requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.1 Buildbot Components</h3>

<p>Buildbot is shipped in two components: the buildmaster (called <code>buildbot</code>
for legacy reasons) and the buildslave.  The buildslave component has far fewer
requirements, and is more broadly compatible than the buildmaster.  You will
need to carefully pick the environment in which to run your buildmaster, but
the buildslave should be able to run just about anywhere.

   <p>It is possible to install the buildmaster and buildslave on the same system,
although for anything but the smallest installation this arrangement will not
be very efficient.

<div class="node">
<a name="Requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installing-the-code">Installing the code</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Buildbot-Components">Buildbot Components</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.2 Requirements</h3>

<ul class="menu">
<li><a accesskey="1" href="#Common-Requirements">Common Requirements</a>
<li><a accesskey="2" href="#Buildmaster-Requirements">Buildmaster Requirements</a>
</ul>

<div class="node">
<a name="Common-Requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Buildmaster-Requirements">Buildmaster Requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Requirements">Requirements</a>

</div>

<h4 class="subsection">2.2.1 Common Requirements</h4>

<p>At a bare minimum, you'll need the following for both the buildmaster and a
buildslave:

     <ul>
<li>Python: http://www.python.org

     <p>Buildbot requires python-2.4 or later.

     <li>Twisted: http://twistedmatrix.com

     <p>Both the buildmaster and the buildslaves require Twisted-8.0.x or
later. As always, the most recent version is recommended.

     <p>Twisted is delivered as a collection of subpackages. You'll need at
least "Twisted" (the core package), and you'll also want TwistedMail,
TwistedWeb, and TwistedWords (for sending email, serving a web status
page, and delivering build status via IRC, respectively). You might
also want TwistedConch (for the encrypted Manhole debug port). Note
that Twisted requires ZopeInterface to be installed as well.

   </ul>

   <p>Of course, your project's build process will impose additional
requirements on the buildslaves. These hosts must have all the tools
necessary to compile and test your project's source code.

<h3 class="heading">Windows Support</h3>

<p>Buildbot - both master and slave - runs well natively on Windows.  The slave
runs well on Cygwin, but because of problems with SQLite on Cygwin, the master
does not.

   <p>Buildbot's windows testing is limited to the most recent Twisted and Python
versions.  For best results, use the most recent available versions of these
libraries on Windows.

   <p>Note that versions of MSys Git earlier than 1.7.3.1 are known to have problems
with incorrect exit statuses from git commands.  Always use the newest version
of MSys Git.

<div class="node">
<a name="Buildmaster-Requirements"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Common-Requirements">Common Requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Requirements">Requirements</a>

</div>

<h4 class="subsection">2.2.2 Buildmaster Requirements</h4>

     <ul>
<li>sqlite3: http://www.sqlite.org

     <p>Buildbot requires SQLite to store its state.  Version 3.3.8 or higher is
recommended, as earlier versions had trouble with contention for database
tables.

     <li>pysqlite: http://pypi.python.org/pypi/pysqlite

     <p>The SQLite Python package is required for python-2.5 and earlier (it is already
included in python-2.5 and later, but the version in python-2.5 has nasty bugs)

     <li>simplejson: http://pypi.python.org/pypi/simplejson

     <p>The simplejson package is required for python-2.5 and earlier (it is already
included as json in python-2.6 and later)

     <li>Jinja2: http://jinja.pocoo.org/

     <p>Buildbot requires Jinja version 2.1 or higher.

     <p>Jinja2 is a general purpose templating language and is used by Buildbot
to generate the HTML output.

     <li>SQLAlchemy: http://www.sqlalchemy.org/

     <p>Buildbot requires SQLAlchemy 0.6 or higher.  SQLAlchemy allows Buildbot to
build database schemas and queries for a wide variety of database systems.

     <li>SQLAlchemy-Migrate: http://code.google.com/p/sqlalchemy-migrate/

     <p>Buildbot requires SQLAlchemy-Migrate version 0.6 (exactly; as-yet unreleased
later versions may not work).  Buildbot uses SQLAlchemy-Migrate to manage
schema upgrades from version to version.

</ul>

<div class="node">
<a name="Installing-the-code"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Running-Buildbot_0027s-Tests-_0028optional_0029">Running Buildbot's Tests (optional)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Requirements">Requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.3 Installing the code</h3>

<h3 class="heading">The Distribution Packages</h3>

<p><a name="index-Packages-3"></a><a name="index-Installation-4"></a><a name="index-PyPI-5"></a>
Buildbot comes in two parts: <code>buildbot</code> (the master) and
<code>buildbot-slave</code> (the slave).  The two can be installed individually or
together.

<h3 class="heading">Installation From PyPI</h3>

<p>The easiest way to install Buildbot is using 'pip'.  For the master:
<pre class="example">     pip install buildbot
</pre>
   <p>and for the slave:

<pre class="example">     pip install buildbot-slave
</pre>
   <h3 class="heading">Installation From Tarballs</h3>

<p>Buildbot and Buildslave can also be installed using the standard python
<code>distutils</code> process. For either component (buildbot or buildbot-slave),
after unpacking the tarball, the process is:

<pre class="example">     python setup.py build
     python setup.py install
</pre>
   <p>where the install step may need to be done as root. This will put the bulk of
the code in somewhere like <code>/usr/lib/python2.3/site-packages/buildbot</code>. It
will also install the <code>buildbot</code> command-line tool in
<code>/usr/bin/buildbot</code>.

   <p>If the environment variable <code>$NO_INSTALL_REQS</code> is set to '1', then
<code>setup.py</code> will not try to install Buildbot's requirements.  This is
usually only useful when building a Buildbot package.

   <p>To test this, shift to a different directory (like <code>/tmp</code>), and run:

<pre class="example">     buildbot --version
     # or
     buildslave --version
</pre>
   <p>If it shows you the versions of Buildbot and Twisted, the install went
ok. If it says <code>no such command</code> or it gets an <code>ImportError</code>
when it tries to load the libaries, then something went wrong. 
<code>pydoc buildbot</code> is another useful diagnostic tool.

   <p>Windows users will find these files in other places. You will need to
make sure that python can find the libraries, and will probably find
it convenient to have <code>buildbot</code> on your PATH.

<div class="node">
<a name="Running-Buildbot's-Tests-(optional)"></a>
<a name="Running-Buildbot_0027s-Tests-_0028optional_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Creating-a-buildmaster">Creating a buildmaster</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installing-the-code">Installing the code</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.4 Running Buildbot's Tests (optional)</h3>

<p>If you wish, you can run the buildbot unit test suite.  First, ensure you have
the <a href="http://pypi.python.org/pypi/mock">mock</a> Python module installed from
PyPi.  This module is not required for ordinary Buildbot operation - only to
run the tests.  Note that this is not the same as the Fedora <code>mock</code>
package!  You can check with

<pre class="example">     python -mmock
</pre>
   <p>Then, run the tests:

<pre class="example">     PYTHONPATH=. trial buildbot.test
     # or
     PYTHONPATH=. trial buildslave.test
</pre>
   <p>Nothing should fail, although a few might be skipped.

   <p>If any of the tests fail for reasons other than a missing <code>mock</code>, you
should stop and investigate the cause before continuing the installation
process, as it will probably be easier to track down the bug early.  In most
cases, the problem is incorrectly installed Python modules or a badly
configured PYTHONPATH.  This may be a good time to contact the Buildbot
developers for help.

   <p>If you cannot or do not wish to install the buildbot into a site-wide location
like <samp><span class="file">/usr</span></samp> or <samp><span class="file">/usr/local</span></samp>, you can also install it into the
account's home directory or any other location using a tool like
<a href="http://pypi.python.org/pypi/virtualenv">virtualenv</a>.

<div class="node">
<a name="Creating-a-buildmaster"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Upgrading-an-Existing-Buildmaster">Upgrading an Existing Buildmaster</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Running-Buildbot_0027s-Tests-_0028optional_0029">Running Buildbot's Tests (optional)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.5 Creating a buildmaster</h3>

<p>As you learned earlier (see <a href="#System-Architecture">System Architecture</a>), the buildmaster
runs on a central host (usually one that is publically visible, so
everybody can check on the status of the project), and controls all
aspects of the buildbot system.

   <p>You will probably wish to create a separate user account for the buildmaster,
perhaps named <code>buildmaster</code>.  Do not run the buildmaster as root!

   <p>You also need to choose a directory for the buildmaster, called the
<code>basedir</code>. This directory will be owned by the buildmaster.  It will
contain configuration, the adtabase, and status information - including
logfiles.  On a large buildmaster this directory will see a lot of activity, so
it should be on a disk with adequate space and speed.

   <p>Once you've picked a basedir, use the <samp><span class="command">buildbot
create-master</span></samp> command to create the directory and populate it with
startup files:

<pre class="example">     buildbot create-master -r <var>basedir</var>
</pre>
   <p>You will need to create a configuration file (see <a href="#Configuration">Configuration</a>)
before starting the buildmaster. Most of the rest of this manual is
dedicated to explaining how to do this. A sample configuration file is
placed in the working directory, named <samp><span class="file">master.cfg.sample</span></samp>, which
can be copied to <samp><span class="file">master.cfg</span></samp> and edited to suit your purposes.

   <p>(Internal details: This command creates a file named
<samp><span class="file">buildbot.tac</span></samp> that contains all the state necessary to create
the buildmaster. Twisted has a tool called <code>twistd</code> which can use
this .tac file to create and launch a buildmaster instance. twistd
takes care of logging and daemonization (running the program in the
background). <samp><span class="file">/usr/bin/buildbot</span></samp> is a front end which runs twistd
for you.)

   <p>In addition to <samp><span class="file">buildbot.tac</span></samp>, a small <samp><span class="file">Makefile.sample</span></samp> is
installed. This can be used as the basis for customized daemon startup,
See <a href="#Launching-the-daemons">Launching the daemons</a>.

<h3 class="heading">Using MySQL</h3>

<p>If you want to use MySQL as the database backend for your Buildbot, add the
<code>--db</code> option to the <code>create-master</code> invocation to specify the
connection string for the MySQL database (see <a href="#Database-Specification">Database Specification</a>), and
make sure that the same URL appears in the <code>C['db_url']</code> parameter in your
configuration file.

<h3 class="heading">Buildmaster Options</h3>

<p>This section lists options to the <samp><span class="command">create-master</span></samp> command. 
You can also type <samp><span class="command">buildslave create-slave --help</span></samp> for an up-to-the-moment summary.

     <dl>
<dt><code>--force</code><dd>With this option, <samp><span class="command">create-master</span></samp> will re-use an existing master
directory.

     <br><dt><code>--no-logrotate</code><dd>This disables internal buildslave log management mechanism. With this option
buildslave does not override the default logfile name and its behaviour giving
a possibility to control those with command-line options of twistd daemon.

     <br><dt><code>--relocatable</code><dd>This creates a "relocatable" buildbot.tac, which uses relative paths instead
of absolute paths, so that the buildmaster directory can be moved about.

     <br><dt><code>--config</code><dd>The name of the configuration file to use.  This configuration file need not
reside in the buildmaster directory.

     <br><dt><code>--log-size</code><dd>This is the size in bytes when to rotate the Twisted log files.  The default is
10MiB.

     <br><dt><code>--log-count</code><dd>This is the number of log rotations to keep around. You can either
specify a number or <code>None</code> to keep all <samp><span class="file">twistd.log</span></samp> files
around.  The default is 10.

     <br><dt><code>--db</code><dd>The database that the Buildmaster should use.  Note that the same value must be
added to the configuration file.

   </dl>

<div class="node">
<a name="Upgrading-an-Existing-Buildmaster"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Creating-a-buildslave">Creating a buildslave</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Creating-a-buildmaster">Creating a buildmaster</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.6 Upgrading an Existing Buildmaster</h3>

<p>If you have just installed a new version of the Buildbot code, and you
have buildmasters that were created using an older version, you'll
need to upgrade these buildmasters before you can use them. The
upgrade process adds and modifies files in the buildmaster's base
directory to make it compatible with the new code.

<pre class="example">     buildbot upgrade-master <var>basedir</var>
</pre>
   <p>This command will also scan your <samp><span class="file">master.cfg</span></samp> file for
incompatibilities (by loading it and printing any errors or deprecation
warnings that occur). Each buildbot release tries to be compatible
with configurations that worked cleanly (i.e. without deprecation
warnings) on the previous release: any functions or classes that are
to be removed will first be deprecated in a release, to give you a
chance to start using the replacement.

   <p>The <code>upgrade-master</code> command is idempotent. It is safe to run it
multiple times. After each upgrade of the buildbot code, you should
use <code>upgrade-master</code> on all your buildmasters.

   <p>In general, Buildbot slaves and masters can be upgraded independently, although
some new features will not be available, depending on the master and slave
versions.

   <p>Beyond this general information, read all of the sections below that apply to
versions through which you are upgrading.

<h3 class="heading">Version-specific Notes</h3>

<ul class="menu">
<li><a accesskey="1" href="#Upgrading-a-Buildmaster-to-Buildbot_002d0_002e7_002e6">Upgrading a Buildmaster to Buildbot-0.7.6</a>
<li><a accesskey="2" href="#Upgrading-a-Buildmaster-to-Buildbot_002d0_002e8_002e0">Upgrading a Buildmaster to Buildbot-0.8.0</a>
<li><a accesskey="3" href="#Upgrading-a-Buildmaster-to-Later-Versions">Upgrading a Buildmaster to Later Versions</a>
</ul>

<div class="node">
<a name="Upgrading-a-Buildmaster-to-Buildbot-0.7.6"></a>
<a name="Upgrading-a-Buildmaster-to-Buildbot_002d0_002e7_002e6"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Upgrading-a-Buildmaster-to-Buildbot_002d0_002e8_002e0">Upgrading a Buildmaster to Buildbot-0.8.0</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Upgrading-an-Existing-Buildmaster">Upgrading an Existing Buildmaster</a>

</div>

<h4 class="subsection">2.6.1 Upgrading a Buildmaster to Buildbot-0.7.6</h4>

<p>The 0.7.6 release introduced the <samp><span class="file">public_html/</span></samp> directory, which
contains <samp><span class="file">index.html</span></samp> and other files served by the
<code>WebStatus</code> and <code>Waterfall</code> status displays. The
<code>upgrade-master</code> command will create these files if they do not
already exist. It will not modify existing copies, but it will write a
new copy in e.g. <samp><span class="file">index.html.new</span></samp> if the new version differs from
the version that already exists.

<div class="node">
<a name="Upgrading-a-Buildmaster-to-Buildbot-0.8.0"></a>
<a name="Upgrading-a-Buildmaster-to-Buildbot_002d0_002e8_002e0"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Upgrading-a-Buildmaster-to-Later-Versions">Upgrading a Buildmaster to Later Versions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrading-a-Buildmaster-to-Buildbot_002d0_002e7_002e6">Upgrading a Buildmaster to Buildbot-0.7.6</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Upgrading-an-Existing-Buildmaster">Upgrading an Existing Buildmaster</a>

</div>

<h4 class="subsection">2.6.2 Upgrading a Buildmaster to Buildbot-0.8.0</h4>

<p>Buildbot-0.8.0 introduces a database backend, which is SQLite by default.  The
<code>upgrade-master</code> command will automatically create and populate this
database with the changes the buildmaster has seen.  Note that, as of this
release, build history is <i>not</i> contained in the database, and is thus not
migrated.

   <p>The upgrade process renames the Changes pickle (<code>$basedir/changes.pck</code>) to
<code>changes.pck.old</code> once the upgrade is complete.  To reverse the upgrade,
simply downgrade Buildbot and move this file back to its original name.  You
may also wish to delete the state database (<code>state.sqlite</code>).

<h3 class="heading">Upgrading into a non-SQLite database</h3>

<p>If you are not using sqlite, you will need to add an entry into your
<samp><span class="file">master.cfg</span></samp> to reflect the database version you are using. The upgrade
process does <i>not</i> edit your <samp><span class="file">master.cfg</span></samp> for you. So something like:

<pre class="example">     # for using mysql:
     c['db_url'] = 'mysql://bbuser:&lt;password&gt;@localhost/buildbot'
</pre>
   <p>Once the parameter has been added, invoke <code>upgrade-master</code> with the
<code>--db</code> parameter, e.g.,

<pre class="example">     buildbot upgrade-master --db=mysql://bbuser:&lt;password&gt;@localhost/buildbot
</pre>
   <p>The <code>--db</code> option must match the <code>c['db_url']</code> exactly.

   <p>See see <a href="#Database-Specification">Database Specification</a> for more options to specify a database.

<h3 class="heading">Change Encoding Issues</h3>

<p>The upgrade process assumes that strings in your Changes pickle are encoded in
UTF-8 (or plain ASCII).  If this is not the case, and if there are non-UTF-8
characters in the pickle, the upgrade will fail with a suitable error message. 
If this occurs, you have two options.  If the change history is not important
to your purpose, you can simply delete <code>changes.pck</code>.

   <p>If you would like to keep the change history, then you will need to figure out
which encoding is in use, and use <code>contrib/fix_changes_pickle_encoding.py</code>
(see <a href="#Contrib-Scripts">Contrib Scripts</a>) to rewrite the changes pickle into Unicode before
upgrading the master.  A typical invocation (with Mac-Roman encoding) might
look like:

<pre class="example">     $ python $buildbot/contrib/fix_changes_pickle_encoding.py changes.pck macroman
     decoding bytestrings in changes.pck using macroman
     converted 11392 strings
     backing up changes.pck to changes.pck.old
</pre>
   <p>If your Changes pickle uses multiple encodings, you're on your own, but the
script in contrib may provide a good starting point for the fix.

<div class="node">
<a name="Upgrading-a-Buildmaster-to-Later-Versions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrading-a-Buildmaster-to-Buildbot_002d0_002e8_002e0">Upgrading a Buildmaster to Buildbot-0.8.0</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Upgrading-an-Existing-Buildmaster">Upgrading an Existing Buildmaster</a>

</div>

<h4 class="subsection">2.6.3 Upgrading a Buildmaster to Later Versions</h4>

<p>Up to Buildbot version 0.8.4p1, no further steps beyond those described
above are required.

<div class="node">
<a name="Creating-a-buildslave"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Upgrading-an-Existing-Buildslave">Upgrading an Existing Buildslave</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrading-an-Existing-Buildmaster">Upgrading an Existing Buildmaster</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.7 Creating a buildslave</h3>

<p>Typically, you will be adding a buildslave to an existing buildmaster,
to provide additional architecture coverage. The buildbot
administrator will give you several pieces of information necessary to
connect to the buildmaster. You should also be somewhat familiar with
the project being tested, so you can troubleshoot build problems
locally.

   <p>The buildbot exists to make sure that the project's stated &ldquo;how to
build it&rdquo; process actually works. To this end, the buildslave should
run in an environment just like that of your regular developers. 
Typically the project build process is documented somewhere
(<samp><span class="file">README</span></samp>, <samp><span class="file">INSTALL</span></samp>, etc), in a document that should
mention all library dependencies and contain a basic set of build
instructions. This document will be useful as you configure the host
and account in which the buildslave runs.

   <p>Here's a good checklist for setting up a buildslave:

     <ol type=1 start=1>
<li>Set up the account

     <p>It is recommended (although not mandatory) to set up a separate user
account for the buildslave. This account is frequently named
<code>buildbot</code> or <code>buildslave</code>. This serves to isolate your
personal working environment from that of the slave's, and helps to
minimize the security threat posed by letting possibly-unknown
contributors run arbitrary code on your system. The account should
have a minimum of fancy init scripts.

     <li>Install the buildbot code

     <p>Follow the instructions given earlier (see <a href="#Installing-the-code">Installing the code</a>). 
If you use a separate buildslave account, and you didn't install the
buildbot code to a shared location, then you will need to install it
with <code>--home=~</code> for each account that needs it.

     <li>Set up the host

     <p>Make sure the host can actually reach the buildmaster. Usually the
buildmaster is running a status webserver on the same machine, so
simply point your web browser at it and see if you can get there. 
Install whatever additional packages or libraries the project's
INSTALL document advises. (or not: if your buildslave is supposed to
make sure that building without optional libraries still works, then
don't install those libraries).

     <p>Again, these libraries don't necessarily have to be installed to a
site-wide shared location, but they must be available to your build
process. Accomplishing this is usually very specific to the build
process, so installing them to <samp><span class="file">/usr</span></samp> or <samp><span class="file">/usr/local</span></samp> is
usually the best approach.

     <li>Test the build process

     <p>Follow the instructions in the INSTALL document, in the buildslave's
account. Perform a full CVS (or whatever) checkout, configure, make,
run tests, etc. Confirm that the build works without manual fussing. 
If it doesn't work when you do it by hand, it will be unlikely to work
when the buildbot attempts to do it in an automated fashion.

     <li>Choose a base directory

     <p>This should be somewhere in the buildslave's account, typically named
after the project which is being tested. The buildslave will not touch
any file outside of this directory. Something like <samp><span class="file">~/Buildbot</span></samp>
or <samp><span class="file">~/Buildslaves/fooproject</span></samp> is appropriate.

     <li>Get the buildmaster host/port, botname, and password

     <p>When the buildbot admin configures the buildmaster to accept and use
your buildslave, they will provide you with the following pieces of
information:

          <ul>
<li>your buildslave's name
<li>the password assigned to your buildslave
<li>the hostname and port number of the buildmaster, i.e. buildbot.example.org:8007
</ul>

     <li>Create the buildslave

     <p>Now run the 'buildslave' command as follows:

     <pre class="example">          buildslave create-slave <var>BASEDIR</var> <var>MASTERHOST</var>:<var>PORT</var> <var>SLAVENAME</var> <var>PASSWORD</var>
</pre>
     <p>This will create the base directory and a collection of files inside,
including the <samp><span class="file">buildbot.tac</span></samp> file that contains all the
information you passed to the <code>buildbot</code> command.

     <li>Fill in the hostinfo files

     <p>When it first connects, the buildslave will send a few files up to the
buildmaster which describe the host that it is running on. These files
are presented on the web status display so that developers have more
information to reproduce any test failures that are witnessed by the
buildbot. There are sample files in the <samp><span class="file">info</span></samp> subdirectory of
the buildbot's base directory. You should edit these to correctly
describe you and your host.

     <p><samp><span class="file">BASEDIR/info/admin</span></samp> should contain your name and email address. 
This is the &ldquo;buildslave admin address&rdquo;, and will be visible from the
build status page (so you may wish to munge it a bit if
address-harvesting spambots are a concern).

     <p><samp><span class="file">BASEDIR/info/host</span></samp> should be filled with a brief description of
the host: OS, version, memory size, CPU speed, versions of relevant
libraries installed, and finally the version of the buildbot code
which is running the buildslave.

     <p>The optional <samp><span class="file">BASEDIR/info/access_uri</span></samp> can specify a URI which will
connect a user to the machine.  Many systems accept <code>ssh://hostname</code> URIs
for this purpose.

     <p>If you run many buildslaves, you may want to create a single
<samp><span class="file">~buildslave/info</span></samp> file and share it among all the buildslaves
with symlinks.

        </ol>

<ul class="menu">
<li><a accesskey="1" href="#Buildslave-Options">Buildslave Options</a>
<li><a accesskey="2" href="#Other-Buildslave-Configuration">Other Buildslave Configuration</a>
</ul>

<div class="node">
<a name="Buildslave-Options"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Other-Buildslave-Configuration">Other Buildslave Configuration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Creating-a-buildslave">Creating a buildslave</a>

</div>

<h4 class="subsection">2.7.1 Buildslave Options</h4>

<p>There are a handful of options you might want to use when creating the
buildslave with the <samp><span class="command">buildslave create-slave &lt;options&gt; DIR &lt;params&gt;</span></samp>
command. You can type <samp><span class="command">buildslave create-slave --help</span></samp> for a summary. 
To use these, just include them on the <samp><span class="command">buildslave create-slave</span></samp>
command line, like this:

<pre class="example">     buildslave create-slave --umask=022 ~/buildslave buildmaster.example.org:42012 myslavename mypasswd
</pre>
     <dl>
<dt><code>--no-logrotate</code><dd>This disables internal buildslave log management mechanism. With this option
buildslave does not override the default logfile name and its behaviour giving
a possibility to control those with command-line options of twistd daemon.

     <br><dt><code>--usepty</code><dd>This is a boolean flag that tells the buildslave whether to launch child
processes in a PTY or with regular pipes (the default) when the master does not
specify.  This option is deprecated, as this particular parameter is better
specified on the master.

     <br><dt><code>--umask</code><dd>This is a string (generally an octal representation of an integer)
which will cause the buildslave process' &ldquo;umask&rdquo; value to be set
shortly after initialization. The &ldquo;twistd&rdquo; daemonization utility
forces the umask to 077 at startup (which means that all files created
by the buildslave or its child processes will be unreadable by any
user other than the buildslave account). If you want build products to
be readable by other accounts, you can add <code>--umask=022</code> to tell
the buildslave to fix the umask after twistd clobbers it. If you want
build products to be <em>writable</em> by other accounts too, use
<code>--umask=000</code>, but this is likely to be a security problem.

     <br><dt><code>--keepalive</code><dd>This is a number that indicates how frequently &ldquo;keepalive&rdquo; messages
should be sent from the buildslave to the buildmaster, expressed in
seconds. The default (600) causes a message to be sent to the
buildmaster at least once every 10 minutes. To set this to a lower
value, use e.g. <code>--keepalive=120</code>.

     <p>If the buildslave is behind a NAT box or stateful firewall, these
messages may help to keep the connection alive: some NAT boxes tend to
forget about a connection if it has not been used in a while. When
this happens, the buildmaster will think that the buildslave has
disappeared, and builds will time out. Meanwhile the buildslave will
not realize than anything is wrong.

     <br><dt><code>--maxdelay</code><dd>This is a number that indicates the maximum amount of time the
buildslave will wait between connection attempts, expressed in
seconds. The default (300) causes the buildslave to wait at most 5
minutes before trying to connect to the buildmaster again.

     <br><dt><code>--log-size</code><dd>This is the size in bytes when to rotate the Twisted log files.  The default is
10MiB.

     <br><dt><code>--log-count</code><dd>This is the number of log rotations to keep around. You can either
specify a number or <code>None</code> to keep all <samp><span class="file">twistd.log</span></samp> files
around.  The default is 10.

   </dl>

<div class="node">
<a name="Other-Buildslave-Configuration"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Buildslave-Options">Buildslave Options</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Creating-a-buildslave">Creating a buildslave</a>

</div>

<h4 class="subsection">2.7.2 Other Buildslave Configuration</h4>

     <dl>
<dt><code>unicode_encoding</code><dd>This represents the encoding that buildbot should use when converting unicode
commandline arguments into byte strings in order to pass to the operating
system when spawning new processes.

     <p>The default value is what python's sys.getfilesystemencoding() returns, which
on Windows is 'mbcs', on Mac OSX is 'utf-8', and on Unix depends on your locale
settings.

     <p>If you need a different encoding, this can be changed in your build slave's
buildbot.tac file by adding a unicode_encoding argument to the BuildSlave
constructor.

     <br><dt><code>allow_shutdown</code><dd>allow_shutdown can be passed to the BuildSlave constructor in buildbot.tac.  If
set, it allows the buildslave to initiate a graceful shutdown, meaning that it
will ask the master to shut down the slave when the current build, if any, is
complete.

     <p>Setting allow_shutdown to 'file' will cause the buildslave to watch
'shutdown.stamp' in basedir for updates to its mtime.  When the mtime changes,
the slave will request a graceful shutdown from the master.  The file does not
need to exist prior to starting the slave.

     <p>Setting allow_shutdown to 'signal' will set up a SIGHUP handler to start a
graceful shutdown.  When the signal is received, the slave will request a
graceful shutdown from the master.

     <p>The default value is None, in which case this feature will be disabled.

     <p>Both master and slave must be at least version 0.8.3 for this feature to work.

     <pre class="example">          s = BuildSlave(buildmaster_host, port, slavename, passwd, basedir,
                         keepalive, usepty, umask=umask, maxdelay=maxdelay,
                         unicode_encoding='utf-8', allow_shutdown='signal')
</pre>
     </dl>

<div class="node">
<a name="Upgrading-an-Existing-Buildslave"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Launching-the-daemons">Launching the daemons</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Creating-a-buildslave">Creating a buildslave</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.8 Upgrading an Existing Buildslave</h3>

<p>If you have just installed a new version of Buildbot-slave, you may need to
take some steps to upgrade it.  If you are upgrading to version 0.8.2 or later,
you can run

<pre class="example">     buildslave upgrade-slave /path/to/buildslave/dir
</pre>
   <h3 class="heading">Version-specific Notes</h3>

<ul class="menu">
<li><a accesskey="1" href="#Upgrading-a-Buildslave-to-Buildbot_002dslave_002d0_002e8_002e1">Upgrading a Buildslave to Buildbot-slave-0.8.1</a>
</ul>

<div class="node">
<a name="Upgrading-a-Buildslave-to-Buildbot-slave-0.8.1"></a>
<a name="Upgrading-a-Buildslave-to-Buildbot_002dslave_002d0_002e8_002e1"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#Upgrading-an-Existing-Buildslave">Upgrading an Existing Buildslave</a>

</div>

<h4 class="subsection">2.8.1 Upgrading a Buildslave to Buildbot-slave-0.8.1</h4>

<p>Before Buildbot version 0.8.1, the Buildbot master and slave were part of the
same distribution.  As of version 0.8.1, the buildslave is a separate
distribution.

   <p>As of this release, you will need to install <i>buildbot-slave</i> to run a slave.

   <p>Any automatic startup scripts that had run <code>buildbot start</code> for previous versions
should be changed to run <code>buildslave start</code> instead.

   <p>If you are running a version later than 0.8.1, then you can skip the remainder
of this section: the <code>upgrade-slave</code> command will take care of this.  If
you are upgrading directly to 0.8.1, read on.

   <p>The existing <code>buildbot.tac</code> for any buildslaves running older versions
will need to be edited or replaced.  If the loss of cached buildslave state
(e.g., for Source steps in copy mode) is not problematic, the easiest solution
is to simply delete the slave directory and re-run <code>buildslave
create-slave</code>.

   <p>If deleting the slave directory is problematic, the change to
<code>buildbot.tac</code> is simple.  On line 3, replace

<pre class="example">     from buildbot.slave.bot import BuildSlave
</pre>
   <p>with

<pre class="example">     from buildslave.bot import BuildSlave
</pre>
   <p>After this change, the buildslave should start as usual.

<div class="node">
<a name="Launching-the-daemons"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Logfiles">Logfiles</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrading-an-Existing-Buildslave">Upgrading an Existing Buildslave</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.9 Launching the daemons</h3>

<p>Both the buildmaster and the buildslave run as daemon programs. To
launch them, pass the working directory to the <code>buildbot</code>
and <code>buildslave</code> commands, as appropriate:

<pre class="example">     # start a master
     buildbot start <var>BASEDIR</var>
     # start a slave
     buildslave start <var>SLAVE_BASEDIR</var>
</pre>
   <p>The <var>BASEDIR</var> is option and can be omitted if the current directory
contains the buildbot configuration (the <samp><span class="file">buildbot.tac</span></samp> file).

<pre class="example">     buildbot start
</pre>
   <p>This command will start the daemon and then return, so normally it
will not produce any output. To verify that the programs are indeed
running, look for a pair of files named <samp><span class="file">twistd.log</span></samp> and
<samp><span class="file">twistd.pid</span></samp> that should be created in the working directory. 
<samp><span class="file">twistd.pid</span></samp> contains the process ID of the newly-spawned daemon.

   <p>When the buildslave connects to the buildmaster, new directories will
start appearing in its base directory. The buildmaster tells the slave
to create a directory for each Builder which will be using that slave. 
All build operations are performed within these directories: CVS
checkouts, compiles, and tests.

   <p>Once you get everything running, you will want to arrange for the
buildbot daemons to be started at boot time. One way is to use
<code>cron</code>, by putting them in a @reboot crontab entry<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>:

<pre class="example">     @reboot buildbot start <var>BASEDIR</var>
</pre>
   <p>When you run <samp><span class="command">crontab</span></samp> to set this up, remember to do it as
the buildmaster or buildslave account! If you add this to your crontab
when running as your regular account (or worse yet, root), then the
daemon will run as the wrong user, quite possibly as one with more
authority than you intended to provide.

   <p>It is important to remember that the environment provided to cron jobs
and init scripts can be quite different that your normal runtime. 
There may be fewer environment variables specified, and the PATH may
be shorter than usual. It is a good idea to test out this method of
launching the buildslave by using a cron job with a time in the near
future, with the same command, and then check <samp><span class="file">twistd.log</span></samp> to
make sure the slave actually started correctly. Common problems here
are for <samp><span class="file">/usr/local</span></samp> or <samp><span class="file">~/bin</span></samp> to not be on your
<code>PATH</code>, or for <code>PYTHONPATH</code> to not be set correctly. 
Sometimes <code>HOME</code> is messed up too.

   <p>Some distributions may include conveniences to make starting buildbot
at boot time easy.  For instance, with the default buildbot package in
Debian-based distributions, you may only need to modify
<code>/etc/default/buildbot</code> (see also <code>/etc/init.d/buildbot</code>, which
reads the configuration in <code>/etc/default/buildbot</code>).

   <p>Buildbot also comes with its own init scripts that provide support for
controlling multi-slave and multi-master setups (mostly because they are based
on the init script from the debian package).  With a little modification these
scripts can be used both on debian and rhel based distributions and may thus
prove helpful to package maintainers who are working on buildbot (or those that
haven't yet split buildbot into master and slave packages).

<pre class="example">     # install as /etc/default|sysconfig/buildslave
     master/contrib/init-scripts/buildslave.default
     
     # install /etc/default|sysconfig/buildslave
     master/contrib/init-scripts/buildmaster.default
     
     # install as /etc/init.d/buildslave
     slave/contrib/init-scripts/buildslave.init.sh
     
     # install as /etc/init.d/buildmaster
     slave/contrib/init-scripts/buildmaster.init.sh
     
     # ... and tell sysvinit about them
     chkconfig buildmaster reset
     # ... or
     update-rc.d buildmaster defaults
</pre>
   <div class="node">
<a name="Logfiles"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Shutdown">Shutdown</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Launching-the-daemons">Launching the daemons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.10 Logfiles</h3>

<p><a name="index-logfiles-6"></a>
While a buildbot daemon runs, it emits text to a logfile, named
<samp><span class="file">twistd.log</span></samp>. A command like <code>tail -f twistd.log</code> is useful
to watch the command output as it runs.

   <p>The buildmaster will announce any errors with its configuration file
in the logfile, so it is a good idea to look at the log at startup
time to check for any problems. Most buildmaster activities will cause
lines to be added to the log.

<div class="node">
<a name="Shutdown"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Maintenance">Maintenance</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Logfiles">Logfiles</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.11 Shutdown</h3>

<p>To stop a buildmaster or buildslave manually, use:

<pre class="example">     buildbot stop <var>BASEDIR</var>
     # or
     buildslave stop <var>SLAVE_BASEDIR</var>
</pre>
   <p>This simply looks for the <samp><span class="file">twistd.pid</span></samp> file and kills whatever
process is identified within.

   <p>At system shutdown, all processes are sent a <code>SIGKILL</code>. The
buildmaster and buildslave will respond to this by shutting down
normally.

   <p>The buildmaster will respond to a <code>SIGHUP</code> by re-reading its
config file. Of course, this only works on unix-like systems with
signal support, and won't work on Windows. The following shortcut is
available:

<pre class="example">     buildbot reconfig <var>BASEDIR</var>
</pre>
   <p>When you update the Buildbot code to a new release, you will need to
restart the buildmaster and/or buildslave before it can take advantage
of the new code. You can do a <code>buildbot stop </code><var>BASEDIR</var> and
<code>buildbot start </code><var>BASEDIR</var> in quick succession, or you can
use the <code>restart</code> shortcut, which does both steps for you:

<pre class="example">     buildbot restart <var>BASEDIR</var>
</pre>
   <p>Buildslaves can similarly be restarted with:

<pre class="example">     buildslave restart <var>BASEDIR</var>
</pre>
   <p>There are certain configuration changes that are not handled cleanly
by <code>buildbot reconfig</code>. If this occurs, <code>buildbot restart</code>
is a more robust tool to fully switch over to the new configuration.

   <p><code>buildbot restart</code> may also be used to start a stopped Buildbot
instance. This behaviour is useful when writing scripts that stop, start
and restart Buildbot.

   <p>A buildslave may also be gracefully shutdown from the
see <a href="#WebStatus">WebStatus</a> status plugin. This is useful to shutdown a
buildslave without interrupting any current builds. The buildmaster
will wait until the buildslave is finished all its current builds, and
will then tell the buildslave to shutdown.

<div class="node">
<a name="Maintenance"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Troubleshooting">Troubleshooting</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Shutdown">Shutdown</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.12 Maintenance</h3>

<p>The buildmaster can be configured to send out email notifications when a
slave has been offline for a while.  Be sure to configure the buildmaster
with a contact email address for each slave so these notifications are sent
to someone who can bring it back online.

   <p>If you find you can no longer provide a buildslave to the project, please
let the project admins know, so they can put out a call for a
replacement.

   <p>The Buildbot records status and logs output continually, each time a
build is performed. The status tends to be small, but the build logs
can become quite large. Each build and log are recorded in a separate
file, arranged hierarchically under the buildmaster's base directory. 
To prevent these files from growing without bound, you should
periodically delete old build logs. A simple cron job to delete
anything older than, say, two weeks should do the job. The only trick
is to leave the <samp><span class="file">buildbot.tac</span></samp> and other support files alone, for
which find's <code>-mindepth</code> argument helps skip everything in the
top directory. You can use something like the following:

<pre class="example">     @weekly cd BASEDIR &amp;&amp; find . -mindepth 2 -ipath './public_html/*' -prune -o -type f -mtime +14 -exec rm {} \;
     @weekly cd BASEDIR &amp;&amp; find twistd.log* -mtime +14 -exec rm {} \;
</pre>
   <p>Alternatively, you can configure a maximum number of old logs to be kept
using the <code>--log-count</code> command line option when running <code>buildbot
create-slave</code> or <code>buildbot create-master</code>.

<div class="node">
<a name="Troubleshooting"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Contrib-Scripts">Contrib Scripts</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Maintenance">Maintenance</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.13 Troubleshooting</h3>

<p>Here are a few hints on diagnosing common problems.

<ul class="menu">
<li><a accesskey="1" href="#Starting-the-buildslave">Starting the buildslave</a>
<li><a accesskey="2" href="#Connecting-to-the-buildmaster">Connecting to the buildmaster</a>
</ul>

<div class="node">
<a name="Starting-the-buildslave"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Connecting-to-the-buildmaster">Connecting to the buildmaster</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h4 class="subsection">2.13.1 Starting the buildslave</h4>

<p>Cron jobs are typically run with a minimal shell (<samp><span class="file">/bin/sh</span></samp>, not
<samp><span class="file">/bin/bash</span></samp>), and tilde expansion is not always performed in such
commands. You may want to use explicit paths, because the <code>PATH</code>
is usually quite short and doesn't include anything set by your
shell's startup scripts (<samp><span class="file">.profile</span></samp>, <samp><span class="file">.bashrc</span></samp>, etc). If
you've installed buildbot (or other python libraries) to an unusual
location, you may need to add a <code>PYTHONPATH</code> specification (note
that python will do tilde-expansion on <code>PYTHONPATH</code> elements by
itself). Sometimes it is safer to fully-specify everything:

<pre class="example">     @reboot PYTHONPATH=~/lib/python /usr/local/bin/buildbot start /usr/home/buildbot/basedir
</pre>
   <p>Take the time to get the @reboot job set up. Otherwise, things will work
fine for a while, but the first power outage or system reboot you have will
stop the buildslave with nothing but the cries of sorrowful developers to
remind you that it has gone away.

<div class="node">
<a name="Connecting-to-the-buildmaster"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Starting-the-buildslave">Starting the buildslave</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h4 class="subsection">2.13.2 Connecting to the buildmaster</h4>

<p>If the buildslave cannot connect to the buildmaster, the reason should
be described in the <samp><span class="file">twistd.log</span></samp> logfile. Some common problems
are an incorrect master hostname or port number, or a mistyped bot
name or password. If the buildslave loses the connection to the
master, it is supposed to attempt to reconnect with an
exponentially-increasing backoff. Each attempt (and the time of the
next attempt) will be logged. If you get impatient, just manually stop
and re-start the buildslave.

   <p>When the buildmaster is restarted, all slaves will be disconnected, and will
attempt to reconnect as usual. The reconnect time will depend upon how long the
buildmaster is offline (i.e. how far up the exponential backoff curve the
slaves have travelled). Again, <code>buildslave restart </code><var>BASEDIR</var> will
speed up the process.

<div class="node">
<a name="Contrib-Scripts"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Troubleshooting">Troubleshooting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<h3 class="section">2.14 Contrib Scripts</h3>

<p>While some features of Buildbot are included in the distribution, others are
only available in <code>contrib/</code> in the source directory.  The latest versions
of such scripts are available at
<a href="http://github.com/buildbot/buildbot/tree/master/master/contrib">http://github.com/buildbot/buildbot/tree/master/master/contrib</a>.

<div class="node">
<a name="Concepts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Configuration">Configuration</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installation">Installation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">3 Concepts</h2>

<p>This chapter defines some of the basic concepts that the Buildbot
uses. You'll need to understand how the Buildbot sees the world to
configure it properly.

<ul class="menu">
<li><a accesskey="1" href="#Version-Control-Systems">Version Control Systems</a>
<li><a accesskey="2" href="#Scheduling-Builds">Scheduling Builds</a>
<li><a accesskey="3" href="#BuildSet">BuildSet</a>
<li><a accesskey="4" href="#BuildRequest">BuildRequest</a>
<li><a accesskey="5" href="#Builder">Builder</a>
<li><a accesskey="6" href="#Build">Build</a>
<li><a accesskey="7" href="#Users">Users</a>
<li><a accesskey="8" href="#Build-Properties">Build Properties</a>
</ul>

<div class="node">
<a name="Version-Control-Systems"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Scheduling-Builds">Scheduling Builds</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Concepts">Concepts</a>

</div>

<h3 class="section">3.1 Version Control Systems</h3>

<p><a name="index-Version-Control-7"></a>
These source trees come from a Version Control System of some kind. 
CVS and Subversion are two popular ones, but the Buildbot supports
others. All VC systems have some notion of an upstream
<code>repository</code> which acts as a server<a rel="footnote" href="#fn-2" name="fnd-2"><sup>2</sup></a>, from which clients
can obtain source trees according to various parameters. The VC
repository provides source trees of various projects, for different
branches, and from various points in time. The first thing we have to
do is to specify which source tree we want to get.

<ul class="menu">
<li><a accesskey="1" href="#Generalizing-VC-Systems">Generalizing VC Systems</a>
<li><a accesskey="2" href="#Source-Tree-Specifications">Source Tree Specifications</a>
<li><a accesskey="3" href="#How-Different-VC-Systems-Specify-Sources">How Different VC Systems Specify Sources</a>
<li><a accesskey="4" href="#Attributes-of-Changes">Attributes of Changes</a>
</ul>

<div class="node">
<a name="Generalizing-VC-Systems"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Source-Tree-Specifications">Source Tree Specifications</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Version-Control-Systems">Version Control Systems</a>

</div>

<h4 class="subsection">3.1.1 Generalizing VC Systems</h4>

<p>For the purposes of the Buildbot, we will try to generalize all VC
systems as having repositories that each provide sources for a variety
of projects. Each project is defined as a directory tree with source
files. The individual files may each have revisions, but we ignore
that and treat the project as a whole as having a set of revisions
(CVS is the only VC system still in widespread use that has
per-file revisions, as everything modern has moved to atomic tree-wide
changesets). Each time someone commits a change to the project, a new
revision becomes available. These revisions can be described by a
tuple with two items: the first is a branch tag, and the second is
some kind of revision stamp or timestamp. Complex projects may have
multiple branch tags, but there is always a default branch. The
timestamp may be an actual timestamp (such as the -D option to CVS),
or it may be a monotonically-increasing transaction number (such as
the change number used by SVN and P4, or the revision number used by
Bazaar, or a labeled tag used in CVS)<a rel="footnote" href="#fn-3" name="fnd-3"><sup>3</sup></a>. The SHA1 revision ID used by Mercurial, Git and Monotone is
also a kind of revision stamp, in that it specifies a unique copy of
the source tree, as does a Darcs &ldquo;context&rdquo; file.

   <p>When we aren't intending to make any changes to the sources we check out
(at least not any that need to be committed back upstream), there are two
basic ways to use a VC system:

     <ul>
<li>Retrieve a specific set of source revisions: some tag or key is used
to index this set, which is fixed and cannot be changed by subsequent
developers committing new changes to the tree. Releases are built from
tagged revisions like this, so that they can be rebuilt again later
(probably with controlled modifications). 
<li>Retrieve the latest sources along a specific branch: some tag is used
to indicate which branch is to be used, but within that constraint we want
to get the latest revisions. 
</ul>

   <p>Build personnel or CM staff typically use the first approach: the
build that results is (ideally) completely specified by the two
parameters given to the VC system: repository and revision tag. This
gives QA and end-users something concrete to point at when reporting
bugs. Release engineers are also reportedly fond of shipping code that
can be traced back to a concise revision tag of some sort.

   <p>Developers are more likely to use the second approach: each morning
the developer does an update to pull in the changes committed by the
team over the last day. These builds are not easy to fully specify: it
depends upon exactly when you did a checkout, and upon what local
changes the developer has in their tree. Developers do not normally
tag each build they produce, because there is usually significant
overhead involved in creating these tags. Recreating the trees used by
one of these builds can be a challenge. Some VC systems may provide
implicit tags (like a revision number), while others may allow the use
of timestamps to mean &ldquo;the state of the tree at time X&rdquo; as opposed
to a tree-state that has been explicitly marked.

   <p>The Buildbot is designed to help developers, so it usually works in
terms of <em>the latest</em> sources as opposed to specific tagged
revisions. However, it would really prefer to build from reproducible
source trees, so implicit revisions are used whenever possible.

<div class="node">
<a name="Source-Tree-Specifications"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#How-Different-VC-Systems-Specify-Sources">How Different VC Systems Specify Sources</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Generalizing-VC-Systems">Generalizing VC Systems</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Version-Control-Systems">Version Control Systems</a>

</div>

<h4 class="subsection">3.1.2 Source Tree Specifications</h4>

<p>So for the Buildbot's purposes we treat each VC system as a server
which can take a list of specifications as input and produce a source
tree as output. Some of these specifications are static: they are
attributes of the builder and do not change over time. Others are more
variable: each build will have a different value. The repository is
changed over time by a sequence of Changes, each of which represents a
single developer making changes to some set of files. These Changes
are cumulative.

   <p>For normal builds, the Buildbot wants to get well-defined source trees
that contain specific Changes, and exclude other Changes that may have
occurred after the desired ones. We assume that the Changes arrive at
the buildbot (through one of the mechanisms described in see <a href="#Change-Sources">Change Sources</a>) in the same order in which they are committed to the
repository. The Buildbot waits for the tree to become &ldquo;stable&rdquo;
before initiating a build, for two reasons. The first is that
developers frequently make multiple related commits in quick
succession, even when the VC system provides ways to make atomic
transactions involving multiple files at the same time. Running a
build in the middle of these sets of changes would use an inconsistent
set of source files, and is likely to fail (and is certain to be less
useful than a build which uses the full set of changes). The
tree-stable-timer is intended to avoid these useless builds that
include some of the developer's changes but not all. The second reason
is that some VC systems (i.e. CVS) do not provide repository-wide
transaction numbers, so that timestamps are the only way to refer to
a specific repository state. These timestamps may be somewhat
ambiguous, due to processing and notification delays. By waiting until
the tree has been stable for, say, 10 minutes, we can choose a
timestamp from the middle of that period to use for our source
checkout, and then be reasonably sure that any clock-skew errors will
not cause the build to be performed on an inconsistent set of source
files.

   <p>The Schedulers always use the tree-stable-timer, with a timeout that
is configured to reflect a reasonable tradeoff between build latency
and change frequency. When the VC system provides coherent
repository-wide revision markers (such as Subversion's revision
numbers, or in fact anything other than CVS's timestamps), the
resulting Build is simply performed against a source tree defined by
that revision marker. When the VC system does not provide this, a
timestamp from the middle of the tree-stable period is used to
generate the source tree<a rel="footnote" href="#fn-4" name="fnd-4"><sup>4</sup></a>.

<div class="node">
<a name="How-Different-VC-Systems-Specify-Sources"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Attributes-of-Changes">Attributes of Changes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Source-Tree-Specifications">Source Tree Specifications</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Version-Control-Systems">Version Control Systems</a>

</div>

<h4 class="subsection">3.1.3 How Different VC Systems Specify Sources</h4>

<p>For CVS, the static specifications are <code>repository</code> and
<code>module</code>. In addition to those, each build uses a timestamp (or
omits the timestamp to mean <code>the latest</code>) and <code>branch tag</code>
(which defaults to HEAD). These parameters collectively specify a set
of sources from which a build may be performed.

   <p><a href="http://subversion.tigris.org">Subversion</a> combines the
repository, module, and branch into a single <code>Subversion URL</code>
parameter. Within that scope, source checkouts can be specified by a
numeric <code>revision number</code> (a repository-wide
monotonically-increasing marker, such that each transaction that
changes the repository is indexed by a different revision number), or
a revision timestamp. When branches are used, the repository and
module form a static <code>baseURL</code>, while each build has a
<code>revision number</code> and a <code>branch</code> (which defaults to a
statically-specified <code>defaultBranch</code>). The <code>baseURL</code> and
<code>branch</code> are simply concatenated together to derive the
<code>svnurl</code> to use for the checkout.

   <p><a href="http://www.perforce.com/">Perforce</a> is similar. The server
is specified through a <code>P4PORT</code> parameter. Module and branch
are specified in a single depot path, and revisions are
depot-wide. When branches are used, the <code>p4base</code> and
<code>defaultBranch</code> are concatenated together to produce the depot
path.

   <p><a href="http://bazaar-vcs.org">Bzr</a> (which is a descendant of
Arch/Bazaar, and is frequently referred to as &ldquo;Bazaar&rdquo;) has the same
sort of repository-vs-workspace model as Arch, but the repository data
can either be stored inside the working directory or kept elsewhere
(either on the same machine or on an entirely different machine). For
the purposes of Buildbot (which never commits changes), the repository
is specified with a URL and a revision number.

   <p>The most common way to obtain read-only access to a bzr tree is via
HTTP, simply by making the repository visible through a web server
like Apache. Bzr can also use FTP and SFTP servers, if the buildslave
process has sufficient privileges to access them. Higher performance
can be obtained by running a special Bazaar-specific server. None of
these matter to the buildbot: the repository URL just has to match the
kind of server being used. The <code>repoURL</code> argument provides the
location of the repository.

   <p>Branches are expressed as subdirectories of the main central
repository, which means that if branches are being used, the BZR step
is given a <code>baseURL</code> and <code>defaultBranch</code> instead of getting
the <code>repoURL</code> argument.

   <p><a href="http://darcs.net/">Darcs</a> doesn't really have the
notion of a single master repository. Nor does it really have
branches. In Darcs, each working directory is also a repository, and
there are operations to push and pull patches from one of these
<code>repositories</code> to another. For the Buildbot's purposes, all you
need to do is specify the URL of a repository that you want to build
from. The build slave will then pull the latest patches from that
repository and build them. Multiple branches are implemented by using
multiple repositories (possibly living on the same server).

   <p>Builders which use Darcs therefore have a static <code>repourl</code> which
specifies the location of the repository. If branches are being used,
the source Step is instead configured with a <code>baseURL</code> and a
<code>defaultBranch</code>, and the two strings are simply concatenated
together to obtain the repository's URL. Each build then has a
specific branch which replaces <code>defaultBranch</code>, or just uses the
default one. Instead of a revision number, each build can have a
&ldquo;context&rdquo;, which is a string that records all the patches that are
present in a given tree (this is the output of <samp><span class="command">darcs changes
--context</span></samp>, and is considerably less concise than, e.g. Subversion's
revision number, but the patch-reordering flexibility of Darcs makes
it impossible to provide a shorter useful specification).

   <p><a href="http://selenic.com/mercurial">Mercurial</a> is like Darcs, in that
each branch is stored in a separate repository. The <code>repourl</code>,
<code>baseURL</code>, and <code>defaultBranch</code> arguments are all handled the
same way as with Darcs. The &ldquo;revision&rdquo;, however, is the hash
identifier returned by <samp><span class="command">hg identify</span></samp>.

   <p><a href="http://git.or.cz/">Git</a> also follows a decentralized model, and
each repository can have several branches and tags. The source Step is
configured with a static <code>repourl</code> which specifies the location
of the repository. In addition, an optional <code>branch</code> parameter
can be specified to check out code from a specific branch instead of
the default &ldquo;master&rdquo; branch. The &ldquo;revision&rdquo; is specified as a SHA1
hash as returned by e.g. <samp><span class="command">git rev-parse</span></samp>. No attempt is made
to ensure that the specified revision is actually a subset of the
specified branch.

   <p><a href="http://www.monotone.ca/">Monotone</a> is another that follows a
decentralized model where each repository can have several branches and
tags. The source Step is configured with static <code>repourl</code> and
<code>branch</code> parameters, which specifies the location of the
repository and the branch to use.  The &ldquo;revision&rdquo; is specified as a
SHA1 hash as returned by e.g. <samp><span class="command">mtn automate select w:</span></samp>. No
attempt is made to ensure that the specified revision is actually a
subset of the specified branch.

<div class="node">
<a name="Attributes-of-Changes"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#How-Different-VC-Systems-Specify-Sources">How Different VC Systems Specify Sources</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Version-Control-Systems">Version Control Systems</a>

</div>

<h4 class="subsection">3.1.4 Attributes of Changes</h4>

<h3 class="heading">Who</h3>

<p>Each Change has a <code>who</code> attribute, which specifies which developer is
responsible for the change. This is a string which comes from a namespace
controlled by the VC repository. Frequently this means it is a username on the
host which runs the repository, but not all VC systems require this.  Each
StatusNotifier will map the <code>who</code> attribute into something appropriate for
their particular means of communication: an email address, an IRC handle, etc.

<h3 class="heading">Files</h3>

<p>It also has a list of <code>files</code>, which are just the tree-relative
filenames of any files that were added, deleted, or modified for this
Change. These filenames are used by the <code>fileIsImportant</code>
function (in the Scheduler) to decide whether it is worth triggering a
new build or not, e.g. the function could use the following function
to only run a build if a C file were checked in:

<pre class="example">     def has_C_files(change):
         for name in change.files:
             if name.endswith(".c"):
                 return True
         return False
</pre>
   <p>Certain BuildSteps can also use the list of changed files
to run a more targeted series of tests, e.g. the
<code>python_twisted.Trial</code> step can run just the unit tests that
provide coverage for the modified .py files instead of running the
full test suite.

<h3 class="heading">Comments</h3>

<p>The Change also has a <code>comments</code> attribute, which is a string
containing any checkin comments.

<h3 class="heading">Project</h3>

<p>A change's <i>project</i>, by default the empty string, describes the source code
that changed.  It is a free-form string which the buildbot administrator can
use to flexibly discriminate among changes.

   <p>Generally, a project is an independently-buildable unit of source.  This field
can be used to apply different build steps to different projects.  For example,
an open-source application might build its Windows client from a separate
codebase than its POSIX server.  In this case, the change sources should be
configured to attach an appropriate project string (say, "win-client" and
"server") to changes from each codebase.  Schedulers would then examine these
strings and trigger the appropriate builders for each project.

<h3 class="heading">Repository</h3>

<p>A change occurs within the context of a specific repository.  This is generally
specified with a string, and for most version-control systems, this string
takes the form of a URL.

   <p>Changes can be filtered on repository, but more often this field is used as a
hint for the build steps to figure out which code to check out.

<h3 class="heading">Revision</h3>

<p>Each Change can have a <code>revision</code> attribute, which describes how
to get a tree with a specific state: a tree which includes this Change
(and all that came before it) but none that come after it. If this
information is unavailable, the <code>.revision</code> attribute will be
<code>None</code>. These revisions are provided by the ChangeSource, and
consumed by the <code>computeSourceRevision</code> method in the appropriate
<code>source.Source</code> class.

     <dl>
<dt>&lsquo;<samp><span class="samp">CVS</span></samp>&rsquo;<dd><code>revision</code> is an int, seconds since the epoch
<br><dt>&lsquo;<samp><span class="samp">SVN</span></samp>&rsquo;<dd><code>revision</code> is an int, the changeset number (r%d)
<br><dt>&lsquo;<samp><span class="samp">Darcs</span></samp>&rsquo;<dd><code>revision</code> is a large string, the output of <code>darcs changes --context</code>
<br><dt>&lsquo;<samp><span class="samp">Mercurial</span></samp>&rsquo;<dd><code>revision</code> is a short string (a hash ID), the output of <code>hg identify</code>
<br><dt>&lsquo;<samp><span class="samp">P4</span></samp>&rsquo;<dd><code>revision</code> is an int, the transaction number
<br><dt>&lsquo;<samp><span class="samp">Git</span></samp>&rsquo;<dd><code>revision</code> is a short string (a SHA1 hash), the output of e.g. 
<code>git rev-parse</code>
<br><dt>&lsquo;<samp><span class="samp">Monotone</span></samp>&rsquo;<dd><code>revision</code> is a short string (a SHA1 hash), the output of e.g. 
<code>mtn automate select w:</code>
</dl>

<h3 class="heading">Branches</h3>

<p>The Change might also have a <code>branch</code> attribute. This indicates
that all of the Change's files are in the same named branch. The
Schedulers get to decide whether the branch should be built or not.

   <p>For VC systems like CVS, Git, and Monotone, the <code>branch</code>
name is unrelated to the filename. (that is, the branch name and the
filename inhabit unrelated namespaces). For SVN, branches are
expressed as subdirectories of the repository, so the file's
&ldquo;svnurl&rdquo; is a combination of some base URL, the branch name, and the
filename within the branch. (In a sense, the branch name and the
filename inhabit the same namespace). Darcs branches are
subdirectories of a base URL just like SVN. Mercurial branches are the
same as Darcs.

     <dl>
<dt>&lsquo;<samp><span class="samp">CVS</span></samp>&rsquo;<dd>branch='warner-newfeature', files=['src/foo.c']
<br><dt>&lsquo;<samp><span class="samp">SVN</span></samp>&rsquo;<dd>branch='branches/warner-newfeature', files=['src/foo.c']
<br><dt>&lsquo;<samp><span class="samp">Darcs</span></samp>&rsquo;<dd>branch='warner-newfeature', files=['src/foo.c']
<br><dt>&lsquo;<samp><span class="samp">Mercurial</span></samp>&rsquo;<dd>branch='warner-newfeature', files=['src/foo.c']
<br><dt>&lsquo;<samp><span class="samp">Git</span></samp>&rsquo;<dd>branch='warner-newfeature', files=['src/foo.c']
<br><dt>&lsquo;<samp><span class="samp">Monotone</span></samp>&rsquo;<dd>branch='warner-newfeature', files=['src/foo.c']
</dl>

<h3 class="heading">Build Properties</h3>

<p>A Change may have one or more properties attached to it, usually specified
through the Force Build form or see <a href="#sendchange">sendchange</a>. Properties are discussed
in detail in the see <a href="#Build-Properties">Build Properties</a> section.

<h3 class="heading">Links</h3>

<!-- TODO: who is using 'links'? how is it being used? -->
<p>Finally, the Change might have a <code>links</code> list, which is intended
to provide a list of URLs to a <em>viewcvs</em>-style web page that
provides more detail for this Change, perhaps including the full file
diffs.

<div class="node">
<a name="Scheduling-Builds"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#BuildSet">BuildSet</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Version-Control-Systems">Version Control Systems</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Concepts">Concepts</a>

</div>

<h3 class="section">3.2 Scheduling Builds</h3>

<p><a name="index-Scheduler-8"></a>
Each Buildmaster has a set of <code>Scheduler</code> objects, each of which
gets a copy of every incoming Change. The Schedulers are responsible
for deciding when Builds should be run. Some Buildbot installations
might have a single Scheduler, while others may have several, each for
a different purpose.

   <p>For example, a &ldquo;quick&rdquo; scheduler might exist to give immediate
feedback to developers, hoping to catch obvious problems in the code
that can be detected quickly. These typically do not run the full test
suite, nor do they run on a wide variety of platforms. They also
usually do a VC update rather than performing a brand-new checkout
each time.

   <p>A separate &ldquo;full&rdquo; scheduler might run more comprehensive tests to catch more
subtle problems, configured to run after the quick scheduler, to give
developers time to commit fixes to bugs caught by the quick scheduler before
running the comprehensive tests.  This scheduler would also feed multiple
Builders.

   <p>Many schedulers can be configured to wait a while after seeing a source-code
change - this is the "tree stable timer".  The timer allows multiple commits to
be "batched" together.  This is particularly useful in distributed version
control systems, where a developer may push a long sequence of changes all at
once.  To save resources, it's often desirable only to test the most recent
change.

   <p>Schedulers can also filter out the changes they are interested in, based on a
number of criteria.  For example, a scheduler that only builds documentation
might skip any changes that do not affect the documentation.  Schedulers can
also filter on the branch to which a commit was made.

   <p>There is some support for configuring dependencies between builds - for
example, you may want to build packages only for revisions which pass all of
the unit tests.  This support is under active development in Buildbot, and is
referred to as "build coordination".

   <p>Periodic builds (those which are run every N seconds rather than after
new Changes arrive) are triggered by a special <code>Periodic</code>
Scheduler subclass.

   <p>Each Scheduler creates and submits <code>BuildSet</code> objects to the
<code>BuildMaster</code>, which is then responsible for making sure the
individual <code>BuildRequests</code> are delivered to the target
<code>Builders</code>.

   <p><code>Scheduler</code> instances are activated by placing them in the
<code>c['schedulers']</code> list in the buildmaster config file. Each
Scheduler has a unique name.

<div class="node">
<a name="BuildSet"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#BuildRequest">BuildRequest</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Scheduling-Builds">Scheduling Builds</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Concepts">Concepts</a>

</div>

<h3 class="section">3.3 BuildSet</h3>

<p><a name="index-BuildSet-9"></a>
A <code>BuildSet</code> is the name given to a set of Builds that all
compile/test the same version of the tree on multiple Builders. In
general, all these component Builds will perform the same sequence of
Steps, using the same source code, but on different platforms or
against a different set of libraries.

   <p>The <code>BuildSet</code> is tracked as a single unit, which fails if any of
the component Builds have failed, and therefore can succeed only if
<em>all</em> of the component Builds have succeeded. There are two kinds
of status notification messages that can be emitted for a BuildSet:
the <code>firstFailure</code> type (which fires as soon as we know the
BuildSet will fail), and the <code>Finished</code> type (which fires once
the BuildSet has completely finished, regardless of whether the
overall set passed or failed).

   <p>A <code>BuildSet</code> is created with a <em>source stamp</em> tuple of
(branch, revision, changes, patch), some of which may be None, and a
list of Builders on which it is to be run. They are then given to the
BuildMaster, which is responsible for creating a separate
<code>BuildRequest</code> for each Builder.

   <p>There are a couple of different likely values for the
<code>SourceStamp</code>:

     <dl>
<dt><code>(revision=None, changes=[CHANGES], patch=None)</code><dd>This is a <code>SourceStamp</code> used when a series of Changes have
triggered a build. The VC step will attempt to check out a tree that
contains CHANGES (and any changes that occurred before CHANGES, but
not any that occurred after them).

     <br><dt><code>(revision=None, changes=None, patch=None)</code><dd>This builds the most recent code on the default branch. This is the
sort of <code>SourceStamp</code> that would be used on a Build that was
triggered by a user request, or a Periodic scheduler. It is also
possible to configure the VC Source Step to always check out the
latest sources rather than paying attention to the Changes in the
SourceStamp, which will result in same behavior as this.

     <br><dt><code>(branch=BRANCH, revision=None, changes=None, patch=None)</code><dd>This builds the most recent code on the given BRANCH. Again, this is
generally triggered by a user request or Periodic build.

     <br><dt><code>(revision=REV, changes=None, patch=(LEVEL, DIFF, SUBDIR_ROOT))</code><dd>This checks out the tree at the given revision REV, then applies a
patch (using <code>patch -pLEVEL &lt;DIFF</code>) from inside the relative
directory SUBDIR_ROOT. Item SUBDIR_ROOT is optional and defaults to the
builder working directory. The <a href="#try">try</a> feature uses this kind of
<code>SourceStamp</code>. If <code>patch</code> is None, the patching step is
bypassed.

   </dl>

   <p>The buildmaster is responsible for turning the <code>BuildSet</code> into a
set of <code>BuildRequest</code> objects and queueing them on the
appropriate Builders.

<div class="node">
<a name="BuildRequest"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Builder">Builder</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BuildSet">BuildSet</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Concepts">Concepts</a>

</div>

<h3 class="section">3.4 BuildRequest</h3>

<p><a name="index-BuildRequest-10"></a>
A <code>BuildRequest</code> is a request to build a specific revision of the source
code (specified by a source stamp) on a single <code>Builder</code>. Each
<code>Builder</code> runs the <code>BuildRequest</code> as soon as it can (i.e. when an
associated buildslave becomes free). <code>BuildRequest</code>s are prioritized from
oldest to newest, and when a buildslave becomes free, the <code>Builder</code> with
the oldest <code>BuildRequest</code> is run.

   <p>The <code>BuildRequest</code> may be mergeable with other compatible
<code>BuildRequest</code>s. Builds that are triggered by incoming Changes
will generally be mergeable. Builds that are triggered by user
requests are generally not, unless they are multiple requests to build
the <em>latest sources</em> of the same branch.

<div class="node">
<a name="Builder"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Build">Build</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BuildRequest">BuildRequest</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Concepts">Concepts</a>

</div>

<h3 class="section">3.5 Builder</h3>

<p><a name="index-Builder-11"></a><a name="index-BuildFactory-12"></a><a name="index-BuildSlave-13"></a>
The Buildmaster runs a collection of Builders, each of which handles a single
type of build (e.g. full versus quick), on one or more build slaves.   Builders
serve as a kind of queue for a particular type of build.  Each Builder gets a
separate column in the waterfall display. In general, each Builder runs
independently (although various kinds of interlocks can cause one Builder to
have an effect on another).

   <p>Each builder is a long-lived object which controls a sequence of Builds. 
Each Builder is created when the config file is first parsed, and lives forever
(or rather until it is removed from the config file). It mediates the
connections to the buildslaves that do all the work, and is responsible for
creating the Build objects - see <a href="#Build">Build</a>.

   <p>Each builder gets a unique name, and the path name of a directory where it gets
to do all its work (there is a buildmaster-side directory for keeping status
information, as well as a buildslave-side directory where the actual
checkout/compile/test commands are executed).

<h3 class="heading">Build Factories</h3>

<p>A builder also has a BuildFactory, which is responsible for creating new Build
instances: because the Build instance is what actually performs each build,
choosing the BuildFactory is the way to specify what happens each time a build
is done (see <a href="#Build">Build</a>).

<h3 class="heading">Build Slaves</h3>

<p>Each builder is associated with one of more BuildSlaves.  A builder which is
used to perform Mac OS X builds (as opposed to Linux or Solaris builds) should
naturally be associated with a Mac buildslave.

   <p>If multiple buildslaves are available for any given builder, you will
have some measure of redundancy: in case one slave goes offline, the
others can still keep the Builder working. In addition, multiple
buildslaves will allow multiple simultaneous builds for the same
Builder, which might be useful if you have a lot of forced or &ldquo;try&rdquo;
builds taking place.

   <p>If you use this feature, it is important to make sure that the
buildslaves are all, in fact, capable of running the given build. The
slave hosts should be configured similarly, otherwise you will spend a
lot of time trying (unsuccessfully) to reproduce a failure that only
occurs on some of the buildslaves and not the others. Different
platforms, operating systems, versions of major programs or libraries,
all these things mean you should use separate Builders.

<div class="node">
<a name="Build"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Users">Users</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Builder">Builder</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Concepts">Concepts</a>

</div>

<h3 class="section">3.6 Build</h3>

<p><a name="index-Build-14"></a><a name="index-BuildStep-15"></a>
A build is a single compile or test run of a particular version of the source
code, and is comprised of a series of steps.  It is ultimately up to you what
constitutes a build, but for compiled software it is generally the checkout,
configure, make, and make check sequence.  For interpreted projects like Python
modules, a build is generally a checkout followed by an invocation of the
bundled test suite.

   <p>A build factory describes the steps a build will perform.  The builder which
starts a build uses its configured build factory to determine the build's
steps.

<div class="node">
<a name="Users"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Build-Properties">Build Properties</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Build">Build</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Concepts">Concepts</a>

</div>

<h3 class="section">3.7 Users</h3>

<p><a name="index-Users-16"></a>
Buildbot has a somewhat limited awareness of <em>users</em>. It assumes
the world consists of a set of developers, each of whom can be
described by a couple of simple attributes. These developers make
changes to the source code, causing builds which may succeed or fail.

   <p>Each developer is primarily known through the source control system. Each
Change object that arrives is tagged with a <code>who</code> field that
typically gives the account name (on the repository machine) of the user
responsible for that change. This string is the primary key by which the
User is known, and is displayed on the HTML status pages and in each Build's
&ldquo;blamelist&rdquo;.

   <p>To do more with the User than just refer to them, this username needs to
be mapped into an address of some sort. The responsibility for this mapping
is left up to the status module which needs the address. The core code knows
nothing about email addresses or IRC nicknames, just user names.

<ul class="menu">
<li><a accesskey="1" href="#Doing-Things-With-Users">Doing Things With Users</a>
<li><a accesskey="2" href="#Email-Addresses">Email Addresses</a>
<li><a accesskey="3" href="#IRC-Nicknames">IRC Nicknames</a>
<li><a accesskey="4" href="#Live-Status-Clients">Live Status Clients</a>
</ul>

<div class="node">
<a name="Doing-Things-With-Users"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Email-Addresses">Email Addresses</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Users">Users</a>

</div>

<h4 class="subsection">3.7.1 Doing Things With Users</h4>

<p>Each change has a single user who is responsible for it. Most builds have a set
of changes: the build generally represents the first time these changes have
been built and tested by the Buildbot. The build has a &ldquo;blamelist&rdquo; that is
the union of the users responsible for all the build's changes.

   <p>The build provides a list of users who are interested in the build &ndash; the
&ldquo;interested users&rdquo;. Usually this is equal to the blamelist, but may also be
expanded, e.g., to include the current build sheriff or a module's maintainer.

   <p>If desired, the buildbot can notify the interested users until the problem is
resolved.

<div class="node">
<a name="Email-Addresses"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#IRC-Nicknames">IRC Nicknames</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Doing-Things-With-Users">Doing Things With Users</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Users">Users</a>

</div>

<h4 class="subsection">3.7.2 Email Addresses</h4>

<p>The <code>buildbot.status.mail.MailNotifier</code> class
(see <a href="#MailNotifier">MailNotifier</a>) provides a status target which can send email
about the results of each build. It accepts a static list of email
addresses to which each message should be delivered, but it can also
be configured to send mail to the Build's Interested Users. To do
this, it needs a way to convert User names into email addresses.

   <p>For many VC systems, the User Name is actually an account name on the
system which hosts the repository. As such, turning the name into an
email address is a simple matter of appending
&ldquo;@repositoryhost.com&rdquo;. Some projects use other kinds of mappings
(for example the preferred email address may be at &ldquo;project.org&rdquo;
despite the repository host being named &ldquo;cvs.project.org&rdquo;), and some
VC systems have full separation between the concept of a user and that
of an account on the repository host (like Perforce). Some systems
(like Git) put a full contact email address in every change.

   <p>To convert these names to addresses, the MailNotifier uses an EmailLookup
object. This provides a .getAddress method which accepts a name and
(eventually) returns an address. The default <code>MailNotifier</code>
module provides an EmailLookup which simply appends a static string,
configurable when the notifier is created. To create more complex behaviors
(perhaps using an LDAP lookup, or using &ldquo;finger&rdquo; on a central host to
determine a preferred address for the developer), provide a different object
as the <code>lookup</code> argument.

   <p>In the future, when the Problem mechanism has been set up, the Buildbot
will need to send mail to arbitrary Users. It will do this by locating a
MailNotifier-like object among all the buildmaster's status targets, and
asking it to send messages to various Users. This means the User-to-address
mapping only has to be set up once, in your MailNotifier, and every email
message the buildbot emits will take advantage of it.

<div class="node">
<a name="IRC-Nicknames"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Live-Status-Clients">Live Status Clients</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Email-Addresses">Email Addresses</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Users">Users</a>

</div>

<h4 class="subsection">3.7.3 IRC Nicknames</h4>

<p>Like MailNotifier, the <code>buildbot.status.words.IRC</code> class
provides a status target which can announce the results of each build. It
also provides an interactive interface by responding to online queries
posted in the channel or sent as private messages.

   <p>In the future, the buildbot can be configured map User names to IRC
nicknames, to watch for the recent presence of these nicknames, and to
deliver build status messages to the interested parties. Like
<code>MailNotifier</code> does for email addresses, the <code>IRC</code> object
will have an <code>IRCLookup</code> which is responsible for nicknames. The
mapping can be set up statically, or it can be updated by online users
themselves (by claiming a username with some kind of &ldquo;buildbot: i am
user warner&rdquo; commands).

   <p>Once the mapping is established, the rest of the buildbot can ask the
<code>IRC</code> object to send messages to various users. It can report on
the likelihood that the user saw the given message (based upon how long the
user has been inactive on the channel), which might prompt the Problem
Hassler logic to send them an email message instead.

<div class="node">
<a name="Live-Status-Clients"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#IRC-Nicknames">IRC Nicknames</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Users">Users</a>

</div>

<h4 class="subsection">3.7.4 Live Status Clients</h4>

<p>The Buildbot also offers a desktop status client interface which can display
real-time build status in a GUI panel on the developer's desktop.

<div class="node">
<a name="Build-Properties"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Users">Users</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Concepts">Concepts</a>

</div>

<h3 class="section">3.8 Build Properties</h3>

<p><a name="index-Properties-17"></a>
Each build has a set of &ldquo;Build Properties&rdquo;, which can be used by its
BuildSteps to modify their actions.  These properties, in the form of
key-value pairs, provide a general framework for dynamically altering
the behavior of a build based on its circumstances.

   <p>Properties come from a number of places:
     <ul>
<li>global configuration &ndash;
These properties apply to all builds. 
<li>schedulers &ndash;
A scheduler can specify properties available to all the builds it
starts. 
<li>changes &ndash;
A change can have properties attached to it. These are usually specified
through a change source (see <a href="#Change-Sources">Change Sources</a>), the "Force Build" form on the web interface (see <a href="#WebStatus">WebStatus</a>), or sendchange (see <a href="#sendchange">sendchange</a>). 
<li>buildslaves &ndash;
A buildslave can pass properties on to the builds it performs. 
<li>builds &ndash;
A build automatically sets a number of properties on itself. 
<li>builders &ndash;
A builder can set properties on all the builds it runs. 
<li>steps &ndash;
The steps of a build can set properties that are available to subsequent
steps.  In particular, source steps set a number of properties. 
</ul>

   <p>Properties are very flexible, and can be used to implement all manner
of functionality.  Here are some examples:

   <p>Most Source steps record the revision that they checked out in
the <code>got_revision</code> property.  A later step could use this
property to specify the name of a fully-built tarball, dropped in an
easily-acessible directory for later testing.

   <p>Some projects want to perform nightly builds as well as bulding in response to
committed changes.  Such a project would run two schedulers, both pointing to
the same set of builders, but could provide an <code>is_nightly</code> property so
that steps can distinguish the nightly builds, perhaps to run more
resource-intensive tests.

   <p>Some projects have different build processes on different systems. 
Rather than create a build factory for each slave, the steps can use
buildslave properties to identify the unique aspects of each slave
and adapt the build process dynamically.

<div class="node">
<a name="Configuration"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Customization">Customization</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Concepts">Concepts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">4 Configuration</h2>

<p><a name="index-Configuration-18"></a>
The buildbot's behavior is defined by the &ldquo;config file&rdquo;, which
normally lives in the <samp><span class="file">master.cfg</span></samp> file in the buildmaster's base
directory (but this can be changed with an option to the
<code>buildbot create-master</code> command). This file completely specifies
which Builders are to be run, which slaves they should use, how
Changes should be tracked, and where the status information is to be
sent. The buildmaster's <samp><span class="file">buildbot.tac</span></samp> file names the base
directory; everything else comes from the config file.

   <p>A sample config file was installed for you when you created the
buildmaster, but you will need to edit it before your buildbot will do
anything useful.

   <p>This chapter gives an overview of the format of this file and the
various sections in it. You will need to read the later chapters to
understand how to fill in each section properly.

<ul class="menu">
<li><a accesskey="1" href="#Config-File-Format">Config File Format</a>
<li><a accesskey="2" href="#Predefined-Config-File-Symbols">Predefined Config File Symbols</a>
<li><a accesskey="3" href="#Loading-the-Config-File">Loading the Config File</a>
<li><a accesskey="4" href="#Testing-the-Config-File">Testing the Config File</a>
<li><a accesskey="5" href="#Reloading-the-Config-File-_0028reconfig_0029">Reloading the Config File (reconfig)</a>
<li><a accesskey="6" href="#Global-Configuration">Global Configuration</a>
<li><a accesskey="7" href="#Change-Sources">Change Sources</a>
<li><a accesskey="8" href="#Schedulers">Schedulers</a>
<li><a accesskey="9" href="#Buildslaves">Buildslaves</a>
<li><a href="#Builders">Builders</a>
<li><a href="#Build-Factories">Build Factories</a>
<li><a href="#Build-Steps">Build Steps</a>
<li><a href="#Interlocks">Interlocks</a>
<li><a href="#Status-Targets">Status Targets</a>
<li><a href="#Configuration-Index">Configuration Index</a>
</ul>

<div class="node">
<a name="Config-File-Format"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Predefined-Config-File-Symbols">Predefined Config File Symbols</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.1 Config File Format</h3>

<p>The config file is, fundamentally, just a piece of Python code which
defines a dictionary named <code>BuildmasterConfig</code>, with a number of
keys that are treated specially. You don't need to know Python to do
basic configuration, though, you can just copy the syntax of the
sample file. If you <em>are</em> comfortable writing Python code,
however, you can use all the power of a full programming language to
achieve more complicated configurations.

   <p>The <code>BuildmasterConfig</code> name is the only one which matters: all
other names defined during the execution of the file are discarded. 
When parsing the config file, the Buildmaster generally compares the
old configuration with the new one and performs the minimum set of
actions necessary to bring the buildbot up to date: Builders which are
not changed are left untouched, and Builders which are modified get to
keep their old event history.

   <p>The beginning of the master.cfg file
typically starts with something like:

<pre class="example">     BuildmasterConfig = c = {}
</pre>
   <p>Therefore a config key of <code>change_source</code> will usually appear in
master.cfg as <code>c['change_source']</code>.

   <p>See <a href="#Configuration-Index">Configuration Index</a> for a full list of <code>BuildMasterConfig</code>
keys.

<h3 class="heading">Basic Python Syntax</h3>

<p>Python comments start with a hash character (&ldquo;#&rdquo;), tuples are defined with
<code>(parenthesis, pairs)</code>, and lists (arrays) are defined with <code>[square,
brackets]</code>. Tuples and lists are mostly interchangeable. Dictionaries (data
structures which map &ldquo;keys&rdquo; to &ldquo;values&rdquo;) are defined with curly braces:
<code>{'key1': 'value1', 'key2': 'value2'} </code>. Function calls (and object
instantiation) can use named parameters, like <code>w =
html.Waterfall(http_port=8010)</code>.

   <p>The config file starts with a series of <code>import</code> statements, which make
various kinds of Steps and Status targets available for later use. The main
<code>BuildmasterConfig</code> dictionary is created, then it is populated with a
variety of keys, described section-by-section in subsequent chapters.

<div class="node">
<a name="Predefined-Config-File-Symbols"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Loading-the-Config-File">Loading the Config File</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Config-File-Format">Config File Format</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.2 Predefined Config File Symbols</h3>

<p>The following symbols are automatically available for use in the configuration
file.

     <dl>
<dt><code>basedir</code><dd>the base directory for the buildmaster. This string has not been
expanded, so it may start with a tilde. It needs to be expanded before
use. The config file is located in
<code>os.path.expanduser(os.path.join(basedir, 'master.cfg'))</code>

     <br><dt><code>__file__</code><dd>the absolute path of the config file. The config file's directory is located in
<code>os.path.dirname(__file__)</code>.

   </dl>

<div class="node">
<a name="Testing-the-Config-File"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Reloading-the-Config-File-_0028reconfig_0029">Reloading the Config File (reconfig)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Loading-the-Config-File">Loading the Config File</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.3 Testing the Config File</h3>

<p>To verify that the config file is well-formed and contains no deprecated or
invalid elements, use the &ldquo;checkconfig&rdquo; command, passing it either a master
directory or a config file.

<pre class="example">     % buildbot checkconfig master.cfg
     Config file is good!
     # or
     % buildbot checkconfig /tmp/masterdir
     Config file is good!
</pre>
   <p>If the config file has deprecated features (perhaps because you've
upgraded the buildmaster and need to update the config file to match),
they will be announced by checkconfig. In this case, the config file
will work, but you should really remove the deprecated items and use
the recommended replacements instead:

<pre class="example">     % buildbot checkconfig master.cfg
     /usr/lib/python2.4/site-packages/buildbot/master.py:559: DeprecationWarning: c['sources'] is
     deprecated as of 0.7.6 and will be removed by 0.8.0 . Please use c['change_source'] instead.
       warnings.warn(m, DeprecationWarning)
     Config file is good!
</pre>
   <p>If the config file is simply broken, that will be caught too:

<pre class="example">     % buildbot checkconfig master.cfg
     Traceback (most recent call last):
       File "/usr/lib/python2.4/site-packages/buildbot/scripts/runner.py", line 834, in doCheckConfig
         ConfigLoader(configFile)
       File "/usr/lib/python2.4/site-packages/buildbot/scripts/checkconfig.py", line 31, in __init__
         self.loadConfig(configFile)
       File "/usr/lib/python2.4/site-packages/buildbot/master.py", line 480, in loadConfig
         exec f in localDict
       File "/home/warner/BuildBot/master/foolscap/master.cfg", line 90, in ?
         c[bogus] = "stuff"
     NameError: name 'bogus' is not defined
</pre>
   <div class="node">
<a name="Loading-the-Config-File"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Testing-the-Config-File">Testing the Config File</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Predefined-Config-File-Symbols">Predefined Config File Symbols</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.4 Loading the Config File</h3>

<p>The configuration file is only read at specific points in time. It is first
read when the buildmaster is launched.  If the configuration is invalid, the
master will display the errors in the console output, but will not exit.

<div class="node">
<a name="Reloading-the-Config-File-(reconfig)"></a>
<a name="Reloading-the-Config-File-_0028reconfig_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Global-Configuration">Global Configuration</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Testing-the-Config-File">Testing the Config File</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.5 Reloading the Config File (reconfig)</h3>

<p>If you are on the system hosting the buildmaster, you can send a <code>SIGHUP</code>
signal to it: the <samp><span class="command">buildbot</span></samp> tool has a shortcut for this:

<pre class="example">     buildbot reconfig <var>BASEDIR</var>
</pre>
   <p>This command will show you all of the lines from <samp><span class="file">twistd.log</span></samp>
that relate to the reconfiguration. If there are any problems during
the config-file reload, they will be displayed in these lines.

   <p>When reloading the config file, the buildmaster will endeavor to
change as little as possible about the running system. For example,
although old status targets may be shut down and new ones started up,
any status targets that were not changed since the last time the
config file was read will be left running and untouched. Likewise any
Builders which have not been changed will be left running. If a
Builder is modified (say, the build process is changed) while a Build
is currently running, that Build will keep running with the old
process until it completes. Any previously queued Builds (or Builds
which get queued after the reconfig) will use the new process.

<h3 class="heading">Warning</h3>

<p>Buildbot's reconfiguration system is fragile for a few difficult-to-fix
reasons:

     <ul>
<li>Any modules imported by the configuration file are not automatically reloaded. 
Python modules such as <a href="http://pypi.python.org/pypi/lazy-reload">http://pypi.python.org/pypi/lazy-reload</a> may help
here, but reloading modules is fraught with subtlties and difficult-to-decipher
failure cases.

     <li>During the reconfiguration, active internal objects are divorced from the service
hierarchy, leading to tracebacks in the web interface and other components. These
are ordinarily transient, but with HTTP connection caching (either by the browser or
an intervening proxy) they can last for a long time.

     <li>If the new configuration file is invalid, it is possible for Buildbot's
internal state to be corrupted, leading to undefined results.  When this
occurs, it is best to restart the mater.

     <li>For more advanced configurations, it is impossible for Buildbot to tell if the
configuration for a builder or scheduler has chanaged, and thus the builder or
scheduler will always be reloaded.  This occurs most commonly when a callable
is passed as a configuration parameter.

   </ul>

   <p>The bbproto project (at <a href="https://github.com/dabrahams/bbproto">https://github.com/dabrahams/bbproto</a>) may help to
construct large (multi-file) configurations which can be effectively reloaded
and reconfigured.

<h3 class="heading">Reconfig by Debug Client</h3>

<p>The debug tool (<code>buildbot debugclient --master HOST:PORT</code>) has a
&ldquo;Reload .cfg&rdquo; button which will also trigger a reload. In the
future, there will be other ways to accomplish this step (probably a
password-protected button on the web page, as well as a privileged IRC
command).

<div class="node">
<a name="Global-Configuration"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Change-Sources">Change Sources</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Reloading-the-Config-File-_0028reconfig_0029">Reloading the Config File (reconfig)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.6 Global Configuration</h3>

<p>The keys in this section affect the operations of the buildmaster globally.

<ul class="menu">
<li><a accesskey="1" href="#Database-Specification">Database Specification</a>
<li><a accesskey="2" href="#Multi_002dmaster-mode">Multi-master mode</a>
<li><a accesskey="3" href="#Site-Definition">Site Definition</a>
<li><a accesskey="4" href="#Log-Handling">Log Handling</a>
<li><a accesskey="5" href="#Data-Lifetime">Data Lifetime</a>
<li><a accesskey="6" href="#Merging-Build-Requests-_0028global-option_0029">Merging Build Requests (global option)</a>
<li><a accesskey="7" href="#Prioritizing-Builders">Prioritizing Builders</a>
<li><a accesskey="8" href="#Setting-the-PB-Port-for-Slaves">Setting the PB Port for Slaves</a>
<li><a accesskey="9" href="#Defining-Global-Properties">Defining Global Properties</a>
<li><a href="#Debug-Options">Debug Options</a>
<li><a href="#Metrics-Options">Metrics Options</a>
</ul>

<div class="node">
<a name="Database-Specification"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Multi_002dmaster-mode">Multi-master mode</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.1 Database Specification</h4>

<p>Buildbot requires a connection to a database to maintain certain state
information, such as tracking pending build requests.  By default this is
stored in a sqlite file called 'state.sqlite' in the base directory of your
master.  This can be overridden with the <code>db_url</code> parameter.

   <p>The format of this parameter is completely documetned at
<a href="http://www.sqlalchemy.org/docs/dialects/">http://www.sqlalchemy.org/docs/dialects/</a>, but is generally of the form:

<pre class="example">     driver://[username:password@]host:port/database[?args]
</pre>
   <p>For sqlite databases, since there is no host and port, relative paths are
specified with <code>sqlite:///</code> and absolute paths with <code>sqlite:////</code>. 
Examples:

   <p>Notes for particular database backends:

<h3 class="heading">SQLite</h3>

<pre class="example">     c['db_url'] = "sqlite:///state.sqlite"
</pre>
   <p>No special configuration is required to use SQLite.

<h3 class="heading">MySQL</h3>

<pre class="example">     c['db_url'] = "mysql://user:pass@somehost.com/database_name?max_idle=300"
</pre>
   <p>The <code>max_idle</code> argument for MySQL connections is unique to Buildbot, and
should be set to something less than the wait_timeout configured for your
server.  This controls the SQLAlchemy <code>pool_recycle</code> parameter, which
defaults to no timeout.  Setting this parameter ensures that connections are
closed and re-opened after the configured amount of idle time.  If you see
errors such as <code>_mysql_exceptions.OperationalError: (2006, 'MySQL server
has gone away')</code>, this means your <code>max_idle</code> setting is probably too high. 
<code>show global variables like 'wait_timeout';</code> will show what the currently
configured <code>wait_timeout</code> is on your MySQL server.

   <p>Buildbot requires <code>use_unique=True</code> and <code>charset=utf8</code>, and will add
them automatically, so they do not need to be specified in <code>db_url</code>.

   <p>MySQL defaults to the MyISAM storage engine, but this can be overridden with
the <code>storage_engine</code> URL argument.  Note that, because of InnoDB's
extremely short key length limitations, it cannot be used to run Buildbot.  See
<a href="http://bugs.mysql.com/bug.php?id=4541">http://bugs.mysql.com/bug.php?id=4541</a> for more information.

   <p>Buildbot uses temporary tables internally to manage large transactions.  MySQL
has trouble doing replication with temporary tables, so if you are using a
replicated MySQL installation, you may need to handle this situation carefully. 
The MySQL documentation
(<a href="http://dev.mysql.com/doc/refman/5.5/en/replication-features-temptables.html">http://dev.mysql.com/doc/refman/5.5/en/replication-features-temptables.html</a>)
recommends using <code>--replicate-wild-ignore-table</code> to ignore temporary
tables that should not be replicated.  All Buildbot temporary tables begin with
<code>bbtmp_</code>, so an option such as
<code>--replicate-wild-ignore-table=bbtmp_.*</code> may help.

<h3 class="heading">Postgres</h3>

<pre class="example">     c['db_url'] = "postgresql://username@hostname/dbname"
</pre>
   <p>No special configuration is required to use Postgres.

<div class="node">
<a name="Multi-master-mode"></a>
<a name="Multi_002dmaster-mode"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Site-Definition">Site Definition</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Database-Specification">Database Specification</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.2 Multi-master mode</h4>

<p>Normally buildbot operates using a single master process that uses the
configured database to save state.

   <p>It is possible to configure buildbot to have multiple master processes that
share state in the same database.  This has been well tested using a MySQL
database.  There are several benefits of Multi-master mode:
     <ul>
<li>You can have large numbers of build slaves handling the same queue of build
requests.  A single master can only handle so many slaves (the number is based
on a number of factors including type of builds, number of builds, and master
and slave IO and CPU capacity - there is no fixed formula).  By adding another
master which shares the queue of build requests, you can attach more slaves to
this additional master, and increase your build throughput.

     <li>You can shut one master down to do maintenance, and other masters will continue
to do builds.

   </ul>

   <p>State that is shared in the database includes:
     <ul>
<li>List of changes
<li>Scheduler names and internal state
<li>Build requests, including the builder name
</ul>

   <p>Because of this shared state, you are strongly encouraged to:
     <ul>
<li>
Ensure that each named scheduler runs on only one master.  If the same
scheduler runs on multiple masters, it will trigger duplicate builds and may
produce other undesirable behaviors.

     <li>
Ensure builder names are unique for a given build factory implementation.  You
can have the same builder name configured on many masters, but if the build
factories differ, you will get different results depending on which master
claims the build.

   </ul>

   <p>One suggested configuration is to have one buildbot master configured with
just the scheduler and change sources; and then other masters configured
with just the builders.

   <p>To enable multi-master mode in this configuration, you will need to set the
<code>multiMaster</code> option so that buildbot doesn't warn about missing
schedulers or builders.  You will also need to set <code>db_poll_interval</code>
to the masters with only builders check the database for new build requests
at the configured interval.

<pre class="example">     # Enable multiMaster mode; disables warnings about unknown builders and
     # schedulers
     c['multiMaster'] = True
     # Check for new build requests every 60 seconds
     c['db_poll_interval'] = 60
</pre>
   <div class="node">
<a name="Site-Definition"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Log-Handling">Log Handling</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Multi_002dmaster-mode">Multi-master mode</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.3 Site Definition</h4>

<p>Three basic settings describe the buildmaster in status reports.

<pre class="example">     c['title'] = "Buildbot"
     c['titleURL'] = "http://buildbot.sourceforge.net/"
     c['buildbotURL'] = "http://localhost:8010/"
</pre>
   <p><a name="index-c_005b_0027title_0027_005d-19"></a><code>title</code> is a short string that will appear at the top of this
buildbot installation's <code>html.WebStatus</code> home page (linked to the
<code>titleURL</code>), and is embedded in the title of the waterfall HTML
page.

   <p><a name="index-c_005b_0027titleURL_0027_005d-20"></a>
<code>titleURL</code> is a URL string that must end with a slash (<code>/</code>). 
HTML status displays will show <code>title</code> as a link to
<code>titleURL</code>.  This URL is often used to provide a link from
buildbot HTML pages to your project's home page.

   <p><a name="index-c_005b_0027buildbotURL_0027_005d-21"></a>The <code>buildbotURL</code> string should point to the location where the buildbot's
internal web server is visible. This URL must end with a slash (<code>/</code>). 
This typically uses the port number set for the web status (see <a href="#WebStatus">WebStatus</a>):
the buildbot needs your help to figure out a suitable externally-visible host
URL.

   <p>When status notices are sent to users (either by email or over IRC),
<code>buildbotURL</code> will be used to create a URL to the specific build
or problem that they are being notified about. It will also be made
available to queriers (over IRC) who want to find out where to get
more information about this buildbot.

<div class="node">
<a name="Log-Handling"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Data-Lifetime">Data Lifetime</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Site-Definition">Site Definition</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.4 Log Handling</h4>

<pre class="example">     c['logCompressionLimit'] = 16384
     c['logCompressionMethod'] = 'gz'
     c['logMaxSize'] = 1024*1024 # 1M
     c['logMaxTailSize'] = 32768
</pre>
   <p><a name="index-c_005b_0027logCompressionLimit_0027_005d-22"></a>The <code>logCompressionLimit</code> enables compression of build logs on
disk for logs that are bigger than the given size, or disables that
completely if set to <code>False</code>. The default value is 4k, which should
be a reasonable default on most file systems. This setting has no impact
on status plugins, and merely affects the required disk space on the
master for build logs.

   <p><a name="index-c_005b_0027logCompressionMethod_0027_005d-23"></a>The <code>logCompressionMethod</code> controls what type of compression is used for
build logs.  The default is 'bz2', the other valid option is 'gz'.  'bz2'
offers better compression at the expense of more CPU time.

   <p><a name="index-c_005b_0027logMaxSize_0027_005d-24"></a>The <code>logMaxSize</code> parameter sets an upper limit (in bytes) to how large
logs from an individual build step can be.  The default value is None, meaning
no upper limit to the log size.  Any output exceeding <code>logMaxSize</code> will be
truncated, and a message to this effect will be added to the log's HEADER
channel.

   <p><a name="index-c_005b_0027logMaxTailSize_0027_005d-25"></a>If <code>logMaxSize</code> is set, and the output from a step exceeds the maximum,
the <code>logMaxTailSize</code> parameter controls how much of the end of the build
log will be kept.  The effect of setting this parameter is that the log will
contain the first <code>logMaxSize</code> bytes and the last <code>logMaxTailSize</code>
bytes of output.  Don't set this value too high, as the the tail of the log is
kept in memory.

<div class="node">
<a name="Data-Lifetime"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Merging-Build-Requests-_0028global-option_0029">Merging Build Requests (global option)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Log-Handling">Log Handling</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.5 Data Lifetime</h4>

<pre class="example">     c['changeHorizon'] = 200
     c['buildHorizon'] = 100
     c['eventHorizon'] = 50
     c['logHorizon'] = 40
     c['caches'] = { 'changes' : 100 }
     c['buildCacheSize'] = 15
</pre>
   <p><a name="index-c_005b_0027caches_0027_005d-26"></a><a name="index-c_005b_0027logHorizon_0027_005d-27"></a><a name="index-c_005b_0027buildCacheSize_0027_005d-28"></a><a name="index-c_005b_0027changeHorizon_0027_005d-29"></a><a name="index-c_005b_0027buildHorizon_0027_005d-30"></a><a name="index-c_005b_0027eventHorizon_0027_005d-31"></a><a name="index-c_005b_0027changeCacheSize_0027_005d-32"></a>

<h3 class="heading">Horizons</h3>

<p>Buildbot stores historical information about builds on disk in the form of
"Pickle" files and compressed logfiles.  In a large installation, these can
quickly consume disk space, yet in many cases developers never consult this
historical information.

   <p>The <code>c['changeHorizon']</code> key determines how many changes the master will
keep a record of. One place these changes are displayed is on the waterfall
page.  This parameter defaults to 0, which means keep all changes indefinitely.

   <p>The <code>buildHorizon</code> specifies the minimum number of builds for each builder
which should be kept on disk.  The <code>eventHorizon</code> specifies the minumum
number of events to keep &ndash; events mostly describe connections and
disconnections of slaves, and are seldom helpful to developers.  The
<code>logHorizon</code> gives the minimum number of builds for which logs should be
maintained; this parameter must be less than <code>buildHorizon</code>. Builds older
than <code>logHorizon</code> but not older than <code>buildHorizon</code> will maintain
their overall status and the status of each step, but the logfiles will be
deleted.

<h3 class="heading">Caches</h3>

<p>The <code>caches</code> configuration key contains the configuration for Buildbot's
in-memory caches.  These caches keep frequently-used objects in memory to avoid
unnecessary trips to the database or to pickle files.  Caches are divided by
object type, and each has a configurable maximum size.  The default size for
each cache is 1, which allows Buildbot to make a number of optimizations
without consuming much memory.  Larger, busier installations will likely want
to increase these values.

   <p>The available caches are:

     <ol type=1 start=1>
<li>Changes

     <p>the number of change objects to cache in memory.  This should be larger than
the number of changes that typically arrive in the span of a few minutes,
otherwise your schedulers will be reloading changes from the database every
time they run.  For distributed version control systems, like git or hg,
several thousand changes may arrive at once, so setting this parameter to
something like 10000 isn't unreasonable.

     <p>This parameter is the same as the deprecated global parameter
<code>changeCacheSize</code>.

     <li>chdicts

     <p>The number of rows from the <code>changes</code> table to cache in memory.  This
value should be similar to the value for <code>Changes</code>.

     <li>BuildRequests

     <p>the number of BuildRequest objects kept in memory.  This number should be
higher than the typical number of outstanding build requests.  If the master
ordinarily finds jobs for BuildRequests immediately, it can be set to a
relatively low value.

     <li>SourceStamps

     <p>the number of SourceStamp objects kept in memory.  This number should generally
be similar to the number BuildRequesets.

     <li>ssdicts

     <p>The number of rows from the <code>sourcestamps</code> table to cache in memory.  This
value should be similar to the value for <code>SourceStamps</code>.

        </ol>

   <p>The <em>global</em> <code>buildCacheSize</code> parameter gives the number of builds
for each builder which are cached in memory.  This number should be larger than
the number of builds required for commonly-used status displays (the waterfall
or grid views), so that those displays do not miss the cache on a refresh.

<pre class="example">     c['buildCacheSize'] = 15
</pre>
   <div class="node">
<a name="Merging-Build-Requests-(global-option)"></a>
<a name="Merging-Build-Requests-_0028global-option_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Prioritizing-Builders">Prioritizing Builders</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Data-Lifetime">Data Lifetime</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.6 Merging Build Requests (global option)</h4>

<p><a name="index-c_005b_0027mergeRequests_0027_005d-33"></a>
This is a global default value for builders' <code>mergeRequests</code> parameter,
and controls the merging of build requests.  See <a href="#Merging-Build-Requests">Merging Build Requests</a>
for more details.

<div class="node">
<a name="Prioritizing-Builders"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Setting-the-PB-Port-for-Slaves">Setting the PB Port for Slaves</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Merging-Build-Requests-_0028global-option_0029">Merging Build Requests (global option)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.7 Prioritizing Builders</h4>

<p><a name="index-c_005b_0027prioritizeBuilders_0027_005d-34"></a>
By default, buildbot will attempt to start builds on builders in order from the
builder with the highest priority or oldest pending request to the
lowest-priority, newest request. This behaviour can be customized with the
<code>c['prioritizeBuilders']</code> configuration key.  This key specifies a
function which is called with two arguments: a <code>BuildMaster</code> and a list of
<code>Builder</code> objects. It should return a list of <code>Builder</code> objects in
the desired order.  It may also remove items from the list if builds should not
be started on those builders.  If necessary, this function can return its
results via a Deferred (it is called with <code>maybeDeferred</code>).

   <p>This parameter controls the order in which builders are activated.  It does not
affect the order in which a builder processes the build requests in its queue. 
For that purpose, see see <a href="#Prioritizing-Builds">Prioritizing Builds</a>.

<pre class="example">     def prioritizeBuilders(buildmaster, builders):
         """Prioritize builders.  'finalRelease' builds have the highest
         priority, so they should be built before running tests, or
         creating builds."""
         builderPriorities = {
             "finalRelease": 0,
             "test": 1,
             "build": 2,
         }
         builders.sort(key=lambda b: builderPriorities.get(b.name, 0))
         return builders
     
     c['prioritizeBuilders'] = prioritizeBuilders
</pre>
   <div class="node">
<a name="Setting-the-PB-Port-for-Slaves"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Defining-Global-Properties">Defining Global Properties</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Prioritizing-Builders">Prioritizing Builders</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.8 Setting the PB Port for Slaves</h4>

<p><a name="index-c_005b_0027slavePortnum_0027_005d-35"></a>
<pre class="example">     c['slavePortnum'] = 10000
</pre>
   <p>The buildmaster will listen on a TCP port of your choosing for
connections from buildslaves. It can also use this port for
connections from remote Change Sources, status clients, and debug
tools. This port should be visible to the outside world, and you'll
need to tell your buildslave admins about your choice.

   <p>It does not matter which port you pick, as long it is externally
visible, however you should probably use something larger than 1024,
since most operating systems don't allow non-root processes to bind to
low-numbered ports. If your buildmaster is behind a firewall or a NAT
box of some sort, you may have to configure your firewall to permit
inbound connections to this port.

   <p><code>c['slavePortnum']</code> is a <em>strports</em> specification string,
defined in the <code>twisted.application.strports</code> module (try
<samp><span class="command">pydoc twisted.application.strports</span></samp> to get documentation on
the format). This means that you can have the buildmaster listen on a
localhost-only port by doing:

<pre class="example">     c['slavePortnum'] = "tcp:10000:interface=127.0.0.1"
</pre>
   <p>This might be useful if you only run buildslaves on the same machine,
and they are all configured to contact the buildmaster at
<code>localhost:10000</code>.

<div class="node">
<a name="Defining-Global-Properties"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Debug-Options">Debug Options</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Setting-the-PB-Port-for-Slaves">Setting the PB Port for Slaves</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.9 Defining Global Properties</h4>

<p><a name="index-c_005b_0027properties_0027_005d-36"></a><a name="index-Properties-37"></a>
The <code>'properties'</code> configuration key defines a dictionary
of properties that will be available to all builds started by the
buildmaster:

<pre class="example">     c['properties'] = {
         'Widget-version' : '1.2',
         'release-stage' : 'alpha'
     }
</pre>
   <div class="node">
<a name="Debug-Options"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Metrics-Options">Metrics Options</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Defining-Global-Properties">Defining Global Properties</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.10 Debug Options</h4>

<p><a name="index-c_005b_0027debugPassword_0027_005d-38"></a>If you set <code>c['debugPassword']</code>, then you can connect to the
buildmaster with the diagnostic tool launched by <code>buildbot
debugclient MASTER:PORT</code>. From this tool, you can reload the config
file, manually force builds, and inject changes, which may be useful
for testing your buildmaster without actually commiting changes to
your repository (or before you have the Change Sources set up). The
debug tool uses the same port number as the slaves do:
<code>c['slavePortnum']</code>, and is authenticated with this password.

<pre class="example">     c['debugPassword'] = "debugpassword"
</pre>
   <p><a name="index-c_005b_0027manhole_0027_005d-39"></a>If you set <code>c['manhole']</code> to an instance of one of the classes in
<code>buildbot.manhole</code>, you can telnet or ssh into the buildmaster
and get an interactive Python shell, which may be useful for debugging
buildbot internals. It is probably only useful for buildbot
developers. It exposes full access to the buildmaster's account
(including the ability to modify and delete files), so it should not
be enabled with a weak or easily guessable password.

   <p>There are three separate <code>Manhole</code> classes. Two of them use SSH,
one uses unencrypted telnet. Two of them use a username+password
combination to grant access, one of them uses an SSH-style
<samp><span class="file">authorized_keys</span></samp> file which contains a list of ssh public keys.

   <p>Note that using any Manhole requires that <code>pycrypto</code> and <code>pyasn1</code> be
installed.  These are not part of the normal Buildbot dependencies.

     <dl>
<dt><code>buildbot.manhole.AuthorizedKeysManhole</code><dd>You construct this with the name of a file that contains one SSH
public key per line, just like <samp><span class="file">~/.ssh/authorized_keys</span></samp>. If you
provide a non-absolute filename, it will be interpreted relative to
the buildmaster's base directory.

     <br><dt><code>buildbot.manhole.PasswordManhole</code><dd>This one accepts SSH connections but asks for a username and password
when authenticating. It accepts only one such pair.

     <br><dt><code>buildbot.manhole.TelnetManhole</code><dd>This accepts regular unencrypted telnet connections, and asks for a
username/password pair before providing access. Because this
username/password is transmitted in the clear, and because Manhole
access to the buildmaster is equivalent to granting full shell
privileges to both the buildmaster and all the buildslaves (and to all
accounts which then run code produced by the buildslaves), it is
highly recommended that you use one of the SSH manholes instead.

   </dl>

<pre class="example">     # some examples:
     from buildbot import manhole
     c['manhole'] = manhole.AuthorizedKeysManhole(1234, "authorized_keys")
     c['manhole'] = manhole.PasswordManhole(1234, "alice", "mysecretpassword")
     c['manhole'] = manhole.TelnetManhole(1234, "bob", "snoop_my_password_please")
</pre>
   <p>The <code>Manhole</code> instance can be configured to listen on a specific
port. You may wish to have this listening port bind to the loopback
interface (sometimes known as &ldquo;lo0&rdquo;, &ldquo;localhost&rdquo;, or 127.0.0.1) to
restrict access to clients which are running on the same host.

<pre class="example">     from buildbot.manhole import PasswordManhole
     c['manhole'] = PasswordManhole("tcp:9999:interface=127.0.0.1","admin","passwd")
</pre>
   <p>To have the <code>Manhole</code> listen on all interfaces, use
<code>"tcp:9999"</code> or simply 9999. This port specification uses
<code>twisted.application.strports</code>, so you can make it listen on SSL
or even UNIX-domain sockets if you want.

   <p>The buildmaster's SSH server will use a different host key than the
normal sshd running on a typical unix host. This will cause the ssh
client to complain about a &ldquo;host key mismatch&rdquo;, because it does not
realize there are two separate servers running on the same host. To
avoid this, use a clause like the following in your <samp><span class="file">.ssh/config</span></samp>
file:

<pre class="example">     Host remotehost-buildbot
      HostName remotehost
      HostKeyAlias remotehost-buildbot
      Port 9999
      # use 'user' if you use PasswordManhole and your name is not 'admin'.
      # if you use AuthorizedKeysManhole, this probably doesn't matter.
      User admin
</pre>
   <h3 class="heading">Using Manhole</h3>

<p>After you have connected to a manhole instance, you will find yourself at a
Python prompt.  You have access to two objects: <code>master</code> (the BuildMaster)
and <code>status</code> (the master's Status object).  Most interesting objects on
the master can be reached from these two objects.

   <p>To aid in navigation, the <code>show</code> method is defined.  It displays the
non-method attributes of an object.

   <p>A manhole session might look like:

<pre class="example">     &gt;&gt;&gt; show(master)
     data attributes of &lt;buildbot.master.BuildMaster instance at 0x7f7a4ab7df38&gt;
                            basedir : '/home/dustin/code/buildbot/t/buildbot/'...
                          botmaster : &lt;type 'instance'&gt;
                     buildCacheSize : None
                       buildHorizon : None
                        buildbotURL : http://localhost:8010/
                    changeCacheSize : None
                         change_svc : &lt;type 'instance'&gt;
                     configFileName : master.cfg
                                 db : &lt;class 'buildbot.db.connector.DBConnector'&gt;
                   db_poll_interval : None
                             db_url : sqlite:///state.sqlite
                                   ...
     &gt;&gt;&gt; show(master.botmaster.builders['win32'])
     data attributes of &lt;Builder ''builder'' at 48963528&gt;
                                   ...
     &gt;&gt;&gt; win32 = _
     &gt;&gt;&gt; win32.category = 'w32'
</pre>
   <div class="node">
<a name="Metrics-Options"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Debug-Options">Debug Options</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Global-Configuration">Global Configuration</a>

</div>

<h4 class="subsection">4.6.11 Metrics Options</h4>

<p><code>c['metrics'] = dict(log_interval=10, periodic_interval=10)</code>

   <p><code>c['metrics']</code> can be a dictionary that configures various aspects of the metrics subsystem. If <code>c['metrics']</code> is None, then metrics collection, logging and reporting will be disabled.

   <p><code>log_interval</code> determines how often metrics should be logged to twistd.log. It default to 60s. If set to 0 or None, then logging of metrics will be disabled. This value can be changed via a reconfig.

   <p><code>periodic_interval</code> determines how often various non-event based metrics are collected, such as memory usage, uncollectable garbage, reactor delay. This defaults to 10s. If set to 0 or None, then periodic collection of this data is disabled. This value can also be changed via a reconifg.

   <p>Read more about metrics in the <a href="#Metrics">Metrics</a> section of the documentation.

<div class="node">
<a name="Change-Sources"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Schedulers">Schedulers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Global-Configuration">Global Configuration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.7 Change Sources</h3>

<p>A Version Control System mantains a source tree, and tells the
buildmaster when it changes. The first step of each Build is typically
to acquire a copy of some version of this tree.

   <p>This chapter describes how the Buildbot learns about what Changes have
occurred. For more information on VC systems and Changes, see
<a href="#Version-Control-Systems">Version Control Systems</a>.

   <p>Changes can be provided by a variety of ChangeSource types, although any given
project will typically have only a single ChangeSource active. This section
provides a description of all available ChangeSource types and explains how to
set up each of them.

   <p>In general, each Buildmaster watches a single source tree.  It is possible to
work around this, but true support for multi-tree builds remains elusive.

<ul class="menu">
<li><a accesskey="1" href="#Choosing-a-Change-Source">Choosing a Change Source</a>
<li><a accesskey="2" href="#Configuring-Change-Sources">Configuring Change Sources</a>
<li><a accesskey="3" href="#Mail_002dparsing-ChangeSources">Mail-parsing ChangeSources</a>
<li><a accesskey="4" href="#PBChangeSource">PBChangeSource</a>
<li><a accesskey="5" href="#P4Source">P4Source</a>
<li><a accesskey="6" href="#BonsaiPoller">BonsaiPoller</a>
<li><a accesskey="7" href="#SVNPoller">SVNPoller</a>
<li><a accesskey="8" href="#Bzr-Poller">Bzr Poller</a>
<li><a accesskey="9" href="#Change-Hooks-_0028HTTP-Notifications_0029">Change Hooks (HTTP Notifications)</a>
<li><a href="#GoogleCodeAtomPoller">GoogleCodeAtomPoller</a>
<li><a href="#GitPoller">GitPoller</a>
<li><a href="#GerritChangeSource">GerritChangeSource</a>
<li><a href="#Change-Source-Index">Change Source Index</a>
</ul>

<div class="node">
<a name="Choosing-a-Change-Source"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Configuring-Change-Sources">Configuring Change Sources</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.1 Choosing a Change Source</h4>

<p>There are a variety of ChangeSources available, some of which are
meant to be used in conjunction with other tools to deliver Change
events from the VC repository to the buildmaster.

   <p>As a quick guide, here is a list of VC systems and the ChangeSources that might
be useful with them. All of these ChangeSources are in the
<code>buildbot.changes</code> module.  The <code>contrib/</code> scripts mentioned below
are available on github - see <a href="#Contrib-Scripts">Contrib Scripts</a>.

     <dl>
<dt><code>CVS</code><dd>
          <ul>
<li>mail.CVSMaildirSource (watching mail sent by <code>contrib/buildbot_cvs_mail.py</code> script)
<li>pb.PBChangeSource (see <a href="#PBChangeSource">PBChangeSource</a>) (listening for connections from <code>buildbot sendchange</code> run in a loginfo script)
<li>pb.PBChangeSource (listening for connections from a long-running
<code>contrib/viewcvspoll.py</code> polling process which examines the ViewCVS database directly
<li>change_hook in WebStatus (
<code>status.web.change_hook</code>)
</ul>

     <br><dt><code>SVN</code><dd>
          <ul>
<li>pb.PBChangeSource (listening for connections from
<code>contrib/svn_buildbot.py</code> run in a postcommit script)
<li>pb.PBChangeSource (listening for connections from a long-running
<code>contrib/svn_watcher.py</code> or <code>contrib/svnpoller.py</code> polling
process
<li>mail.SVNCommitEmailMaildirSource (watching for email sent by commit-email.pl)
<li>svnpoller.SVNPoller (polling the SVN repository)
<li>change_hook in WebStatus (
<code>status.web.change_hook</code>)
<li><code>contrib/googlecode_atom.py</code>'s GoogleCodeAtomPoller (polling the commit feed for a GoogleCode SVN repository)
</ul>

     <br><dt><code>Darcs</code><dd>
          <ul>
<li>pb.PBChangeSource (listening for connections from
<code>contrib/darcs_buildbot.py</code> in a commit script
<li>change_hook in WebStatus (
<code>status.web.change_hook</code>)
</ul>

     <br><dt><code>Mercurial</code><dd>
          <ul>
<li>pb.PBChangeSource (listening for connections from
<code>buildbot/changes/hgbuildbot.py</code> run as an in-process 'changegroup'
hook)
<li>change_hook in WebStatus (
<code>status.web.change_hook</code>)
<li><code>contrib/googlecode_atom.py</code>'s GoogleCodeAtomPoller (polling the commit feed for a GoogleCode Mercurial repository)
</ul>

     <br><dt><code>Bzr (the newer Bazaar)</code><dd>
          <ul>
<li>pb.PBChangeSource (listening for connections from
<code>contrib/bzr_buildbot.py</code> run in a post-change-branch-tip or commit hook)
<li><code>contrib/bzr_buildbot.py</code>'s BzrPoller (polling the Bzr repository)
<li>change_hook in WebStatus (
<code>status.web.change_hook</code>)
</ul>

     <br><dt><code>Git</code><dd>
          <ul>
<li>pb.PBChangeSource (listening for connections from <code>contrib/git_buildbot.py</code> run in the post-receive hook)
<li>pb.PBChangeSource (listening for connections from <code>contrib/github_buildbot.py</code>, which listens for notifications from github)
<li>change_hook in WebStatus (see <a href="#Change-Hooks">Change Hooks</a>)
<li>github change hook (specifically designed for github notifications, but requiring a publicly-accessible WebStatus)
<li><code>gitpoller.GitPoller</code> (polling a remote git repository)
</ul>

     <br><dt><code>Repo/Git</code><dd>
          <ul>
<li><code>gerritchangesource.GerritChangeSource</code> connects to Gerrit via SSH to get a live stream of changes
</ul>

     <br><dt><code>Monotone</code><dd>
          <ul>
<li>pb.PBChangeSource (listening for connections from
<code>monotone-buildbot.lua</code>, which is available with monotone)
</ul>

   </dl>

   <p>All VC systems can be driven by a PBChangeSource, and the
<code>buildbot sendchange</code> tool run from some form of commit script. 
If you write an email parsing function, they can also all be driven by
a suitable <code>MaildirSource</code>. Additionally, handlers for web-based
notification (i.e. from github) can be used with WebStatus' change_hook
module. The interface is simple, so adding your own handlers (and sharing!) 
should be a breeze.

<div class="node">
<a name="Configuring-Change-Sources"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mail_002dparsing-ChangeSources">Mail-parsing ChangeSources</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Choosing-a-Change-Source">Choosing a Change Source</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.2 Configuring Change Sources</h4>

<p><a name="index-c_005b_0027change_005fsource_0027_005d-40"></a>
The <code>master.cfg</code> configuration file has a dictionary key named
<code>BuildmasterConfig['change_source']</code>, which holds the active
<code>IChangeSource</code> object. The config file will typically create an
object from one of the classes described below and stuff it into this
key.

   <p>Each buildmaster typically has just a single ChangeSource, since it is
only watching a single source tree. But if, for some reason, you need
multiple sources, just set <code>c['change_source']</code> to a list of
ChangeSources.

<pre class="example">     s = PBChangeSource()
     c['change_source'] = [s]
</pre>
   <p>Each source tree has a nominal <code>top</code>. Each Change has a list of
filenames, which are all relative to this top location. The
ChangeSource is responsible for doing whatever is necessary to
accomplish this. Most sources have a <code>prefix</code> argument: a partial
pathname which is stripped from the front of all filenames provided to
that <code>ChangeSource</code>. Files which are outside this sub-tree are
ignored by the changesource: it does not generate Changes for those
files.

<h3 class="heading">Repository and Project</h3>

<p>ChangeSources will, in general, automatically provide the proper 'repository'
attribute for any changes they produce.  For systems which operate on URL-like
specifiers, this is a repository URL. Other ChangeSources adapt the concept as
necessary.

   <p>Many ChangeSources allow you to specify a project, as well.  This attribute is
useful when building from several distinct codebases in the same buildmaster:
the project string can serve to differentiate the different codebases. 
Schedulers can filter on project, so you can configure different builders to
run for each project.

<div class="node">
<a name="Mail-parsing-ChangeSources"></a>
<a name="Mail_002dparsing-ChangeSources"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#PBChangeSource">PBChangeSource</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configuring-Change-Sources">Configuring Change Sources</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.3 Mail-parsing ChangeSources</h4>

<p>Many projects publish information about changes to their source tree
by sending an email message out to a mailing list, frequently named
PROJECT-commits or PROJECT-changes. Each message usually contains a
description of the change (who made the change, which files were
affected) and sometimes a copy of the diff. Humans can subscribe to
this list to stay informed about what's happening to the source tree.

   <p>The Buildbot can also be subscribed to a -commits mailing list, and
can trigger builds in response to Changes that it hears about. The
buildmaster admin needs to arrange for these email messages to arrive
in a place where the buildmaster can find them, and configure the
buildmaster to parse the messages correctly. Once that is in place,
the email parser will create Change objects and deliver them to the
Schedulers (see see <a href="#Schedulers">Schedulers</a>) just like any other ChangeSource.

   <p>There are two components to setting up an email-based ChangeSource. 
The first is to route the email messages to the buildmaster, which is
done by dropping them into a &ldquo;maildir&rdquo;. The second is to actually
parse the messages, which is highly dependent upon the tool that was
used to create them. Each VC system has a collection of favorite
change-emailing tools, and each has a slightly different format, so
each has a different parsing function. There is a separate
ChangeSource variant for each parsing function.

   <p>Once you've chosen a maildir location and a parsing function, create
the change source and put it in <code>c['change_source']</code>:

<pre class="example">     from buildbot.changes.mail import CVSMaildirSource
     c['change_source'] = CVSMaildirSource("/home/buildbot/Mail", urlmaker=fileToUrl)
</pre>
   <ul class="menu">
<li><a accesskey="1" href="#Subscribing-the-Buildmaster">Subscribing the Buildmaster</a>
<li><a accesskey="2" href="#Using-Maildirs">Using Maildirs</a>
<li><a accesskey="3" href="#Parsing-Email-Change-Messages">Parsing Email Change Messages</a>
<li><a accesskey="4" href="#CVSMaildirSource">CVSMaildirSource</a>
<li><a accesskey="5" href="#SVNCommitEmailMaildirSource">SVNCommitEmailMaildirSource</a>
<li><a accesskey="6" href="#BzrLaunchpadEmailMaildirSource">BzrLaunchpadEmailMaildirSource</a>
</ul>

<div class="node">
<a name="Subscribing-the-Buildmaster"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Using-Maildirs">Using Maildirs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mail_002dparsing-ChangeSources">Mail-parsing ChangeSources</a>

</div>

<h5 class="subsubsection">4.7.3.1 Subscribing the Buildmaster</h5>

<p>The recommended way to install the buildbot is to create a dedicated
account for the buildmaster. If you do this, the account will probably
have a distinct email address (perhaps
<a href="mailto:buildmaster@example.org">buildmaster@example.org</a>). Then just arrange for this
account's email to be delivered to a suitable maildir (described in
the next section).

   <p>If the buildbot does not have its own account, &ldquo;extension addresses&rdquo;
can be used to distinguish between email intended for the buildmaster
and email intended for the rest of the account. In most modern MTAs,
the e.g. <code>foo@example.org</code> account has control over every email
address at example.org which begins with "foo", such that email
addressed to <a href="mailto:account-foo@example.org">account-foo@example.org</a> can be delivered to a
different destination than <a href="mailto:account-bar@example.org">account-bar@example.org</a>. qmail
does this by using separate .qmail files for the two destinations
(<samp><span class="file">.qmail-foo</span></samp> and <samp><span class="file">.qmail-bar</span></samp>, with <samp><span class="file">.qmail</span></samp>
controlling the base address and <samp><span class="file">.qmail-default</span></samp> controlling all
other extensions). Other MTAs have similar mechanisms.

   <p>Thus you can assign an extension address like
<a href="mailto:foo-buildmaster@example.org">foo-buildmaster@example.org</a> to the buildmaster, and retain
<a href="mailto:foo@example.org">foo@example.org</a> for your own use.

<div class="node">
<a name="Using-Maildirs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Parsing-Email-Change-Messages">Parsing Email Change Messages</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Subscribing-the-Buildmaster">Subscribing the Buildmaster</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mail_002dparsing-ChangeSources">Mail-parsing ChangeSources</a>

</div>

<h5 class="subsubsection">4.7.3.2 Using Maildirs</h5>

<p>A &ldquo;maildir&rdquo; is a simple directory structure originally developed for
qmail that allows safe atomic update without locking. Create a base
directory with three subdirectories: &ldquo;new&rdquo;, &ldquo;tmp&rdquo;, and &ldquo;cur&rdquo;. 
When messages arrive, they are put into a uniquely-named file (using
pids, timestamps, and random numbers) in &ldquo;tmp&rdquo;. When the file is
complete, it is atomically renamed into &ldquo;new&rdquo;. Eventually the
buildmaster notices the file in &ldquo;new&rdquo;, reads and parses the
contents, then moves it into &ldquo;cur&rdquo;. A cronjob can be used to delete
files in &ldquo;cur&rdquo; at leisure.

   <p>Maildirs are frequently created with the <samp><span class="command">maildirmake</span></samp> tool,
but a simple <samp><span class="command">mkdir -p ~/MAILDIR/{cur,new,tmp}</span></samp> is pretty much
equivalent.

   <p>Many modern MTAs can deliver directly to maildirs. The usual .forward
or .procmailrc syntax is to name the base directory with a trailing
slash, so something like <code>~/MAILDIR/</code> . qmail and postfix are
maildir-capable MTAs, and procmail is a maildir-capable MDA (Mail
Delivery Agent).

   <p>Here is an example procmail config, located in ~/.procmailrc

<pre class="example">     # .procmailrc
     # routes incoming mail to appropriate mailboxes
     PATH=/usr/bin:/usr/local/bin
     MAILDIR=$HOME/Mail
     LOGFILE=.procmail_log
     SHELL=/bin/sh
     
     :0
     *
     new
</pre>
   <p>If procmail is not setup on a system wide basis, then the following one-line
<samp><span class="file">.forward</span></samp> file will invoke it.

<pre class="example">     !/usr/bin/procmail
</pre>
   <p>For MTAs which cannot put files into maildirs directly, the
<samp><span class="file">safecat</span></samp> tool can be executed from a <samp><span class="file">.forward</span></samp> file to accomplish
the same thing.

   <p>The Buildmaster uses the linux DNotify facility to receive immediate
notification when the maildir's &ldquo;new&rdquo; directory has changed. When
this facility is not available, it polls the directory for new
messages, every 10 seconds by default.

<div class="node">
<a name="Parsing-Email-Change-Messages"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CVSMaildirSource">CVSMaildirSource</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Using-Maildirs">Using Maildirs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mail_002dparsing-ChangeSources">Mail-parsing ChangeSources</a>

</div>

<h5 class="subsubsection">4.7.3.3 Parsing Email Change Messages</h5>

<p>The second component to setting up an email-based ChangeSource is to
parse the actual notices. This is highly dependent upon the VC system
and commit script in use.

   <p>A couple of common tools used to create these change emails, along with the
buildbot tools to parse them, are:

     <dl>
<dt><b>CVS</b><dd>
          <dl>
<dt>&lsquo;<samp><span class="samp">Buildbot CVS MailNotifier</span></samp>&rsquo;<dd><a href="#CVSMaildirSource">CVSMaildirSource</a>
</dl>

     <br><dt><b>SVN</b><dd>
          <dl>
<dt>&lsquo;<samp><span class="samp">svnmailer</span></samp>&rsquo;<dd>http://opensource.perlig.de/en/svnmailer/
<br><dt>&lsquo;<samp><span class="samp">commit-email.pl</span></samp>&rsquo;<dd><a href="#SVNCommitEmailMaildirSource">SVNCommitEmailMaildirSource</a>
</dl>

     <br><dt><b>Bzr</b><dd>
          <dl>
<dt>&lsquo;<samp><span class="samp">Launchpad</span></samp>&rsquo;<dd><a href="#BzrLaunchpadEmailMaildirSource">BzrLaunchpadEmailMaildirSource</a>
</dl>

     <br><dt><b>Mercurial</b><dd>
          <dl>
<dt>&lsquo;<samp><span class="samp">NotifyExtension</span></samp>&rsquo;<dd>http://www.selenic.com/mercurial/wiki/index.cgi/NotifyExtension
</dl>

     <br><dt><b>Git</b><dd>
          <dl>
<dt>&lsquo;<samp><span class="samp">post-receive-email</span></samp>&rsquo;<dd>http://git.kernel.org/?p=git/git.git;a=blob;f=contrib/hooks/post-receive-email;hb=HEAD
</dl>

   </dl>

   <p>The following sections describe the parsers available for each of
these tools.

   <p>Most of these parsers accept a <code>prefix=</code> argument, which is used
to limit the set of files that the buildmaster pays attention to. This
is most useful for systems like CVS and SVN which put multiple
projects in a single repository (or use repository names to indicate
branches). Each filename that appears in the email is tested against
the prefix: if the filename does not start with the prefix, the file
is ignored. If the filename <em>does</em> start with the prefix, that
prefix is stripped from the filename before any further processing is
done. Thus the prefix usually ends with a slash.

<div class="node">
<a name="CVSMaildirSource"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#SVNCommitEmailMaildirSource">SVNCommitEmailMaildirSource</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Parsing-Email-Change-Messages">Parsing Email Change Messages</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mail_002dparsing-ChangeSources">Mail-parsing ChangeSources</a>

</div>

<h5 class="subsubsection">4.7.3.4 CVSMaildirSource</h5>

<p><a name="index-buildbot_002echanges_002email_002eCVSMaildirSource-41"></a>
This parser works with the <samp><span class="file">buildbot_cvs_maildir.py</span></samp> script in the
contrib directory.

   <p>The script sends an email containing all the files submitted in
one directory. It is invoked by using the <samp><span class="file">CVSROOT/loginfo</span></samp> facility.

   <p>The Buildbot's <code>CVSMaildirSource</code> knows how to parse
these messages and turn them into Change objects. It takes two parameters,
the directory name of the maildir root, and an optional function to create
a URL for each file. The function takes three parameters:

<pre class="example">      file   - file name
      oldRev - old revision of the file
      newRev - new revision of the file
</pre>
   <p>It must return, oldly enough, a url for the file in question. For example:

<pre class="example">     def fileToUrl( file, oldRev, newRev ):
         return 'http://example.com/cgi-bin/cvsweb.cgi/' + file + '?rev=' + newRev
     
     from buildbot.changes.mail import CVSMaildirSource
     c['change_source'] = CVSMaildirSource("/home/buildbot/Mail", urlmaker=fileToUrl)
</pre>
   <h4 class="subheading">Configuration of CVS and buildbot_cvs_mail.py</h4>

<p>CVS must be configured to invoke the buildbot_cvs_mail.py script when files
are checked in. This is done via the CVS loginfo configuration file.

   <p>To update this, first do:

<pre class="example">     cvs checkout CVSROOT
</pre>
   <p>cd to the CVSROOT directory and edit the file loginfo, adding a line like:

<pre class="example">     SomeModule /cvsroot/CVSROOT/buildbot_cvs_mail.py --cvsroot :ext:example.com:/cvsroot -e buildbot -P SomeModule %{sVv}
</pre>
   <p><em>NOTE:</em> For cvs version 1.12.x, the '<code>--path %p</code>' option is required. 
Version 1.11.x and 1.12.x report the directory path differently.

   <p>The above example you put the buildbot_cvs_mail.py script under /cvsroot/CVSROOT. 
It can be anywhere. Run the script with &ndash;help to see all the options. 
At the very least, the
options <code>-e</code> (email) and <code>-P</code> (project) should be specified. The line must end with <code>%{sVv}</code>
This is expanded to the files that were modified.

   <p>Additional entries can be added to support more modules.

   <p>The following is an abreviated form of buildbot_cvs_mail.py &ndash;help

<pre class="example">     
     Usage:
     
         buildbot-cvs-mail [options] %{sVv}
     
     Where options are:
     
         --category=category
         -C
             Category for change. This becomes the Change.category attribute.
             This may not make sense to specify it here, as category is meant
             to distinguish the diffrent types of bots inside a same project,
             such as "test", "docs", "full"
     
         --cvsroot=&lt;path&gt;
         -c
             CVSROOT for use by buildbot slaves to checkout code.
             This becomes the Change.repository attribute.
             Exmaple: :ext:myhost:/cvsroot
     
         --email=email
         -e email
             Email address of the buildbot.
     
         --fromhost=hostname
         -f hostname
             The hostname that email messages appear to be coming from.  The From:
             header of the outgoing message will look like user@hostname.  By
             default, hostname is the machine's fully qualified domain name.
     
         --help / -h
             Print this text.
     
         -m hostname
         --mailhost=hostname
             The hostname of an available SMTP server.  The default is
             'localhost'.
     
         --mailport=port
             The port number of SMTP server.  The default is '25'.
     
         --quiet / -q
             Don't print as much status to stdout.
     
         --path=path
         -p path
             The path for the files in this update. This comes from the %p parameter
             in loginfo for CVS version 1.12.x. Do not use this for CVS version 1.11.x
     
         --project=project
         -P project
             The project for the source. Use the CVS module being modified. This
             becomes the Change.project attribute.
     
         -R ADDR
         --reply-to=ADDR
           Add a "Reply-To: ADDR" header to the email message.
     
         -t
         --testing
           Construct message and send to stdout for testing
     
     The rest of the command line arguments are:
     
         %{sVv}
             CVS %{sVv} loginfo expansion.  When invoked by CVS, this will be a single
             string containing the files that are changing.
</pre>
   <div class="node">
<a name="SVNCommitEmailMaildirSource"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#BzrLaunchpadEmailMaildirSource">BzrLaunchpadEmailMaildirSource</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CVSMaildirSource">CVSMaildirSource</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mail_002dparsing-ChangeSources">Mail-parsing ChangeSources</a>

</div>

<h5 class="subsubsection">4.7.3.5 SVNCommitEmailMaildirSource</h5>

<p><a name="index-buildbot_002echanges_002email_002eSVNCommitEmailMaildirSource-42"></a>
<code>SVNCommitEmailMaildirSource</code> parses message sent out by the
<code>commit-email.pl</code> script, which is included in the Subversion
distribution.

   <p>It does not currently handle branches: all of the Change objects that
it creates will be associated with the default (i.e. trunk) branch.

<pre class="example">     from buildbot.changes.mail import SVNCommitEmailMaildirSource
     c['change_source'] = SVNCommitEmailMaildirSource("~/maildir-buildbot")
</pre>
   <div class="node">
<a name="BzrLaunchpadEmailMaildirSource"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#SVNCommitEmailMaildirSource">SVNCommitEmailMaildirSource</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mail_002dparsing-ChangeSources">Mail-parsing ChangeSources</a>

</div>

<h5 class="subsubsection">4.7.3.6 BzrLaunchpadEmailMaildirSource</h5>

<p><a name="index-buildbot_002echanges_002email_002eBzrLaunchpadEmailMaildirSource-43"></a>
<code>BzrLaunchpadEmailMaildirSource</code> parses the mails that are sent to
addresses that subscribe to branch revision notifications for a bzr branch
hosted on Launchpad.

   <p>The branch name defaults to <code>lp:&lt;Launchpad path&gt;</code>. For example
<code>lp:~maria-captains/maria/5.1</code>.

   <p>If only a single branch is used, the default branch name can be changed by
setting <code>defaultBranch</code>.

   <p>For multiple branches, pass a dictionary as the value of the <code>branchMap</code>
option to map specific repository paths to specific branch names (see example
below). The leading <code>lp:</code> prefix of the path is optional.

   <p>The <code>prefix</code> option is not supported (it is silently ignored). Use the
<code>branchMap</code> and <code>defaultBranch</code> instead to assign changes to
branches (and just do not subscribe the buildbot to branches that are not of
interest).

   <p>The revision number is obtained from the email text. The bzr revision id is
not available in the mails sent by Launchpad. However, it is possible to set
the bzr <code>append_revisions_only</code> option for public shared repositories to
avoid new pushes of merges changing the meaning of old revision numbers.

<pre class="verbatim">from buildbot.changes.mail import BzrLaunchpadEmailMaildirSource
bm = { 'lp:~maria-captains/maria/5.1' : '5.1', 'lp:~maria-captains/maria/6.0' : '6.0' }
c['change_source'] = BzrLaunchpadEmailMaildirSource("~/maildir-buildbot", branchMap = bm)
</pre>

<div class="node">
<a name="PBChangeSource"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#P4Source">P4Source</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mail_002dparsing-ChangeSources">Mail-parsing ChangeSources</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.4 PBChangeSource</h4>

<p><a name="index-buildbot_002echanges_002epb_002ePBChangeSource-44"></a>
<code>PBChangeSource</code> actually listens on a TCP port for clients to connect and
push change notices <em>into</em> the Buildmaster. This is used by the built-in
<code>buildbot sendchange</code> notification tool, as well as several
version-control hook scripts.  This change source is also useful for creating
new kinds of change sources that work on a <code>push</code> model instead of some
kind of subscription scheme, for example a script which is run out of an email
<samp><span class="file">.forward</span></samp> file. 
This ChangeSource always runs on the same TCP port as the slaves.  It
shares the same protocol, and in fact shares the same space of "usernames", so you cannot configure a <code>PBChangeSource</code> with the same name as a slave.

   <p>If you have a publicly accessible slave port, and are using
<code>PBChangeSource</code>, <em>you must establish a secure username and password
for the change source</em>.  If your sendchange credentials are known (e.g., the
defaults), then your buildmaster is susceptible to injection of arbitrary
changes, which (depending on the build factories) could lead to arbitrary code
execution on buildslaves.

   <p>The <code>PBChangeSource</code> is created with the following arguments.

     <dl>
<dt>&lsquo;<samp><code>port</code></samp>&rsquo;<dd>which port to listen on. If <code>None</code> (which is the default), it
shares the port used for buildslave connections.

     <br><dt>&lsquo;<samp><code>user</code><span class="samp"> and </span><code>passwd</code></samp>&rsquo;<dd>The user/passwd account information that the client program must use
to connect. Defaults to <code>change</code> and <code>changepw</code>.  Do not use
these defaults on a publicly exposed port!

     <br><dt>&lsquo;<samp><code>prefix</code></samp>&rsquo;<dd>The prefix to be found and stripped from filenames delivered over the
connection, defaulting to None. Any filenames which do not start with this
prefix will be removed. If all the filenames in a given Change are removed, the
that whole Change will be dropped. This string should probably end with a
directory separator.

     <p>This is useful for changes coming from version control systems that
represent branches as parent directories within the repository (like
SVN and Perforce). Use a prefix of 'trunk/' or
'project/branches/foobranch/' to only follow one branch and to get
correct tree-relative filenames. Without a prefix, the PBChangeSource
will probably deliver Changes with filenames like <samp><span class="file">trunk/foo.c</span></samp>
instead of just <samp><span class="file">foo.c</span></samp>. Of course this also depends upon the
tool sending the Changes in (like <samp><span class="command">buildbot sendchange</span></samp>) and
what filenames it is delivering: that tool may be filtering and
stripping prefixes at the sending end.

   </dl>

   <p>The following hooks are useful for sending changes to a PBChangeSource:

<ul class="menu">
<li><a accesskey="1" href="#Mercurial-Hook">Mercurial Hook</a>
<li><a accesskey="2" href="#Bzr-Hook">Bzr Hook</a>
</ul>

<div class="node">
<a name="Mercurial-Hook"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Bzr-Hook">Bzr Hook</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#PBChangeSource">PBChangeSource</a>

</div>

<h5 class="subsubsection">4.7.4.1 Mercurial Hook</h5>

<p>Since Mercurial is written in python, the hook script can invoke
Buildbot's <code>sendchange</code> function directly, rather than having to
spawn an external process. This function delivers the same sort of
changes as <code>buildbot sendchange</code> and the various hook scripts in
<code>contrib/</code>, so you'll need to add a <code>pb.PBChangeSource</code> to your
buildmaster to receive these changes.

   <p>To set this up, first choose a Mercurial repository that represents
your central &ldquo;official&rdquo; source tree. This will be the same
repository that your buildslaves will eventually pull from. Install
Buildbot on the machine that hosts this repository, using the same
version of python as Mercurial is using (so that the Mercurial hook
can import code from buildbot). Then add the following to the
<code>.hg/hgrc</code> file in that repository, replacing the buildmaster
hostname/portnumber as appropriate for your buildbot:

<pre class="example">     [hooks]
     changegroup.buildbot = python:buildbot.changes.hgbuildbot.hook
     
     [hgbuildbot]
     master = buildmaster.example.org:9987
</pre>
   <p>(Note that Mercurial lets you define multiple <code>changegroup</code> hooks
by giving them distinct names, like <code>changegroup.foo</code> and
<code>changegroup.bar</code>, which is why we use
<code>changegroup.buildbot</code> in this example. There is nothing magical
about the &ldquo;buildbot&rdquo; suffix in the hook name. The
<code>[hgbuildbot]</code> section <em>is</em> special, however, as it is the
only section that the buildbot hook pays attention to.)

   <p>Also note that this runs as a <code>changegroup</code> hook, rather than as
an <code>incoming</code> hook. The <code>changegroup</code> hook is run with
multiple revisions at a time (say, if multiple revisions are being
pushed to this repository in a single <samp><span class="command">hg push</span></samp> command),
whereas the <code>incoming</code> hook is run with just one revision at a
time. The <code>hgbuildbot.hook</code> function will only work with the
<code>changegroup</code> hook.

   <p>If the buildmaster <code>PBChangeSource</code> is configured to require
sendchange credentials then you can set these with the <code>auth</code>
parameter. When this parameter is not set it defaults to
<code>change:changepw</code>, which are the defaults for the <code>user</code> and
<code>password</code> values of a <code>PBChangeSource</code> which doesn't require
authentication.

<pre class="example">     [hgbuildbot]
     master = buildmaster.example.org:9987
     auth = clientname:supersecret
</pre>
   <p>You can set this parameter in either the global <samp><span class="file">/etc/mercurial/hgrc</span></samp>,
your personal <samp><span class="file">~/.hgrc</span></samp> file or the repository local <samp><span class="file">.hg/hgrc</span></samp>
file. But since this value is stored in plain text, you must make sure that
it can only be read by those users that need to know the authentication
credentials.

   <p>The <code>[hgbuildbot]</code> section has two other parameters that you
might specify, both of which control the name of the branch that is
attached to the changes coming from this hook.

   <p>One common branch naming policy for Mercurial repositories is to use
it just like Darcs: each branch goes into a separate repository, and
all the branches for a single project share a common parent directory. 
For example, you might have <samp><span class="file">/var/repos/PROJECT/trunk/</span></samp> and
<samp><span class="file">/var/repos/PROJECT/release</span></samp>. To use this style, use the
<code>branchtype = dirname</code> setting, which simply uses the last
component of the repository's enclosing directory as the branch name:

<pre class="example">     [hgbuildbot]
     master = buildmaster.example.org:9987
     branchtype = dirname
</pre>
   <p>Another approach is to use Mercurial's built-in branches (the kind
created with <samp><span class="command">hg branch</span></samp> and listed with <samp><span class="command">hg
branches</span></samp>). This feature associates persistent names with particular
lines of descent within a single repository. (note that the buildbot
<code>source.Mercurial</code> checkout step does not yet support this kind
of branch). To have the commit hook deliver this sort of branch name
with the Change object, use <code>branchtype = inrepo</code>:

<pre class="example">     [hgbuildbot]
     master = buildmaster.example.org:9987
     branchtype = inrepo
</pre>
   <p>Finally, if you want to simply specify the branchname directly, for
all changes, use <code>branch = BRANCHNAME</code>. This overrides
<code>branchtype</code>:

<pre class="example">     [hgbuildbot]
     master = buildmaster.example.org:9987
     branch = trunk
</pre>
   <p>If you use <code>branch=</code> like this, you'll need to put a separate
.hgrc in each repository. If you use <code>branchtype=</code>, you may be
able to use the same .hgrc for all your repositories, stored in
<samp><span class="file">~/.hgrc</span></samp> or <samp><span class="file">/etc/mercurial/hgrc</span></samp>.

   <p>As twisted needs to hook some Signals, and that some web server are
strictly forbiding that, the parameter <code>fork</code> in the
<code>[hgbuildbot]</code> section will instruct mercurial to fork before
sending the change request. Then as the created process will be of short
life, it is considered as safe to disable the signal restriction in
the Apache setting like that <code>WSGIRestrictSignal Off</code>. Refer to the
documentation of your web server for other way to do the same.

   <p>The <code>category</code> parameter sets the category for any changes generated from
the hook.  Likewise, the <code>project</code> parameter sets the project.  Changes'
<code>repository</code> attributes are formed from the Mercurial repo path by
stripping <code>strip</code> slashes.

<div class="node">
<a name="Bzr-Hook"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mercurial-Hook">Mercurial Hook</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#PBChangeSource">PBChangeSource</a>

</div>

<h5 class="subsubsection">4.7.4.2 Bzr Hook</h5>

<p>Bzr is also written in Python, and the Bzr hook depends on Twisted to send the
changes.

   <p>To install, put <code>contrib/bzr_buildbot.py</code> (see <a href="#Contrib-Scripts">Contrib Scripts</a>) in one
of your plugins locations a bzr plugins directory (e.g.,
<code>~/.bazaar/plugins</code>). Then, in one of your bazaar conf files (e.g.,
<code>~/.bazaar/locations.conf</code>), set the location you want to connect with
buildbot with these keys:

     <dl>
<dt><code>buildbot_on</code><dd>one of 'commit', 'push, or 'change'. Turns the plugin on to report changes via
commit, changes via push, or any changes to the trunk. 'change' is
recommended.

     <br><dt><code>buildbot_server</code><dd>(required to send to a buildbot master) the URL of the buildbot master to
which you will connect (as of this writing, the same server and port to which
slaves connect).

     <br><dt><code>buildbot_port</code><dd>(optional, defaults to 9989) the port of the buildbot master to which you will
connect (as of this writing, the same server and port to which slaves connect)

     <br><dt><code>buildbot_pqm</code><dd>(optional, defaults to not pqm) Normally, the user that commits the revision
is the user that is responsible for the change. When run in a pqm (Patch Queue
Manager, see https://launchpad.net/pqm) environment, the user that commits is
the Patch Queue Manager, and the user that committed the *parent* revision is
responsible for the change. To turn on the pqm mode, set this value to any of
(case-insensitive) "Yes", "Y", "True", or "T".

     <br><dt><code>buildbot_dry_run</code><dd>(optional, defaults to not a dry run) Normally, the post-commit hook will
attempt to communicate with the configured buildbot server and port. If this
parameter is included and any of (case-insensitive) "Yes", "Y", "True", or
"T", then the hook will simply print what it would have sent, but not attempt
to contact the buildbot master.

     <br><dt><code>buildbot_send_branch_name</code><dd>(optional, defaults to not sending the branch name) If your buildbot's bzr
source build step uses a repourl, do *not* turn this on. If your buildbot's
bzr build step uses a baseURL, then you may set this value to any of
(case-insensitive) "Yes", "Y", "True", or "T" to have the buildbot master
append the branch name to the baseURL.

   </dl>

   <p>Note: The bzr smart server (as of version 2.2.2) doesn't know how to resolve
<code>bzr://</code> urls into absolute paths so any paths in <code>locations.conf</code>
won't match, hence no change notifications will be sent to Buildbot. Setting
configuration parameters globally or in-branch might still work.

   <p>When buildbot no longer has a hardcoded password, it will be a configuration
option here as well.

   <p>Here's a simple example that you might have in your
<code>~/.bazaar/locations.conf</code>.

<pre class="example">     [chroot-*:///var/local/myrepo/mybranch]
     buildbot_on = change
     buildbot_server = localhost
</pre>
   <div class="node">
<a name="P4Source"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#BonsaiPoller">BonsaiPoller</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#PBChangeSource">PBChangeSource</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.5 P4Source</h4>

<p><a name="index-buildbot_002echanges_002ep4poller_002eP4Source-45"></a>
The <code>P4Source</code> periodically polls a <a href="http://www.perforce.com/">Perforce</a> depot for changes. It accepts the following arguments:

     <dl>
<dt>&lsquo;<samp><code>p4base</code></samp>&rsquo;<dd>The base depot path to watch, without the trailing '/...'.

     <br><dt>&lsquo;<samp><code>p4port</code></samp>&rsquo;<dd>The Perforce server to connect to (as host:port).

     <br><dt>&lsquo;<samp><code>p4user</code></samp>&rsquo;<dd>The Perforce user.

     <br><dt>&lsquo;<samp><code>p4passwd</code></samp>&rsquo;<dd>The Perforce password.

     <br><dt>&lsquo;<samp><code>p4bin</code></samp>&rsquo;<dd>An optional string parameter. Specify the location of the perforce command
line binary (p4).  You only need to do this if the perforce binary is not
in the path of the buildbot user.  Defaults to &ldquo;p4&rdquo;.

     <br><dt>&lsquo;<samp><code>split_file</code></samp>&rsquo;<dd>A function that maps a pathname, without the leading <code>p4base</code>, to a
(branch, filename) tuple. The default just returns (None, branchfile),
which effectively disables branch support. You should supply a function
which understands your repository structure.

     <br><dt>&lsquo;<samp><code>pollInterval</code></samp>&rsquo;<dd>How often to poll, in seconds. Defaults to 600 (10 minutes).

     <br><dt>&lsquo;<samp><code>histmax</code></samp>&rsquo;<dd>The maximum number of changes to inspect at a time. If more than this
number occur since the last poll, older changes will be silently
ignored. 
</dl>

<h3 class="heading">Example</h3>

<p>This configuration uses the <code>P4PORT</code>, <code>P4USER</code>, and <code>P4PASSWD</code>
specified in the buildmaster's environment. It watches a project in which the
branch name is simply the next path component, and the file is all path
components after.

<pre class="example">     from buildbot.changes import p4poller
     s = p4poller.P4Source(p4base='//depot/project/',
                           split_file=lambda branchfile: branchfile.split('/',1),
                          )
     c['change_source'] = s
</pre>
   <div class="node">
<a name="BonsaiPoller"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#SVNPoller">SVNPoller</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#P4Source">P4Source</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.6 BonsaiPoller</h4>

<p><a name="index-buildbot_002echanges_002ebonsaipoller_002eBonsaiPoller-46"></a>
The <code>BonsaiPoller</code> periodically polls a Bonsai server. This is a
CGI script accessed through a web server that provides information
about a CVS tree, for example the Mozilla bonsai server at
<a href="http://bonsai.mozilla.org">http://bonsai.mozilla.org</a>. Bonsai servers are usable by both
humans and machines. In this case, the buildbot's change source forms
a query which asks about any files in the specified branch which have
changed since the last query.

   <p><code>BonsaiPoller</code> accepts the following arguments:

     <dl>
<dt><code>bonsaiURL</code><dd>The base URL of the Bonsai server, e.g., <code>http://bonsai.mozilla.org</code>

     <br><dt><code>module</code><dd>The module to look for changes in. Commonly this is <code>all</code>.

     <br><dt><code>branch</code><dd>The branch to look for changes in.  This will appear in the <code>branch</code> field
of the resulting change objects.

     <br><dt><code>tree</code><dd>The tree to look for changes in.  Commonly this is <code>all</code>.

     <br><dt><code>cvsroot</code><dd>The CVS root of the repository.  Usually this is <code>/cvsroot</code>.

     <br><dt><code>pollInterval</code><dd>The time (in seconds) between queries for changes.

     <br><dt><code>project</code><dd>The project name to attach to all change objects produced by this change
source.

   </dl>

<div class="node">
<a name="SVNPoller"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Bzr-Poller">Bzr Poller</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BonsaiPoller">BonsaiPoller</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.7 SVNPoller</h4>

<p><a name="index-buildbot_002echanges_002esvnpoller_002eSVNPoller-47"></a>
The <code>buildbot.changes.svnpoller.SVNPoller</code> is a ChangeSource
which periodically polls a <a href="http://subversion.tigris.org/">Subversion</a> repository for new revisions, by running the <code>svn
log</code> command in a subshell. It can watch a single branch or multiple
branches.

   <p><code>SVNPoller</code> accepts the following arguments:

     <dl>
<dt><code>svnurl</code><dd>The base URL path to watch, like
<code>svn://svn.twistedmatrix.com/svn/Twisted/trunk</code>, or
<code>http://divmod.org/svn/Divmod/</code>, or even
<code>file:///home/svn/Repository/ProjectA/branches/1.5/</code>. This must
include the access scheme, the location of the repository (both the
hostname for remote ones, and any additional directory names necessary
to get to the repository), and the sub-path within the repository's
virtual filesystem for the project and branch of interest.

     <p>The <code>SVNPoller</code> will only pay attention to files inside the
subdirectory specified by the complete svnurl.

     <br><dt><code>split_file</code><dd>A function to convert pathnames into (branch, relative_pathname)
tuples. Use this to explain your repository's branch-naming policy to
<code>SVNPoller</code>. This function must accept a single string and return
a two-entry tuple. There are a few utility functions in
<code>buildbot.changes.svnpoller</code> that can be used as a
<code>split_file</code> function; see below for details.

     <p>The default value always returns (None, path), which indicates that
all files are on the trunk.

     <p>Subclasses of <code>SVNPoller</code> can override the <code>split_file</code>
method instead of using the <code>split_file=</code> argument.

     <br><dt><code>project</code><dd>Set the name of the project to be used for the <code>SVNPoller</code>. 
This will then be set in any changes generated by the <code>SVNPoller</code>,
and can be used in a Change Filter for triggering particular builders.

     <br><dt><code>svnuser</code><dd>An optional string parameter. If set, the <code>--user</code> argument will
be added to all <code>svn</code> commands. Use this if you have to
authenticate to the svn server before you can do <code>svn info</code> or
<code>svn log</code> commands.

     <br><dt><code>svnpasswd</code><dd>Like <code>svnuser</code>, this will cause a <code>--password</code> argument to
be passed to all svn commands.

     <br><dt><code>pollInterval</code><dd>How often to poll, in seconds. Defaults to 600 (checking once every 10
minutes). Lower this if you want the buildbot to notice changes
faster, raise it if you want to reduce the network and CPU load on
your svn server. Please be considerate of public SVN repositories by
using a large interval when polling them.

     <br><dt><code>histmax</code><dd>The maximum number of changes to inspect at a time. Every POLLINTERVAL
seconds, the <code>SVNPoller</code> asks for the last HISTMAX changes and
looks through them for any ones it does not already know about. If
more than HISTMAX revisions have been committed since the last poll,
older changes will be silently ignored. Larger values of histmax will
cause more time and memory to be consumed on each poll attempt. 
<code>histmax</code> defaults to 100.

     <br><dt><code>svnbin</code><dd>This controls the <code>svn</code> executable to use. If subversion is
installed in a weird place on your system (outside of the
buildmaster's <code>$PATH</code>), use this to tell <code>SVNPoller</code> where
to find it. The default value of &ldquo;svn&rdquo; will almost always be
sufficient.

     <br><dt><code>revlinktmpl</code><dd>This parameter allows a link to be provided for each revision (for example,
to websvn or viewvc).  These links appear anywhere changes are shown, such
as on build or change pages.  The proper form for this parameter is an URL
with the portion that will substitute for a revision number replaced by
&rdquo;%s&rdquo;.  For example, <code>'http://myserver/websvn/revision.php?rev=%s'</code>
could be used to cause revision links to be created to a websvn repository
viewer.

     <br><dt><code>cachepath</code><dd>If specified, buildbot will cache processed revisions between restarts. This
means you don't miss changes that were committed if the master is down for any
reason.

   </dl>

<h3 class="heading">Branches</h3>

<p>Each source file that is tracked by a Subversion repository has a
fully-qualified SVN URL in the following form:
(REPOURL)(PROJECT-plus-BRANCH)(FILEPATH). When you create the
<code>SVNPoller</code>, you give it a <code>svnurl</code> value that includes all
of the REPOURL and possibly some portion of the PROJECT-plus-BRANCH
string. The <code>SVNPoller</code> is responsible for producing Changes that
contain a branch name and a FILEPATH (which is relative to the top of
a checked-out tree). The details of how these strings are split up
depend upon how your repository names its branches.

<h4 class="subheading">PROJECT/BRANCHNAME/FILEPATH repositories</h4>

<p>One common layout is to have all the various projects that share a
repository get a single top-level directory each. Then under a given
project's directory, you get two subdirectories, one named &ldquo;trunk&rdquo;
and another named &ldquo;branches&rdquo;. Under &ldquo;branches&rdquo; you have a bunch of
other directories, one per branch, with names like &ldquo;1.5.x&rdquo; and
&ldquo;testing&rdquo;. It is also common to see directories like &ldquo;tags&rdquo; and
&ldquo;releases&rdquo; next to &ldquo;branches&rdquo; and &ldquo;trunk&rdquo;.

   <p>For example, the Twisted project has a subversion server on
&ldquo;svn.twistedmatrix.com&rdquo; that hosts several sub-projects. The
repository is available through a SCHEME of &ldquo;svn:&rdquo;. The primary
sub-project is Twisted, of course, with a repository root of
&ldquo;svn://svn.twistedmatrix.com/svn/Twisted&rdquo;. Another sub-project is
Informant, with a root of
&ldquo;svn://svn.twistedmatrix.com/svn/Informant&rdquo;, etc. Inside any
checked-out Twisted tree, there is a file named bin/trial (which is
used to run unit test suites).

   <p>The trunk for Twisted is in
&ldquo;svn://svn.twistedmatrix.com/svn/Twisted/trunk&rdquo;, and the
fully-qualified SVN URL for the trunk version of <code>trial</code> would be
&ldquo;svn://svn.twistedmatrix.com/svn/Twisted/trunk/bin/trial&rdquo;. The same
SVNURL for that file on a branch named &ldquo;1.5.x&rdquo; would be
&ldquo;svn://svn.twistedmatrix.com/svn/Twisted/branches/1.5.x/bin/trial&rdquo;.

   <p>To set up a <code>SVNPoller</code> that watches the Twisted trunk (and
nothing else), we would use the following:

<pre class="example">     from buildbot.changes.svnpoller import SVNPoller
     c['change_source'] = SVNPoller("svn://svn.twistedmatrix.com/svn/Twisted/trunk")
</pre>
   <p>In this case, every Change that our <code>SVNPoller</code> produces will
have <code>.branch=None</code>, to indicate that the Change is on the trunk. 
No other sub-projects or branches will be tracked.

   <p>If we want our ChangeSource to follow multiple branches, we have to do
two things. First we have to change our <code>svnurl=</code> argument to
watch more than just &ldquo;.../Twisted/trunk&rdquo;. We will set it to
&ldquo;.../Twisted&rdquo; so that we'll see both the trunk and all the branches. 
Second, we have to tell <code>SVNPoller</code> how to split the
(PROJECT-plus-BRANCH)(FILEPATH) strings it gets from the repository
out into (BRANCH) and (FILEPATH) pairs.

   <p>We do the latter by providing a &ldquo;split_file&rdquo; function. This function
is responsible for splitting something like
&ldquo;branches/1.5.x/bin/trial&rdquo; into <code>branch</code>=&rdquo;branches/1.5.x&rdquo; and
<code>filepath</code>=&rdquo;bin/trial&rdquo;. This function is always given a string
that names a file relative to the subdirectory pointed to by the
<code>SVNPoller</code>'s <code>svnurl=</code> argument. It is expected to return a
(BRANCHNAME, FILEPATH) tuple (in which FILEPATH is relative to the
branch indicated), or None to indicate that the file is outside any
project of interest.

   <p>(note that we want to see &ldquo;branches/1.5.x&rdquo; rather than just
&ldquo;1.5.x&rdquo; because when we perform the SVN checkout, we will probably
append the branch name to the baseURL, which requires that we keep the
&ldquo;branches&rdquo; component in there. Other VC schemes use a different
approach towards branches and may not require this artifact.)

   <p>If your repository uses this same PROJECT/BRANCH/FILEPATH naming
scheme, the following function will work:

<pre class="example">     def split_file_branches(path):
         pieces = path.split('/')
         if pieces[0] == 'trunk':
             return (None, '/'.join(pieces[1:]))
         elif pieces[0] == 'branches':
             return ('/'.join(pieces[0:2]),
                     '/'.join(pieces[2:]))
         else:
             return None
</pre>
   <p>This function is provided as
<code>buildbot.changes.svnpoller.split_file_branches</code> for your
convenience. So to have our Twisted-watching <code>SVNPoller</code> follow
multiple branches, we would use this:

<pre class="example">     from buildbot.changes.svnpoller import SVNPoller, split_file_branches
     c['change_source'] = SVNPoller("svn://svn.twistedmatrix.com/svn/Twisted",
                                    split_file=split_file_branches)
</pre>
   <p>Changes for all sorts of branches (with names like &ldquo;branches/1.5.x&rdquo;,
and None to indicate the trunk) will be delivered to the Schedulers. 
Each Scheduler is then free to use or ignore each branch as it sees
fit.

<h4 class="subheading">BRANCHNAME/PROJECT/FILEPATH repositories</h4>

<p>Another common way to organize a Subversion repository is to put the
branch name at the top, and the projects underneath. This is
especially frequent when there are a number of related sub-projects
that all get released in a group.

   <p>For example, Divmod.org hosts a project named &ldquo;Nevow&rdquo; as well as one
named &ldquo;Quotient&rdquo;. In a checked-out Nevow tree there is a directory
named &ldquo;formless&rdquo; that contains a python source file named
&ldquo;webform.py&rdquo;. This repository is accessible via webdav (and thus
uses an &ldquo;http:&rdquo; scheme) through the divmod.org hostname. There are
many branches in this repository, and they use a
(BRANCHNAME)/(PROJECT) naming policy.

   <p>The fully-qualified SVN URL for the trunk version of webform.py is
<code>http://divmod.org/svn/Divmod/trunk/Nevow/formless/webform.py</code>. 
You can do an <code>svn co</code> with that URL and get a copy of the latest
version. The 1.5.x branch version of this file would have a URL of
<code>http://divmod.org/svn/Divmod/branches/1.5.x/Nevow/formless/webform.py</code>. 
The whole Nevow trunk would be checked out with
<code>http://divmod.org/svn/Divmod/trunk/Nevow</code>, while the Quotient
trunk would be checked out using
<code>http://divmod.org/svn/Divmod/trunk/Quotient</code>.

   <p>Now suppose we want to have an <code>SVNPoller</code> that only cares about
the Nevow trunk. This case looks just like the PROJECT/BRANCH layout
described earlier:

<pre class="example">     from buildbot.changes.svnpoller import SVNPoller
     c['change_source'] = SVNPoller("http://divmod.org/svn/Divmod/trunk/Nevow")
</pre>
   <p>But what happens when we want to track multiple Nevow branches? We
have to point our <code>svnurl=</code> high enough to see all those
branches, but we also don't want to include Quotient changes (since
we're only building Nevow). To accomplish this, we must rely upon the
<code>split_file</code> function to help us tell the difference between
files that belong to Nevow and those that belong to Quotient, as well
as figuring out which branch each one is on.

<pre class="example">     from buildbot.changes.svnpoller import SVNPoller
     c['change_source'] = SVNPoller("http://divmod.org/svn/Divmod",
                                    split_file=my_file_splitter)
</pre>
   <p>The <code>my_file_splitter</code> function will be called with
repository-relative pathnames like:

     <dl>
<dt><code>trunk/Nevow/formless/webform.py</code><dd>This is a Nevow file, on the trunk. We want the Change that includes this
to see a filename of <code>formless/webform.py"</code>, and a branch of None

     <br><dt><code>branches/1.5.x/Nevow/formless/webform.py</code><dd>This is a Nevow file, on a branch. We want to get
branch=&rdquo;branches/1.5.x&rdquo; and filename=&rdquo;formless/webform.py&rdquo;.

     <br><dt><code>trunk/Quotient/setup.py</code><dd>This is a Quotient file, so we want to ignore it by having
<code>my_file_splitter</code> return None.

     <br><dt><code>branches/1.5.x/Quotient/setup.py</code><dd>This is also a Quotient file, which should be ignored. 
</dl>

   <p>The following definition for <code>my_file_splitter</code> will do the job:

<pre class="example">     def my_file_splitter(path):
         pieces = path.split('/')
         if pieces[0] == 'trunk':
             branch = None
             pieces.pop(0) # remove 'trunk'
         elif pieces[0] == 'branches':
             pieces.pop(0) # remove 'branches'
             # grab branch name
             branch = 'branches/' + pieces.pop(0)
         else:
             return None # something weird
         projectname = pieces.pop(0)
         if projectname != 'Nevow':
             return None # wrong project
         return (branch, '/'.join(pieces))
</pre>
   <div class="node">
<a name="Bzr-Poller"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Change-Hooks-_0028HTTP-Notifications_0029">Change Hooks (HTTP Notifications)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#SVNPoller">SVNPoller</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.8 Bzr Poller</h4>

<p>If you cannot insert a Bzr hook in the server, you can use the Bzr Poller. To
use, put <code>contrib/bzr_buildbot.py</code> (see <a href="#Contrib-Scripts">Contrib Scripts</a>) somewhere
that your buildbot configuration can import it. Even putting it in the same
directory as the master.cfg should work. Install the poller in the buildbot
configuration as with any other change source. Minimally, provide a URL that
you want to poll (bzr://, bzr+ssh://, or lp:), though make sure the buildbot
user has necessary privileges. You may also want to specify these optional
values.

     <dl>
<dt><code>poll_interval</code><dd>The number of seconds to wait between polls.  Defaults to 10 minutes.

     <br><dt><code>branch_name</code><dd>Any value to be used as the branch name. Defaults to None, or specify a
string, or specify the constants from <code>bzr_buildbot.py</code> SHORT or FULL to
get the short branch name or full branch address.

     <br><dt><code>blame_merge_author</code><dd>normally, the user that commits the revision is the user that is responsible
for the change. When run in a pqm (Patch Queue Manager, see
https://launchpad.net/pqm) environment, the user that commits is the Patch
Queue Manager, and the user that committed the merged, *parent* revision is
responsible for the change. set this value to True if this is pointed against
a PQM-managed branch. 
</dl>

<div class="node">
<a name="GitPoller"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#GerritChangeSource">GerritChangeSource</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#GoogleCodeAtomPoller">GoogleCodeAtomPoller</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.9 GitPoller</h4>

<p><a name="index-buildbot_002echanges_002egitpoller_002eGitPoller-48"></a>
If you cannot take advantage of post-receive hooks as provided by
<code>contrib/git_buildbot.py</code> for example, then you can use the <code>GitPoller</code>.

   <p>The <code>GitPoller</code> periodically fetches from a remote git repository and
processes any changes. It requires its own working directory for operation, which
can be specified via the <code>workdir</code> property. By default a temporary directory will
be used.

   <p>The <code>GitPoller</code> only works with git <code>1.7</code> and up, out of the
box.  If you're using earlier versions of git, you can get things to
work by manually creating an empty repository in
<code>&lt;tempdir&gt;/gitpoller_work</code>.

   <p><code>GitPoller</code> accepts the following arguments:

     <dl>
<dt><code>repourl</code><dd>the git-url that describes the remote repository, e.g. <code>git@example.com:foobaz/myrepo.git</code>
(see the <code>git fetch</code> help for more info on git-url formats)

     <br><dt><code>branch</code><dd>the desired branch to fetch, will default to <code>'master'</code>

     <br><dt><code>workdir</code><dd>the directory where the poller should keep its local repository. will default
to <code>&lt;tempdir&gt;/gitpoller_work</code>, which is probably not what you want.  If
this is a relative path, it will be interpreted relative to the master's
basedir.

     <br><dt><code>pollInterval</code><dd>interval in seconds between polls, default is 10 minutes.

     <br><dt><code>gitbin</code><dd>path to the git binary, defaults to just <code>'git'</code>

     <br><dt><code>fetch_refspec</code><dd>One or more refspecs to use when fetching updates for the repository. By default,
the <code>GitPoller</code> will simply fetch all refs. If your repository is large
enough that this would be unwise (or active enough on irrelevant branches that
it'd be a waste of time to fetch them all), you may wish to specify only a certain
refs to be updated. (A single refspec may be passed as a string, or multiple refspecs
may be passed as a list or set of strings.)

     <br><dt><code>category</code><dd>Set the category to be used for the changes produced by the <code>GitPoller</code>. 
This will then be set in any changes generated by the <code>GitPoller</code>, and can
be used in a Change Filter for triggering particular builders.

     <br><dt><code>project</code><dd>Set the name of the project to be used for the <code>GitPoller</code>. 
This will then be set in any changes generated by the <code>GitPoller</code>,
and can be used in a Change Filter for triggering particular builders.

     <br><dt><code>usetimestamps</code><dd>parse each revision's commit timestamp (default is <code>True</code>), or ignore it in favor of the current time (so recently processed commits appear together in the waterfall page)

     <br><dt><code>encoding</code><dd>Set encoding will be used to parse author's name and commit message. Default
encoding is <code>'utf-8'</code>. This will not be applied to file names since git
will translate non-ascii file names to unreadable escape sequences.

   </dl>

<h3 class="heading">Example</h3>

<pre class="example">     from buildbot.changes.gitpoller import GitPoller
     c['change_source'] = GitPoller('git@example.com:foobaz/myrepo.git',
                                    branch='great_new_feature',
                                    workdir='/home/buildbot/gitpoller_workdir')
</pre>
<div class="node">
<a name="GerritChangeSource"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Change-Source-Index">Change Source Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#GitPoller">GitPoller</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.10 GerritChangeSource</h4>

<p><a name="index-buildbot_002echanges_002egerritchangesource_002eGerritChangeSource-49"></a>
The <code>GerritChangeSource</code> class connects to a Gerrit server by its SSH
interface and uses its event source mechanism,
<a href="http://gerrit.googlecode.com/svn/documentation/2.1.6/cmd-stream-events.html">gerrit stream-events</a>.

   <p>This class adds a change to the buildbot system for each of the following events:
     <dl>
<dt><code>patchset-created</code><dd>A change is proposed for review. Automatic checks like <code>checkpatch.pl</code> can be
automatically triggered. Beware of what kind of automatic task you trigger. 
At this point, no trusted human has reviewed the code, and a patch could be
specially crafted by an attacker to compromise your buildslaves. 
<br><dt><code>ref-updated</code><dd>A change has been merged into the repository. Typically, this kind of event can lead
to a complete rebuild of the project, and upload binaries to an incremental build
results server. 
</dl>

   <p>This class will populate the property list of the triggered build with the info
received from Gerrit server in JSON format.

   <p>In case of &ldquo;patchset-created&rdquo; event, these properties will be:
     <dl>
<dt><code>event.change.branch</code><dd>Branch of the Change
<br><dt><code>event.change.id</code><dd>Change's ID in the Gerrit system (the ChangeId: in commit comments)
<br><dt><code>event.change.number</code><dd>Change's number in Gerrit system
<br><dt><code>event.change.owner.email</code><dd>Change's owner email (owner is first uploader)
<br><dt><code>event.change.owner.name</code><dd>Change's owner name
<br><dt><code>event.change.project</code><dd>Project of the Change
<br><dt><code>event.change.subject</code><dd>Change's subject
<br><dt><code>event.change.url</code><dd>URL of the Change in the Gerrit's web interface
<br><dt><code>event.patchSet.number</code><dd>Patchset's version number
<br><dt><code>event.patchSet.ref</code><dd>Patchset's Gerrit "virtual branch"
<br><dt><code>event.patchSet.revision</code><dd>Patchset's Git commit ID
<br><dt><code>event.patchSet.uploader.email</code><dd>Patchset uploader's email (owner is first uploader)
<br><dt><code>event.patchSet.uploader.name</code><dd>Patchset uploader's name (owner is first uploader)
<br><dt><code>event.type</code><dd>Event type (&ldquo;patchset-created&rdquo;)
<br><dt><code>event.uploader.email</code><dd>Patchset uploader's email
<br><dt><code>event.uploader.name</code><dd>Patchset uploader's name
</dl>

   <p>In case of &ldquo;ref-updated&rdquo; event, these properties will be:
     <dl>
<dt><code>event.refUpdate.newRev</code><dd>New Git commit ID (after merger)
<br><dt><code>event.refUpdate.oldRev</code><dd>Previous Git commit ID (before merger)
<br><dt><code>event.refUpdate.project</code><dd>Project that was updated
<br><dt><code>event.refUpdate.refName</code><dd>Branch that was updated
<br><dt><code>event.submitter.email</code><dd>Submitter's email (merger responsible)
<br><dt><code>event.submitter.name</code><dd>Submitter's name (merger responsible)
<br><dt><code>event.type</code><dd>Event type (&ldquo;ref-updated&rdquo;)
<br><dt><code>event.submitter.email</code><dd>Submitter's email (merger responsible)
<br><dt><code>event.submitter.name</code><dd>Submitter's name (merger responsible)
</dl>

<h3 class="heading">Example</h3>

<pre class="example">     from buildbot.changes.gerritchangesource import GerritChangeSource
     c['change_source'] = GerritChangeSource(gerrit_server, gerrit_user)
</pre>
   <p>see
<code>master/docs/examples/repo_gerrit.cfg</code> in the Buildbot distribution for an example setup of <code>GerritChangeSource</code>.

<div class="node">
<a name="Change-Hooks-(HTTP-Notifications)"></a>
<a name="Change-Hooks-_0028HTTP-Notifications_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#GoogleCodeAtomPoller">GoogleCodeAtomPoller</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Bzr-Poller">Bzr Poller</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.11 Change Hooks (HTTP Notifications)</h4>

<p>Buildbot already provides a web frontend, and that frontend can easily be used
to receive HTTP push notifications of commits from services like github.  See
see <a href="#Change-Hooks">Change Hooks</a> for more information.

<div class="node">
<a name="GoogleCodeAtomPoller"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#GitPoller">GitPoller</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Change-Hooks-_0028HTTP-Notifications_0029">Change Hooks (HTTP Notifications)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.12 GoogleCodeAtomPoller</h4>

<p>The <code>GoogleCodeAtomPoller</code> periodically polls a Google Code Project's
commit feed for changes. Works on both SVN and Mercurial repositories. Branches
are not understood (yet). It accepts the following arguments:

     <dl>
<dt>&lsquo;<samp><code>feedurl</code></samp>&rsquo;<dd>The commit Atom feed URL of the GoogleCode repository (MANDATORY)

     <br><dt>&lsquo;<samp><code>pollinterval</code></samp>&rsquo;<dd>Polling frequency for the feed (in seconds). Default is 1 hour (OPTIONAL)

   </dl>

<h3 class="heading">Example</h3>

<p>To poll the Ostinato project's commit feed every 3 hours, use -

<pre class="example">     from contrib.googlecode_atom import GoogleCodeAtomPoller
     poller = GoogleCodeAtomPoller(
         feedurl="http://code.google.com/feeds/p/ostinato/hgchanges/basic",
         pollinterval=10800)
     c['change_source'] = [ poller ]
</pre>
   <div class="node">
<a name="Change-Source-Index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#GerritChangeSource">GerritChangeSource</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Change-Sources">Change Sources</a>

</div>

<h4 class="subsection">4.7.13 Change Source Index</h4>

<ul class="index-cs" compact>
<li><a href="#index-buildbot_002echanges_002ebonsaipoller_002eBonsaiPoller-46"><code>buildbot.changes.bonsaipoller.BonsaiPoller</code></a>: <a href="#BonsaiPoller">BonsaiPoller</a></li>
<li><a href="#index-buildbot_002echanges_002egerritchangesource_002eGerritChangeSource-49"><code>buildbot.changes.gerritchangesource.GerritChangeSource</code></a>: <a href="#GerritChangeSource">GerritChangeSource</a></li>
<li><a href="#index-buildbot_002echanges_002egitpoller_002eGitPoller-48"><code>buildbot.changes.gitpoller.GitPoller</code></a>: <a href="#GitPoller">GitPoller</a></li>
<li><a href="#index-buildbot_002echanges_002email_002eBzrLaunchpadEmailMaildirSource-43"><code>buildbot.changes.mail.BzrLaunchpadEmailMaildirSource</code></a>: <a href="#BzrLaunchpadEmailMaildirSource">BzrLaunchpadEmailMaildirSource</a></li>
<li><a href="#index-buildbot_002echanges_002email_002eCVSMaildirSource-41"><code>buildbot.changes.mail.CVSMaildirSource</code></a>: <a href="#CVSMaildirSource">CVSMaildirSource</a></li>
<li><a href="#index-buildbot_002echanges_002email_002eSVNCommitEmailMaildirSource-42"><code>buildbot.changes.mail.SVNCommitEmailMaildirSource</code></a>: <a href="#SVNCommitEmailMaildirSource">SVNCommitEmailMaildirSource</a></li>
<li><a href="#index-buildbot_002echanges_002ep4poller_002eP4Source-45"><code>buildbot.changes.p4poller.P4Source</code></a>: <a href="#P4Source">P4Source</a></li>
<li><a href="#index-buildbot_002echanges_002epb_002ePBChangeSource-44"><code>buildbot.changes.pb.PBChangeSource</code></a>: <a href="#PBChangeSource">PBChangeSource</a></li>
<li><a href="#index-buildbot_002echanges_002esvnpoller_002eSVNPoller-47"><code>buildbot.changes.svnpoller.SVNPoller</code></a>: <a href="#SVNPoller">SVNPoller</a></li>
   </ul><div class="node">
<a name="Schedulers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Buildslaves">Buildslaves</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Change-Sources">Change Sources</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.8 Schedulers</h3>

<p>Schedulers are responsible for initiating builds on builders.

   <p>Some schedulers listen for changes from ChangeSources and generate build sets
in response to these changes.  Others generate build sets without changes,
based on other events in the buildmaster.

<ul class="menu">
<li><a accesskey="1" href="#Configuring-Schedulers">Configuring Schedulers</a>
<li><a accesskey="2" href="#Change-Filters">Change Filters</a>
<li><a accesskey="3" href="#SingleBranchScheduler">SingleBranchScheduler</a>
<li><a accesskey="4" href="#AnyBranchScheduler">AnyBranchScheduler</a>
<li><a accesskey="5" href="#Dependent-Scheduler">Dependent Scheduler</a>
<li><a accesskey="6" href="#Periodic-Scheduler">Periodic Scheduler</a>
<li><a accesskey="7" href="#Nightly-Scheduler">Nightly Scheduler</a>
<li><a accesskey="8" href="#Try-Schedulers">Try Schedulers</a>
<li><a accesskey="9" href="#Triggerable-Scheduler">Triggerable Scheduler</a>
<li><a href="#Scheduler-Index">Scheduler Index</a>
</ul>

<div class="node">
<a name="Configuring-Schedulers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Change-Filters">Change Filters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.1 Configuring Schedulers</h4>

<p><a name="index-c_005b_0027schedulers_0027_005d-50"></a><code>c['schedulers']</code> is a list of Scheduler instances, each
of which causes builds to be started on a particular set of
Builders. The two basic Scheduler classes you are likely to start
with are <code>Scheduler</code> and <code>Periodic</code>, but you can write a
customized subclass to implement more complicated build scheduling.

   <p>Scheduler arguments should always be specified by name (as keyword arguments),
to allow for future expansion:

<pre class="example">     sched = Scheduler(name="quick", builderNames=['lin', 'win'])
</pre>
   <p>There are several common arguments for schedulers, although not all are
available with all schedulers.

     <dl>
<dt><code>name</code><dd>
Each Scheduler must have a unique name. This is used in status
displays, and is also available in the build property <code>scheduler</code>.

     <br><dt><code>builderNames</code><dd>
This is the set of builders which this scheduler should trigger, specified
as a list of names (strings).

     <br><dt><code>properties</code><dd><a name="index-Properties-51"></a>
This is a dictionary specifying properties that will be transmitted to all
builds started by this scheduler.  The <code>owner</code> property may be of
particular interest, as its contents (as a list) will be added to the list of
"interested users" (see <a href="#Doing-Things-With-Users">Doing Things With Users</a>) for each triggered build. 
For example:

     <pre class="example">          sched = Scheduler(...,
              properties = { 'owner' : [ 'zorro@company.com', 'silver@company.com' ] })
</pre>
     <br><dt><code>fileIsImportant</code><dd>A callable which takes one argument, a Change instance, and returns
<code>True</code> if the change is worth building, and <code>False</code> if
it is not.  Unimportant Changes are accumulated until the build is
triggered by an important change.  The default value of None means
that all Changes are important.

     <br><dt><code>change_filter</code><dd>The change filter that will determine whch changes are recognized by this
scheduler; see <a href="#Change-Filters">Change Filters</a>.  Note that this is different from
<code>fileIsImportant</code>: if the change filter filters out a Change, then it is
completely ignored by the scheduler.  If a Change is allowed by the change
filter, but is deemed unimportant, then it will not cause builds to start, but
will be remembered and shown in status displays.

   </dl>

   <p>The remaining subsections represent a catalog of the available Scheduler types. 
All these Schedulers are defined in modules under <code>buildbot.schedulers</code>,
and the docstrings there are the best source of documentation on the arguments
taken by each one.

<div class="node">
<a name="Change-Filters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#SingleBranchScheduler">SingleBranchScheduler</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configuring-Schedulers">Configuring Schedulers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.2 Change Filters</h4>

<p><a name="index-buildbot_002eschedulers_002efilter_002eChangeFilter-52"></a>
Several schedulers perform filtering on an incoming set of changes.  The filter
can most generically be specified as a ChangeFilter.  Set up a ChangeFilter
like this:

<pre class="example">     from buildbot.changes.filter import ChangeFilter
     my_filter = ChangeFilter(
         project_re="^baseproduct/.*",
         branch="devel")
</pre>
   <p>and then add it to a scheduler with the <code>change_filter</code> parameter:

<pre class="example">     sch = SomeSchedulerClass(...,
         change_filter=my_filter)
</pre>
   <p>There are four attributes of changes on which you can filter:

     <ul>
<li><code>project</code>
the project string, as defined by the ChangeSource. 
<li><code>repository</code>
the repository in which this change occurred. 
<li><code>branch</code>
the branch on which this change occurred.  Note that 'trunk' or 'master' is often
denoted by <code>None</code>. 
<li><code>category</code>
the category, again as defined by the ChangeSource. 
</ul>

   <p>For each attribute, the filter can look for a single, specific value:
<pre class="example">     my_filter = ChangeFilter(project = 'myproject')
</pre>
   <p>or accept any of a set of values:

<pre class="example">     my_filter = ChangeFilter(project = ['myproject', 'jimsproject'])
</pre>
   <p>It can apply a regular expression, use the attribute name with a suffix of
<code>_re</code>:

<pre class="example">     my_filter = ChangeFilter(category_re = '.*deve.*')
     # or, to use regular expression flags:
     import re
     my_filter = ChangeFilter(category_re = re.compile('.*deve.*', re.I))
</pre>
   <p>For anything more complicated, define a Python function to recognize the strings
you want:

<pre class="example">     def my_branch_fn(branch):
         return branch in branches_to_build and branch not in branches_to_ignore
     my_filter = ChangeFilter(branch_fn = my_branch_fn)
</pre>
   <p>The special argument <code>filter_fn</code> can be used to specify a function that is
given the entire Change object, and returns a boolean.

   <p>A Change passes the filter only if <i>all</i> arguments are satisfied.  If no
filter object is given to a scheduler, then all changes will be built (subject
to any other restrictions the scheduler enforces).

<div class="node">
<a name="SingleBranchScheduler"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#AnyBranchScheduler">AnyBranchScheduler</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Change-Filters">Change Filters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.3 SingleBranchScheduler</h4>

<p><a name="index-buildbot_002eschedulers_002ebasic_002eSingleBranchScheduler-53"></a>
This is the original and still most popular scheduler class. It follows
exactly one branch, and starts a configurable tree-stable-timer after
each change on that branch. When the timer expires, it starts a build
on some set of Builders. The scheduler accepts a <code>fileIsImportant</code>
function which can be used to ignore some Changes if they do not
affect any &ldquo;important&rdquo; files.

   <p>The arguments to this scheduler are:

     <dl>
<dt><code>name</code>
<br><dt><code>builderNames</code>
<br><dt><code>properties</code>
<br><dt><code>fileIsImportant</code>
<br><dt><code>change_filter</code><dd>see <a href="#Configuring-Schedulers">Configuring Schedulers</a>

     <br><dt><code>treeStableTimer</code><dd>The scheduler will wait for this many seconds before starting the
build. If new changes are made during this interval, the timer will be
restarted, so really the build will be started after a change and then
after this many seconds of inactivity.

     <p>If treeStableTimer is <code>None</code>, then a separate build is started
immediately for each Change.

     <br><dt><code>categories (deprecated; use change_filter)</code><dd>A list of categories of changes that this scheduler will respond to.  If this
is specified, then any non-matching changes are ignored.

     <br><dt><code>branch (deprecated; use change_filter)</code><dd>The scheduler will pay attention to this branch, ignoring Changes that occur
on other branches. Setting <code>branch</code> equal to the special value of
<code>None</code> means it should only pay attention to the default branch. Note that
<code>None</code> is a keyword, not a string, so write <code>None</code> and not
<code>"None"</code>.

   </dl>

   <p>Example:

<pre class="example">     from buildbot.schedulers.basic  import SingleBranchScheduler
     quick = SingleBranchScheduler(name="quick",
                         branch=None,
                         treeStableTimer=60,
                         builderNames=["quick-linux", "quick-netbsd"])
     full = SingleBranchScheduler(name="full",
                         branch=None,
                         treeStableTimer=5*60,
                         builderNames=["full-linux", "full-netbsd", "full-OSX"])
     c['schedulers'] = [quick, full]
</pre>
   <p>In this example, the two &ldquo;quick&rdquo; builders are triggered 60 seconds
after the tree has been changed. The &ldquo;full&rdquo; builds do not run quite
so quickly (they wait 5 minutes), so hopefully if the quick builds
fail due to a missing file or really simple typo, the developer can
discover and fix the problem before the full builds are started. Both
Schedulers only pay attention to the default branch: any changes
on other branches are ignored by these schedulers. Each scheduler
triggers a different set of Builders, referenced by name.

   <p><a name="index-buildbot_002eschedulers_002ebasic_002eScheduler-54"></a><a name="index-buildbot_002escheduler_002eScheduler-55"></a>The old names for this scheduler, <code>buildbot.scheduler.Scheduler</code> and
<code>buildbot.schedulers.basic.Scheduler</code>, are deprecated in favor of the more
accurate name <code>SingleBranchScheduler</code>.

<div class="node">
<a name="AnyBranchScheduler"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Dependent-Scheduler">Dependent Scheduler</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#SingleBranchScheduler">SingleBranchScheduler</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.4 AnyBranchScheduler</h4>

<p><a name="index-buildbot_002eschedulers_002ebasic_002eAnyBranchScheduler-56"></a>
This scheduler uses a tree-stable-timer like the default one, but
uses a separate timer for each branch.

   <p>The arguments to this scheduler are:

     <dl>
<dt><code>name</code>
<br><dt><code>builderNames</code>
<br><dt><code>properties</code>
<br><dt><code>fileIsImportant</code>
<br><dt><code>change_filter</code><dd>see <a href="#Configuring-Schedulers">Configuring Schedulers</a>

     <br><dt><code>treeStableTimer</code><dd>The scheduler will wait for this many seconds before starting the
build. If new changes are made during this interval, the timer will be
restarted, so really the build will be started after a change and then
after this many seconds of inactivity.

     <br><dt><code>branches (deprecated; use change_filter)</code><dd>This scheduler will pay attention to any number of branches, ignoring
Changes that occur on other branches.

     <br><dt><code>categories (deprecated; use change_filter)</code><dd>A list of categories of changes that this scheduler will respond to.  If this
is specified, then any non-matching changes are ignored.

   </dl>

<div class="node">
<a name="Dependent-Scheduler"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Periodic-Scheduler">Periodic Scheduler</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#AnyBranchScheduler">AnyBranchScheduler</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.5 Dependent Scheduler</h4>

<p><a name="index-Dependent-57"></a><a name="index-Dependencies-58"></a><a name="index-buildbot_002eschedulers_002edependent_002eDependent-59"></a><a name="index-buildbot_002eschedulers_002ebasic_002eDependent-60"></a>
It is common to wind up with one kind of build which should only be
performed if the same source code was successfully handled by some
other kind of build first. An example might be a packaging step: you
might only want to produce .deb or RPM packages from a tree that was
known to compile successfully and pass all unit tests. You could put
the packaging step in the same Build as the compile and testing steps,
but there might be other reasons to not do this (in particular you
might have several Builders worth of compiles/tests, but only wish to
do the packaging once). Another example is if you want to skip the
&ldquo;full&rdquo; builds after a failing &ldquo;quick&rdquo; build of the same source
code. Or, if one Build creates a product (like a compiled library)
that is used by some other Builder, you'd want to make sure the
consuming Build is run <em>after</em> the producing one.

   <p>You can use &ldquo;Dependencies&rdquo; to express this relationship
to the Buildbot. There is a special kind of scheduler named
<code>scheduler.Dependent</code> that will watch an &ldquo;upstream&rdquo; scheduler
for builds to complete successfully (on all of its Builders). Each time
that happens, the same source code (i.e. the same <code>SourceStamp</code>)
will be used to start a new set of builds, on a different set of
Builders. This &ldquo;downstream&rdquo; scheduler doesn't pay attention to
Changes at all. It only pays attention to the upstream scheduler.

   <p>If the build fails on any of the Builders in the upstream set,
the downstream builds will not fire.  Note that, for SourceStamps
generated by a ChangeSource, the <code>revision</code> is None, meaning HEAD. 
If any changes are committed between the time the upstream scheduler
begins its build and the time the dependent scheduler begins its
build, then those changes will be included in the downstream build. 
See the see <a href="#Triggerable-Scheduler">Triggerable Scheduler</a> for a more flexible dependency
mechanism that can avoid this problem.

   <p>The keyword arguments to this scheduler are:

     <dl>
<dt><code>name</code>
<br><dt><code>builderNames</code>
<br><dt><code>properties</code>
<br><dt><code>upstream</code><dd>The upstream scheduler to watch.  Note that this is an &ldquo;instance&rdquo;,
not the name of the scheduler. 
</dl>

   <p>Example:

<pre class="example">     from buildbot.schedulers import dependent
     tests = basic.SingleBranchScheduler(name="just-tests", branch=None,
                     treeStableTimer=5*60,
                     builderNames=["full-linux", "full-netbsd", "full-OSX"])
     package = dependent.Dependent(name="build-package",
                     upstream=tests, # &lt;- no quotes!
                     builderNames=["make-tarball", "make-deb", "make-rpm"])
     c['schedulers'] = [tests, package]
</pre>
   <div class="node">
<a name="Periodic-Scheduler"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Nightly-Scheduler">Nightly Scheduler</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Dependent-Scheduler">Dependent Scheduler</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.6 Periodic Scheduler</h4>

<p><a name="index-buildbot_002eschedulers_002etimed_002ePeriodic-61"></a>
This simple scheduler just triggers a build every N seconds.

   <p>The arguments to this scheduler are:

     <dl>
<dt><code>name</code>
<br><dt><code>builderNames</code>
<br><dt><code>properties</code>
<br><dt><code>periodicBuildTimer</code><dd>The time, in seconds, after which to start a build. 
</dl>

   <p>Example:

<pre class="example">     from buildbot.schedulers import timed
     nightly = timed.Periodic(name="daily",
                     builderNames=["full-solaris"],
                     periodicBuildTimer=24*60*60)
     c['schedulers'] = [nightly]
</pre>
   <p>The scheduler in this example just runs the full solaris build once per day. 
Note that this scheduler only lets you control the time between builds, not the
absolute time-of-day of each Build, so this could easily wind up an &ldquo;evening&rdquo;
or &ldquo;every afternoon&rdquo; scheduler depending upon when it was first activated.

<div class="node">
<a name="Nightly-Scheduler"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Try-Schedulers">Try Schedulers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Periodic-Scheduler">Periodic Scheduler</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.7 Nightly Scheduler</h4>

<p><a name="index-buildbot_002eschedulers_002etimed_002eNightly-62"></a>
This is highly configurable periodic build scheduler, which triggers
a build at particular times of day, week, month, or year. The
configuration syntax is very similar to the well-known <code>crontab</code>
format, in which you provide values for minute, hour, day, and month
(some of which can be wildcards), and a build is triggered whenever
the current time matches the given constraints. This can run a build
every night, every morning, every weekend, alternate Thursdays,
on your boss's birthday, etc.

   <p>Pass some subset of <code>minute</code>, <code>hour</code>, <code>dayOfMonth</code>,
<code>month</code>, and <code>dayOfWeek</code>; each may be a single number or
a list of valid values. The builds will be triggered whenever the
current time matches these values. Wildcards are represented by a
'*' string. All fields default to a wildcard except 'minute', so
with no fields this defaults to a build every hour, on the hour. 
The full list of parameters is:

     <dl>
<dt><code>name</code>
<br><dt><code>builderNames</code>
<br><dt><code>properties</code>
<br><dt><code>fileIsImportant</code>
<br><dt><code>branch</code><dd>(required) The branch to build when the time comes.  Remember that a value of
<code>None</code> here means the default branch, and will not match other branches!

     <br><dt><code>change_filter</code><dd>see <a href="#Configuring-Schedulers">Configuring Schedulers</a>.  Note that <code>fileIsImportant</code> and
<code>change_filter</code> are only relevant if <code>onlyIfChanged</code> is true.

     <br><dt><code>minute</code><dd>The minute of the hour on which to start the build.  This defaults
to 0, meaning an hourly build.

     <br><dt><code>hour</code><dd>The hour of the day on which to start the build, in 24-hour notation. 
This defaults to *, meaning every hour.

     <br><dt><code>dayOfMonth</code><dd>The day of the month to start a build.  This defauls to *, meaning every day.

     <br><dt><code>month</code><dd>The month in which to start the build, with January = 1.  This defaults
to *, meaning every month.

     <br><dt><code>dayOfWeek</code><dd>The day of the week to start a build, with Monday = 0.  This defauls to *,
meaning every day of the week.  If <code>dayOfMonth</code> and <code>dayOfWeek</code> are
both specified, builds will be started when <em>either</em> parameter matches.

     <br><dt><code>onlyIfChanged</code><dd>If this is true, then builds will not be scheduled at the designated time
<em>unless</em> the specified branch has seen an important change since the
previous build.

   </dl>

   <p>For example, the following master.cfg clause will cause a build to be
started every night at 3:00am:

<pre class="example">     from buildbot.schedulers import timed
     s = timed.Nightly(name='nightly',
             branch='master',
             builderNames=['builder1', 'builder2'],
             hour=3,
             minute=0)
</pre>
   <p>This scheduler will perform a build each monday morning at 6:23am and
again at 8:23am, but only if someone has committed code in the interim:

<pre class="example">     s = timed.Nightly(name='BeforeWork',
              branch='default',
              builderNames=['builder1'],
              dayOfWeek=0,
              hour=[6,8],
              minute=23,
              onlyIfChanged=True)
</pre>
   <p>The following runs a build every two hours, using Python's <code>range</code>
function:

<pre class="example">     s = timed.Nightly(name='every2hours',
             branch=None, # default branch
             builderNames=['builder1'],
             hour=range(0, 24, 2))
</pre>
   <p>Finally, this example will run only on December 24th:

<pre class="example">     s = timed.Nightly(name='SleighPreflightCheck',
             branch=None, # default branch
             builderNames=['flying_circuits', 'radar'],
             month=12,
             dayOfMonth=24,
             hour=12,
             minute=0)
</pre>
   <div class="node">
<a name="Try-Schedulers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Triggerable-Scheduler">Triggerable Scheduler</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Nightly-Scheduler">Nightly Scheduler</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.8 Try Schedulers</h4>

<p><a name="index-buildbot_002eschedulers_002etrysched_002eTry_005fJobdir-63"></a><a name="index-buildbot_002eschedulers_002etrysched_002eTry_005fUserpass-64"></a>
This scheduler allows developers to use the <code>buildbot try</code>
command to trigger builds of code they have not yet committed. See
<a href="#try">try</a> for complete details.

   <p>Two implementations are available: <code>Try_Jobdir</code> and
<code>Try_Userpass</code>.  The former monitors a job directory, specified
by the <code>jobdir</code> parameter, while the latter listens for PB
connections on a specific <code>port</code>, and authenticates against
<code>userport</code>.

   <p>The buildmaster must have a scheduler instance in the config file's
<code>c['schedulers']</code> list to receive try requests. This lets the
administrator control who may initiate these &ldquo;trial&rdquo; builds, which branches
are eligible for trial builds, and which Builders should be used for them.

   <p>The scheduler has various means to accept build requests. 
All of them enforce more security than the usual buildmaster ports do. 
Any source code being built can be used to compromise the buildslave
accounts, but in general that code must be checked out from the VC
repository first, so only people with commit privileges can get
control of the buildslaves. The usual force-build control channels can
waste buildslave time but do not allow arbitrary commands to be
executed by people who don't have those commit privileges. However,
the source code patch that is provided with the trial build does not
have to go through the VC system first, so it is important to make
sure these builds cannot be abused by a non-committer to acquire as
much control over the buildslaves as a committer has. Ideally, only
developers who have commit access to the VC repository would be able
to start trial builds, but unfortunately the buildmaster does not, in
general, have access to VC system's user list.

   <p>As a result, the try scheduler requires a bit more configuration. There are
currently two ways to set this up:

     <dl>
<dt><strong>jobdir (ssh)</strong><dd>
This approach creates a command queue directory, called the
&ldquo;jobdir&rdquo;, in the buildmaster's working directory. The buildmaster
admin sets the ownership and permissions of this directory to only
grant write access to the desired set of developers, all of whom must
have accounts on the machine. The <code>buildbot try</code> command creates
a special file containing the source stamp information and drops it in
the jobdir, just like a standard maildir. When the buildmaster notices
the new file, it unpacks the information inside and starts the builds.

     <p>The config file entries used by 'buildbot try' either specify a local
queuedir (for which write and mv are used) or a remote one (using scp
and ssh).

     <p>The advantage of this scheme is that it is quite secure, the
disadvantage is that it requires fiddling outside the buildmaster
config (to set the permissions on the jobdir correctly). If the
buildmaster machine happens to also house the VC repository, then it
can be fairly easy to keep the VC userlist in sync with the
trial-build userlist. If they are on different machines, this will be
much more of a hassle. It may also involve granting developer accounts
on a machine that would not otherwise require them.

     <p>To implement this, the buildslave invokes 'ssh -l username host
buildbot tryserver ARGS', passing the patch contents over stdin. The
arguments must include the inlet directory and the revision
information.

     <br><dt><strong>user+password (PB)</strong><dd>
In this approach, each developer gets a username/password pair, which
are all listed in the buildmaster's configuration file. When the
developer runs <code>buildbot try</code>, their machine connects to the
buildmaster via PB and authenticates themselves using that username
and password, then sends a PB command to start the trial build.

     <p>The advantage of this scheme is that the entire configuration is
performed inside the buildmaster's config file. The disadvantages are
that it is less secure (while the &ldquo;cred&rdquo; authentication system does
not expose the password in plaintext over the wire, it does not offer
most of the other security properties that SSH does). In addition, the
buildmaster admin is responsible for maintaining the username/password
list, adding and deleting entries as developers come and go.

   </dl>

   <p>For example, to set up the &ldquo;jobdir&rdquo; style of trial build, using a
command queue directory of <samp><span class="file">MASTERDIR/jobdir</span></samp> (and assuming that
all your project developers were members of the <code>developers</code> unix
group), you would first set up that directory:

<pre class="example">     mkdir -p MASTERDIR/jobdir MASTERDIR/jobdir/new MASTERDIR/jobdir/cur MASTERDIR/jobdir/tmp
     chgrp developers MASTERDIR/jobdir MASTERDIR/jobdir/*
     chmod g+rwx,o-rwx MASTERDIR/jobdir MASTERDIR/jobdir/*
</pre>
   <p>and then use the following scheduler in the buildmaster's config file:

<pre class="example">     from buildbot.schedulers.trysched import Try_Jobdir
     s = Try_Jobdir(name="try1",
                    builderNames=["full-linux", "full-netbsd", "full-OSX"],
                    jobdir="jobdir")
     c['schedulers'] = [s]
</pre>
   <p>Note that you must create the jobdir before telling the buildmaster to
use this configuration, otherwise you will get an error. Also remember
that the buildmaster must be able to read and write to the jobdir as
well. Be sure to watch the <samp><span class="file">twistd.log</span></samp> file (see <a href="#Logfiles">Logfiles</a>)
as you start using the jobdir, to make sure the buildmaster is happy
with it.

   <p>To use the username/password form of authentication, create a
<code>Try_Userpass</code> instance instead. It takes the same
<code>builderNames</code> argument as the <code>Try_Jobdir</code> form, but
accepts an addtional <code>port</code> argument (to specify the TCP port to
listen on) and a <code>userpass</code> list of username/password pairs to
accept. Remember to use good passwords for this: the security of the
buildslave accounts depends upon it:

<pre class="example">     from buildbot.schedulers.trysched import Try_Userpass
     s = Try_Userpass(name="try2",
                      builderNames=["full-linux", "full-netbsd", "full-OSX"],
                      port=8031,
                      userpass=[("alice","pw1"), ("bob", "pw2")] )
     c['schedulers'] = [s]
</pre>
   <p>Like most places in the buildbot, the <code>port</code> argument takes a
strports specification. See <code>twisted.application.strports</code> for
details.

<div class="node">
<a name="Triggerable-Scheduler"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Scheduler-Index">Scheduler Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Try-Schedulers">Try Schedulers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.9 Triggerable Scheduler</h4>

<p><a name="index-Triggers-65"></a><a name="index-buildbot_002eschedulers_002etriggerable_002eTriggerable-66"></a>
The <code>Triggerable</code> scheduler waits to be triggered by a Trigger
step (see <a href="#Triggering-Schedulers">Triggering Schedulers</a>) in another build. That step
can optionally wait for the scheduler's builds to complete. This
provides two advantages over Dependent schedulers. First, the same
scheduler can be triggered from multiple builds. Second, the ability
to wait for a Triggerable's builds to complete provides a form of
"subroutine call", where one or more builds can "call" a scheduler
to perform some work for them, perhaps on other buildslaves.

   <p>The parameters are just the basics:

     <dl>
<dt><code>name</code><br><dt><code>builderNames</code><br><dt><code>properties</code><dd></dl>

   <p>This class is only useful in conjunction with the <code>Trigger</code> step. 
Here is a fully-worked example:

<pre class="example">     from buildbot.schedulers import basic, timed, triggerable
     from buildbot.process import factory
     from buildbot.steps import trigger
     
     checkin = basic.SingleBranchScheduler(name="checkin",
                 branch=None,
                 treeStableTimer=5*60,
                 builderNames=["checkin"])
     nightly = timed.Nightly(name='nightly',
                 builderNames=['nightly'],
                 hour=3,
                 minute=0)
     
     mktarball = triggerable.Triggerable(name="mktarball",
                     builderNames=["mktarball"])
     build = triggerable.Triggerable(name="build-all-platforms",
                     builderNames=["build-all-platforms"])
     test = triggerable.Triggerable(name="distributed-test",
                     builderNames=["distributed-test"])
     package = triggerable.Triggerable(name="package-all-platforms",
                     builderNames=["package-all-platforms"])
     
     c['schedulers'] = [mktarball, checkin, nightly, build, test, package]
     
     # on checkin, make a tarball, build it, and test it
     checkin_factory = factory.BuildFactory()
     checkin_factory.addStep(trigger.Trigger(schedulerNames=['mktarball'],
                                            waitForFinish=True))
     checkin_factory.addStep(trigger.Trigger(schedulerNames=['build-all-platforms'],
                                        waitForFinish=True))
     checkin_factory.addStep(trigger.Trigger(schedulerNames=['distributed-test'],
                                       waitForFinish=True))
     
     # and every night, make a tarball, build it, and package it
     nightly_factory = factory.BuildFactory()
     nightly_factory.addStep(trigger.Trigger(schedulerNames=['mktarball'],
                                            waitForFinish=True))
     nightly_factory.addStep(trigger.Trigger(schedulerNames=['build-all-platforms'],
                                        waitForFinish=True))
     nightly_factory.addStep(trigger.Trigger(schedulerNames=['package-all-platforms'],
                                          waitForFinish=True))
</pre>
   <div class="node">
<a name="Scheduler-Index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Triggerable-Scheduler">Triggerable Scheduler</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Schedulers">Schedulers</a>

</div>

<h4 class="subsection">4.8.10 Scheduler Index</h4>



<ul class="index-sl" compact>
<li><a href="#index-buildbot_002escheduler_002eScheduler-55"><code>buildbot.scheduler.Scheduler</code></a>: <a href="#SingleBranchScheduler">SingleBranchScheduler</a></li>
<li><a href="#index-buildbot_002eschedulers_002ebasic_002eAnyBranchScheduler-56"><code>buildbot.schedulers.basic.AnyBranchScheduler</code></a>: <a href="#AnyBranchScheduler">AnyBranchScheduler</a></li>
<li><a href="#index-buildbot_002eschedulers_002ebasic_002eDependent-60"><code>buildbot.schedulers.basic.Dependent</code></a>: <a href="#Dependent-Scheduler">Dependent Scheduler</a></li>
<li><a href="#index-buildbot_002eschedulers_002ebasic_002eScheduler-54"><code>buildbot.schedulers.basic.Scheduler</code></a>: <a href="#SingleBranchScheduler">SingleBranchScheduler</a></li>
<li><a href="#index-buildbot_002eschedulers_002ebasic_002eSingleBranchScheduler-53"><code>buildbot.schedulers.basic.SingleBranchScheduler</code></a>: <a href="#SingleBranchScheduler">SingleBranchScheduler</a></li>
<li><a href="#index-buildbot_002eschedulers_002edependent_002eDependent-59"><code>buildbot.schedulers.dependent.Dependent</code></a>: <a href="#Dependent-Scheduler">Dependent Scheduler</a></li>
<li><a href="#index-buildbot_002eschedulers_002efilter_002eChangeFilter-52"><code>buildbot.schedulers.filter.ChangeFilter</code></a>: <a href="#Change-Filters">Change Filters</a></li>
<li><a href="#index-buildbot_002eschedulers_002etimed_002eNightly-62"><code>buildbot.schedulers.timed.Nightly</code></a>: <a href="#Nightly-Scheduler">Nightly Scheduler</a></li>
<li><a href="#index-buildbot_002eschedulers_002etimed_002ePeriodic-61"><code>buildbot.schedulers.timed.Periodic</code></a>: <a href="#Periodic-Scheduler">Periodic Scheduler</a></li>
<li><a href="#index-buildbot_002eschedulers_002etriggerable_002eTriggerable-66"><code>buildbot.schedulers.triggerable.Triggerable</code></a>: <a href="#Triggerable-Scheduler">Triggerable Scheduler</a></li>
<li><a href="#index-buildbot_002eschedulers_002etrysched_002eTry_005fJobdir-63"><code>buildbot.schedulers.trysched.Try_Jobdir</code></a>: <a href="#Try-Schedulers">Try Schedulers</a></li>
<li><a href="#index-buildbot_002eschedulers_002etrysched_002eTry_005fUserpass-64"><code>buildbot.schedulers.trysched.Try_Userpass</code></a>: <a href="#Try-Schedulers">Try Schedulers</a></li>
   </ul><div class="node">
<a name="Buildslaves"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Builders">Builders</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Schedulers">Schedulers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.9 Buildslaves</h3>

<p><a name="index-c_005b_0027slaves_0027_005d-67"></a>
The <code>c['slaves']</code> key is a list of known buildslaves. In the common case,
each buildslave is defined by an instance of the BuildSlave class.  It
represents a standard, manually started machine that will try to connect to
the buildbot master as a slave.  Contrast these with the "on-demand" latent
buildslaves, such as the Amazon Web Service Elastic Compute Cloud latent
buildslave discussed below.

   <p>The BuildSlave class is instantiated with two values: (slavename,
slavepassword). These are the same two values that need to be provided to the
buildslave administrator when they create the buildslave.

   <p>The slavenames must be unique, of course. The password exists to
prevent evildoers from interfering with the buildbot by inserting
their own (broken) buildslaves into the system and thus displacing the
real ones.

   <p>Buildslaves with an unrecognized slavename or a non-matching password
will be rejected when they attempt to connect, and a message
describing the problem will be put in the log file (see <a href="#Logfiles">Logfiles</a>).

<pre class="example">     from buildbot.buildslave import BuildSlave
     c['slaves'] = [BuildSlave('bot-solaris', 'solarispasswd'),
                    BuildSlave('bot-bsd', 'bsdpasswd'),
                   ]
</pre>
   <p><a name="index-Properties-68"></a><code>BuildSlave</code> objects can also be created with an optional
<code>properties</code> argument, a dictionary specifying properties that
will be available to any builds performed on this slave.  For example:

<pre class="example">     from buildbot.buildslave import BuildSlave
     c['slaves'] = [BuildSlave('bot-solaris', 'solarispasswd',
                         properties={'os':'solaris'}),
                   ]
</pre>
   <p>The <code>BuildSlave</code> constructor can also take an optional
<code>max_builds</code> parameter to limit the number of builds that it
will execute simultaneously:

<pre class="example">     from buildbot.buildslave import BuildSlave
     c['slaves'] = [BuildSlave("bot-linux", "linuxpassword", max_builds=2)]
</pre>
   <ul class="menu">
<li><a accesskey="1" href="#Master_002dslave-TCP-Keepalive">Master-slave TCP Keepalive</a>
<li><a accesskey="2" href="#When-Buildslaves-Go-Missing">When Buildslaves Go Missing</a>
<li><a accesskey="3" href="#Latent-Buildslaves">Latent Buildslaves</a>
</ul>

<div class="node">
<a name="Master-slave-TCP-Keepalive"></a>
<a name="Master_002dslave-TCP-Keepalive"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#When-Buildslaves-Go-Missing">When Buildslaves Go Missing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Buildslaves">Buildslaves</a>

</div>

<h4 class="subsection">4.9.1 Mater-slave TCP keepalive</h4>

<p>By default, the buildmaster sends a simple, non-blocking message to each slave
every hour.  These keepalives ensure that traffic is flowing over the
underlying TCP connection, allowing the system's network stack to detect any
problems before a build is started.

   <p>The interval can be modified by specifying the interval in seconds using the
keepalive_interval parameter of BuildSlave:

<pre class="example">     c['slaves'] = [ BuildSlave('bot-linux', 'linuxpasswd',
                               keepalive_interval=3600),
                   ]
</pre>
   <p>The interval can be set to <code>None</code> to disable this functionality
altogether.

<div class="node">
<a name="When-Buildslaves-Go-Missing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Latent-Buildslaves">Latent Buildslaves</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Master_002dslave-TCP-Keepalive">Master-slave TCP Keepalive</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Buildslaves">Buildslaves</a>

</div>

<h4 class="subsection">4.9.2 When Buildslaves Go Missing</h4>

<p>Sometimes, the buildslaves go away. One very common reason for this is
when the buildslave process is started once (manually) and left
running, but then later the machine reboots and the process is not
automatically restarted.

   <p>If you'd like to have the administrator of the buildslave (or other
people) be notified by email when the buildslave has been missing for
too long, just add the <code>notify_on_missing=</code> argument to the
<code>BuildSlave</code> definition:

<pre class="example">     c['slaves'] = [BuildSlave('bot-solaris', 'solarispasswd',
                               notify_on_missing="bob@example.com"),
                   ]
</pre>
   <p>By default, this will send email when the buildslave has been
disconnected for more than one hour. Only one email per
connection-loss event will be sent. To change the timeout, use
<code>missing_timeout=</code> and give it a number of seconds (the default
is 3600).

   <p>You can have the buildmaster send email to multiple recipients: just
provide a list of addresses instead of a single one:

<pre class="example">     c['slaves'] = [BuildSlave('bot-solaris', 'solarispasswd',
                               notify_on_missing=["bob@example.com",
                                                  "alice@example.org"],
                               missing_timeout=300, # notify after 5 minutes
                               ),
                   ]
</pre>
   <p>The email sent this way will use a MailNotifier (see <a href="#MailNotifier">MailNotifier</a>)
status target, if one is configured. This provides a way for you to
control the &ldquo;from&rdquo; address of the email, as well as the relayhost
(aka &ldquo;smarthost&rdquo;) to use as an SMTP server. If no MailNotifier is
configured on this buildmaster, the buildslave-missing emails will be
sent using a default configuration.

   <p>Note that if you want to have a MailNotifier for buildslave-missing
emails but not for regular build emails, just create one with
builders=[], as follows:

<pre class="example">     from buildbot.status import mail
     m = mail.MailNotifier(fromaddr="buildbot@localhost", builders=[],
                           relayhost="smtp.example.org")
     c['status'].append(m)
     c['slaves'] = [BuildSlave('bot-solaris', 'solarispasswd',
                               notify_on_missing="bob@example.com"),
                   ]
</pre>
   <div class="node">
<a name="Latent-Buildslaves"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#When-Buildslaves-Go-Missing">When Buildslaves Go Missing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Buildslaves">Buildslaves</a>

</div>

<h4 class="subsection">4.9.3 Latent Buildslaves</h4>

<p>The standard buildbot model has slaves started manually.  The previous section
described how to configure the master for this approach.

   <p>Another approach is to let the buildbot master start slaves when builds are
ready, on-demand.  Thanks to services such as Amazon Web Services' Elastic
Compute Cloud ("AWS EC2"), this is relatively easy to set up, and can be
very useful for some situations.

   <p>The buildslaves that are started on-demand are called "latent" buildslaves. 
As of this writing, buildbot ships with an abstract base class for building
latent buildslaves, and a concrete implementation for AWS EC2.

<ul class="menu">
<li><a accesskey="1" href="#Amazon-Web-Services-Elastic-Compute-Cloud-_0028_0022AWS-EC2_0022_0029">Amazon Web Services Elastic Compute Cloud ("AWS EC2")</a>
<li><a accesskey="2" href="#Libvirt">Libvirt</a>
<li><a accesskey="3" href="#Dangers-with-Latent-Buildslaves">Dangers with Latent Buildslaves</a>
<li><a accesskey="4" href="#Writing-New-Latent-Buildslaves">Writing New Latent Buildslaves</a>
</ul>

<div class="node">
<a name="Amazon-Web-Services-Elastic-Compute-Cloud-(%22AWS-EC2%22)"></a>
<a name="Amazon-Web-Services-Elastic-Compute-Cloud-_0028_0022AWS-EC2_0022_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Libvirt">Libvirt</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Latent-Buildslaves">Latent Buildslaves</a>

</div>

<h5 class="subsubsection">4.9.3.1 Amazon Web Services Elastic Compute Cloud ("AWS EC2")</h5>

<p><a href="http://aws.amazon.com/ec2/">AWS EC2</a> is a web service that allows you to
start virtual machines in an Amazon data center. Please see their website for
details, incuding costs. Using the AWS EC2 latent buildslaves involves getting
an EC2 account with AWS and setting up payment; customizing one or more EC2
machine images ("AMIs") on your desired operating system(s) and publishing
them (privately if needed); and configuring the buildbot master to know how to
start your customized images for "substantiating" your latent slaves.

<h3 class="heading">Get an AWS EC2 Account</h3>

<p>To start off, to use the AWS EC2 latent buildslave, you need to get an AWS
developer account and sign up for EC2. These instructions may help you get
started:

     <ul>
<li>Go to http://aws.amazon.com/ and click to "Sign Up Now" for an AWS account.

     <li>Once you are logged into your account, you need to sign up for EC2. 
Instructions for how to do this have changed over time because Amazon changes
their website, so the best advice is to hunt for it. After signing up for EC2,
it may say it wants you to upload an x.509 cert. You will need this to create
images (see below) but it is not technically necessary for the buildbot master
configuration.

     <li>You must enter a valid credit card before you will be able to use EC2. Do that
under 'Payment Method'.

     <li>Make sure you're signed up for EC2 by going to 'Your Account'-&gt;'Account
Activity' and verifying EC2 is listed. 
</ul>

<h3 class="heading">Create an AMI</h3>

<p>Now you need to create an AMI and configure the master.  You may need to
run through this cycle a few times to get it working, but these instructions
should get you started.

   <p>Creating an AMI is out of the scope of this document.  The
<a href="http://docs.amazonwebservices.com/AWSEC2/latest/GettingStartedGuide/">EC2 Getting Started Guide</a>
is a good resource for this task.  Here are a few additional hints.

     <ul>
<li>When an instance of the image starts, it needs to automatically start a
buildbot slave that connects to your master (to create a buildbot slave,
see <a href="#Creating-a-buildslave">Creating a buildslave</a>; to make a daemon,
see <a href="#Launching-the-daemons">Launching the daemons</a>).

     <li>You may want to make an instance of the buildbot slave, configure it as a
standard buildslave in the master (i.e., not as a latent slave), and test and
debug it that way before you turn it into an AMI and convert to a latent
slave in the master. 
</ul>

<h3 class="heading">Configure the Master with an EC2LatentBuildSlave</h3>

<p>Now let's assume you have an AMI that should work with the
EC2LatentBuildSlave.  It's now time to set up your buildbot master
configuration.

   <p>You will need some information from your AWS account: the "Access Key Id" and
the "Secret Access Key".  If you've built the AMI yourself, you probably
already are familiar with these values.  If you have not, and someone has
given you access to an AMI, these hints may help you find the necessary
values:

     <ul>
<li>While logged into your AWS account, find the "Access Identifiers" link (either
on the left, or via "Your Account" -&gt; "Access Identifiers".

     <li>On the page, you'll see alphanumeric values for "Your Access Key Id:" and
"Your Secret Access Key:". Make a note of these. Later on, we'll call the
first one your "identifier" and the second one your "secret_identifier." 
</ul>

   <p>When creating an EC2LatentBuildSlave in the buildbot master configuration,
the first three arguments are required.  The name and password are the first
two arguments, and work the same as with normal buildslaves.  The next
argument specifies the type of the EC2 virtual machine (available options as
of this writing include "m1.small", "m1.large", 'm1.xlarge", "c1.medium",
and "c1.xlarge"; see the EC2 documentation for descriptions of these
machines).

   <p>Here is the simplest example of configuring an EC2 latent buildslave. It
specifies all necessary remaining values explicitly in the instantiation.

<pre class="example">     from buildbot.ec2buildslave import EC2LatentBuildSlave
     c['slaves'] = [EC2LatentBuildSlave('bot1', 'sekrit', 'm1.large',
                                        ami='ami-12345',
                                        identifier='publickey',
                                        secret_identifier='privatekey'
                                        )]
</pre>
   <p>The "ami" argument specifies the AMI that the master should start.  The
"identifier" argument specifies the AWS "Access Key Id," and the
"secret_identifier" specifies the AWS "Secret Access Key." Both the AMI and
the account information can be specified in alternate ways.

   <p>Note that whoever has your identifier and secret_identifier values can request
AWS work charged to your account, so these values need to be carefully
protected. Another way to specify these access keys is to put them in a
separate file. You can then make the access privileges stricter for this
separate file, and potentially let more people read your main configuration
file.

   <p>By default, you can make an .ec2 directory in the home folder of the user
running the buildbot master. In that directory, create a file called aws_id. 
The first line of that file should be your access key id; the second line
should be your secret access key id. Then you can instantiate the build slave
as follows.

<pre class="example">     from buildbot.ec2buildslave import EC2LatentBuildSlave
     c['slaves'] = [EC2LatentBuildSlave('bot1', 'sekrit', 'm1.large',
                                        ami='ami-12345')]
</pre>
   <p>If you want to put the key information in another file, use the
"aws_id_file_path" initialization argument.

   <p>Previous examples used a particular AMI.  If the Buildbot master will be
deployed in a process-controlled environment, it may be convenient to
specify the AMI more flexibly.  Rather than specifying an individual AMI,
specify one or two AMI filters.

   <p>In all cases, the AMI that sorts last by its location (the S3 bucket and
manifest name) will be preferred.

   <p>One available filter is to specify the acceptable AMI owners, by AWS account
number (the 12 digit number, usually rendered in AWS with hyphens like
"1234-5678-9012", should be entered as in integer).

<pre class="example">     from buildbot.ec2buildslave import EC2LatentBuildSlave
     bot1 = EC2LatentBuildSlave('bot1', 'sekrit', 'm1.large',
                                valid_ami_owners=[11111111111,
                                                  22222222222],
                                identifier='publickey',
                                secret_identifier='privatekey'
                                )
</pre>
   <p>The other available filter is to provide a regular expression string that
will be matched against each AMI's location (the S3 bucket and manifest name).

<pre class="example">     from buildbot.ec2buildslave import EC2LatentBuildSlave
     bot1 = EC2LatentBuildSlave(
         'bot1', 'sekrit', 'm1.large',
         valid_ami_location_regex=r'buildbot\-.*/image.manifest.xml',
         identifier='publickey', secret_identifier='privatekey')
</pre>
   <p>The regular expression can specify a group, which will be preferred for the
sorting.  Only the first group is used; subsequent groups are ignored.

<pre class="example">     from buildbot.ec2buildslave import EC2LatentBuildSlave
     bot1 = EC2LatentBuildSlave(
         'bot1', 'sekrit', 'm1.large',
         valid_ami_location_regex=r'buildbot\-.*\-(.*)/image.manifest.xml',
         identifier='publickey', secret_identifier='privatekey')
</pre>
   <p>If the group can be cast to an integer, it will be.  This allows 10 to sort
after 1, for instance.

<pre class="example">     from buildbot.ec2buildslave import EC2LatentBuildSlave
     bot1 = EC2LatentBuildSlave(
         'bot1', 'sekrit', 'm1.large',
         valid_ami_location_regex=r'buildbot\-.*\-(\d+)/image.manifest.xml',
         identifier='publickey', secret_identifier='privatekey')
</pre>
   <p>In addition to using the password as a handshake between the master and the
slave, you may want to use a firewall to assert that only machines from a
specific IP can connect as slaves.  This is possible with AWS EC2 by using
the Elastic IP feature.  To configure, generate a Elastic IP in AWS, and then
specify it in your configuration using the "elastic_ip" argument.

<pre class="example">     from buildbot.ec2buildslave import EC2LatentBuildSlave
     c['slaves'] = [EC2LatentBuildSlave('bot1', 'sekrit', 'm1.large',
                                        'ami-12345',
                                        identifier='publickey',
                                        secret_identifier='privatekey',
                                        elastic_ip='208.77.188.166'
                                        )]
</pre>
   <p>The EC2LatentBuildSlave supports all other configuration from the standard
BuildSlave.  The "missing_timeout" and "notify_on_missing" specify how long
to wait for an EC2 instance to attach before considering the attempt to have
failed, and email addresses to alert, respectively.  "missing_timeout"
defaults to 20 minutes.

   <p>The "build_wait_timeout" allows you to specify how long an EC2LatentBuildSlave
should wait after a build for another build before it shuts down the EC2
instance.  It defaults to 10 minutes.

   <p>"keypair_name" and "security_name" allow you to specify different names for
these AWS EC2 values.  They both default to "latent_buildbot_slave".

<div class="node">
<a name="Libvirt"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Dangers-with-Latent-Buildslaves">Dangers with Latent Buildslaves</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Amazon-Web-Services-Elastic-Compute-Cloud-_0028_0022AWS-EC2_0022_0029">Amazon Web Services Elastic Compute Cloud (&quot;AWS EC2&quot;)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Latent-Buildslaves">Latent Buildslaves</a>

</div>

<h5 class="subsubsection">4.9.3.2 Libvirt</h5>

<p><a href="http://www.libvirt.org/">libvirt</a> is a virtualization API for interacting
with the virtualization capabilities of recent versions of Linux and other OSes. 
It is LGPL and comes with a stable C API, and python bindings.

   <p>This means we now have an API which when tied to buildbot allows us to have slaves
that run under Xen, QEMU, KVM, LXC, OpenVZ, User Mode Linux, VirtualBox and VMWare.

   <p>The libvirt code in Buildbot was developed against libvirt 0.7.5 on Ubuntu Lucid. It
is used with KVM to test python code on Karmic VM's, but obviously isn't limited to that. 
Each build is run on a new VM, images are temporary and thrown away after each build.

<h3 class="heading">Setting up libvirt</h3>

<p>We won't show you how to set up libvirt as it is quite different on each platform,
but there are a few things you should keep in mind.

     <ul>
<li>If you are running on Ubuntu, your master should run Lucid. Libvirt and apparmor are
buggy on Karmic.

     <li>If you are using the system libvirt, your buildbot master user will need to be in the
libvirtd group.

     <li>If you are using KVM, your buildbot master user will need to be in the KVM group.

     <li>You need to think carefully about your virtual network *first*. Will NAT be enough? 
What IP will my VM's need to connect to for connecting to the master? 
</ul>

<h3 class="heading">Configuring your base image</h3>

<p>You need to create a base image for your builds that has everything needed to build
your software. You need to configure the base image with a buildbot slave that is configured
to connect to the master on boot.

   <p>Because this image may need updating a lot, we strongly suggest scripting its creation.

   <p>If you want to have multiple slaves using the same base image it can be annoying to duplicate
the image just to change the buildbot credentials. One option is to use libvirt's DHCP
server to allocate an identity to the slave: DHCP sets a hostname, and the slave takes its
identity from that.

   <p>Doing all this is really beyond the scope of the manual, but there is a
vmbuilder script and a network.xml file to create such a DHCP server in
<code>contrib/</code> (see <a href="#Contrib-Scripts">Contrib Scripts</a>) that should get you started:

<pre class="example">     sudo apt-get install ubuntu-vm-builder
     sudo contrib/libvirt/vmbuilder
</pre>
   <p>Should create an ubuntu/ folder with a suitable image in it.

<pre class="example">     virsh net-define contrib/libvirt/network.xml
     virsh net-start buildbot-network
</pre>
   <p>Should set up a KVM compatible libvirt network for your buildbot VM's to run on.

<h3 class="heading">Configuring your Master</h3>

<p>If you want to add a simple on demand VM to your setup, you only need the following. We
set the username to minion1, the password to sekrit. The base image is called base_image
and a copy of it will be made for the duration of the VM's life. That copy will be thrown
away every time a build is complete.

<pre class="example">     from buildbot.libvirtbuildslave import LibVirtBuildSlave
     c['slaves'] = [LibVirtBuildSlave('minion1', 'sekrit',
                                        '/home/buildbot/images/minion1', '/home/buildbot/images/base_image')]
</pre>
   <p>You can use virt-manager to define 'minion1' with the correct hardware. If you don't, buildbot
won't be able to find a VM to start.

   <p><code>LibVirtBuildSlave</code> accepts the following arguments:

     <dl>
<dt><code>name</code><dd>Both a buildbot username and the name of the virtual machine

     <br><dt><code>password</code><dd>A password for the buildbot to login to the master with

     <br><dt><code>hd_image</code><dd>The path to a libvirt disk image, normally in qcow2 format when using KVM.

     <br><dt><code>base_image</code><dd>If given a base image, buildbot will clone it every time it starts a VM. 
This means you always have a clean environment to do your build in.

     <br><dt><code>xml</code><dd>If a VM isn't predefined in virt-manager, then you can instead provide XML
like that used with <code>virsh define</code>. The VM will be created
automatically when needed, and destroyed when not needed any longer.

   </dl>

<div class="node">
<a name="Dangers-with-Latent-Buildslaves"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Writing-New-Latent-Buildslaves">Writing New Latent Buildslaves</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Libvirt">Libvirt</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Latent-Buildslaves">Latent Buildslaves</a>

</div>

<h5 class="subsubsection">4.9.3.3 Dangers with Latent Buildslaves</h5>

<p>Any latent build slave that interacts with a for-fee service, such as the
EC2LatentBuildSlave, brings significant risks. As already identified, the
configuration will need access to account information that, if obtained by a
criminal, can be used to charge services to your account. Also, bugs in the
buildbot software may lead to unnecessary charges. In particular, if the
master neglects to shut down an instance for some reason, a virtual machine
may be running unnecessarily, charging against your account. Manual and/or
automatic (e.g. nagios with a plugin using a library like boto)
double-checking may be appropriate.

   <p>A comparatively trivial note is that currently if two instances try to attach
to the same latent buildslave, it is likely that the system will become
confused.  This should not occur, unless, for instance, you configure a normal
build slave to connect with the authentication of a latent buildbot.  If this
situation does occur, stop all attached instances and restart the master.

<div class="node">
<a name="Writing-New-Latent-Buildslaves"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Dangers-with-Latent-Buildslaves">Dangers with Latent Buildslaves</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Latent-Buildslaves">Latent Buildslaves</a>

</div>

<h5 class="subsubsection">4.9.3.4 Writing New Latent Buildslaves</h5>

<p>Writing a new latent buildslave should only require subclassing
<code>buildbot.buildslave.AbstractLatentBuildSlave</code> and implementing
start_instance and stop_instance.

<pre class="example">     def start_instance(self):
         # responsible for starting instance that will try to connect with this
         # master. Should return deferred. Problems should use an errback. The
         # callback value can be None, or can be an iterable of short strings to
         # include in the "substantiate success" status message, such as
         # identifying the instance that started.
         raise NotImplementedError
     
     def stop_instance(self, fast=False):
         # responsible for shutting down instance. Return a deferred. If `fast`,
         # we're trying to shut the master down, so callback as soon as is safe.
         # Callback value is ignored.
         raise NotImplementedError
</pre>
   <p>See <code>buildbot.ec2buildslave.EC2LatentBuildSlave</code> for an example.

<div class="node">
<a name="Builders"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Build-Factories">Build Factories</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Buildslaves">Buildslaves</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.10 Builders</h3>

<ul class="menu">
<li><a accesskey="1" href="#Builder-Configuration">Builder Configuration</a>
<li><a accesskey="2" href="#Merging-Build-Requests">Merging Build Requests</a>
<li><a accesskey="3" href="#Prioritizing-Builds">Prioritizing Builds</a>
</ul>

<div class="node">
<a name="Builder-Configuration"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Merging-Build-Requests">Merging Build Requests</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Builders">Builders</a>

</div>

<h4 class="subsection">4.10.1 Builder Configuration</h4>

<p><a name="index-c_005b_0027builders_0027_005d-69"></a>
The <code>c['builders']</code> key is a list of objects giving configuration for the
Builders.  For more information, See <a href="#Builder">Builder</a>.  The class definition for the
builder configuration is in <code>buildbot.config</code>.  In the configuration file,
its use looks like:

<pre class="example">     from buildbot.config import BuilderConfig
     c['builders'] = [
         BuilderConfig(name='quick', slavenames=['bot1', 'bot2'], factory=f_quick),
         BuilderConfig(name='thorough', slavename='bot1', factory=f_thorough),
     ]
</pre>
   <p>The constructor takes the following keyword arguments:

     <dl>
<dt><code>name</code><dd>This specifies the Builder's name, which is used in status
reports.

     <br><dt><code>slavename</code><br><dt><code>slavenames</code><dd>These arguments specify the buildslave or buildslaves that will be used by this
Builder.  All slaves names must appear in the <code>c['slaves']</code> list. Each
buildslave can accomodate multiple Builders.  The <code>slavenames</code> parameter
can be a list of names, while <code>slavename</code> can specify only one slave.

     <br><dt><code>factory</code><dd>This is a <code>buildbot.process.factory.BuildFactory</code> instance which
controls how the build is performed. Full details appear in their own
section, See <a href="#Build-Factories">Build Factories</a>. Parameters like the location of the CVS
repository and the compile-time options used for the build are
generally provided as arguments to the factory's constructor.

   </dl>

   <p>Other optional keys may be set on each Builder:

     <dl>
<dt><code>builddir</code><dd>Specifies the name of a subdirectory (under the base directory) in which
everything related to this builder will be placed on the buildmaster. 
This holds build status information. If not set, defaults to <code>name</code>
with some characters escaped. Each builder must have a unique build
directory.

     <br><dt><code>slavebuilddir</code><dd>Specifies the name of a subdirectory (under the base directory) in which
everything related to this builder will be placed on the buildslave. 
This is where checkouts, compiles, and tests are run. If not set,
defaults to <code>builddir</code>. If a slave is connected to multiple builders
that share the same <code>slavebuilddir</code>, make sure the slave is set to
run one build at a time or ensure this is fine to run multiple builds from
the same directory simultaneously.

     <br><dt><code>category</code><dd>If provided, this is a string that identifies a category for the
builder to be a part of. Status clients can limit themselves to a
subset of the available categories. A common use for this is to add
new builders to your setup (for a new module, or for a new buildslave)
that do not work correctly yet and allow you to integrate them with
the active builders. You can put these new builders in a test
category, make your main status clients ignore them, and have only
private status clients pick them up. As soon as they work, you can
move them over to the active category.

     <br><dt><code>nextSlave</code><dd>If provided, this is a function that controls which slave will be assigned
future jobs. The function is passed two arguments, the <code>Builder</code>
object which is assigning a new job, and a list of <code>SlaveBuilder</code>
objects. The function should return one of the <code>SlaveBuilder</code>
objects, or <code>None</code> if none of the available slaves should be
used.  This function can optionally return a Deferred which should
fire with the same results.

     <br><dt><code>nextBuild</code><dd>If provided, this is a function that controls which build request will be
handled next. The function is passed two arguments, the <code>Builder</code> object
which is assigning a new job, and a list of <code>BuildRequest</code> objects
representing pending build requests, sorted by increasing submission time.  . 
The function should return one of the <code>BuildRequest</code> objects, or
<code>None</code> if none of the pending builds should be started.  This function can
optionally return a Deferred which should fire with the same results.

     <br><dt><code>locks</code><dd>This argument specifies a list of locks that apply to this builder; See <a href="#Interlocks">Interlocks</a>.

     <br><dt><code>env</code><dd>A Builder may be given a dictionary of environment variables in this parameter. 
The variables are used in see <a href="#ShellCommand">ShellCommand</a> steps in builds created by this
builder. The environment variables will override anything in the buildslave's
environment. Variables passed directly to a <code>ShellCommand</code> will override
variables of the same name passed to the Builder.

     <p>For example, if you have a pool of identical slaves, it is often easier to
manage variables like PATH from Buildbot, rather than manually editing it inside
of the slaves' environment.

     <pre class="example">          f = factory.BuildFactory
          f.addStep(ShellCommand(
                        command=['bash', './configure']))
          f.addStep(Compile())
          
          c['builders'] = [
            BuilderConfig(name='test', factory=f,
                  slavenames=['slave1', 'slave2', 'slave3', 'slave4'],
                  env={'PATH': '/opt/local/bin:/opt/app/bin:/usr/local/bin:/usr/bin'}),
          ]
</pre>
     <br><dt><code>mergeRequests</code><dd>Specifies how build requests for this builder should be merged, overriding the
global option (see <a href="#Merging-Build-Requests-_0028global-option_0029">Merging Build Requests (global option)</a>).  See
<a href="#Merging-Build-Requests">Merging Build Requests</a> for details.

     <br><dt><code>properties</code><dd>A builder may be given a dictionary of <a href="#Build-Properties">Build Properties</a>
specific for this builder in this parameter. Those values can be used
later on like other properties. see <a href="#WithProperties">WithProperties</a>.

   </dl>

<div class="node">
<a name="Merging-Build-Requests"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Prioritizing-Builds">Prioritizing Builds</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Builder-Configuration">Builder Configuration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Builders">Builders</a>

</div>

<h4 class="subsection">4.10.2 Merging Build Requests</h4>

<p>When more than one build request is available for a builder, Buildbot can
"merge" the requests into a single build.  This is desirable when build
requests arrive more quickly than the available slaves can satisfy them, but
has the drawback that separate results for each build are not available.

   <p>This behavior can be controlled globally, using the <code>c['mergeRequests']</code>
parameter, and on a per-builder basis, using the <code>mergeRequests</code> argument
to the builder configuration.  If <code>mergeRequests</code> is given, it completely
overrides the global configuration.

   <p>For either configuration parameter, a value of <code>True</code> (the default) causes
buildbot to merge BuildRequests that have "compatible" source stamps.  Source
stamps are compatible if:

     <ul>
<li>their branch, project, and repository attributes match exactly;
<li>neither source stamp has a patch (e.g., from a try scheduler); and
<li>either both source stamps are associated with changes, or neither ar
associated with changes but they have matching revisions. 
</ul>

   <p>This algorithm is implemented by the SourceStamp method <code>canBeMergedWith</code>.

   <p>A configuration value of <code>False</code> indicates that requests should never be
merged.

   <p>If the configuration value is a callable, that callable will be invoked with
three positional arguments: a <code>Builder</code> object and two <code>BuildRequest</code>
objects. It should return true if the requests can be merged, and False
otherwise. For example:

<pre class="example">     def mergeRequests(builder, req1, req2):
         "any requests with the same branch can be merged"
         return req1.branch == req2.branch
     c['mergeRequests'] = mergeRequests
</pre>
   <p>In many cases, the details of the SourceStamps and BuildRequests are important. 
In this example, only BuildRequests with the same "reason" are merged; thus
developers forcing builds for different reasons will see distinct builds.  Note
the use of the <code>canBeMergedWith</code> method to access the source stamp
compatibility algorithm.

<pre class="example">     def mergeRequests(builder, req1, req2):
         if req1.source.canBeMergedWith(req2.source) and  req1.reason == req2.reason:
            return True
         return False
     c['mergeRequests'] = mergeRequests
</pre>
   <p>If it's necessary to perform some blocking operation to determine whether two
requests can be merged, then the <code>mergeRequests</code> callable may return its
result via Deferred.  Note, however, that the number of invocations of the
callable is proportional to the square of the request queue length, so a
long-running callable may cause undesirable delays when the queue length grows.

<div class="node">
<a name="Prioritizing-Builds"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Merging-Build-Requests">Merging Build Requests</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Builders">Builders</a>

</div>

<h4 class="subsection">4.10.3 Prioritizing Builds</h4>

<p>The <code>BuilderConfig</code> parameter <code>nextBuild</code> can be use to prioritize
build requests within a builder. Note that this is orthogonal to
see <a href="#Prioritizing-Builders">Prioritizing Builders</a>, which controls the order in which builders are
called on to start their builds.

<pre class="example">     def nextBuild(bldr, requests):
         for r in requests:
             if r.source.branch == 'release':
                 return r
         return requests[0]
     
     c['builders'] = [
       BuilderConfig(name='test', factory=f,
             nextBuild=nextBuild,
             slavenames=['slave1', 'slave2', 'slave3', 'slave4']),
     ]
</pre>
   <div class="node">
<a name="Build-Factories"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Build-Steps">Build Steps</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Builders">Builders</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.11 Build Factories</h3>

<p>Each Builder is equipped with a &ldquo;build factory&rdquo;, which is
responsible for producing the actual <code>Build</code> objects that perform
each build. This factory is created in the configuration file, and
attached to a Builder through the <code>factory</code> element of its
dictionary.

   <p>The standard <code>BuildFactory</code> object creates <code>Build</code> objects
by default. These Builds will each execute a collection of BuildSteps
in a fixed sequence. Each step can affect the results of the build,
but in general there is little intelligence to tie the different steps
together.

   <p>The steps used by these builds are all subclasses of <code>BuildStep</code>. 
The standard ones provided with Buildbot are documented later,
See <a href="#Build-Steps">Build Steps</a>. You can also write your own subclasses to use in
builds.

   <p>The basic behavior for a <code>BuildStep</code> is to:

     <ul>
<li>run for a while, then stop
<li>possibly invoke some RemoteCommands on the attached build slave
<li>possibly produce a set of log files
<li>finish with a status described by one of four values defined in
buildbot.status.builder: SUCCESS, WARNINGS, FAILURE, SKIPPED
<li>provide a list of short strings to describe the step
</ul>

<ul class="menu">
<li><a accesskey="1" href="#BuildFactory">BuildFactory</a>
<li><a accesskey="2" href="#GNUAutoconf">GNUAutoconf</a>
<li><a accesskey="3" href="#BasicBuildFactory">BasicBuildFactory</a>
<li><a accesskey="4" href="#BasicSVN">BasicSVN</a>
<li><a accesskey="5" href="#QuickBuildFactory">QuickBuildFactory</a>
<li><a accesskey="6" href="#CPAN">CPAN</a>
<li><a accesskey="7" href="#Distutils">Distutils</a>
<li><a accesskey="8" href="#Trial-_0028Factory_0029">Trial (Factory)</a>
<li><a accesskey="9" href="#Build-Factory-Index">Build Factory Index</a>
</ul>

<div class="node">
<a name="BuildFactory"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#GNUAutoconf">GNUAutoconf</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Factories">Build Factories</a>

</div>

<h4 class="subsection">4.11.1 BuildFactory</h4>

<p><a name="index-buildbot_002eprocess_002efactory_002eBuildFactory-70"></a>
A BuildFactory defines the steps that every build will follow.  Think of it as
a glorified script.  For example, a build which consists of a CVS checkout
followed by a <code>make build</code> would be constructed as follows:

<pre class="example">     from buildbot.steps import source, shell
     from buildbot.process import factory
     
     f = factory.BuildFactory()
     f.addStep(source.CVS(cvsroot=CVSROOT, cvsmodule="project", mode="update"))
     f.addStep(shell.Compile(command=["make", "build"]))
</pre>
   <p>It is also possible to pass a list of steps into the
<code>BuildFactory</code> when it is created. Using <code>addStep</code> is
usually simpler, but there are cases where is is more convenient to
create the list of steps ahead of time, perhaps using some Python
tricks to generate the steps.

<pre class="example">     from buildbot.steps import source, shell
     from buildbot.process import factory
     
     all_steps = [
         source.CVS(cvsroot=CVSROOT, cvsmodule="project", mode="update"),
         shell.Compile(command=["make", "build"]),
     ]
     f = factory.BuildFactory(all_steps)
</pre>
   <p>Finally, you can also add a sequence of steps all at once:

<pre class="example">     f.addSteps(all_steps)
</pre>
   <h3 class="heading">Attributes</h3>

     <dl>
<dt><code>useProgress</code><dd>(defaults to True): if True, the buildmaster keeps track of how long
each step takes, so it can provide estimates of how long future builds
will take. If builds are not expected to take a consistent amount of
time (such as incremental builds in which a random set of files are
recompiled or tested each time), this should be set to False to
inhibit progress-tracking.

     <br><dt><code>workdir</code><dd>(defaults to 'build'): workdir given to every build step created by
this factory as default. The workdir can be overridden in a build step
definition. 
If this attribute is set to a string, that string will be used
for constructing the workdir (buildslave base + builder builddir +
workdir). If this attributed is set to a Python callable, that
callable will be called with SourceStamp as single parameter and
is supposed to return a string which will be used as above. 
The latter is useful in scenarios with multiple repositories
submitting changes to BuildBot. In this case you likely will want
to have a dedicated workdir per repository, since otherwise a
sourcing step with mode = "update" will fail as a workdir with
a working copy of repository A can't be "updated" for changes
from a repository B. Here is an example how you can achive
workdir-per-repo:

     <pre class="example">          #
          # pre-repository working directory
          #
          def workdir (source_stamp):
              return hashlib.md5 (source_stamp.repository).hexdigest ()[:8]
          
          build = factory.BuildFactory()
          build.workdir = workdir
          
          build.addStep (Git (mode = "update"))
          ...
          builders.append ({'name': 'mybuilder',
                            'slavename': 'myslave',
                            'builddir': 'mybuilder',
                            'factory': build})
          
          # You'll end up with workdirs like:
          #
          # Repo1 =&gt; &lt;buildslave-base&gt;/mybuilder/a78890ba
          # Repo2	=&gt; &lt;buildslave-base&gt;/mybuilder/0823ba88
          # ...
</pre>
     <p>You could make the workdir() function compute other paths, based on
parts of the repo URL in the sourcestamp, or lookup in a lookup table
based on repo URL. As long as there is a permanent 1:1 mapping between
repos and workdir this will work. 
</dl>

<h3 class="heading">Implementation Note</h3>

<p>The default <code>BuildFactory</code>, provided in the
<code>buildbot.process.factory</code> module, contains an internal list of
&ldquo;BuildStep specifications&rdquo;: a list of <code>(step_class, kwargs)</code>
tuples for each. These specification tuples are constructed when the
config file is read, by asking the instances passed to <code>addStep</code>
for their subclass and arguments.

   <p>To support config files from buildbot-0.7.5 and earlier,
<code>addStep</code> also accepts the <code>f.addStep(shell.Compile,
command=["make","build"])</code> form, although its use is discouraged
because then the <code>Compile</code> step doesn't get to validate or
complain about its arguments until build time. The modern
pass-by-instance approach allows this validation to occur while the
config file is being loaded, where the admin has a better chance of
noticing problems.

   <p>When asked to create a Build, the <code>BuildFactory</code> puts a copy of
the list of step specifications into the new Build object. When the
Build is actually started, these step specifications are used to
create the actual set of BuildSteps, which are then executed one at a
time. This serves to give each Build an independent copy of each step.

   <p>Each step can affect the build process in the following ways:

     <ul>
<li>If the step's <code>haltOnFailure</code> attribute is True, then a failure
in the step (i.e. if it completes with a result of FAILURE) will cause
the whole build to be terminated immediately: no further steps will be
executed, with the exception of steps with <code>alwaysRun</code> set to
True. <code>haltOnFailure</code> is useful for setup steps upon which the
rest of the build depends: if the CVS checkout or <code>./configure</code>
process fails, there is no point in trying to compile or test the
resulting tree.

     <li>If the step's <code>alwaysRun</code> attribute is True, then it will always
be run, regardless of if previous steps have failed. This is useful
for cleanup steps that should always be run to return the build
directory or build slave into a good state.

     <li>If the <code>flunkOnFailure</code> or <code>flunkOnWarnings</code> flag is set,
then a result of FAILURE or WARNINGS will mark the build as a whole as
FAILED. However, the remaining steps will still be executed. This is
appropriate for things like multiple testing steps: a failure in any
one of them will indicate that the build has failed, however it is
still useful to run them all to completion.

     <li>Similarly, if the <code>warnOnFailure</code> or <code>warnOnWarnings</code> flag
is set, then a result of FAILURE or WARNINGS will mark the build as
having WARNINGS, and the remaining steps will still be executed. This
may be appropriate for certain kinds of optional build or test steps. 
For example, a failure experienced while building documentation files
should be made visible with a WARNINGS result but not be serious
enough to warrant marking the whole build with a FAILURE.

   </ul>

   <p>In addition, each Step produces its own results, may create logfiles,
etc. However only the flags described above have any effect on the
build as a whole.

   <p>The pre-defined BuildSteps like <code>CVS</code> and <code>Compile</code> have
reasonably appropriate flags set on them already. For example, without
a source tree there is no point in continuing the build, so the
<code>CVS</code> class has the <code>haltOnFailure</code> flag set to True. Look
in <samp><span class="file">buildbot/steps/*.py</span></samp> to see how the other Steps are
marked.

   <p>Each Step is created with an additional <code>workdir</code> argument that
indicates where its actions should take place. This is specified as a
subdirectory of the slave builder's base directory, with a default
value of <code>build</code>. This is only implemented as a step argument (as
opposed to simply being a part of the base directory) because the
CVS/SVN steps need to perform their checkouts from the parent
directory.

<div class="node">
<a name="GNUAutoconf"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#BasicBuildFactory">BasicBuildFactory</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BuildFactory">BuildFactory</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Factories">Build Factories</a>

</div>

<h4 class="subsection">4.11.2 GNUAutoconf</h4>

<p><a name="index-buildbot_002eprocess_002efactory_002eGNUAutoconf-71"></a>
<a href="http://www.gnu.org/software/autoconf/">GNU Autoconf</a> is a
software portability tool, intended to make it possible to write
programs in C (and other languages) which will run on a variety of
UNIX-like systems. Most GNU software is built using autoconf. It is
frequently used in combination with GNU automake. These tools both
encourage a build process which usually looks like this:

<pre class="example">     % CONFIG_ENV=foo ./configure --with-flags
     % make all
     % make check
     # make install
</pre>
   <p>(except of course the Buildbot always skips the <code>make install</code>
part).

   <p>The Buildbot's <code>buildbot.process.factory.GNUAutoconf</code> factory is
designed to build projects which use GNU autoconf and/or automake. The
configuration environment variables, the configure flags, and command
lines used for the compile and test are all configurable, in general
the default values will be suitable.

   <p>Example:

<pre class="example">     f = factory.GNUAutoconf(source=source.SVN(svnurl=URL, mode="copy"),
                             flags=["--disable-nls"])
</pre>
   <p>Required Arguments:

     <dl>
<dt><code>source</code><dd>This argument must be a step specification tuple that provides a
BuildStep to generate the source tree. 
</dl>

   <p>Optional Arguments:

     <dl>
<dt><code>configure</code><dd>The command used to configure the tree. Defaults to
<code>./configure</code>. Accepts either a string or a list of shell argv
elements.

     <br><dt><code>configureEnv</code><dd>The environment used for the initial configuration step. This accepts
a dictionary which will be merged into the buildslave's normal
environment. This is commonly used to provide things like
<code>CFLAGS="-O2 -g"</code> (to turn off debug symbols during the compile). 
Defaults to an empty dictionary.

     <br><dt><code>configureFlags</code><dd>A list of flags to be appended to the argument list of the configure
command. This is commonly used to enable or disable specific features
of the autoconf-controlled package, like <code>["--without-x"]</code> to
disable windowing support. Defaults to an empty list.

     <br><dt><code>compile</code><dd>this is a shell command or list of argv values which is used to
actually compile the tree. It defaults to <code>make all</code>. If set to
None, the compile step is skipped.

     <br><dt><code>test</code><dd>this is a shell command or list of argv values which is used to run
the tree's self-tests. It defaults to <code>make check</code>. If set to
None, the test step is skipped.

   </dl>

<div class="node">
<a name="BasicBuildFactory"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#BasicSVN">BasicSVN</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#GNUAutoconf">GNUAutoconf</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Factories">Build Factories</a>

</div>

<h4 class="subsection">4.11.3 BasicBuildFactory</h4>

<p><a name="index-buildbot_002eprocess_002efactory_002eBasicBuildFactory-72"></a>
This is a subclass of <code>GNUAutoconf</code> which assumes the source is in CVS,
and uses <code>mode='clobber'</code> to always build from a clean working copy.

<div class="node">
<a name="BasicSVN"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#QuickBuildFactory">QuickBuildFactory</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BasicBuildFactory">BasicBuildFactory</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Factories">Build Factories</a>

</div>

<h4 class="subsection">4.11.4 BasicSVN</h4>

<p><a name="index-buildbot_002eprocess_002efactory_002eBasicSVN-73"></a>
This class is similar to <a href="#BasicBuildFactory">BasicBuildFactory</a>, but uses SVN instead of CVS.

<div class="node">
<a name="QuickBuildFactory"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CPAN">CPAN</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BasicSVN">BasicSVN</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Factories">Build Factories</a>

</div>

<h4 class="subsection">4.11.5 QuickBuildFactory</h4>

<p><a name="index-buildbot_002eprocess_002efactory_002eQuickBuildFactory-74"></a>
The <code>QuickBuildFactory</code> class is a subclass of <code>GNUAutoconf</code> which
assumes the source is in CVS, and uses <code>mode='update'</code> to get incremental
updates.

   <p>The difference between a &ldquo;full build&rdquo; and a &ldquo;quick build&rdquo; is that
quick builds are generally done incrementally, starting with the tree
where the previous build was performed. That simply means that the
source-checkout step should be given a <code>mode='update'</code> flag, to
do the source update in-place.

   <p>In addition to that, this class sets the <code>useProgress</code> flag to False. 
Incremental builds will (or at least the ought to) compile as few files as
necessary, so they will take an unpredictable amount of time to run. Therefore
it would be misleading to claim to predict how long the build will take.

   <p>This class is probably not of use to new projects.

<div class="node">
<a name="CPAN"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Distutils">Distutils</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#QuickBuildFactory">QuickBuildFactory</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Factories">Build Factories</a>

</div>

<h4 class="subsection">4.11.6 CPAN</h4>

<p><a name="index-buildbot_002eprocess_002efactory_002eCPAN-75"></a>
Most Perl modules available from the <a href="http://www.cpan.org/">CPAN</a>
archive use the <code>MakeMaker</code> module to provide configuration,
build, and test services. The standard build routine for these modules
looks like:

<pre class="example">     % perl Makefile.PL
     % make
     % make test
     # make install
</pre>
   <p>(except again Buildbot skips the install step)

   <p>Buildbot provides a <code>CPAN</code> factory to compile and test these
projects.

   <p>Arguments:
     <dl>
<dt><code>source</code><dd>(required): A step specification tuple, like that used by GNUAutoconf.

     <br><dt><code>perl</code><dd>A string which specifies the <code>perl</code> executable to use. Defaults
to just <code>perl</code>.

   </dl>

<div class="node">
<a name="Distutils"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Trial-_0028Factory_0029">Trial (Factory)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CPAN">CPAN</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Factories">Build Factories</a>

</div>

<h4 class="subsection">4.11.7 Distutils</h4>

<p><a name="index-buildbot_002eprocess_002efactory_002eDistutils-76"></a>
Most Python modules use the <code>distutils</code> package to provide
configuration and build services. The standard build process looks
like:

<pre class="example">     % python ./setup.py build
     % python ./setup.py install
</pre>
   <p>Unfortunately, although Python provides a standard unit-test framework
named <code>unittest</code>, to the best of my knowledge <code>distutils</code>
does not provide a standardized target to run such unit tests. (Please
let me know if I'm wrong, and I will update this factory.)

   <p>The <code>Distutils</code> factory provides support for running the build
part of this process. It accepts the same <code>source=</code> parameter as
the other build factories.

   <p>Arguments:
     <dl>
<dt><code>source</code><dd>(required): A step specification tuple, like that used by GNUAutoconf.

     <br><dt><code>python</code><dd>A string which specifies the <code>python</code> executable to use. Defaults
to just <code>python</code>.

     <br><dt><code>test</code><dd>Provides a shell command which runs unit tests. This accepts either a
string or a list. The default value is None, which disables the test
step (since there is no common default command to run unit tests in
distutils modules).

   </dl>

<div class="node">
<a name="Trial-(Factory)"></a>
<a name="Trial-_0028Factory_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Build-Factory-Index">Build Factory Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Distutils">Distutils</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Factories">Build Factories</a>

</div>

<h4 class="subsection">4.11.8 Trial</h4>

<p><a name="index-buildbot_002eprocess_002efactory_002eTrial-77"></a>
Twisted provides a unit test tool named <code>trial</code> which provides a
few improvements over Python's built-in <code>unittest</code> module. Many
python projects which use Twisted for their networking or application
services also use trial for their unit tests. These modules are
usually built and tested with something like the following:

<pre class="example">     % python ./setup.py build
     % PYTHONPATH=build/lib.linux-i686-2.3 trial -v PROJECTNAME.test
     % python ./setup.py install
</pre>
   <p>Unfortunately, the <samp><span class="file">build/lib</span></samp> directory into which the
built/copied .py files are placed is actually architecture-dependent,
and I do not yet know of a simple way to calculate its value. For many
projects it is sufficient to import their libraries &ldquo;in place&rdquo; from
the tree's base directory (<code>PYTHONPATH=.</code>).

   <p>In addition, the <var>PROJECTNAME</var> value where the test files are
located is project-dependent: it is usually just the project's
top-level library directory, as common practice suggests the unit test
files are put in the <code>test</code> sub-module. This value cannot be
guessed, the <code>Trial</code> class must be told where to find the test
files.

   <p>The <code>Trial</code> class provides support for building and testing
projects which use distutils and trial. If the test module name is
specified, trial will be invoked. The library path used for testing
can also be set.

   <p>One advantage of trial is that the Buildbot happens to know how to
parse trial output, letting it identify which tests passed and which
ones failed. The Buildbot can then provide fine-grained reports about
how many tests have failed, when individual tests fail when they had
been passing previously, etc.

   <p>Another feature of trial is that you can give it a series of source
.py files, and it will search them for special <code>test-case-name</code>
tags that indicate which test cases provide coverage for that file. 
Trial can then run just the appropriate tests. This is useful for
quick builds, where you want to only run the test cases that cover the
changed functionality.

   <p>Arguments:
     <dl>
<dt><code>testpath</code><dd>Provides a directory to add to <code>PYTHONPATH</code> when running the unit
tests, if tests are being run. Defaults to <code>.</code> to include the
project files in-place. The generated build library is frequently
architecture-dependent, but may simply be <samp><span class="file">build/lib</span></samp> for
pure-python modules.

     <br><dt><code>python</code><dd>which python executable to use. This list will form the start of
the argv array that will launch trial. If you use this,
you should set <code>trial</code> to an explicit path (like
<code>/usr/bin/trial</code> or <code>./bin/trial</code>). The parameter defaults to <code>None</code>, which
leaves it out entirely (running <code>trial args</code> instead of
<code>python ./bin/trial args</code>). Likely values are <code>['python']</code>,
<code>['python2.2']</code>, or <code>['python', '-Wall']</code>.

     <br><dt><code>trial</code><dd>provides the name of the <code>trial</code> command. It is occasionally
useful to use an alternate executable, such as <code>trial2.2</code> which
might run the tests under an older version of Python. Defaults to
<code>trial</code>.

     <br><dt><code>trialMode</code><dd>a list of arguments to pass to trial, specifically to set the reporting mode. 
This defaults to <code>['--reporter=bwverbose']</code>, which only works for
Twisted-2.1.0 and later.

     <br><dt><code>trialArgs</code><dd>a list of arguments to pass to trial, available to turn on any extra flags you
like. Defaults to <code>[]</code>.

     <br><dt><code>tests</code><dd>Provides a module name or names which contain the unit tests for this
project. Accepts a string, typically <code>PROJECTNAME.test</code>, or a
list of strings. Defaults to None, indicating that no tests should be
run. You must either set this or <code>testChanges</code>.

     <br><dt><code>testChanges</code><dd>if True, ignore the <code>tests</code> parameter and instead ask the Build for all
the files that make up the Changes going into this build. Pass these filenames
to trial and ask it to look for test-case-name tags, running just the tests
necessary to cover the changes.

     <br><dt><code>recurse</code><dd>If <code>True</code>, tells Trial (with the <code>--recurse</code> argument) to look in all
subdirectories for additional test cases.

     <br><dt><code>reactor</code><dd>which reactor to use, like 'gtk' or 'java'. If not provided, the Twisted's
usual platform-dependent default is used.

     <br><dt><code>randomly</code><dd>If <code>True</code>, tells Trial (with the <code>--random=0</code> argument) to
run the test cases in random order, which sometimes catches subtle
inter-test dependency bugs. Defaults to <code>False</code>. 
</dl>

   <p>The step can also take any of the <code>ShellCommand</code> arguments, e.g.,
<code>haltOnFailure</code>.

   <p>Unless one of <code>tests</code> or <code>testChanges</code> are set, the step will
generate an exception.

<div class="node">
<a name="Build-Factory-Index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Trial-_0028Factory_0029">Trial (Factory)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Factories">Build Factories</a>

</div>

<h4 class="subsection">4.11.9 Build Factory Index</h4>



<ul class="index-bf" compact>
<li><a href="#index-buildbot_002eprocess_002efactory_002eBasicBuildFactory-72"><code>buildbot.process.factory.BasicBuildFactory</code></a>: <a href="#BasicBuildFactory">BasicBuildFactory</a></li>
<li><a href="#index-buildbot_002eprocess_002efactory_002eBasicSVN-73"><code>buildbot.process.factory.BasicSVN</code></a>: <a href="#BasicSVN">BasicSVN</a></li>
<li><a href="#index-buildbot_002eprocess_002efactory_002eBuildFactory-70"><code>buildbot.process.factory.BuildFactory</code></a>: <a href="#BuildFactory">BuildFactory</a></li>
<li><a href="#index-buildbot_002eprocess_002efactory_002eCPAN-75"><code>buildbot.process.factory.CPAN</code></a>: <a href="#CPAN">CPAN</a></li>
<li><a href="#index-buildbot_002eprocess_002efactory_002eDistutils-76"><code>buildbot.process.factory.Distutils</code></a>: <a href="#Distutils">Distutils</a></li>
<li><a href="#index-buildbot_002eprocess_002efactory_002eGNUAutoconf-71"><code>buildbot.process.factory.GNUAutoconf</code></a>: <a href="#GNUAutoconf">GNUAutoconf</a></li>
<li><a href="#index-buildbot_002eprocess_002efactory_002eQuickBuildFactory-74"><code>buildbot.process.factory.QuickBuildFactory</code></a>: <a href="#QuickBuildFactory">QuickBuildFactory</a></li>
<li><a href="#index-buildbot_002eprocess_002efactory_002eTrial-77"><code>buildbot.process.factory.Trial</code></a>: <a href="#Trial-_0028Factory_0029">Trial (Factory)</a></li>
   </ul><div class="node">
<a name="Build-Steps"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Interlocks">Interlocks</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Build-Factories">Build Factories</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.12 Build Steps</h3>

<p><code>BuildStep</code>s are usually specified in the buildmaster's
configuration file, in a list that goes into the <code>BuildFactory</code>. 
The <code>BuildStep</code> instances in this list are used as templates to
construct new independent copies for each build (so that state can be
kept on the <code>BuildStep</code> in one build without affecting a later
build). Each <code>BuildFactory</code> can be created with a list of steps,
or the factory can be created empty and then steps added to it using
the <code>addStep</code> method:

<pre class="example">     from buildbot.steps import source, shell
     from buildbot.process import factory
     
     f = factory.BuildFactory()
     f.addStep(source.SVN(svnurl="http://svn.example.org/Trunk/"))
     f.addStep(shell.ShellCommand(command=["make", "all"]))
     f.addStep(shell.ShellCommand(command=["make", "test"]))
</pre>
   <p>The rest of this section lists all the standard BuildStep objects
available for use in a Build, and the parameters which can be used to
control each.

<ul class="menu">
<li><a accesskey="1" href="#Common-Parameters">Common Parameters</a>
<li><a accesskey="2" href="#Using-Build-Properties">Using Build Properties</a>
<li><a accesskey="3" href="#Source-Checkout">Source Checkout</a>
<li><a accesskey="4" href="#ShellCommand">ShellCommand</a>
<li><a accesskey="5" href="#Slave-Filesystem-Steps">Slave Filesystem Steps</a>
<li><a accesskey="6" href="#Python-BuildSteps">Python BuildSteps</a>
<li><a accesskey="7" href="#Transferring-Files">Transferring Files</a>
<li><a accesskey="8" href="#Transferring-Strings">Transferring Strings</a>
<li><a accesskey="9" href="#Running-Commands-on-the-Master">Running Commands on the Master</a>
<li><a href="#Setting-Properties">Setting Properties</a>
<li><a href="#Triggering-Schedulers">Triggering Schedulers</a>
<li><a href="#Miscellaneous-BuildSteps">Miscellaneous BuildSteps</a>
<li><a href="#Writing-New-BuildSteps">Writing New BuildSteps</a>
<li><a href="#Build-Step-Index">Build Step Index</a>
</ul>

<div class="node">
<a name="Common-Parameters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Using-Build-Properties">Using Build Properties</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.1 Common Parameters</h4>

<p>All BuildSteps accept some common parameters. Some of these control
how their individual status affects the overall build. Others are used
to specify which <code>Locks</code> (see see <a href="#Interlocks">Interlocks</a>) should be
acquired before allowing the step to run.

   <p>Arguments common to all <code>BuildStep</code> subclasses:

     <dl>
<dt><code>name</code><dd>the name used to describe the step on the status display. It is also
used to give a name to any LogFiles created by this step.

     <br><dt><code>haltOnFailure</code><dd>if True, a FAILURE of this build step will cause the build to halt
immediately. Steps with <code>alwaysRun=True</code> are still run. Generally
speaking, haltOnFailure implies flunkOnFailure (the default for most
BuildSteps). In some cases, particularly series of tests, it makes sense
to haltOnFailure if something fails early on but not flunkOnFailure. 
This can be achieved with haltOnFailure=True, flunkOnFailure=False.

     <br><dt><code>flunkOnWarnings</code><dd>when True, a WARNINGS or FAILURE of this build step will mark the
overall build as FAILURE. The remaining steps will still be executed.

     <br><dt><code>flunkOnFailure</code><dd>when True, a FAILURE of this build step will mark the overall build as
a FAILURE. The remaining steps will still be executed.

     <br><dt><code>warnOnWarnings</code><dd>when True, a WARNINGS of this build step will mark the
overall build as having WARNINGS. The remaining steps will still be
executed.

     <br><dt><code>warnOnFailure</code><dd>when True, a FAILURE of this build step will mark the overall build as
having WARNINGS. The remaining steps will still be executed.

     <br><dt><code>alwaysRun</code><dd>if True, this build step will always be run, even if a previous buildstep
with <code>haltOnFailure=True</code> has failed.

     <br><dt><code>doStepIf</code><dd>A step can be configured to only run under certain conditions.  To do this, set
the step's <code>doStepIf</code> to a boolean value, or to a function that returns a
boolean value or Deferred.  If the value or function result is false, then the
step will return SKIPPED without doing anything.  Oherwise, the step will be
executed normally.  If you set <code>doStepIf</code> to a function, that function
should accept one parameter, which will be the <code>Step</code> object itself.

     <br><dt><code>locks</code><dd>a list of Locks (instances of <code>buildbot.locks.SlaveLock</code> or
<code>buildbot.locks.MasterLock</code>) that should be acquired before starting this
Step. The Locks will be released when the step is complete. Note that this is a
list of actual Lock instances, not names. Also note that all Locks must have
unique names.  See <a href="#Interlocks">Interlocks</a>.

   </dl>

<div class="node">
<a name="Using-Build-Properties"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Source-Checkout">Source Checkout</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Common-Parameters">Common Parameters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.2 Using Build Properties</h4>

<p><a name="index-Properties-78"></a>
Build properties are a generalized way to provide configuration
information to build steps; see <a href="#Build-Properties">Build Properties</a>.

   <p>Some build properties are inherited from external sources &ndash; global
properties, schedulers, or buildslaves.  Some build properties are
set when the build starts, such as the SourceStamp information. Other
properties can be set by BuildSteps as they run, for example the
various Source steps will set the <code>got_revision</code> property to the
source revision that was actually checked out (which can be useful
when the SourceStamp in use merely requested the &ldquo;latest revision&rdquo;:
<code>got_revision</code> will tell you what was actually built).

   <p>In custom BuildSteps, you can get and set the build properties with
the <code>getProperty</code>/<code>setProperty</code> methods. Each takes a string
for the name of the property, and returns or accepts an
arbitrary<a rel="footnote" href="#fn-5" name="fnd-5"><sup>5</sup></a> object. For example:

<pre class="example">     class MakeTarball(ShellCommand):
         def start(self):
             if self.getProperty("os") == "win":
                 self.setCommand([ ... ]) # windows-only command
             else:
                 self.setCommand([ ... ]) # equivalent for other systems
             ShellCommand.start(self)
</pre>
   <ul class="menu">
<li><a accesskey="1" href="#Property">Property</a>
<li><a accesskey="2" href="#WithProperties">WithProperties</a>
<li><a accesskey="3" href="#Common-Build-Properties">Common Build Properties</a>
</ul>

<div class="node">
<a name="Property"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#WithProperties">WithProperties</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-Build-Properties">Using Build Properties</a>

</div>

<h5 class="subsubsection">4.12.2.1 Property</h5>

<p><a name="index-Property-79"></a>
You can use build properties in most step paramaters.  Please file bugs for any
parameters which do not accept properties.  The simplest form is to wrap the
property name with <code>Property</code>, passing an optional default argument.

<pre class="example">     from buildbot.steps.trigger import Trigger
     form buildbot.process.properties import Property
     
     f.addStep(Trigger(waitForFinish=False, schedulerNames=['build-dependents'], alwaysUseLatest=True,
     			set_properties={'coq_revision': Property("got_revision")}))
</pre>
   <p>You can specify a default value by passing a <code>default</code> argument to
<code>Property</code>. This is normally used when the property doesn't exist,
or when the value is something Python regards as "false". The <code>defaultWhenFalse</code>
argument can be used to force buildbot to use the default argument only
if the parameter is not set.

<div class="node">
<a name="WithProperties"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Common-Build-Properties">Common Build Properties</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Property">Property</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-Build-Properties">Using Build Properties</a>

</div>

<h5 class="subsubsection">4.12.2.2 WithProperties</h5>

<p><a name="index-WithProperties-80"></a>
You can use build properties in ShellCommands by using the
<code>WithProperties</code> wrapper when setting the arguments of
the ShellCommand. This interpolates the named build properties
into the generated shell command.  Most step parameters accept
<code>WithProperties</code>.

   <p>You can use python dictionary-style string interpolation by using
the <code>%(propname)s</code> syntax. In this form, the property name goes
in the parentheses:

<pre class="example">     f.addStep(ShellCommand(
               command=["tar", "czf",
                        WithProperties("build-%(revision)s.tar.gz"),
                        "source"]))
</pre>
   <p>If this BuildStep were used in a tree obtained from Subversion, it
would create a tarball with a name like <samp><span class="file">build-1234.tar.gz</span></samp>.

   <p>Don't forget the extra &ldquo;s&rdquo; after the closing parenthesis! This is
the cause of many confusing errors.

   <p>The dictionary-style interpolation supports a number of more advanced
syntaxes, too.

     <dl>
<dt><code>propname:-replacement</code><dd>If <code>propname</code> exists, substitute its value; otherwise,
substitute <code>replacement</code>.  <code>replacement</code> may be empty
(<code>%(propname:-)s</code>)

     <br><dt><code>propname:~replacement</code><dd>Like <code>propname:-replacement</code>, but only substitutes the value
of property <code>propname</code> if it is something Python regards as "true". 
Python considers <code>None</code>, 0, empty lists, and the empty string to be
false, so such values will be replaced by <code>replacement</code>.

     <br><dt><code>propname:+replacement</code><dd>If <code>propname</code> exists, substitute <code>replacement</code>; otherwise,
substitute an empty string.

   </dl>

   <p>Although these are similar to shell substitutions, no other
substitutions are currently supported, and <code>replacement</code> in the
above cannot contain more substitutions.

   <p>If you need to do more complex substitution, you can pass keyword
arguments to <code>WithProperties</code>. The value of each keyword argument
should be a function that takes one argument (the existing properties)
and returns a string value that will be used to replace that key:

<pre class="example">     WithProperties('%(now)s', now=lambda _: time.clock())
</pre>
   <pre class="example">     def determine_foo(props):
         if props.has_key('bar'):
             return props['bar']
         elif props.has_key('baz'):
             return props['baz']
         return 'qux'
     
     WithProperties('%(foo)s', foo=determine_foo)
</pre>
   <p>The <code>WithProperties</code> function also does <code>printf</code>-style string
interpolation, using strings obtained by calling
<code>build.getProperty(propname)</code>. Note that for every <code>%s</code> (or
<code>%d</code>, etc), you must have exactly one additional argument to
indicate which build property you want to insert.

<pre class="example">     from buildbot.steps.shell import ShellCommand
     from buildbot.process.properties import WithProperties
     
     f.addStep(ShellCommand(
               command=["tar", "czf",
                        WithProperties("build-%s.tar.gz", "revision"),
                        "source"]))
</pre>
   <p>Note: like python, you can either do positional-argument interpolation
<em>or</em> keyword-argument interpolation, not both. Thus you cannot use
a string like <code>WithProperties("foo-%(revision)s-%s", "branch")</code>.

<div class="node">
<a name="Common-Build-Properties"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#WithProperties">WithProperties</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-Build-Properties">Using Build Properties</a>

</div>

<h5 class="subsubsection">4.12.2.3 Common Build Properties</h5>

<p>The following build properties are set when the build is started, and
are available to all steps.

     <dl>
<dt><code>branch</code><dd>
This comes from the build's SourceStamp, and describes which branch is
being checked out. This will be <code>None</code> (which interpolates into
<code>WithProperties</code> as an empty string) if the build is on the
default branch, which is generally the trunk. Otherwise it will be a
string like &ldquo;branches/beta1.4&rdquo;. The exact syntax depends upon the VC
system being used.

     <br><dt><code>revision</code><dd>
This also comes from the SourceStamp, and is the revision of the source code
tree that was requested from the VC system. When a build is requested of a
specific revision (as is generally the case when the build is triggered by
Changes), this will contain the revision specification. This is always a
string, although the syntax depends upon the VC system in use: for SVN it is an
integer, for Mercurial it is a short string, for Darcs it is a rather large
string, etc.

     <p>If the &ldquo;force build&rdquo; button was pressed, the revision will be <code>None</code>,
which means to use the most recent revision available.  This is a &ldquo;trunk
build&rdquo;. This will be interpolated as an empty string.

     <br><dt><code>got_revision</code><dd>
This is set when a Source step checks out the source tree, and
provides the revision that was actually obtained from the VC system. 
In general this should be the same as <code>revision</code>, except for
trunk builds, where <code>got_revision</code> indicates what revision was
current when the checkout was performed. This can be used to rebuild
the same source code later.

     <p>Note that for some VC systems (Darcs in particular), the revision is a
large string containing newlines, and is not suitable for interpolation
into a filename.

     <br><dt><code>buildername</code><dd>
This is a string that indicates which Builder the build was a part of. 
The combination of buildername and buildnumber uniquely identify a
build.

     <br><dt><code>buildnumber</code><dd>
Each build gets a number, scoped to the Builder (so the first build
performed on any given Builder will have a build number of 0). This
integer property contains the build's number.

     <br><dt><code>slavename</code><dd>
This is a string which identifies which buildslave the build is
running on.

     <br><dt><code>scheduler</code><dd>
If the build was started from a scheduler, then this property will
contain the name of that scheduler.

     <br><dt><code>repository</code><dd>
The repository of the sourcestamp for this build

     <br><dt><code>project</code><dd>
The project of the sourcestamp for this build

     <br><dt><code>workdir</code><dd>
The absolute path of the base working directory on the slave, of the current
builder.

   </dl>

<div class="node">
<a name="Source-Checkout"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ShellCommand">ShellCommand</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Using-Build-Properties">Using Build Properties</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.3 Source Checkout</h4>

<p>The first step of any build is typically to acquire the source code
from which the build will be performed. There are several classes to
handle this, one for each of the different source control system that
Buildbot knows about. For a description of how Buildbot treats source
control in general, see <a href="#Version-Control-Systems">Version Control Systems</a>.

   <p>All source checkout steps accept some common parameters to control how
they get the sources and where they should be placed. The remaining
per-VC-system parameters are mostly to specify where exactly the
sources are coming from.

     <dl>
<dt><code>mode</code><dd>
a string describing the kind of VC operation that is desired. Defaults
to <code>update</code>.

          <dl>
<dt><code>update</code><dd>specifies that the CVS checkout/update should be performed directly
into the workdir. Each build is performed in the same directory,
allowing for incremental builds. This minimizes disk space, bandwidth,
and CPU time. However, it may encounter problems if the build process
does not handle dependencies properly (sometimes you must do a &ldquo;clean
build&rdquo; to make sure everything gets compiled), or if source files are
deleted but generated files can influence test behavior (e.g. python's
.pyc files), or when source directories are deleted but generated
files prevent CVS from removing them. Builds ought to be correct
regardless of whether they are done &ldquo;from scratch&rdquo; or incrementally,
but it is useful to test both kinds: this mode exercises the
incremental-build style.

          <br><dt><code>copy</code><dd>specifies that the CVS workspace should be maintained in a separate
directory (called the 'copydir'), using checkout or update as
necessary. For each build, a new workdir is created with a copy of the
source tree (rm -rf workdir; cp -r copydir workdir). This doubles the
disk space required, but keeps the bandwidth low (update instead of a
full checkout). A full 'clean' build is performed each time. This
avoids any generated-file build problems, but is still occasionally
vulnerable to CVS problems such as a repository being manually
rearranged, causing CVS errors on update which are not an issue with a
full checkout.

          <!-- TODO: something is screwy about this, revisit. Is it the source -->
          <!-- directory or the working directory that is deleted each time? -->
          <br><dt><code>clobber</code><dd>specifies that the working directory should be deleted each time,
necessitating a full checkout for each build. This insures a clean
build off a complete checkout, avoiding any of the problems described
above. This mode exercises the &ldquo;from-scratch&rdquo; build style.

          <br><dt><code>export</code><dd>this is like <code>clobber</code>, except that the 'cvs export' command is
used to create the working directory. This command removes all CVS
metadata files (the CVS/ directories) from the tree, which is
sometimes useful for creating source tarballs (to avoid including the
metadata in the tar file). 
</dl>

     <br><dt><code>workdir</code><dd>like all Steps, this indicates the directory where the build will take
place. Source Steps are special in that they perform some operations
outside of the workdir (like creating the workdir itself).

     <br><dt><code>alwaysUseLatest</code><dd>if True, bypass the usual &ldquo;update to the last Change&rdquo; behavior, and
always update to the latest changes instead.

     <br><dt><code>retry</code><dd>If set, this specifies a tuple of <code>(delay, repeats)</code> which means
that when a full VC checkout fails, it should be retried up to
<var>repeats</var> times, waiting <var>delay</var> seconds between attempts. If
you don't provide this, it defaults to <code>None</code>, which means VC
operations should not be retried. This is provided to make life easier
for buildslaves which are stuck behind poor network connections.

     <br><dt><code>repository</code><dd>The name of this parameter might vary depending on the Source step you
are running. The concept explained here is common to all steps and
applies to <code>repourl</code> as well as for <code>baseURL</code> (when
applicable). Buildbot, now being aware of the repository name via the
ChangeSource step might in some cases not need the repository URL. There
are multiple way to pass it through to this step, corresponding to
the type of the parameter given to this step:

          <dl>
<dt><code>None</code><dd>In the case where no parameter is specified, the repository URL will
be taken directly from the Change property. This value should be used
if your ChangeSource step has all the information about how to reach
the Change.

          <br><dt><code>string</code><dd>The parameter might be a string. In this case, this string will be
used as the full repository URL. The value coming from the
ChangeSource step will be ignored.

          <br><dt><code>format string</code><dd>If the parameter is a string containing <code>%s</code>, then the repository
property from the Change will be substituted in place of the
<code>%s</code>. This is usefull when the ChangeSource step knows where the
repository resides locally, but doesn't know the scheme used to access
it. For instance, <code>ssh://server/%s</code> makes sense if the repository
property is the local path of the repository.

          <br><dt><code>dict</code><dd>In this case, the repository URL will be the value indexed by the
repository property in the dict given as parameter.

          <br><dt><code>callable</code><dd>The callable given as parameter will take the repository property from
the Change and its return value will be used as repository URL.

     </dl>

     <br><dt><code>timeout</code><dd>Specifies the timeout for slave-side operations, in seconds.  If your
repositories are particularly large, then you may need to increase this
value from its default of 1200 (20 minutes).

   </dl>

   <p>Use of WithProperties with string, dict and callable is supported.

   <p>Note that this is quite similar to the mechanism used by the WebStatus
for the <code>changecommentlink</code>, <code>projects</code> or <code>repositories</code> parameter.

   <p>My habit as a developer is to do a <code>cvs update</code> and <code>make</code> each
morning. Problems can occur, either because of bad code being checked in, or
by incomplete dependencies causing a partial rebuild to fail where a
complete from-scratch build might succeed. A quick Builder which emulates
this incremental-build behavior would use the <code>mode='update'</code>
setting.

   <p>On the other hand, other kinds of dependency problems can cause a clean
build to fail where a partial build might succeed. This frequently results
from a link step that depends upon an object file that was removed from a
later version of the tree: in the partial tree, the object file is still
around (even though the Makefiles no longer know how to create it).

   <p>&ldquo;official&rdquo; builds (traceable builds performed from a known set of
source revisions) are always done as clean builds, to make sure it is
not influenced by any uncontrolled factors (like leftover files from a
previous build). A &ldquo;full&rdquo; Builder which behaves this way would want
to use the <code>mode='clobber'</code> setting.

   <p>Each VC system has a corresponding source checkout class: their
arguments are described on the following pages.

<ul class="menu">
<li><a accesskey="1" href="#CVS">CVS</a>
<li><a accesskey="2" href="#SVN">SVN</a>
<li><a accesskey="3" href="#Darcs">Darcs</a>
<li><a accesskey="4" href="#Mercurial">Mercurial</a>
<li><a accesskey="5" href="#Bzr">Bzr</a>
<li><a accesskey="6" href="#P4">P4</a>
<li><a accesskey="7" href="#Git">Git</a>
<li><a accesskey="8" href="#BitKeeper">BitKeeper</a>
<li><a accesskey="9" href="#Repo">Repo</a>
<li><a href="#Monotone">Monotone</a>
</ul>

<div class="node">
<a name="CVS"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#SVN">SVN</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.1 CVS</h5>

<p><a name="index-CVS-Checkout-81"></a><a name="index-buildbot_002esteps_002esource_002eCVS-82"></a>

   <p>The <code>CVS</code> build step performs a <a href="http://www.nongnu.org/cvs/">CVS</a> checkout or update. It takes the following arguments:

     <dl>
<dt><code>cvsroot</code><dd>(required): specify the CVSROOT value, which points to a CVS
repository, probably on a remote machine. For example, the cvsroot
value you would use to get a copy of the Buildbot source code is
<code>:pserver:anonymous@cvs.sourceforge.net:/cvsroot/buildbot</code>

     <br><dt><code>cvsmodule</code><dd>(required): specify the cvs <code>module</code>, which is generally a
subdirectory of the CVSROOT. The cvsmodule for the Buildbot source
code is <code>buildbot</code>.

     <br><dt><code>branch</code><dd>a string which will be used in a <code>-r</code> argument. This is most
useful for specifying a branch to work on. Defaults to <code>HEAD</code>.

     <br><dt><code>global_options</code><dd>a list of flags to be put before the verb in the CVS command.

     <br><dt><code>checkout_options</code><br><dt><code>export_options</code><br><dt><code>extra_options</code><dd>a list of flags to be put after the verb in the CVS command. 
<code>checkout_options</code> is only used for checkout operations,
<code>export_options</code> is only used for export operations, and
<code>extra_options</code> is used for both.

     <br><dt><code>checkoutDelay</code><dd>if set, the number of seconds to put between the timestamp of the last
known Change and the value used for the <code>-D</code> option. Defaults to
half of the parent Build's treeStableTimer.

   </dl>

<div class="node">
<a name="SVN"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Darcs">Darcs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CVS">CVS</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.2 SVN</h5>

<p><a name="index-SVN-Checkout-83"></a><a name="index-buildbot_002esteps_002esource_002eSVN-84"></a>

   <p>The <code>SVN</code> build step performs a
<a href="http://subversion.tigris.org">Subversion</a> checkout or update. 
There are two basic ways of setting up the checkout step, depending
upon whether you are using multiple branches or not.

   <p>The most versatile way to create the <code>SVN</code> step is with the
<code>svnurl</code> argument:

     <dl>
<dt><code>svnurl</code><dd>(required): this specifies the <code>URL</code> argument that will be given
to the <code>svn checkout</code> command. It dictates both where the
repository is located and which sub-tree should be extracted. In this
respect, it is like a combination of the CVS <code>cvsroot</code> and
<code>cvsmodule</code> arguments. For example, if you are using a remote
Subversion repository which is accessible through HTTP at a URL of
<code>http://svn.example.com/repos</code>, and you wanted to check out the
<code>trunk/calc</code> sub-tree, you would use
<code>svnurl="http://svn.example.com/repos/trunk/calc"</code> as an argument
to your <code>SVN</code> step. 
</dl>

   <p>The <code>svnurl</code> argument can be considered as a universal means to
create the <code>SVN</code> step as it ignores the branch information in the
SourceStamp.

   <p>Alternatively, if you are building from multiple branches, then you
should preferentially create the <code>SVN</code> step with the
<code>baseURL</code> and <code>defaultBranch</code> arguments instead:

     <dl>
<dt><code>baseURL</code><dd>(required): this specifies the base repository URL, to which a branch name will
be appended. Alternatively, <code>baseURL</code> can contain a <code>%%BRANCH%%</code>
placeholder, which will be replaced with the branch name. <code>baseURL</code> should
probably end in a slash.

     <br><dt><code>defaultBranch</code><dd>(optional): this specifies the name of the branch to use when a Build does not
provide one of its own. This is a string that will be appended to
<code>baseURL</code> to create the URL that will be passed to the <code>svn checkout</code>
command. If you use <code>baseURL</code> without specifying <code>defaultBranch</code>
every <code>ChangeStamp</code> must come with a valid (not None) <code>branch</code>.

     <p>It is possible to mix to have a mix of <code>SVN</code> steps that use
either the <code>svnurl</code> or <code>baseURL</code> arguments but not both at
the same time.

     <br><dt><code>username</code><dd>(optional): if specified, this will be passed to the <code>svn</code>
binary with a <code>--username</code> option.

     <br><dt><code>password</code><dd>(optional): if specified, this will be passed to the <code>svn</code>
binary with a <code>--password</code> option.  The password itself will be
suitably obfuscated in the logs.

     <br><dt><code>extra_args</code><dd>(optional): if specified, an array of strings that will be passed as
extra arguments to the <code>svn</code> binary.

     <br><dt><code>keep_on_purge</code><dd>(optional): specific files or directories to keep between purges,
like some build outputs that can be reused between builds.

     <br><dt><code>ignore_ignores</code><dd>(optional): when purging changes, don't use rules defined in
svn:ignore properties and global-ignores in subversion/config.

     <br><dt><code>always_purge</code><dd>(optional): if set to True, always purge local changes before updating. This deletes unversioned files and reverts everything that would appear in a <code>svn status</code>.

     <br><dt><code>depth</code><dd>(optional): Specify depth argument to achieve sparse checkout.  Only available if slave has Subversion 1.5 or higher.

     <p>If set to "empty" updates will not pull in any files or subdirectories not already present. If set to "files", updates will pull in any files not already present, but not directories.  If set to "immediates", updates willl pull in any files or subdirectories not already present, the new subdirectories will have depth: empty.  If set to "infinity", updates will pull in any files or subdirectories not already present; the new subdirectories will have depth-infinity. Infinity is equivalent to SVN default update behavior, without specifying any depth argument.

   </dl>

   <p>If you are using branches, you must also make sure your
<code>ChangeSource</code> will report the correct branch names.

<h3 class="heading">branch example</h3>

<p>Let's suppose that the &ldquo;MyProject&rdquo; repository uses branches for the
trunk, for various users' individual development efforts, and for
several new features that will require some amount of work (involving
multiple developers) before they are ready to merge onto the trunk. 
Such a repository might be organized as follows:

<pre class="example">     svn://svn.example.org/MyProject/trunk
     svn://svn.example.org/MyProject/branches/User1/foo
     svn://svn.example.org/MyProject/branches/User1/bar
     svn://svn.example.org/MyProject/branches/User2/baz
     svn://svn.example.org/MyProject/features/newthing
     svn://svn.example.org/MyProject/features/otherthing
</pre>
   <p>Further assume that we want the Buildbot to run tests against the
trunk and against all the feature branches (i.e., do a
checkout/compile/build of branch X when a file has been changed on
branch X, when X is in the set [trunk, features/newthing,
features/otherthing]). We do not want the Buildbot to automatically
build any of the user branches, but it should be willing to build a
user branch when explicitly requested (most likely by the user who
owns that branch).

   <p>There are three things that need to be set up to accommodate this
system. The first is a ChangeSource that is capable of identifying the
branch which owns any given file. This depends upon a user-supplied
function, in an external program that runs in the SVN commit hook and
connects to the buildmaster's <code>PBChangeSource</code> over a TCP
connection. (you can use the &ldquo;<code>buildbot sendchange</code>&rdquo; utility
for this purpose, but you will still need an external program to
decide what value should be passed to the <code>--branch=</code> argument). 
For example, a change to a file with the SVN URL of
&ldquo;svn://svn.example.org/MyProject/features/newthing/src/foo.c&rdquo; should
be broken down into a Change instance with
<code>branch='features/newthing'</code> and <code>file='src/foo.c'</code>.

   <p>The second piece is an <code>AnyBranchScheduler</code> which will pay
attention to the desired branches. It will not pay attention to the
user branches, so it will not automatically start builds in response
to changes there. The AnyBranchScheduler class requires you to
explicitly list all the branches you want it to use, but it would not
be difficult to write a subclass which used
<code>branch.startswith('features/'</code> to remove the need for this
explicit list. Or, if you want to build user branches too, you can use
AnyBranchScheduler with <code>branches=None</code> to indicate that you want
it to pay attention to all branches.

   <p>The third piece is an <code>SVN</code> checkout step that is configured to
handle the branches correctly, with a <code>baseURL</code> value that
matches the way the ChangeSource splits each file's URL into base,
branch, and file.

<pre class="example">     from buildbot.changes.pb import PBChangeSource
     from buildbot.scheduler import AnyBranchScheduler
     from buildbot.process import source, factory
     from buildbot.steps import source, shell
     
     c['change_source'] = PBChangeSource()
     s1 = AnyBranchScheduler('main',
                             ['trunk', 'features/newthing', 'features/otherthing'],
                             10*60, ['test-i386', 'test-ppc'])
     c['schedulers'] = [s1]
     
     f = factory.BuildFactory()
     f.addStep(source.SVN(mode='update',
                          baseURL='svn://svn.example.org/MyProject/',
                          defaultBranch='trunk'))
     f.addStep(shell.Compile(command="make all"))
     f.addStep(shell.Test(command="make test"))
     
     c['builders'] = [
       {'name':'test-i386', 'slavename':'bot-i386', 'builddir':'test-i386',
                            'factory':f },
       {'name':'test-ppc', 'slavename':'bot-ppc', 'builddir':'test-ppc',
                           'factory':f },
      ]
</pre>
   <p>In this example, when a change arrives with a <code>branch</code> attribute of
&ldquo;trunk&rdquo;, the resulting build will have a SVN step that concatenates
&ldquo;svn://svn.example.org/MyProject/&rdquo; (the baseURL) with &ldquo;trunk&rdquo; (the branch
name) to get the correct svn command. If the &ldquo;newthing&rdquo; branch has a change
to &ldquo;src/foo.c&rdquo;, then the SVN step will concatenate
&ldquo;svn://svn.example.org/MyProject/&rdquo; with &ldquo;features/newthing&rdquo; to get the
svnurl for checkout.

   <p>For added flexibility, <code>baseURL</code> may contain a <code>%%BRANCH%%</code>
placeholder, which will be replaced either by the branch in the SourceStamp or
the default specified in <code>defaultBranch</code>.

<pre class="example">     source.SVN( mode='update',
                 baseURL='svn://svn.example.org/svn/%%BRANCH%%/myproject',
                 defaultBranch='trunk' )
</pre>
   <div class="node">
<a name="Darcs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mercurial">Mercurial</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#SVN">SVN</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.3 Darcs</h5>

<p><a name="index-Darcs-Checkout-85"></a><a name="index-buildbot_002esteps_002esource_002eDarcs-86"></a>

   <p>The <code>Darcs</code> build step performs a
<a href="http://darcs.net/">Darcs</a> checkout or update.

   <p>Like See <a href="#SVN">SVN</a>, this step can either be configured to always check
out a specific tree, or set up to pull from a particular branch that
gets specified separately for each build. Also like SVN, the
repository URL given to Darcs is created by concatenating a
<code>baseURL</code> with the branch name, and if no particular branch is
requested, it uses a <code>defaultBranch</code>. The only difference in
usage is that each potential Darcs repository URL must point to a
fully-fledged repository, whereas SVN URLs usually point to sub-trees
of the main Subversion repository. In other words, doing an SVN
checkout of <code>baseURL</code> is legal, but silly, since you'd probably
wind up with a copy of every single branch in the whole repository. 
Doing a Darcs checkout of <code>baseURL</code> is just plain wrong, since
the parent directory of a collection of Darcs repositories is not
itself a valid repository.

   <p>The Darcs step takes the following arguments:

     <dl>
<dt><code>repourl</code><dd>(required unless <code>baseURL</code> is provided): the URL at which the
Darcs source repository is available.

     <br><dt><code>baseURL</code><dd>(required unless <code>repourl</code> is provided): the base repository URL,
to which a branch name will be appended. It should probably end in a
slash.

     <br><dt><code>defaultBranch</code><dd>(allowed if and only if <code>baseURL</code> is provided): this specifies
the name of the branch to use when a Build does not provide one of its
own. This will be appended to <code>baseURL</code> to create the string that
will be passed to the <code>darcs get</code> command. 
</dl>

<div class="node">
<a name="Mercurial"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Bzr">Bzr</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Darcs">Darcs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.4 Mercurial</h5>

<p><a name="index-Mercurial-Checkout-87"></a><a name="index-buildbot_002esteps_002esource_002eMercurial-88"></a>

   <p>The <code>Mercurial</code> build step performs a
<a href="http://selenic.com/mercurial">Mercurial</a> (aka &ldquo;hg&rdquo;) checkout
or update.

   <p>Branches are available in two modes: &rdquo;dirname&rdquo; like See <a href="#Darcs">Darcs</a>, or
&rdquo;inrepo&rdquo;, which uses the repository internal branches. Make sure this
setting matches your changehook, if you have that installed.

   <p>The Mercurial step takes the following arguments:

     <dl>
<dt><code>repourl</code><dd>(required unless <code>baseURL</code> is provided): the URL at which the
Mercurial source repository is available.

     <br><dt><code>baseURL</code><dd>(required unless <code>repourl</code> is provided): the base repository URL,
to which a branch name will be appended. It should probably end in a
slash.

     <br><dt><code>defaultBranch</code><dd>(allowed if and only if <code>baseURL</code> is provided): this specifies
the name of the branch to use when a Build does not provide one of its
own. This will be appended to <code>baseURL</code> to create the string that
will be passed to the <code>hg clone</code> command.

     <br><dt><code>branchType</code><dd>either 'dirname' (default) or 'inrepo' depending on whether
the branch name should be appended to the <code>baseURL</code>
or the branch is a mercurial named branch and can be
found within the <code>repourl</code>.

     <br><dt><code>clobberOnBranchChange</code><dd>boolean, defaults to True. If set and
using inrepos branches, clobber the tree
at each branch change. Otherwise, just
update to the branch.

   </dl>

<div class="node">
<a name="Bzr"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#P4">P4</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mercurial">Mercurial</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.5 Bzr</h5>

<p><a name="index-Bzr-Checkout-89"></a><a name="index-buildbot_002esteps_002esource_002eBzr-90"></a>
<code>bzr</code> is a descendant of Arch/Baz, and is frequently referred to
as simply &ldquo;Bazaar&rdquo;. The repository-vs-workspace model is similar to
Darcs, but it uses a strictly linear sequence of revisions (one
history per branch) like Arch. Branches are put in subdirectories. 
This makes it look very much like Mercurial. It takes the following
arguments:

     <dl>
<dt><code>repourl</code><dd>(required unless <code>baseURL</code> is provided): the URL at which the
Bzr source repository is available.

     <br><dt><code>baseURL</code><dd>(required unless <code>repourl</code> is provided): the base repository URL,
to which a branch name will be appended. It should probably end in a
slash.

     <br><dt><code>defaultBranch</code><dd>(allowed if and only if <code>baseURL</code> is provided): this specifies
the name of the branch to use when a Build does not provide one of its
own. This will be appended to <code>baseURL</code> to create the string that
will be passed to the <code>bzr checkout</code> command.

     <br><dt><code>forceSharedRepo</code><dd>(boolean, optional, defaults to False): If set to True, the working directory
will be made into a bzr shared repository if it is not already. Shared
repository greatly reduces the amount of history data that needs to be
downloaded if not using update/copy mode, or if using update/copy mode with
multiple branches. 
</dl>

<div class="node">
<a name="P4"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Git">Git</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Bzr">Bzr</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.6 P4</h5>

<p><a name="index-Perforce-Update-91"></a><a name="index-buildbot_002esteps_002esource_002eP4-92"></a><!-- TODO @bsindex buildbot.steps.source.P4Sync -->

   <p>The <code>P4</code> build step creates a <a href="http://www.perforce.com/">Perforce</a> client specification and performs an update.

     <dl>
<dt><code>p4base</code><dd>A view into the Perforce depot without branch name or trailing "...". 
Typically "//depot/proj/". 
<br><dt><code>defaultBranch</code><dd>A branch name to append on build requests if none is specified. 
Typically "trunk". 
<br><dt><code>p4port</code><dd>(optional): the host:port string describing how to get to the P4 Depot
(repository), used as the -p argument for all p4 commands. 
<br><dt><code>p4user</code><dd>(optional): the Perforce user, used as the -u argument to all p4
commands. 
<br><dt><code>p4passwd</code><dd>(optional): the Perforce password, used as the -p argument to all p4
commands. 
<br><dt><code>p4extra_views</code><dd>(optional): a list of (depotpath, clientpath) tuples containing extra
views to be mapped into the client specification. Both will have
"/..." appended automatically. The client name and source directory
will be prepended to the client path. 
<br><dt><code>p4client</code><dd>(optional): The name of the client to use. In mode='copy' and
mode='update', it's particularly important that a unique name is used
for each checkout directory to avoid incorrect synchronization. For
this reason, Python percent substitution will be performed on this value
to replace %(slave)s with the slave name and %(builder)s with the
builder name. The default is "buildbot_%(slave)s_%(build)s". 
<br><dt><code>p4line_end</code><dd>(optional): The type of line ending handling P4 should use.  This is
added directly to the cliet spec's LineEnd property.  The default is
"local". 
</dl>

<div class="node">
<a name="Git"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#BitKeeper">BitKeeper</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#P4">P4</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.7 Git</h5>

<p><a name="index-Git-Checkout-93"></a><a name="index-buildbot_002esteps_002esource_002eGit-94"></a>
The <code>Git</code> build step clones or updates a <a href="http://git.or.cz/">Git</a> repository and checks out the specified branch or revision. Note
that the buildbot supports Git version 1.2.0 and later: earlier
versions (such as the one shipped in Ubuntu 'Dapper') do not support
the <samp><span class="command">git init</span></samp> command that the buildbot uses.

   <p>The Git step takes the following arguments:

     <dl>
<dt><code>repourl</code><dd>(required): the URL of the upstream Git repository.

     <br><dt><code>branch</code><dd>(optional): this specifies the name of the branch to use when a Build
does not provide one of its own. If this this parameter is not
specified, and the Build does not provide a branch, the &ldquo;master&rdquo;
branch will be used.

     <br><dt><code>ignore_ignores</code><dd>(optional): when purging changes, don't use .gitignore and
.git/info/exclude.

     <br><dt><code>submodules</code><dd>(optional): when initializing/updating a Git repository, this decides whether
or not buildbot should consider git submodules.  Default: False.

     <br><dt><code>reference</code><dd>(optional): use the specified string as a path to a reference repository on the
local machine. Git will try to grab objects from this path first instead of the
main repository, if they exist.

     <br><dt><code>shallow</code><dd>(optional): instructs git to attempt shallow clones (<code>--depth 1</code>).  If the
user/scheduler asks for a specific revision, this parameter is ignored.

     <br><dt><code>progress</code><dd>(optional): passes the (<code>--progress</code>) flag to (<code>git fetch</code>). This
solves issues of long fetches being killed due to lack of output, but requires
Git 1.7.2 or later.

   </dl>

   <p>This Source step integrates with <a href="#GerritChangeSource">GerritChangeSource</a>, and will automatically use
Gerrit's "virtual branch" (<code>refs/changes/*</code>) to download the additionnal changes
introduced by a pending changeset.

   <p>Gerrit integration can be also triggered using forced build with <code>gerrit_change</code>
property with value in format: <code>change_number/patchset_number</code>.

<div class="node">
<a name="BitKeeper"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Repo">Repo</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Git">Git</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.8 BitKeeper</h5>

<p><a name="index-BitKeeper-Checkout-95"></a><a name="index-buildbot_002esteps_002esource_002eBK-96"></a>
The <code>BK</code> build step performs a <a href="http://www.bitkeeper.com/">BitKeeper</a>
checkout or update.

   <p>The BitKeeper step takes the following arguments:

     <dl>
<dt><code>repourl</code><dd>(required unless <code>baseURL</code> is provided): the URL at which the
BitKeeper source repository is available.

     <br><dt><code>baseURL</code><dd>(required unless <code>repourl</code> is provided): the base repository URL,
to which a branch name will be appended. It should probably end in a
slash.

   </dl>

<div class="node">
<a name="Repo"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Monotone">Monotone</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BitKeeper">BitKeeper</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.9 Repo</h5>

<p><a name="index-Repo-init-sync-97"></a><a name="index-buildbot_002esteps_002esource_002eRepo-98"></a>
The <code>Repo</code> build step performs a <a href="http://lwn.net/Articles/304488/">Repo</a>
init and sync.

   <p>The Repo step takes the following arguments:

     <dl>
<dt><code>manifest_url</code><dd>(required): the URL at which the Repo's manifests source repository is available.

     <br><dt><code>manifest_branch</code><dd>(optional, defaults to <code>master</code>): the manifest repository branch on which
repo will take its manifest. Corresponds to the <code>-b</code> argument to the <code>repo init</code> command. 
<br><dt><code>manifest_file</code><dd>(optional, defaults to <code>default.xml</code>): the manifest filename. 
Corresponds to the <code>-m</code> argument to the <code>repo init</code> command. 
<br><dt><code>tarball</code><dd>(optional, defaults to <code>None</code>): the repo tarball used for fast bootstrap. 
If not present the tarball will be created automatically after first sync. 
It is a copy of the <code>.repo</code> directory which contains all the git objects. 
This feature helps to minimize network usage on very big projects. 
</dl>

   <p>This Source step integrates with <a href="#GerritChangeSource">GerritChangeSource</a>, and will automatically use the
<code>repo download</code> command of repo to download the additionnal changes introduced by a
pending changeset.

   <p>Gerrit integration can be also triggered using forced build with following properties:
<code>repo_d</code>, <code>repo_d[0-9]</code>, <code>repo_download</code>, <code>repo_download[0-9]</code>
with values in format: <code>project/change_number/patchset_number</code>. 
All of these properties will be translated into a <code>repo download</code>. 
This feature allows integrators to build with several pending interdependent changes,
which at the moment cannot be described properly in Gerrit, and can only be described
by humans.

<div class="node">
<a name="Monotone"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Repo">Repo</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Source-Checkout">Source Checkout</a>

</div>

<h5 class="subsubsection">4.12.3.10 Monotone</h5>

<p><a name="index-Monotone-Checkout-99"></a><a name="index-buildbot_002esteps_002esource_002eMonotone-100"></a>

   <p>The <code>Monotone</code> build step performs a
<a href="http://www.monotone.ca">Monotone</a> (aka &ldquo;mtn&rdquo;) checkout
or update.

   <p>The Monotone step takes the following arguments:

     <dl>
<dt><code>repourl</code><dd>the URL at which the Monotone source repository is available.

     <br><dt><code>branch</code><dd>this specifies the name of the branch to use when a Build does not
provide one of its own.

     <br><dt><code>progress</code><dd>this is a boolean that has a pull from the repository use
&ldquo;&ndash;ticker=dot&rdquo; instead of the default &ldquo;&ndash;ticker=none&rdquo;.

   </dl>

<div class="node">
<a name="ShellCommand"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Slave-Filesystem-Steps">Slave Filesystem Steps</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Source-Checkout">Source Checkout</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.4 ShellCommand</h4>

<p>Most interesting steps involve executing a process of some sort on the
buildslave.  The <code>ShellCommand</code> class handles this activity.

   <p>Several subclasses of ShellCommand are provided as starting points for
common build steps.

<ul class="menu">
<li><a accesskey="1" href="#Using-ShellCommands">Using ShellCommands</a>
<li><a accesskey="2" href="#Configure">Configure</a>
<li><a accesskey="3" href="#Compile">Compile</a>
<li><a accesskey="4" href="#Visual-C_002b_002b">Visual C++</a>
<li><a accesskey="5" href="#Test">Test</a>
<li><a accesskey="6" href="#TreeSize">TreeSize</a>
<li><a accesskey="7" href="#PerlModuleTest">PerlModuleTest</a>
<li><a accesskey="8" href="#Testing-with-mysql_002dtest_002drun">Testing with mysql-test-run</a>
<li><a accesskey="9" href="#SetProperty">SetProperty</a>
<li><a href="#SubunitShellCommand">SubunitShellCommand</a>
</ul>

<div class="node">
<a name="Using-ShellCommands"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Configure">Configure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.1 Using ShellCommands</h5>

<p><a name="index-buildbot_002esteps_002eshell_002eShellCommand-101"></a>
This is a useful base class for just about everything you might want
to do during a build (except for the initial source checkout). It runs
a single command in a child shell on the buildslave. All stdout/stderr
is recorded into a LogFile. The step finishes with a status of FAILURE
if the command's exit code is non-zero, otherwise it has a status of
SUCCESS.

   <p>The preferred way to specify the command is with a list of argv strings,
since this allows for spaces in filenames and avoids doing any fragile
shell-escaping. You can also specify the command with a single string, in
which case the string is given to '/bin/sh -c COMMAND' for parsing.

   <p>On Windows, commands are run via <code>cmd.exe /c</code> which works well. However,
if you're running a batch file, the error level does not get propagated
correctly unless you add 'call' before your batch file's name:
<code>cmd=['call', 'myfile.bat', ...]</code>.

   <p><code>ShellCommand</code> arguments:

     <dl>
<dt><code>command</code><dd>a list of strings (preferred) or single string (discouraged) which
specifies the command to be run. A list of strings is preferred
because it can be used directly as an argv array. Using a single
string (with embedded spaces) requires the buildslave to pass the
string to /bin/sh for interpretation, which raises all sorts of
difficult questions about how to escape or interpret shell
metacharacters.

     <br><dt><code>workdir</code><dd>All ShellCommands are run by default in the &ldquo;workdir&rdquo;, which
defaults to the &ldquo;<samp><span class="file">build</span></samp>&rdquo; subdirectory of the slave builder's
base directory. The absolute path of the workdir will thus be the
slave's basedir (set as an option to <code>buildbot create-slave</code>,
see <a href="#Creating-a-buildslave">Creating a buildslave</a>) plus the builder's basedir (set in the
builder's <code>c['builddir']</code> key in master.cfg) plus the workdir
itself (a class-level attribute of the BuildFactory, defaults to
&ldquo;<samp><span class="file">build</span></samp>&rdquo;).

     <p>For example:

     <pre class="example">          f.addStep(ShellCommand(command=["make", "test"],
                                 workdir="build/tests"))
</pre>
     <br><dt><code>env</code><dd>a dictionary of environment strings which will be added to the child
command's environment. For example, to run tests with a different i18n
language setting, you might use

     <pre class="example">          f.addStep(ShellCommand(command=["make", "test"],
                                 env={'LANG': 'fr_FR'}))
</pre>
     <p>These variable settings will override any existing ones in the
buildslave's environment or the environment specified in the
Builder. The exception is PYTHONPATH, which is merged
with (actually prepended to) any existing $PYTHONPATH setting. The
value is treated as a list of directories to prepend, and a single
string is treated like a one-item list. For example, to prepend both
<samp><span class="file">/usr/local/lib/python2.3</span></samp> and <samp><span class="file">/home/buildbot/lib/python</span></samp>
to any existing $PYTHONPATH setting, you would do something like the
following:

     <pre class="example">          f.addStep(ShellCommand(
                        command=["make", "test"],
                        env={'PYTHONPATH': ["/usr/local/lib/python2.3",
                                             "/home/buildbot/lib/python"] }))
</pre>
     <p>Those variables support expansion so that if you just want to prepend
<samp><span class="file">/home/buildbot/bin</span></samp> to the PATH environment variable, you can do
it by putting the value <code>${PATH}</code> at the end of the string like
in the example below. Variables that doesn't exists on the slave will be
replaced by <code>""</code>.

     <pre class="example">          f.addStep(ShellCommand(
                        command=["make", "test"],
                        env={'PATH': "/home/buildbot/bin:${PATH}"}))
</pre>
     <br><dt><code>want_stdout</code><dd>if False, stdout from the child process is discarded rather than being
sent to the buildmaster for inclusion in the step's LogFile.

     <br><dt><code>want_stderr</code><dd>like <code>want_stdout</code> but for stderr. Note that commands run through
a PTY do not have separate stdout/stderr streams: both are merged into
stdout.

     <br><dt><code>usePTY</code><dd>Should this command be run in a pseudo-terminal?  The default is to observe the
configuration of the client (see <a href="#Buildslave-Options">Buildslave Options</a>), but specifying
<code>True</code> or <code>False</code> here will override the default.  This option is not
available on Windows.

     <p>In general, you do not want to use a pseudo-terminal.  This is <i>only</i> useful
for running commands that require a terminal - for example, testing a
command-line application that will only accept passwords read from a terminal. 
Using a pseudo-terminal brings lots of compatibility problems, and prevents
Buildbot from distinguishing the standard error (red) and standard output
(black) streams.

     <p>In previous versions, the advantage of using a pseudo-terminal was that
&ldquo;grandchild&rdquo; processes were more likely to be cleaned up if the build was
interrupted or times out.  This occurred because using a pseudo-terminal
incidentally puts the command into its own process group.

     <p>As of Buildbot-0.8.4, all commands are placed in process groups, and thus
grandchild processes will be cleaned up properly.

     <br><dt><code>logfiles</code><dd>Sometimes commands will log interesting data to a local file, rather
than emitting everything to stdout or stderr. For example, Twisted's
&ldquo;trial&rdquo; command (which runs unit tests) only presents summary
information to stdout, and puts the rest into a file named
<samp><span class="file">_trial_temp/test.log</span></samp>. It is often useful to watch these files
as the command runs, rather than using <samp><span class="command">/bin/cat</span></samp> to dump
their contents afterwards.

     <p>The <code>logfiles=</code> argument allows you to collect data from these
secondary logfiles in near-real-time, as the step is running. It
accepts a dictionary which maps from a local log name (which is how
the log data is presented in the build results) to either a remote filename
(interpreted relative to the build's working directory), or a dictionary
of options. Each named file will be polled on a regular basis (every couple
of seconds) as the build runs, and any new text will be sent over to the
buildmaster.

     <p>If you provide a dictionary of options instead of a string, you must specify
the <code>filename</code> key. You can optionally provide a <code>follow</code> key which
is a boolean controlling whether a logfile is followed or concatenated in its
entirety.  Following is appropriate for logfiles to which the build step will
append, where the pre-existing contents are not interesting.  The default value
for <code>follow</code> is <code>False</code>, which gives the same behavior as just
providing a string filename.

     <pre class="example">          f.addStep(ShellCommand(
                        command=["make", "test"],
                        logfiles={"triallog": "_trial_temp/test.log"}))
</pre>
     <p>The above example will add a log named 'triallog' on the master, based on
<code>_trial_temp/test.log</code> on the slave.

     <pre class="example">          f.addStep(ShellCommand(
                        command=["make", "test"],
                        logfiles={"triallog": {"filename": "_trial_temp/test.log",
          			       "follow": True,}}))
</pre>
     <br><dt><code>lazylogfiles</code><dd>If set to <code>True</code>, logfiles will be tracked lazily, meaning that they will
only be added when and if something is written to them. This can be used to
suppress the display of empty or missing log files. The default is <code>False</code>.

     <br><dt><code>timeout</code><dd>if the command fails to produce any output for this many seconds, it
is assumed to be locked up and will be killed. This defaults to 1200 seconds. 
Pass <code>None</code> to disable.

     <br><dt><code>maxTime</code><dd>if the command takes longer than this many seconds, it will be killed. This
is disabled by default.

     <br><dt><code>description</code><dd>This will be used to describe the command (on the Waterfall display)
while the command is still running. It should be a single
imperfect-tense verb, like &ldquo;compiling&rdquo; or &ldquo;testing&rdquo;. The preferred
form is a list of short strings, which allows the HTML
displays to create narrower columns by emitting a &lt;br&gt; tag between each
word. You may also provide a single string.

     <br><dt><code>descriptionDone</code><dd>This will be used to describe the command once it has finished. A
simple noun like &ldquo;compile&rdquo; or &ldquo;tests&rdquo; should be used. Like
<code>description</code>, this may either be a list of short strings or a
single string.

     <p>If neither <code>description</code> nor <code>descriptionDone</code> are set, the
actual command arguments will be used to construct the description. 
This may be a bit too wide to fit comfortably on the Waterfall
display.

     <pre class="example">          f.addStep(ShellCommand(command=["make", "test"],
                                 description=["testing"],
                                 descriptionDone=["tests"]))
</pre>
     <br><dt><code>logEnviron</code><dd>If this option is true (the default), then the step's logfile will describe the
environment variables on the slave.  In situations where the environment is not
relevant and is long, it may be easier to set <code>logEnviron=False</code>.

   </dl>

<div class="node">
<a name="Configure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Compile">Compile</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Using-ShellCommands">Using ShellCommands</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.2 Configure</h5>

<p><a name="index-buildbot_002esteps_002eshell_002eConfigure-102"></a>
This is intended to handle the <code>./configure</code> step from
autoconf-style projects, or the <code>perl Makefile.PL</code> step from perl
MakeMaker.pm-style modules. The default command is <code>./configure</code>
but you can change this by providing a <code>command=</code> parameter.

<div class="node">
<a name="Compile"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Visual-C_002b_002b">Visual C++</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configure">Configure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.3 Compile</h5>

<p><a name="index-buildbot_002esteps_002eshell_002eCompile-103"></a>
This is meant to handle compiling or building a project written in C. 
The default command is <code>make all</code>. When the compile is finished,
the log file is scanned for GCC warning messages, a summary log is
created with any problems that were seen, and the step is marked as
WARNINGS if any were discovered. Through the <code>WarningCountingShellCommand</code>
superclass, the number of warnings is stored in a Build Property named
&ldquo;warnings-count&rdquo;, which is accumulated over all Compile steps (so if two
warnings are found in one step, and three are found in another step, the
overall build will have a &ldquo;warnings-count&rdquo; property of 5).  Each step can be
optionally given a maximum number of warnings via the maxWarnCount parameter. 
If this limit is exceeded, the step will be marked as a failure.

   <p>The default regular expression used to detect a warning is
<code>'.*warning[: ].*'</code> , which is fairly liberal and may cause
false-positives. To use a different regexp, provide a
<code>warningPattern=</code> argument, or use a subclass which sets the
<code>warningPattern</code> attribute:

<pre class="example">     f.addStep(Compile(command=["make", "test"],
                       warningPattern="^Warning: "))
</pre>
   <p>The <code>warningPattern=</code> can also be a pre-compiled python regexp
object: this makes it possible to add flags like <code>re.I</code> (to use
case-insensitive matching).

   <p>Note that the compiled <code>warningPattern</code> will have its <code>match</code> method
called, which is subtly different from a <code>search</code>. Your regular
expression must match the from the beginning of the line. This means that to
look for the word "warning" in the middle of a line, you will need to
prepend <code>'.*'</code> to your regular expression.

   <p>The <code>suppressionFile=</code> argument can be specified as the (relative) path
of a file inside the workdir defining warnings to be suppressed from the
warning counting and log file. The file will be uploaded to the master from
the slave before compiling, and any warning matched by a line in the
suppression file will be ignored. This is useful to accept certain warnings
(eg. in some special module of the source tree or in cases where the compiler
is being particularly stupid), yet still be able to easily detect and fix the
introduction of new warnings.

   <p>The file must contain one line per pattern of warnings to ignore. Empty lines
and lines beginning with <code>#</code> are ignored. Other lines must consist of a
regexp matching the file name, followed by a colon (<code>:</code>), followed by a
regexp matching the text of the warning. Optionally this may be followed by
another colon and a line number range. For example:

<pre class="example">     # Sample warning suppression file
     
     mi_packrec.c : .*result of 32-bit shift implicitly converted to 64 bits.* : 560-600
     DictTabInfo.cpp : .*invalid access to non-static.*
     kernel_types.h : .*only defines private constructors and has no friends.* : 51
</pre>
   <p>If no line number range is specified, the pattern matches the whole file; if
only one number is given it matches only on that line.

   <p>The default warningPattern regexp only matches the warning text, so line
numbers and file names are ignored. To enable line number and file name
matching, privide a different regexp and provide a function (callable) as the
argument of <code>warningExtractor=</code>. The function is called with three
arguments: the BuildStep object, the line in the log file with the warning,
and the <code>SRE_Match</code> object of the regexp search for <code>warningPattern</code>. It
should return a tuple <code>(filename, linenumber, warning_test)</code>. For
example:

<pre class="example">     f.addStep(Compile(command=["make"],
                       warningPattern="^(.*?):([0-9]+): [Ww]arning: (.*)$",
                       warningExtractor=Compile.warnExtractFromRegexpGroups,
                       suppressionFile="support-files/compiler_warnings.supp"))
</pre>
   <p>(<code>Compile.warnExtractFromRegexpGroups</code> is a pre-defined function that
returns the filename, linenumber, and text from groups (1,2,3) of the regexp
match).

   <p>In projects with source files in multiple directories, it is possible to get
full path names for file names matched in the suppression file, as long as the
build command outputs the names of directories as they are entered into and
left again. For this, specify regexps for the arguments
<code>directoryEnterPattern=</code> and <code>directoryLeavePattern=</code>. The
<code>directoryEnterPattern=</code> regexp should return the name of the directory
entered into in the first matched group. The defaults, which are suitable for
GNU Make, are these:

<pre class="example">     directoryEnterPattern = "make.*: Entering directory [\"`'](.*)['`\"]"
     directoryLeavePattern = "make.*: Leaving directory"
</pre>
   <p>(TODO: this step needs to be extended to look for GCC error messages
as well, and collect them into a separate logfile, along with the
source code filenames involved).

<div class="node">
<a name="Visual-C++"></a>
<a name="Visual-C_002b_002b"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Test">Test</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Compile">Compile</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.4 Visual C++</h5>

<p><a name="index-buildbot_002esteps_002evstudio_002eVC6-104"></a><a name="index-buildbot_002esteps_002evstudio_002eVC7-105"></a><a name="index-buildbot_002esteps_002evstudio_002eVC8-106"></a><a name="index-buildbot_002esteps_002evstudio_002eVS2003-107"></a><a name="index-buildbot_002esteps_002evstudio_002eVS2005-108"></a><a name="index-buildbot_002esteps_002evstudio_002eVS2008-109"></a><a name="index-buildbot_002esteps_002evstudio_002eVCExpress9-110"></a>
This step is meant to handle compilation using Microsoft compilers. 
VC++ 6-9, VS2003, VS2005, VS2008, and VCExpress9 are supported. This step will take care
of setting up a clean compilation environment, parse the generated
output in real time and deliver as detailed as possible information
about the compilation executed.

   <p>All of the classes are in <code>buildbot.steps.vstudio</code>.  The available classes are:

     <dl>
<dt><code>VC6</code>
<br><dt><code>VC7</code>
<br><dt><code>VC8</code>
<br><dt><code>VC9</code>
<br><dt><code>VS2003</code>
<br><dt><code>VC2005</code>
<br><dt><code>VC2008</code>
<br><dt><code>VCExpress9</code><dd>
</dl>

   <p>The available constructor arguments are

     <dl>
<dt><code>mode</code><dd>The mode default to <code>"rebuild"</code>, which means that first all the
remaining object files will be cleaned by the compiler. The alternate
value is <code>"build"</code>, where only the updated files will be recompiled.

     <br><dt><code>projectfile</code><dd>This is a mandatory argument which specifies the project file to be used
during the compilation.

     <br><dt><code>config</code><dd>This argument defaults to <code>"release"</code> an gives to the compiler the
configuration to use.

     <br><dt><code>installdir</code><dd>This is the place where the compiler is installed. The default value is
compiler specific and is the default place where the compiler is installed.

     <br><dt><code>useenv</code><dd>This boolean parameter, defaulting to <code>False</code> instruct the compiler
to use its own settings or the one defined through the environment
variables <code>%PATH%</code>, <code>%INCLUDE%</code>, and <code>%LIB%</code>. If any of
the <code>INCLUDE</code> or <code>LIB</code> parameter is defined, this parameter
automatically switches to <code>True</code>.

     <br><dt><code>PATH</code><dd>This is a list of path to be added to the PATH environment
variable. The default value is the one defined in the compiler options.

     <br><dt><code>INCLUDE</code><dd>This is a list of path where the compiler will first look for include
files. Then comes the default paths defined in the compiler options.

     <br><dt><code>LIB</code><dd>This is a list of path where the compiler will first look for
libraries. Then comes the default path defined in the compiler options.

     <br><dt><code>arch</code><dd>That one is only available with the class VS2005 (VC8). It gives the
target architecture of the built artifact. It defaults to <code>"x86''</code>.

     <br><dt><code>project</code><dd>This gives the specific project to build
from within a workspace. It defaults to building all projects. This is useful
for building cmake generate projects. 
</dl>

   <p>Here is an example on how to use this step:

<pre class="example">     from buildbot.steps.VisualStudio import VS2005
     
     f.addStep(VS2005(
             projectfile="project.sln", config="release",
             arch="x64", mode="build",
             INCLUDE=[r'D:\WINDDK\Include\wnet'],
             LIB=[r'D:\WINDDK\lib\wnet\amd64']))
</pre>
   <div class="node">
<a name="Test"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#TreeSize">TreeSize</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Visual-C_002b_002b">Visual C++</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.5 Test</h5>

<p><a name="index-buildbot_002esteps_002eshell_002eTest-111"></a>
This is meant to handle unit tests. The default command is <code>make
test</code>, and the <code>warnOnFailure</code> flag is set.

<div class="node">
<a name="TreeSize"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#PerlModuleTest">PerlModuleTest</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Test">Test</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.6 TreeSize</h5>

<p><a name="index-buildbot_002esteps_002eshell_002eTreeSize-112"></a>
This is a simple command that uses the 'du' tool to measure the size
of the code tree. It puts the size (as a count of 1024-byte blocks,
aka 'KiB' or 'kibibytes') on the step's status text, and sets a build
property named 'tree-size-KiB' with the same value.

<div class="node">
<a name="PerlModuleTest"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Testing-with-mysql_002dtest_002drun">Testing with mysql-test-run</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#TreeSize">TreeSize</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.7 PerlModuleTest</h5>

<p><a name="index-buildbot_002esteps_002eshell_002ePerlModuleTest-113"></a>
This is a simple command that knows how to run tests of perl modules. 
It parses the output to determine the number of tests passed and
failed and total number executed, saving the results for later query.

<div class="node">
<a name="Testing-with-mysql-test-run"></a>
<a name="Testing-with-mysql_002dtest_002drun"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#SetProperty">SetProperty</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#PerlModuleTest">PerlModuleTest</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.8 Testing with mysql-test-run</h5>

<p>The <code>process.mtrlogobserver.MTR</code> class is a subclass of <code>Test</code>
(<a href="#Test">Test</a>). It is used to run test suites using the mysql-test-run program,
as used in MySQL, Drizzle, MariaDB, and MySQL storage engine plugins.

   <p>The shell command to run the test suite is specified in the same way as for
the Test class. The MTR class will parse the output of running the test suite,
and use the count of tests executed so far to provide more accurate completion
time estimates. Any test failures that occur during the test are summarized on
the Waterfall Display.

   <p>Server error logs are added as additional log files, useful to debug test
failures.

   <p>Optionally, data about the test run and any test failures can be inserted into
a database for further analysis and report generation. To use this facility,
create an instance of <code>twisted.enterprise.adbapi.ConnectionPool</code> with
connections to the database. The necessary tables can be created automatically
by setting <code>autoCreateTables</code> to <code>True</code>, or manually using the SQL
found in the <samp><span class="file">mtrlogobserver.py</span></samp> source file.

   <p>One problem with specifying a database is that each reload of the
configuration will get a new instance of <code>ConnectionPool</code> (even if the
connection parameters are the same). To avoid that Buildbot thinks the builder
configuration has changed because of this, use the
<code>process.mtrlogobserver.EqConnectionPool</code> subclass of
<code>ConnectionPool</code>, which implements an equiality operation that avoids
this problem.

   <p>Example use:

<pre class="example">     from buildbot.process.mtrlogobserver import MTR, EqConnectionPool
     myPool = EqConnectionPool("MySQLdb", "host", "buildbot", "password", "db")
     myFactory.addStep(MTR(workdir="mysql-test", dbpool=myPool,
                           command=["perl", "mysql-test-run.pl", "--force"]))
</pre>
   <p><code>MTR</code> arguments:

     <dl>
<dt><code>textLimit</code><dd>Maximum number of test failures to show on the waterfall page (to not flood
the page in case of a large number of test failures). Defaults to 5.

     <br><dt><code>testNameLimit</code><dd>Maximum length of test names to show unabbreviated in the waterfall page, to
avoid excessive column width. Defaults to 16.

     <br><dt><code>parallel</code><dd>Value of <code>--parallel</code> option used for mysql-test-run.pl (number of processes
used to run the test suite in parallel). Defaults to 4. This is used to
determine the number of server error log files to download from the
slave. Specifying a too high value does not hurt (as nonexisting error logs
will be ignored), however if using <code>--parallel</code> value greater than the default
it needs to be specified, or some server error logs will be missing.

     <br><dt><code>dbpool</code><dd>An instance of twisted.enterprise.adbapi.ConnectionPool, or None.  Defaults to
None. If specified, results are inserted into the database using the
ConnectionPool.

     <br><dt><code>autoCreateTables</code><dd>Boolean, defaults to False. If True (and <code>dbpool</code> is specified), the
necessary database tables will be created automatically if they do not exist
already. Alternatively, the tables can be created manually from the SQL
statements found in the mtrlogobserver.py source file.

     <br><dt><code>test_type</code><dd>Short string that will be inserted into the database in the row for the test
run. Defaults to the empty string, but can be specified to identify different
types of test runs.

     <br><dt><code>test_info</code><dd>Descriptive string that will be inserted into the database in the row for the test
run. Defaults to the empty string, but can be specified as a user-readable
description of this particular test run.

     <br><dt><code>mtr_subdir</code><dd>The subdirectory in which to look for server error log files. Defaults to
&ldquo;mysql-test&rdquo;, which is usually correct. WithProperties is supported.

   </dl>

<div class="node">
<a name="SetProperty"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#SubunitShellCommand">SubunitShellCommand</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Testing-with-mysql_002dtest_002drun">Testing with mysql-test-run</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.9 SetProperty</h5>

<p><a name="index-buildbot_002esteps_002eshell_002eSetProperty-114"></a>
This buildstep is similar to ShellCommand, except that it captures the
output of the command into a property.  It is usually used like this:

<pre class="example">     from buildbot.steps import shell
     f.addStep(shell.SetProperty(command="uname -a", property="uname"))
</pre>
   <p>This runs <code>uname -a</code> and captures its output (including stderr), stripped
of leading and trailing whitespace, in the property "uname".  To avoid
stripping, add <code>strip=False</code>.

   <p>The <code>property</code> argument can be specified as a <code>WithProperties</code>
object, allowing the property name to be built from other property values.

   <p>The more advanced usage allows you to specify a function to extract properties
from the command output.  Here you can use regular expressions, string
interpolation, or whatever you would like.  In this form, <code>extract_fn</code>
should be passed, and not <code>property</code>.  The <code>extract_fn</code> function is
called with three arguments: the exit status of the command, its standard
output as a string, and its standard error as a string.  It should return a
dictionary containing all new properties.

<pre class="example">     def glob2list(rc, stdout, stderr):
         jpgs = [ l.strip() for l in stdout.split('\n') ]
         return { 'jpgs' : jpgs }
     f.addStep(SetProperty(command="ls -1 *.jpg", extract_fn=glob2list))
</pre>
   <p>Note that any ordering relationship of the contents of stdout and
stderr is lost.  For example, given

<pre class="example">     f.addStep(SetProperty(
         command="echo output1; echo error &gt;&amp;2; echo output2",
         extract_fn=my_extract))
</pre>
   <p>Then <code>my_extract</code> will see <code>stdout="output1\noutput2\n"</code>
and <code>stderr="error\n"</code>.

   <p>See also <a href="#Setting-Properties">Setting Properties</a>.

<div class="node">
<a name="SubunitShellCommand"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#SetProperty">SetProperty</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ShellCommand">ShellCommand</a>

</div>

<h5 class="subsubsection">4.12.4.10 SubunitShellCommand</h5>

<p><a name="index-buildbot_002esteps_002esubunit_002eSubunitShellCommand-115"></a>
This buildstep is similar to ShellCommand, except that it runs the log content
through a subunit filter to extract test and failure counts.

<pre class="example">     from buildbot.steps.subunit import SubunitShellCommand
     f.addStep(SubunitShellCommand(command="make test", failureOnNoTests=False))
</pre>
   <p>This runs <code>make test</code> and filters it through subunit. The 'tests' and
'test failed' progress metrics will now accumulate test data from the test run.

   <p>If <code>failureOnNoTests</code> is True, this step will fail if no test is run. By
default <code>failureOnNoTests</code> is False.

<div class="node">
<a name="Slave-Filesystem-Steps"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Python-BuildSteps">Python BuildSteps</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ShellCommand">ShellCommand</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.5 Slave Filesystem Steps</h4>

<p>Here are some buildsteps for manipulating the slaves filesystem.

<ul class="menu">
<li><a accesskey="1" href="#RemoveDirectory">RemoveDirectory</a>
</ul>

<div class="node">
<a name="RemoveDirectory"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#Slave-Filesystem-Steps">Slave Filesystem Steps</a>

</div>

<h5 class="subsubsection">4.12.5.1 RemoveDirectory</h5>

<p>This command recursively deletes a directory on the slave.

<pre class="example">     from buildbot.steps.slave import RemoveDirectory
     f.addStep(RemoveDirectory(dir="build/build"))
</pre>
   <div class="node">
<a name="Python-BuildSteps"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Transferring-Files">Transferring Files</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Slave-Filesystem-Steps">Slave Filesystem Steps</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.6 Python BuildSteps</h4>

<p>Here are some BuildSteps that are specifcally useful for projects
implemented in Python.

<ul class="menu">
<li><a accesskey="1" href="#BuildEPYDoc">BuildEPYDoc</a>
<li><a accesskey="2" href="#PyFlakes">PyFlakes</a>
<li><a accesskey="3" href="#PyLint">PyLint</a>
<li><a accesskey="4" href="#Trial">Trial</a>
<li><a accesskey="5" href="#RemovePYCs">RemovePYCs</a>
</ul>

<div class="node">
<a name="BuildEPYDoc"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#PyFlakes">PyFlakes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Python-BuildSteps">Python BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.6.1 BuildEPYDoc</h5>

<p><a name="index-buildbot_002esteps_002epython_002eBuildEPYDoc-116"></a>
<a href="http://epydoc.sourceforge.net/">epydoc</a> is a tool for generating
API documentation for Python modules from their docstrings. It reads
all the .py files from your source tree, processes the docstrings
therein, and creates a large tree of .html files (or a single .pdf
file).

   <p>The <code>buildbot.steps.python.BuildEPYDoc</code> step will run
<samp><span class="command">epydoc</span></samp> to produce this API documentation, and will count the
errors and warnings from its output.

   <p>You must supply the command line to be used. The default is
<samp><span class="command">make epydocs</span></samp>, which assumes that your project has a Makefile
with an &ldquo;epydocs&rdquo; target. You might wish to use something like
<samp><span class="command">epydoc -o apiref source/PKGNAME</span></samp> instead. You might also want
to add <samp><span class="command">--pdf</span></samp> to generate a PDF file instead of a large tree
of HTML files.

   <p>The API docs are generated in-place in the build tree (under the
workdir, in the subdirectory controlled by the &ldquo;-o&rdquo; argument). To
make them useful, you will probably have to copy them to somewhere
they can be read. A command like <samp><span class="command">rsync -ad apiref/
dev.example.com:~public_html/current-apiref/</span></samp> might be useful. You
might instead want to bundle them into a tarball and publish it in the
same place where the generated install tarball is placed.

<pre class="example">     from buildbot.steps.python import BuildEPYDoc
     
     ...
     f.addStep(BuildEPYDoc(command=["epydoc", "-o", "apiref", "source/mypkg"]))
</pre>
   <div class="node">
<a name="PyFlakes"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#PyLint">PyLint</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BuildEPYDoc">BuildEPYDoc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Python-BuildSteps">Python BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.6.2 PyFlakes</h5>

<p><a name="index-buildbot_002esteps_002epython_002ePyFlakes-117"></a>
<a href="http://divmod.org/trac/wiki/DivmodPyflakes">PyFlakes</a> is a tool
to perform basic static analysis of Python code to look for simple
errors, like missing imports and references of undefined names. It is
like a fast and simple form of the C &ldquo;lint&rdquo; program. Other tools
(like pychecker) provide more detailed results but take longer to run.

   <p>The <code>buildbot.steps.python.PyFlakes</code> step will run pyflakes and
count the various kinds of errors and warnings it detects.

   <p>You must supply the command line to be used. The default is
<samp><span class="command">make pyflakes</span></samp>, which assumes you have a top-level Makefile
with a &ldquo;pyflakes&rdquo; target. You might want to use something like
<samp><span class="command">pyflakes .</span></samp> or <samp><span class="command">pyflakes src</span></samp>.

<pre class="example">     from buildbot.steps.python import PyFlakes
     
     ...
     f.addStep(PyFlakes(command=["pyflakes", "src"]))
</pre>
   <div class="node">
<a name="PyLint"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Trial">Trial</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#PyFlakes">PyFlakes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Python-BuildSteps">Python BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.6.3 PyLint</h5>

<p><a name="index-buildbot_002esteps_002epython_002ePyLint-118"></a>
Similarly, the <code>buildbot.steps.python.PyLint</code> step will run pylint and
analyze the results.

   <p>You must supply the command line to be used. There is no default.

<pre class="example">     from buildbot.steps.python import PyLint
     
     ...
     f.addStep(PyLint(command=["pylint", "src"]))
</pre>
   <div class="node">
<a name="Trial"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#RemovePYCs">RemovePYCs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#PyLint">PyLint</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Python-BuildSteps">Python BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.6.4 Trial</h5>

<p><a name="index-buildbot_002esteps_002epython_005ftwisted_002eTrial-119"></a>
This step runs a unit test suite using <code>trial</code>, a unittest-like testing
framework that is a component of Twisted Python. Trial is used to implement
Twisted's own unit tests, and is the unittest-framework of choice for many
projects that use Twisted internally.

   <p>Projects that use trial typically have all their test cases in a 'test'
subdirectory of their top-level library directory. For example, for a package
<code>petmail</code>, the tests might be in <code>petmail/test/test_*.py</code>. More
complicated packages (like Twisted itself) may have multiple test directories,
like <code>twisted/test/test_*.py</code> for the core functionality and
<code>twisted/mail/test/test_*.py</code> for the email-specific tests.

   <p>To run trial tests manually, you run the <code>trial</code> executable and tell it
where the test cases are located. The most common way of doing this is with a
module name. For petmail, this might look like <code>trial petmail.test</code>, which
would locate all the <code>test_*.py</code> files under <code>petmail/test/</code>, running
every test case it could find in them.  Unlike the <code>unittest.py</code> that
comes with Python, it is not necessary to run the <code>test_foo.py</code> as a
script; you always let trial do the importing and running. The step's
<code>tests</code> parameter controls which tests trial will run: it can be a string
or a list of strings.

   <p>To find the test cases, the Python search path must allow something like
<code>import petmail.test</code> to work. For packages that don't use a separate
top-level <code>lib</code> directory, <code>PYTHONPATH=.</code> will work, and will use the
test cases (and the code they are testing) in-place. 
<code>PYTHONPATH=build/lib</code> or <code>PYTHONPATH=build/lib.somearch</code> are also
useful when you do a <code>python setup.py build</code> step first. The
<code>testpath</code> attribute of this class controls what <code>PYTHONPATH</code> is set
to before running <code>trial</code>.

   <p>Trial has the ability, through the <code>--testmodule</code> flag, to run only the
set of test cases named by special <code>test-case-name</code> tags in source files. 
We can get the list of changed source files from our parent Build and provide
them to trial, thus running the minimal set of test cases needed to cover the
Changes.  This is useful for quick builds, especially in trees with a lot of
test cases.  The <code>testChanges</code> parameter controls this feature: if set, it
will override <code>tests</code>.

   <p>The trial executable itself is typically just <code>trial</code>, and is typically
found in the shell search path.  It can be overridden with the <code>trial</code>
parameter.  This is useful for Twisted's own unittests, which want to use the
copy of bin/trial that comes with the sources.

   <p>To influence the version of python being used for the tests, or to add flags to
the command, set the <code>python</code> parameter. This can be a string (like
<code>python2.2</code>) or a list (like <code>['python2.3', '-Wall']</code>).

   <p>Trial creates and switches into a directory named <code>_trial_temp/</code> before
running the tests, and sends the twisted log (which includes all exceptions) to
a file named <code>test.log</code>. This file will be pulled up to the master where
it can be seen as part of the status output.

<pre class="example">     from buildbot.steps.python_twisted import Trial
     f.addStep(Trial(tests='petmail.test'))
</pre>
   <div class="node">
<a name="RemovePYCs"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Trial">Trial</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Python-BuildSteps">Python BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.6.5 RemovePYCs</h5>

<p><a name="index-buildbot_002esteps_002epython_005ftwisted_002eRemovePYCs-120"></a>
This is a simple built-in step that will remove <code>.pyc</code> files from the
workdir.  This is useful in builds that update their source (and thus do not
automatically delete <code>.pyc</code> files) but where some part of the build
process is dynamically searching for Python modules.  Notably, trial has a bad
habit of finding old test modules.

<pre class="example">     from buildbot.steps.python_twisted import RemovePYCs
     f.addStep(RemovePYCs())
</pre>
   <div class="node">
<a name="Transferring-Files"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Transferring-Strings">Transferring Strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Python-BuildSteps">Python BuildSteps</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.7 Transferring Files</h4>

<p><a name="index-File-Transfer-121"></a><a name="index-buildbot_002esteps_002etransfer_002eFileUpload-122"></a><a name="index-buildbot_002esteps_002etransfer_002eFileDownload-123"></a><a name="index-buildbot_002esteps_002etransfer_002eDirectoryUpload-124"></a>
Most of the work involved in a build will take place on the
buildslave. But occasionally it is useful to do some work on the
buildmaster side. The most basic way to involve the buildmaster is
simply to move a file from the slave to the master, or vice versa. 
There are a pair of BuildSteps named <code>FileUpload</code> and
<code>FileDownload</code> to provide this functionality. <code>FileUpload</code>
moves a file <em>up to</em> the master, while <code>FileDownload</code> moves
a file <em>down from</em> the master.

   <p>As an example, let's assume that there is a step which produces an
HTML file within the source tree that contains some sort of generated
project documentation. We want to move this file to the buildmaster,
into a <samp><span class="file">~/public_html</span></samp> directory, so it can be visible to
developers. This file will wind up in the slave-side working directory
under the name <samp><span class="file">docs/reference.html</span></samp>. We want to put it into the
master-side <samp><span class="file">~/public_html/ref.html</span></samp>.

<pre class="example">     from buildbot.steps.shell import ShellCommand
     from buildbot.steps.transfer import FileUpload
     
     f.addStep(ShellCommand(command=["make", "docs"]))
     f.addStep(FileUpload(slavesrc="docs/reference.html",
                          masterdest="~/public_html/ref.html"))
</pre>
   <p>The <code>masterdest=</code> argument will be passed to os.path.expanduser,
so things like &ldquo;~&rdquo; will be expanded properly. Non-absolute paths
will be interpreted relative to the buildmaster's base directory. 
Likewise, the <code>slavesrc=</code> argument will be expanded and
interpreted relative to the builder's working directory.

   <p>To move a file from the master to the slave, use the
<code>FileDownload</code> command. For example, let's assume that some step
requires a configuration file that, for whatever reason, could not be
recorded in the source code repository or generated on the buildslave
side:

<pre class="example">     from buildbot.steps.shell import ShellCommand
     from buildbot.steps.transfer import FileDownload
     
     f.addStep(FileDownload(mastersrc="~/todays_build_config.txt",
                            slavedest="build_config.txt"))
     f.addStep(ShellCommand(command=["make", "config"]))
</pre>
   <p>Like <code>FileUpload</code>, the <code>mastersrc=</code> argument is interpreted
relative to the buildmaster's base directory, and the
<code>slavedest=</code> argument is relative to the builder's working
directory. If the buildslave is running in <samp><span class="file">~buildslave</span></samp>, and the
builder's &ldquo;builddir&rdquo; is something like <samp><span class="file">tests-i386</span></samp>, then the
workdir is going to be <samp><span class="file">~buildslave/tests-i386/build</span></samp>, and a
<code>slavedest=</code> of <samp><span class="file">foo/bar.html</span></samp> will get put in
<samp><span class="file">~buildslave/tests-i386/build/foo/bar.html</span></samp>. Both of these commands
will create any missing intervening directories.

<h4 class="subheading">Other Parameters</h4>

<p>The <code>maxsize=</code> argument lets you set a maximum size for the file
to be transferred. This may help to avoid surprises: transferring a
100MB coredump when you were expecting to move a 10kB status file
might take an awfully long time. The <code>blocksize=</code> argument
controls how the file is sent over the network: larger blocksizes are
slightly more efficient but also consume more memory on each end, and
there is a hard-coded limit of about 640kB.

   <p>The <code>mode=</code> argument allows you to control the access permissions
of the target file, traditionally expressed as an octal integer. The
most common value is probably 0755, which sets the &ldquo;x&rdquo; executable
bit on the file (useful for shell scripts and the like). The default
value for <code>mode=</code> is None, which means the permission bits will
default to whatever the umask of the writing process is. The default
umask tends to be fairly restrictive, but at least on the buildslave
you can make it less restrictive with a &ndash;umask command-line option at
creation time (see <a href="#Buildslave-Options">Buildslave Options</a>).

   <p>The <code>keepstamp=</code> argument is a boolean that, when True, forces
the modified and accessed time of the destination file to match the
times of the source file.  When False, the modified and accessed times
of the destination file are set to the current time on the buildmaster. 
The default is false.

<h4 class="subheading">Transfering Directories</h4>

<p>To transfer complete directories from the buildslave to the master, there
is a BuildStep named <code>DirectoryUpload</code>. It works like <code>FileUpload</code>,
just for directories. As an example, let's assume a step has
generated project documentation, which consists of many files (like the output
of doxygen or epydoc). We want to move the entire documentation to the
buildmaster, into a <code>~/public_html/docs</code> directory. On the slave-side
the directory can be found under <code>docs</code>:

<pre class="example">     from buildbot.steps.shell import ShellCommand
     from buildbot.steps.transfer import DirectoryUpload
     
     f.addStep(ShellCommand(command=["make", "docs"]))
     f.addStep(DirectoryUpload(slavesrc="docs",
     				masterdest="~/public_html/docs"))
</pre>
   <p>The DirectoryUpload step will create all necessary directories and
transfers empty directories, too.

   <p>The <code>maxsize</code> and <code>blocksize</code> parameters are the same as for
<code>FileUpload</code>, although note that the size of the transferred data is
implementation-dependent, and probably much larger than you expect due to the
encoding used (currently tar).

   <p>The optional <code>compress</code> argument can be given as <code>'gz'</code> or
<code>'bz2'</code> to compress the datastream.

<div class="node">
<a name="Transferring-Strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Running-Commands-on-the-Master">Running Commands on the Master</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Transferring-Files">Transferring Files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.8 Transferring Strings</h4>

<p><a name="index-String-Transfer-125"></a><a name="index-buildbot_002esteps_002etransfer_002eStringDownload-126"></a><a name="index-buildbot_002esteps_002etransfer_002eJSONStringDownload-127"></a><a name="index-buildbot_002esteps_002etransfer_002eJSONPropertiesDownload-128"></a>
Sometimes it is useful to transfer a calculated value from the master
to the slave.  Instead of having to create a temporary file and then
use <code>FileDownload</code>, you can use one of the string download steps.

   <p><code>StringDownload</code> works just like <code>FileDownload</code> except it takes a
single argument, <code>s</code>, representing the string to download instead of a
<code>mastersrc</code> argument.  <code>WithProperties</code> will be properly rendered, if
used in this argument.

   <p><code>JSONStringDownload</code> is similar, except it takes an <code>o</code>
argument, which must be json serializable, and transfers that as a
json-encoded string to the slave.

   <p><code>JSONPropertiesDownload</code> transfers a json-encoded string that
represents a dictionary where <code>properties</code> maps to a dictionary
of build property name to property value; and <code>sourcestamp</code>
represents the build's sourcestamp.

<div class="node">
<a name="Running-Commands-on-the-Master"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Setting-Properties">Setting Properties</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Transferring-Strings">Transferring Strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.9 Running Commands on the Master</h4>

<p><a name="index-buildbot_002esteps_002emaster_002eMasterShellCommand-129"></a>
Occasionally, it is useful to execute some task on the master, for example to
create a directory, deploy a build result, or trigger some other centralized
processing.  This is possible, in a limited fashion, with the
<code>MasterShellCommand</code> step.

   <p>This step operates similarly to a regular <code>ShellCommand</code>, but executes on
the master, instead of the slave.  To be clear, the enclosing <code>Build</code>
object must still have a slave object, just as for any other step &ndash; only, in
this step, the slave does not do anything.

   <p>In this example, the step renames a tarball based on the day of the week.

<pre class="example">     from buildbot.steps.transfer import FileUpload
     from buildbot.steps.master import MasterShellCommand
     
     f.addStep(FileUpload(slavesrc="widgetsoft.tar.gz",
                          masterdest="/var/buildoutputs/widgetsoft-new.tar.gz"))
     f.addStep(MasterShellCommand(command="""
         cd /var/buildoutputs;
         mv widgetsoft-new.tar.gz widgetsoft-`date +%a`.tar.gz"""))
</pre>
   <p>Note that, by default, this step passes a copy of the buildmaster's environment
variables to the subprocess.  To pass an explicit environment instead, add an
<code>env={..}</code> argument.

<div class="node">
<a name="Setting-Properties"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Triggering-Schedulers">Triggering Schedulers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Running-Commands-on-the-Master">Running Commands on the Master</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.10 Setting Properties</h4>

<p><a name="index-buildbot_002esteps_002eslave_002eSetPropertiesFromEnv-130"></a>
In Buildbot-0.8.3 and higher, slaves provide their environment variables to the
master on connect.  These can be copied into Buildbot properties with the
<code>SetPropertiesFromEnv</code> step.  Pass a variable or list of variables in the
<code>variables</code> parameter, then simply use the values as properties in a later
step.

   <p>Note that on Windows, environment variables are case-insensitive, but Buildbot
property names are case sensitive.  The property will have exactly the variable
name you specify, even if the underlying environment variable is capitalized
differently.  If, for example, you use <code>variables=['Tmp']</code>, the result
will be a property named <code>Tmp</code>, even though the environment variable is
displayed as <code>TMP</code> in the Windows GUI.

<pre class="example">     from buildbot.steps.slave import SetPropertiesFromEnv
     from buildbot.steps.shell import Compile
     
     f.addStep(SetPropertiesFromEnv(variables=["SOME_JAVA_LIB_HOME", "JAVAC"]))
     f.addStep(Compile(commands=[WithProperties("%s","JAVAC"), "-cp", WithProperties("%s", "SOME_JAVA_LIB_HOME")))
</pre>
   <p>Note that this step requires that the Buildslave be at least version 0.8.3. 
For previous versions, no environment variables are available (the slave
environment will appear to be empty).

   <p>See also <a href="#SetProperty">SetProperty</a>, which runs a command on the slave and sets a
property based on the result.

<div class="node">
<a name="Triggering-Schedulers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Miscellaneous-BuildSteps">Miscellaneous BuildSteps</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Setting-Properties">Setting Properties</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.11 Triggering Schedulers</h4>

<p><a name="index-buildbot_002esteps_002etrigger_002eTrigger-131"></a>
The counterpart to the Triggerable described in section
see <a href="#Triggerable-Scheduler">Triggerable Scheduler</a> is the Trigger BuildStep.

<pre class="example">     from buildbot.steps.trigger import Trigger
     f.addStep(Trigger(schedulerNames=['build-prep'],
                       waitForFinish=True,
                       updateSourceStamp=True,
                       set_properties={ 'quick' : False },
                       copy_properties=[ 'release_code_name' ]))
</pre>
   <p>The <code>schedulerNames=</code> argument lists the Triggerables
that should be triggered when this step is executed.  Note that
it is possible, but not advisable, to create a cycle where a build
continually triggers itself, because the schedulers are specified
by name.

   <p>If <code>waitForFinish</code> is True, then the step will not finish until
all of the builds from the triggered schedulers have finished. If this
argument is False (the default) or not given, then the buildstep
succeeds immediately after triggering the schedulers.

   <p>The SourceStamp to use for the triggered build is controlled by the arguments
<code>updateSourceStamp</code>, <code>alwaysUseLatest</code>, and <code>sourceStamp</code>. 
If <code>updateSourceStamp</code> is True (the default), then step updates
the SourceStamp given to the Triggerables to include
<code>got_revision</code> (the revision actually used in this build) as
<code>revision</code> (the revision to use in the triggered builds). This is
useful to ensure that all of the builds use exactly the same
SourceStamp, even if other Changes have occurred while the build was
running. If <code>updateSourceStamp</code> is False (and neither of the other
arguments are specified), then the exact same SourceStamp is used. If
<code>alwaysUseLatest</code> is True, then no SourceStamp is given, corresponding to
using the latest revision of the repository specified in the Source step. This
is useful if the triggered builds use to a different source repository. 
<code>sourceStamp</code> accepts a dictionary containing the keys <code>branch</code>,
<code>revision</code>, <code>branch</code>, <code>repository</code>, <code>project</code>, and
optionally <code>patch_level</code>, <code>patch_level</code> and <code>patch_subdir</code> and
creates the corresponding SourceStamp.

   <p>Two parameters allow control of the properties that are passed to the triggered
scheduler.  To simply copy properties verbatim, list them in the
<code>copy_properties</code> parameter.  To set properties explicitly, use the more
sophisticated <code>set_properties</code>, which takes a dictionary mapping property
names to values.  You may use <code>WithProperties</code> here to dynamically
construct new property values.

<div class="node">
<a name="Miscellaneous-BuildSteps"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Writing-New-BuildSteps">Writing New BuildSteps</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Triggering-Schedulers">Triggering Schedulers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.12 Miscellaneous BuildSteps</h4>

<p>A number of steps do not fall into any particular category.

<ul class="menu">
<li><a accesskey="1" href="#HLint">HLint</a>
</ul>

<div class="node">
<a name="HLint"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#Miscellaneous-BuildSteps">Miscellaneous BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.12.1 HLint</h5>

<p><a name="index-buildbot_002esteps_002epython_005ftwisted_002eHLint-132"></a>
The HLint step runs Twisted Lore, a lint-like checker over a set of
<code>.xhtml</code> files.  Any deviations from recommended style is flagged and put
in the output log.

   <p>The step looks at the list of changes in the build to determine which files to
check - it does not check all files.  It specifically excludes any <code>.xhtml</code>
files in the top-level <code>sandbox/</code> directory.

   <p>The step takes a single, optional, parameter: <code>python</code>.  This specifies the
Python executable to use to run Lore.

<pre class="example">     from buildbot.steps.python_twisted import HLint
     f.addStep(HLint())
</pre>
   <div class="node">
<a name="Writing-New-BuildSteps"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Build-Step-Index">Build Step Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Miscellaneous-BuildSteps">Miscellaneous BuildSteps</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.13 Writing New BuildSteps</h4>

<p>While it is a good idea to keep your build process self-contained in
the source code tree, sometimes it is convenient to put more
intelligence into your Buildbot configuration. One way to do this is
to write a custom BuildStep. Once written, this Step can be used in
the <samp><span class="file">master.cfg</span></samp> file.

   <p>The best reason for writing a custom BuildStep is to better parse the
results of the command being run. For example, a BuildStep that knows
about JUnit could look at the logfiles to determine which tests had
been run, how many passed and how many failed, and then report more
detailed information than a simple <code>rc==0</code> -based &ldquo;good/bad&rdquo;
decision.

<ul class="menu">
<li><a accesskey="1" href="#Writing-BuildStep-Constructors">Writing BuildStep Constructors</a>
<li><a accesskey="2" href="#BuildStep-LogFiles">BuildStep LogFiles</a>
<li><a accesskey="3" href="#Reading-Logfiles">Reading Logfiles</a>
<li><a accesskey="4" href="#Adding-LogObservers">Adding LogObservers</a>
<li><a accesskey="5" href="#BuildStep-URLs">BuildStep URLs</a>
</ul>

<div class="node">
<a name="Writing-BuildStep-Constructors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#BuildStep-LogFiles">BuildStep LogFiles</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Writing-New-BuildSteps">Writing New BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.13.1 Writing BuildStep Constructors</h5>

<p>BuildStep classes have some extra equipment, because they are their own
factories.  Consider the use of a BuildStep in <samp><span class="file">master.cfg</span></samp>:

<pre class="example">     f.addStep(MyStep(someopt="stuff", anotheropt=1))
</pre>
   <p>This creates a single instance of class <code>MyStep</code>.  However, Buildbot needs
a new object each time the step is executed.  this is accomplished by storing
the information required to instantiate a new object in the <code>factory</code>
attribute.  When the time comes to construct a new Build, BuildFactory consults
this attribute (via <code>getStepFactory</code>) and instantiates a new step object.

   <p>When writing a new step class, then, keep in mind are that you cannot do
anything "interesting" in the constructor &ndash; limit yourself to checking and
storing arguments.  To ensure that these arguments are provided to any new
objects, call <code>self.addFactoryArguments</code> with any keyword arguments your
constructor needs.

   <p>Keep a <code>**kwargs</code> argument on the end of your options, and pass that up to
the parent class's constructor.

   <p>The whole thing looks like this:

<pre class="example">     class Frobinfy(LoggingBuildStep):
         def __init__(self,
                 frob_what="frobee",
                 frob_how_many=None,
                 frob_how=None,
                 **kwargs):
     
             # check
             if frob_how_many is None:
                 raise TypeError("Frobinfy argument how_many is required")
     
             # call parent
             LoggingBuildStep.__init__(self, **kwargs)
     
             # set Frobnify attributes
             self.frob_what = frob_what
             self.frob_how_many = how_many
             self.frob_how = frob_how
     
             # and record arguments for later
             self.addFactoryArguments(
                 frob_what=frob_what,
                 frob_how_many=frob_how_many,
                 frob_how=frob_how)
     
     class FastFrobnify(Frobnify):
         def __init__(self,
                 speed=5,
                 **kwargs)
             Frobnify.__init__(self, **kwargs)
             self.speed = speed
             self.addFactoryArguments(
                 speed=speed)
</pre>
   <div class="node">
<a name="BuildStep-LogFiles"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Reading-Logfiles">Reading Logfiles</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Writing-BuildStep-Constructors">Writing BuildStep Constructors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Writing-New-BuildSteps">Writing New BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.13.2 BuildStep LogFiles</h5>

<p>Each BuildStep has a collection of &ldquo;logfiles&rdquo;. Each one has a short
name, like &ldquo;stdio&rdquo; or &ldquo;warnings&rdquo;. Each LogFile contains an
arbitrary amount of text, usually the contents of some output file
generated during a build or test step, or a record of everything that
was printed to stdout/stderr during the execution of some command.

   <p>These LogFiles are stored to disk, so they can be retrieved later.

   <p>Each can contain multiple &ldquo;channels&rdquo;, generally limited to three
basic ones: stdout, stderr, and &ldquo;headers&rdquo;. For example, when a
ShellCommand runs, it writes a few lines to the &ldquo;headers&rdquo; channel to
indicate the exact argv strings being run, which directory the command
is being executed in, and the contents of the current environment
variables. Then, as the command runs, it adds a lot of &ldquo;stdout&rdquo; and
&ldquo;stderr&rdquo; messages. When the command finishes, a final &ldquo;header&rdquo;
line is added with the exit code of the process.

   <p>Status display plugins can format these different channels in
different ways. For example, the web page shows LogFiles as text/html,
with header lines in blue text, stdout in black, and stderr in red. A
different URL is available which provides a text/plain format, in
which stdout and stderr are collapsed together, and header lines are
stripped completely. This latter option makes it easy to save the
results to a file and run <samp><span class="command">grep</span></samp> or whatever against the
output.

   <p>Each BuildStep contains a mapping (implemented in a python dictionary)
from LogFile name to the actual LogFile objects. Status plugins can
get a list of LogFiles to display, for example, a list of HREF links
that, when clicked, provide the full contents of the LogFile.

<h3 class="heading">Using LogFiles in custom BuildSteps</h3>

<p>The most common way for a custom BuildStep to use a LogFile is to
summarize the results of a ShellCommand (after the command has
finished running). For example, a compile step with thousands of lines
of output might want to create a summary of just the warning messages. 
If you were doing this from a shell, you would use something like:

<pre class="example">     grep "warning:" output.log &gt;warnings.log
</pre>
   <p>In a custom BuildStep, you could instead create a &ldquo;warnings&rdquo; LogFile
that contained the same text. To do this, you would add code to your
<code>createSummary</code> method that pulls lines from the main output log
and creates a new LogFile with the results:

<pre class="example">         import StringIO
         def createSummary(self, log):
             warnings = []
             sio = StringIO.StringIO(log.getText())
             for line in sio.readlines():
                 if "warning:" in line:
                     warnings.append()
             self.addCompleteLog('warnings', "".join(warnings))
</pre>
   <p>This example uses the <code>addCompleteLog</code> method, which creates a
new LogFile, puts some text in it, and then &ldquo;closes&rdquo; it, meaning
that no further contents will be added. This LogFile will appear in
the HTML display under an HREF with the name &ldquo;warnings&rdquo;, since that
is the name of the LogFile.

   <p>You can also use <code>addHTMLLog</code> to create a complete (closed)
LogFile that contains HTML instead of plain text. The normal LogFile
will be HTML-escaped if presented through a web page, but the HTML
LogFile will not. At the moment this is only used to present a pretty
HTML representation of an otherwise ugly exception traceback when
something goes badly wrong during the BuildStep.

   <p>In contrast, you might want to create a new LogFile at the beginning
of the step, and add text to it as the command runs. You can create
the LogFile and attach it to the build by calling <code>addLog</code>, which
returns the LogFile object. You then add text to this LogFile by
calling methods like <code>addStdout</code> and <code>addHeader</code>. When you
are done, you must call the <code>finish</code> method so the LogFile can be
closed. It may be useful to create and populate a LogFile like this
from a LogObserver method See <a href="#Adding-LogObservers">Adding LogObservers</a>.

   <p>The <code>logfiles=</code> argument to <code>ShellCommand</code> (see
see <a href="#ShellCommand">ShellCommand</a>) creates new LogFiles and fills them in realtime
by asking the buildslave to watch a actual file on disk. The
buildslave will look for additions in the target file and report them
back to the BuildStep. These additions will be added to the LogFile by
calling <code>addStdout</code>. These secondary LogFiles can be used as the
source of a LogObserver just like the normal &ldquo;stdio&rdquo; LogFile.

<div class="node">
<a name="Reading-Logfiles"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Adding-LogObservers">Adding LogObservers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#BuildStep-LogFiles">BuildStep LogFiles</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Writing-New-BuildSteps">Writing New BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.13.3 Reading Logfiles</h5>

<p>Once a LogFile has been added to a BuildStep with <code>addLog()</code>,
<code>addCompleteLog()</code>, <code>addHTMLLog()</code>, or <code>logfiles=</code>,
your BuildStep can retrieve it by using <code>getLog()</code>:

<pre class="example">     class MyBuildStep(ShellCommand):
         logfiles = { "nodelog": "_test/node.log" }
     
         def evaluateCommand(self, cmd):
             nodelog = self.getLog("nodelog")
             if "STARTED" in nodelog.getText():
                 return SUCCESS
             else:
                 return FAILURE
</pre>
   <p>For a complete list of the methods you can call on a LogFile, please
see the docstrings on the <code>IStatusLog</code> class in
<samp><span class="file">buildbot/interfaces.py</span></samp>.

<div class="node">
<a name="Adding-LogObservers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#BuildStep-URLs">BuildStep URLs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Reading-Logfiles">Reading Logfiles</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Writing-New-BuildSteps">Writing New BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.13.4 Adding LogObservers</h5>

<p><a name="index-LogObserver-133"></a><a name="index-LogLineObserver-134"></a>
Most shell commands emit messages to stdout or stderr as they operate,
especially if you ask them nicely with a <code>--verbose</code> flag of some
sort. They may also write text to a log file while they run. Your
BuildStep can watch this output as it arrives, to keep track of how
much progress the command has made. You can get a better measure of
progress by counting the number of source files compiled or test cases
run than by merely tracking the number of bytes that have been written
to stdout. This improves the accuracy and the smoothness of the ETA
display.

   <p>To accomplish this, you will need to attach a <code>LogObserver</code> to
one of the log channels, most commonly to the &ldquo;stdio&rdquo; channel but
perhaps to another one which tracks a log file. This observer is given
all text as it is emitted from the command, and has the opportunity to
parse that output incrementally. Once the observer has decided that
some event has occurred (like a source file being compiled), it can
use the <code>setProgress</code> method to tell the BuildStep about the
progress that this event represents.

   <p>There are a number of pre-built <code>LogObserver</code> classes that you
can choose from (defined in <code>buildbot.process.buildstep</code>, and of
course you can subclass them to add further customization. The
<code>LogLineObserver</code> class handles the grunt work of buffering and
scanning for end-of-line delimiters, allowing your parser to operate
on complete stdout/stderr lines. (Lines longer than a set maximum
length are dropped; the maximum defaults to 16384 bytes, but you can
change it by calling <code>setMaxLineLength()</code> on your
<code>LogLineObserver</code> instance.  Use <code>sys.maxint</code> for effective
infinity.)

   <p>For example, let's take a look at the <code>TrialTestCaseCounter</code>, which is
used by the Trial step (see <a href="#Trial">Trial</a>) to count test cases as they are
run.  As Trial executes, it emits lines like the following:

<pre class="example">     buildbot.test.test_config.ConfigTest.testDebugPassword ... [OK]
     buildbot.test.test_config.ConfigTest.testEmpty ... [OK]
     buildbot.test.test_config.ConfigTest.testIRC ... [FAIL]
     buildbot.test.test_config.ConfigTest.testLocks ... [OK]
</pre>
   <p>When the tests are finished, trial emits a long line of &ldquo;======&rdquo; and
then some lines which summarize the tests that failed. We want to
avoid parsing these trailing lines, because their format is less
well-defined than the &ldquo;[OK]&rdquo; lines.

   <p>The parser class looks like this:

<pre class="example">     from buildbot.process.buildstep import LogLineObserver
     
     class TrialTestCaseCounter(LogLineObserver):
         _line_re = re.compile(r'^([\w\.]+) \.\.\. \[([^\]]+)\]$')
         numTests = 0
         finished = False
     
         def outLineReceived(self, line):
             if self.finished:
                 return
             if line.startswith("=" * 40):
                 self.finished = True
                 return
     
             m = self._line_re.search(line.strip())
             if m:
                 testname, result = m.groups()
                 self.numTests += 1
                 self.step.setProgress('tests', self.numTests)
</pre>
   <p>This parser only pays attention to stdout, since that's where trial
writes the progress lines. It has a mode flag named <code>finished</code> to
ignore everything after the &ldquo;====&rdquo; marker, and a scary-looking
regular expression to match each line while hopefully ignoring other
messages that might get displayed as the test runs.

   <p>Each time it identifies a test has been completed, it increments its
counter and delivers the new progress value to the step with
<code>self.step.setProgress</code>. This class is specifically measuring
progress along the &ldquo;tests&rdquo; metric, in units of test cases (as
opposed to other kinds of progress like the &ldquo;output&rdquo; metric, which
measures in units of bytes). The Progress-tracking code uses each
progress metric separately to come up with an overall completion
percentage and an ETA value.

   <p>To connect this parser into the <code>Trial</code> BuildStep,
<code>Trial.__init__</code> ends with the following clause:

<pre class="example">             # this counter will feed Progress along the 'test cases' metric
             counter = TrialTestCaseCounter()
             self.addLogObserver('stdio', counter)
             self.progressMetrics += ('tests',)
</pre>
   <p>This creates a TrialTestCaseCounter and tells the step that the
counter wants to watch the &ldquo;stdio&rdquo; log. The observer is
automatically given a reference to the step in its <code>.step</code>
attribute.

<h4 class="subheading">A Somewhat Whimsical Example</h4>

<p>Let's say that we've got some snazzy new unit-test framework called
Framboozle. It's the hottest thing since sliced bread. It slices, it
dices, it runs unit tests like there's no tomorrow. Plus if your unit
tests fail, you can use its name for a Web 2.1 startup company, make
millions of dollars, and hire engineers to fix the bugs for you, while
you spend your afternoons lazily hang-gliding along a scenic pacific
beach, blissfully unconcerned about the state of your
tests.<a rel="footnote" href="#fn-6" name="fnd-6"><sup>6</sup></a>

   <p>To run a Framboozle-enabled test suite, you just run the 'framboozler'
command from the top of your source code tree. The 'framboozler'
command emits a bunch of stuff to stdout, but the most interesting bit
is that it emits the line "FNURRRGH!" every time it finishes running a
test case<a rel="footnote" href="#fn-7" name="fnd-7"><sup>7</sup></a>. You'd like to have a test-case counting LogObserver that
watches for these lines and counts them, because counting them will
help the buildbot more accurately calculate how long the build will
take, and this will let you know exactly how long you can sneak out of
the office for your hang-gliding lessons without anyone noticing that
you're gone.

   <p>This will involve writing a new BuildStep (probably named
"Framboozle") which inherits from ShellCommand. The BuildStep class
definition itself will look something like this:

<pre class="example">     # START
     from buildbot.steps.shell import ShellCommand
     from buildbot.process.buildstep import LogLineObserver
     
     class FNURRRGHCounter(LogLineObserver):
         numTests = 0
         def outLineReceived(self, line):
             if "FNURRRGH!" in line:
                 self.numTests += 1
                 self.step.setProgress('tests', self.numTests)
     
     class Framboozle(ShellCommand):
         command = ["framboozler"]
     
         def __init__(self, **kwargs):
             ShellCommand.__init__(self, **kwargs)   # always upcall!
             counter = FNURRRGHCounter())
             self.addLogObserver('stdio', counter)
             self.progressMetrics += ('tests',)
     # FINISH
</pre>
   <p>So that's the code that we want to wind up using. How do we actually
deploy it?

   <p>You have a couple of different options.

   <p>Option 1: The simplest technique is to simply put this text
(everything from START to FINISH) in your master.cfg file, somewhere
before the BuildFactory definition where you actually use it in a
clause like:

<pre class="example">     f = BuildFactory()
     f.addStep(SVN(svnurl="stuff"))
     f.addStep(Framboozle())
</pre>
   <p>Remember that master.cfg is secretly just a python program with one
job: populating the BuildmasterConfig dictionary. And python programs
are allowed to define as many classes as they like. So you can define
classes and use them in the same file, just as long as the class is
defined before some other code tries to use it.

   <p>This is easy, and it keeps the point of definition very close to the
point of use, and whoever replaces you after that unfortunate
hang-gliding accident will appreciate being able to easily figure out
what the heck this stupid "Framboozle" step is doing anyways. The
downside is that every time you reload the config file, the Framboozle
class will get redefined, which means that the buildmaster will think
that you've reconfigured all the Builders that use it, even though
nothing changed. Bleh.

   <p>Option 2: Instead, we can put this code in a separate file, and import
it into the master.cfg file just like we would the normal buildsteps
like ShellCommand and SVN.

   <p>Create a directory named ~/lib/python, put everything from START to
FINISH in ~/lib/python/framboozle.py, and run your buildmaster using:

<pre class="example">      PYTHONPATH=~/lib/python buildbot start MASTERDIR
</pre>
   <p>or use the <samp><span class="file">Makefile.buildbot</span></samp> to control the way
<samp><span class="command">buildbot start</span></samp> works. Or add something like this to
something like your ~/.bashrc or ~/.bash_profile or ~/.cshrc:

<pre class="example">      export PYTHONPATH=~/lib/python
</pre>
   <p>Once we've done this, our master.cfg can look like:

<pre class="example">     from framboozle import Framboozle
     f = BuildFactory()
     f.addStep(SVN(svnurl="stuff"))
     f.addStep(Framboozle())
</pre>
   <p>or:

<pre class="example">     import framboozle
     f = BuildFactory()
     f.addStep(SVN(svnurl="stuff"))
     f.addStep(framboozle.Framboozle())
</pre>
   <p>(check out the python docs for details about how "import" and "from A
import B" work).

   <p>What we've done here is to tell python that every time it handles an
"import" statement for some named module, it should look in our
~/lib/python/ for that module before it looks anywhere else. After our
directories, it will try in a bunch of standard directories too
(including the one where buildbot is installed). By setting the
PYTHONPATH environment variable, you can add directories to the front
of this search list.

   <p>Python knows that once it "import"s a file, it doesn't need to
re-import it again. This means that reconfiguring the buildmaster
(with "buildbot reconfig", for example) won't make it think the
Framboozle class has changed every time, so the Builders that use it
will not be spuriously restarted. On the other hand, you either have
to start your buildmaster in a slightly weird way, or you have to
modify your environment to set the PYTHONPATH variable.

   <p>Option 3: Install this code into a standard python library directory

   <p>Find out what your python's standard include path is by asking it:

<pre class="example">     80:warner@luther% python
     Python 2.4.4c0 (#2, Oct  2 2006, 00:57:46)
     [GCC 4.1.2 20060928 (prerelease) (Debian 4.1.1-15)] on linux2
     Type "help", "copyright", "credits" or "license" for more information.
     &gt;&gt;&gt; import sys
     &gt;&gt;&gt; import pprint
     &gt;&gt;&gt; pprint.pprint(sys.path)
     ['',
      '/usr/lib/python24.zip',
      '/usr/lib/python2.4',
      '/usr/lib/python2.4/plat-linux2',
      '/usr/lib/python2.4/lib-tk',
      '/usr/lib/python2.4/lib-dynload',
      '/usr/local/lib/python2.4/site-packages',
      '/usr/lib/python2.4/site-packages',
      '/usr/lib/python2.4/site-packages/Numeric',
      '/var/lib/python-support/python2.4',
      '/usr/lib/site-python']
</pre>
   <p>In this case, putting the code into
/usr/local/lib/python2.4/site-packages/framboozle.py would work just
fine. We can use the same master.cfg "import framboozle" statement as
in Option 2. By putting it in a standard include directory (instead of
the decidedly non-standard ~/lib/python), we don't even have to set
PYTHONPATH to anything special. The downside is that you probably have
to be root to write to one of those standard include directories.

   <p>Option 4: Submit the code for inclusion in the Buildbot distribution

   <p>Make a fork of buildbot on http://github.com/djmitche/buildbot or post a patch
in a bug at http://buildbot.net.  In either case, post a note about your patch
to the mailing list, so others can provide feedback and, eventually, commit it.

<pre class="example">     from buildbot.steps import framboozle
     f = BuildFactory()
     f.addStep(SVN(svnurl="stuff"))
     f.addStep(framboozle.Framboozle())
</pre>
   <p>And then you don't even have to install framboozle.py anywhere on your
system, since it will ship with Buildbot. You don't have to be root,
you don't have to set PYTHONPATH. But you do have to make a good case
for Framboozle being worth going into the main distribution, you'll
probably have to provide docs and some unit test cases, you'll need to
figure out what kind of beer the author likes, and then you'll have to
wait until the next release. But in some environments, all this is
easier than getting root on your buildmaster box, so the tradeoffs may
actually be worth it.

   <p>Putting the code in master.cfg (1) makes it available to that
buildmaster instance. Putting it in a file in a personal library
directory (2) makes it available for any buildmasters you might be
running. Putting it in a file in a system-wide shared library
directory (3) makes it available for any buildmasters that anyone on
that system might be running. Getting it into the buildbot's upstream
repository (4) makes it available for any buildmasters that anyone in
the world might be running. It's all a matter of how widely you want
to deploy that new class.

<div class="node">
<a name="BuildStep-URLs"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Adding-LogObservers">Adding LogObservers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Writing-New-BuildSteps">Writing New BuildSteps</a>

</div>

<h5 class="subsubsection">4.12.13.5 BuildStep URLs</h5>

<p><a name="index-links-135"></a><a name="index-BuildStep-URLs-136"></a><a name="index-addURL-137"></a>
Each BuildStep has a collection of &ldquo;links&rdquo;. Like its collection of
LogFiles, each link has a name and a target URL. The web status page
creates HREFs for each link in the same box as it does for LogFiles,
except that the target of the link is the external URL instead of an
internal link to a page that shows the contents of the LogFile.

   <p>These external links can be used to point at build information hosted
on other servers. For example, the test process might produce an
intricate description of which tests passed and failed, or some sort
of code coverage data in HTML form, or a PNG or GIF image with a graph
of memory usage over time. The external link can provide an easy way
for users to navigate from the buildbot's status page to these
external web sites or file servers. Note that the step itself is
responsible for insuring that there will be a document available at
the given URL (perhaps by using <samp><span class="command">scp</span></samp> to copy the HTML output
to a <samp><span class="file">~/public_html/</span></samp> directory on a remote web server). Calling
<code>addURL</code> does not magically populate a web server.

   <p>To set one of these links, the BuildStep should call the <code>addURL</code>
method with the name of the link and the target URL. Multiple URLs can
be set.

   <p>In this example, we assume that the <samp><span class="command">make test</span></samp> command causes
a collection of HTML files to be created and put somewhere on the
coverage.example.org web server, in a filename that incorporates the
build number.

<pre class="example">     class TestWithCodeCoverage(BuildStep):
         command = ["make", "test",
                    WithProperties("buildnum=%s", "buildnumber")]
     
         def createSummary(self, log):
             buildnumber = self.getProperty("buildnumber")
             url = "http://coverage.example.org/builds/%s.html" % buildnumber
             self.addURL("coverage", url)
</pre>
   <p>You might also want to extract the URL from some special message
output by the build process itself:

<pre class="example">     class TestWithCodeCoverage(BuildStep):
         command = ["make", "test",
                    WithProperties("buildnum=%s", "buildnumber")]
     
         def createSummary(self, log):
             output = StringIO(log.getText())
             for line in output.readlines():
                 if line.startswith("coverage-url:"):
                     url = line[len("coverage-url:"):].strip()
                     self.addURL("coverage", url)
                     return
</pre>
   <p>Note that a build process which emits both stdout and stderr might
cause this line to be split or interleaved between other lines. It
might be necessary to restrict the getText() call to only stdout with
something like this:

<pre class="example">             output = StringIO("".join([c[1]
                                        for c in log.getChunks()
                                        if c[0] == LOG_CHANNEL_STDOUT]))
</pre>
   <p>Of course if the build is run under a PTY, then stdout and stderr will
be merged before the buildbot ever sees them, so such interleaving
will be unavoidable.

<div class="node">
<a name="Build-Step-Index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Writing-New-BuildSteps">Writing New BuildSteps</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Build-Steps">Build Steps</a>

</div>

<h4 class="subsection">4.12.14 Build Step Index</h4>



<ul class="index-bs" compact>
<li><a href="#index-buildbot_002esteps_002emaster_002eMasterShellCommand-129"><code>buildbot.steps.master.MasterShellCommand</code></a>: <a href="#Running-Commands-on-the-Master">Running Commands on the Master</a></li>
<li><a href="#index-buildbot_002esteps_002epython_002eBuildEPYDoc-116"><code>buildbot.steps.python.BuildEPYDoc</code></a>: <a href="#BuildEPYDoc">BuildEPYDoc</a></li>
<li><a href="#index-buildbot_002esteps_002epython_002ePyFlakes-117"><code>buildbot.steps.python.PyFlakes</code></a>: <a href="#PyFlakes">PyFlakes</a></li>
<li><a href="#index-buildbot_002esteps_002epython_002ePyLint-118"><code>buildbot.steps.python.PyLint</code></a>: <a href="#PyLint">PyLint</a></li>
<li><a href="#index-buildbot_002esteps_002epython_005ftwisted_002eHLint-132"><code>buildbot.steps.python_twisted.HLint</code></a>: <a href="#HLint">HLint</a></li>
<li><a href="#index-buildbot_002esteps_002epython_005ftwisted_002eRemovePYCs-120"><code>buildbot.steps.python_twisted.RemovePYCs</code></a>: <a href="#RemovePYCs">RemovePYCs</a></li>
<li><a href="#index-buildbot_002esteps_002epython_005ftwisted_002eTrial-119"><code>buildbot.steps.python_twisted.Trial</code></a>: <a href="#Trial">Trial</a></li>
<li><a href="#index-buildbot_002esteps_002eshell_002eCompile-103"><code>buildbot.steps.shell.Compile</code></a>: <a href="#Compile">Compile</a></li>
<li><a href="#index-buildbot_002esteps_002eshell_002eConfigure-102"><code>buildbot.steps.shell.Configure</code></a>: <a href="#Configure">Configure</a></li>
<li><a href="#index-buildbot_002esteps_002eshell_002ePerlModuleTest-113"><code>buildbot.steps.shell.PerlModuleTest</code></a>: <a href="#PerlModuleTest">PerlModuleTest</a></li>
<li><a href="#index-buildbot_002esteps_002eshell_002eSetProperty-114"><code>buildbot.steps.shell.SetProperty</code></a>: <a href="#SetProperty">SetProperty</a></li>
<li><a href="#index-buildbot_002esteps_002eshell_002eShellCommand-101"><code>buildbot.steps.shell.ShellCommand</code></a>: <a href="#Using-ShellCommands">Using ShellCommands</a></li>
<li><a href="#index-buildbot_002esteps_002eshell_002eTest-111"><code>buildbot.steps.shell.Test</code></a>: <a href="#Test">Test</a></li>
<li><a href="#index-buildbot_002esteps_002eshell_002eTreeSize-112"><code>buildbot.steps.shell.TreeSize</code></a>: <a href="#TreeSize">TreeSize</a></li>
<li><a href="#index-buildbot_002esteps_002eslave_002eSetPropertiesFromEnv-130"><code>buildbot.steps.slave.SetPropertiesFromEnv</code></a>: <a href="#Setting-Properties">Setting Properties</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eBK-96"><code>buildbot.steps.source.BK</code></a>: <a href="#BitKeeper">BitKeeper</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eBzr-90"><code>buildbot.steps.source.Bzr</code></a>: <a href="#Bzr">Bzr</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eCVS-82"><code>buildbot.steps.source.CVS</code></a>: <a href="#CVS">CVS</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eDarcs-86"><code>buildbot.steps.source.Darcs</code></a>: <a href="#Darcs">Darcs</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eGit-94"><code>buildbot.steps.source.Git</code></a>: <a href="#Git">Git</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eMercurial-88"><code>buildbot.steps.source.Mercurial</code></a>: <a href="#Mercurial">Mercurial</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eMonotone-100"><code>buildbot.steps.source.Monotone</code></a>: <a href="#Monotone">Monotone</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eP4-92"><code>buildbot.steps.source.P4</code></a>: <a href="#P4">P4</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eRepo-98"><code>buildbot.steps.source.Repo</code></a>: <a href="#Repo">Repo</a></li>
<li><a href="#index-buildbot_002esteps_002esource_002eSVN-84"><code>buildbot.steps.source.SVN</code></a>: <a href="#SVN">SVN</a></li>
<li><a href="#index-buildbot_002esteps_002esubunit_002eSubunitShellCommand-115"><code>buildbot.steps.subunit.SubunitShellCommand</code></a>: <a href="#SubunitShellCommand">SubunitShellCommand</a></li>
<li><a href="#index-buildbot_002esteps_002etransfer_002eDirectoryUpload-124"><code>buildbot.steps.transfer.DirectoryUpload</code></a>: <a href="#Transferring-Files">Transferring Files</a></li>
<li><a href="#index-buildbot_002esteps_002etransfer_002eFileDownload-123"><code>buildbot.steps.transfer.FileDownload</code></a>: <a href="#Transferring-Files">Transferring Files</a></li>
<li><a href="#index-buildbot_002esteps_002etransfer_002eFileUpload-122"><code>buildbot.steps.transfer.FileUpload</code></a>: <a href="#Transferring-Files">Transferring Files</a></li>
<li><a href="#index-buildbot_002esteps_002etransfer_002eJSONPropertiesDownload-128"><code>buildbot.steps.transfer.JSONPropertiesDownload</code></a>: <a href="#Transferring-Strings">Transferring Strings</a></li>
<li><a href="#index-buildbot_002esteps_002etransfer_002eJSONStringDownload-127"><code>buildbot.steps.transfer.JSONStringDownload</code></a>: <a href="#Transferring-Strings">Transferring Strings</a></li>
<li><a href="#index-buildbot_002esteps_002etransfer_002eStringDownload-126"><code>buildbot.steps.transfer.StringDownload</code></a>: <a href="#Transferring-Strings">Transferring Strings</a></li>
<li><a href="#index-buildbot_002esteps_002etrigger_002eTrigger-131"><code>buildbot.steps.trigger.Trigger</code></a>: <a href="#Triggering-Schedulers">Triggering Schedulers</a></li>
<li><a href="#index-buildbot_002esteps_002evstudio_002eVC6-104"><code>buildbot.steps.vstudio.VC6</code></a>: <a href="#Visual-C_002b_002b">Visual C++</a></li>
<li><a href="#index-buildbot_002esteps_002evstudio_002eVC7-105"><code>buildbot.steps.vstudio.VC7</code></a>: <a href="#Visual-C_002b_002b">Visual C++</a></li>
<li><a href="#index-buildbot_002esteps_002evstudio_002eVC8-106"><code>buildbot.steps.vstudio.VC8</code></a>: <a href="#Visual-C_002b_002b">Visual C++</a></li>
<li><a href="#index-buildbot_002esteps_002evstudio_002eVCExpress9-110"><code>buildbot.steps.vstudio.VCExpress9</code></a>: <a href="#Visual-C_002b_002b">Visual C++</a></li>
<li><a href="#index-buildbot_002esteps_002evstudio_002eVS2003-107"><code>buildbot.steps.vstudio.VS2003</code></a>: <a href="#Visual-C_002b_002b">Visual C++</a></li>
<li><a href="#index-buildbot_002esteps_002evstudio_002eVS2005-108"><code>buildbot.steps.vstudio.VS2005</code></a>: <a href="#Visual-C_002b_002b">Visual C++</a></li>
<li><a href="#index-buildbot_002esteps_002evstudio_002eVS2008-109"><code>buildbot.steps.vstudio.VS2008</code></a>: <a href="#Visual-C_002b_002b">Visual C++</a></li>
   </ul><div class="node">
<a name="Interlocks"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Status-Targets">Status Targets</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Build-Steps">Build Steps</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.13 Interlocks</h3>

<p><a name="index-locks-138"></a>
Until now, we assumed that a master can run builds at any slave whenever
needed or desired.  Some times, you want to enforce additional constraints on
builds. For reasons like limited network bandwidth, old slave machines, or a
self-willed data base server, you may want to limit the number of builds (or
build steps) that can access a resource.

<h3 class="heading">Access Modes</h3>

<p>The mechanism used by Buildbot is known as the read/write lock.<a rel="footnote" href="#fn-8" name="fnd-8"><sup>8</sup></a> It
allows either many readers or a single writer but not a combination of readers
and writers. The general lock has been modified and extended for use in
Buildbot. Firstly, the general lock allows an infinite number of readers. In
Buildbot, we often want to put an upper limit on the number of readers, for
example allowing two out of five possible builds at the same time. To do this,
the lock counts the number of active readers. Secondly, the terms <em>read
mode</em> and <em>write mode</em> are confusing in Buildbot context. They have been
replaced by <em>counting mode</em> (since the lock counts them) and <em>exclusive
mode</em>.  As a result of these changes, locks in Buildbot allow a number of
builds (upto some fixed number) in counting mode, or they allow one build in
exclusive mode.

   <p>Note that access modes are specified when a lock is used.  That is, it is
possible to have a single lock that is used by several slaves in counting mode,
and several slaves in exclusive mode.  In fact, this is the strength of the
modes: accessing a lock in exclusive mode will prevent all counting-mode
accesses.

<h3 class="heading">Count</h3>

<p>Often, not all slaves are equal. To allow for this situation, Buildbot allows
to have a separate upper limit on the count for each slave. In this way, you
can have at most 3 concurrent builds at a fast slave, 2 at a slightly older
slave, and 1 at all other slaves.

<h3 class="heading">Scope</h3>

<p>The final thing you can specify when you introduce a new lock is its scope. 
Some constraints are global &ndash; they must be enforced over all slaves. Other
constraints are local to each slave.  A <em>master lock</em> is used for the
global constraints. You can ensure for example that at most one build (of all
builds running at all slaves) accesses the data base server. With a
<em>slave lock</em> you can add a limit local to each slave. With such a lock,
you can for example enforce an upper limit to the number of active builds at a
slave, like above.

<h3 class="heading">Examples</h3>

<p>Time for a few examples. Below a master lock is defined to protect a data base,
and a slave lock is created to limit the number of builds at each slave.

<pre class="example">     from buildbot import locks
     
     db_lock = locks.MasterLock("database")
     build_lock = locks.SlaveLock("slave_builds",
                                  maxCount = 1,
                                  maxCountForSlave = { 'fast': 3, 'new': 2 })
</pre>
   <p>After importing locks from buildbot, <code>db_lock</code> is defined to be a master
lock. The <code>"database"</code> string is used for uniquely identifying the lock. 
At the next line, a slave lock called <code>build_lock</code> is created. It is
identified by the <code>"slave_builds"</code> string. Since the requirements of the
lock are a bit more complicated, two optional arguments are also specified. The
<code>maxCount</code> parameter sets the default limit for builds in counting mode to
<code>1</code>. For the slave called <code>'fast'</code> however, we want to have at most
three builds, and for the slave called <code>'new'</code> the upper limit is two
builds running at the same time.

   <p>The next step is accessing the locks in builds.  Buildbot allows a lock to be used
during an entire build (from beginning to end), or only during a single build
step. In the latter case, the lock is claimed for use just before the step
starts, and released again when the step ends. To prevent
deadlocks,<a rel="footnote" href="#fn-9" name="fnd-9"><sup>9</sup></a> it is not possible to claim or release
locks at other times.

   <p>To use locks, you add them with a <code>locks</code> argument to a build or a step. 
Each use of a lock is either in counting mode (that is, possibly shared with
other builds) or in exclusive mode, and this is indicated with the syntax <code>lock.access(mode)</code>, where <code>mode</code> is one of <code>"counting"</code> or <code>"shared"</code>.

   <p>A build or build step proceeds only when it has acquired all locks. If a build
or step needs a lot of locks, it may be starved<a rel="footnote" href="#fn-10" name="fnd-10"><sup>10</sup></a> by other builds that need
fewer locks.

   <p>To illustrate use of locks, a few examples.

<pre class="example">     from buildbot import locks
     from buildbot.steps import source, shell
     from buildbot.process import factory
     
     db_lock = locks.MasterLock("database")
     build_lock = locks.SlaveLock("slave_builds",
                                  maxCount = 1,
                                  maxCountForSlave = { 'fast': 3, 'new': 2 })
     
     f = factory.BuildFactory()
     f.addStep(source.SVN(svnurl="http://example.org/svn/Trunk"))
     f.addStep(shell.ShellCommand(command="make all"))
     f.addStep(shell.ShellCommand(command="make test",
                                  locks=[db_lock.access('exclusive')]))
     
     b1 = {'name': 'full1', 'slavename': 'fast',  'builddir': 'f1', 'factory': f,
            'locks': [build_lock.access('counting')] }
     
     b2 = {'name': 'full2', 'slavename': 'new',   'builddir': 'f2', 'factory': f,
            'locks': [build_lock.access('counting')] }
     
     b3 = {'name': 'full3', 'slavename': 'old',   'builddir': 'f3', 'factory': f,
            'locks': [build_lock.access('counting')] }
     
     b4 = {'name': 'full4', 'slavename': 'other', 'builddir': 'f4', 'factory': f,
            'locks': [build_lock.access('counting')] }
     
     c['builders'] = [b1, b2, b3, b4]
</pre>
   <p>Here we have four slaves <code>b1</code>, <code>b2</code>, <code>b3</code>, and <code>b4</code>. Each
slave performs the same checkout, make, and test build step sequence. 
We want to enforce that at most one test step is executed between all slaves due
to restrictions with the data base server. This is done by adding the
<code>locks=</code> parameter with the third step. It takes a list of locks with their
access mode. In this case only the <code>db_lock</code> is needed. The exclusive
access mode is used to ensure there is at most one slave that executes the test
step.

   <p>In addition to exclusive accessing the data base, we also want slaves to stay
responsive even under the load of a large number of builds being triggered. 
For this purpose, the slave lock called <code>build_lock</code> is defined. Since
the restraint holds for entire builds, the lock is specified in the builder
with <code>'locks': [build_lock.access('counting')]</code>.

   <p>Note that you will occasionally see <code>lock.access(mode)</code> written as
<code>LockAccess(lock, mode)</code>.  The two are equivalent, but the former is
preferred.

<div class="node">
<a name="Status-Targets"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Configuration-Index">Configuration Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Interlocks">Interlocks</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.14 Status Targets</h3>

<p>The Buildmaster has a variety of ways to present build status to
various users. Each such delivery method is a &ldquo;Status Target&rdquo; object
in the configuration's <code>status</code> list. To add status targets, you
just append more objects to this list:

   <p><a name="index-c_005b_0027status_0027_005d-139"></a>
<pre class="example">     c['status'] = []
     
     from buildbot.status import html
     c['status'].append(html.Waterfall(http_port=8010))
     
     from buildbot.status import mail
     m = mail.MailNotifier(fromaddr="buildbot@localhost",
                           extraRecipients=["builds@lists.example.com"],
                           sendToInterestedUsers=False)
     c['status'].append(m)
     
     from buildbot.status import words
     c['status'].append(words.IRC(host="irc.example.com", nick="bb",
                                  channels=[{"channel": "#example1"},
                                            {"channel": "#example2",
                                             "password": "somesecretpassword"}]))
</pre>
   <p>Most status delivery objects take a <code>categories=</code> argument, which
can contain a list of &ldquo;category&rdquo; names: in this case, it will only
show status for Builders that are in one of the named categories.

<h3 class="heading">Implementation Note</h3>

<p>Each of these objects should be a service.MultiService which will be attached
to the BuildMaster object when the configuration is processed. They should use
<code>self.parent.getStatus()</code> to get access to the top-level IStatus object,
either inside <code>startService</code> or later. They may call
<code>status.subscribe()</code> in <code>startService</code> to receive notifications of
builder events, in which case they must define <code>builderAdded</code> and related
methods. See the docstrings in <samp><span class="file">buildbot/interfaces.py</span></samp> for full details.

<ul class="menu">
<li><a accesskey="1" href="#WebStatus">WebStatus</a>
<li><a accesskey="2" href="#MailNotifier">MailNotifier</a>
<li><a accesskey="3" href="#IRC-Bot">IRC Bot</a>
<li><a accesskey="4" href="#PBListener">PBListener</a>
<li><a accesskey="5" href="#StatusPush">StatusPush</a>
<li><a accesskey="6" href="#HttpStatusPush">HttpStatusPush</a>
<li><a accesskey="7" href="#GerritStatusPush">GerritStatusPush</a>
<li><a accesskey="8" href="#Writing-New-Status-Plugins">Writing New Status Plugins</a>
<li><a accesskey="9" href="#Status-Target-Index">Status Target Index</a>
</ul>

<div class="node">
<a name="WebStatus"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#MailNotifier">MailNotifier</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Status-Targets">Status Targets</a>

</div>

<h4 class="subsection">4.14.1 WebStatus</h4>

<p><a name="index-WebStatus-140"></a><a name="index-buildbot_002estatus_002eweb_002ebaseweb_002eWebStatus-141"></a>
The <code>buildbot.status.html.WebStatus</code> status target runs a small
web server inside the buildmaster. You can point a browser at this web
server and retrieve information about every build the buildbot knows
about, as well as find out what the buildbot is currently working on.

   <p>The first page you will see is the &ldquo;Welcome Page&rdquo;, which contains
links to all the other useful pages. By default, this page is served from
the <samp><span class="file">status/web/templates/root.html</span></samp> file in buildbot's library area. 
If you'd like to override this page or the other templates found there,
copy the files you're interested in into a <samp><span class="file">templates/</span></samp> directory in
the buildmaster's base directory.

   <p>One of the most complex resource provided by <code>WebStatus</code> is the
&ldquo;Waterfall Display&rdquo;, which shows a time-based chart of events. This
somewhat-busy display provides detailed information about all steps of all
recent builds, and provides hyperlinks to look at individual build logs and
source changes. By simply reloading this page on a regular basis, you will see
a complete description of everything the buildbot is currently working on.

   <p>A similar, but more developer-oriented display is the "Grid" display.  This
arranges builds by SourceStamp (horizontal axis) and builder (vertical axis),
and can provide quick information as to which revisions are passing or failing
on which builders.

   <p>There are also pages with more specialized information. For example,
there is a page which shows the last 20 builds performed by the
buildbot, one line each. Each line is a link to detailed information
about that build. By adding query arguments to the URL used to reach
this page, you can narrow the display to builds that involved certain
branches, or which ran on certain Builders. These pages are described
in great detail below.

<h3 class="heading">Configuration</h3>

<p>Buildbot now uses a templating system for the web interface. The source
of these templates can be found in the <samp><span class="file">status/web/templates/</span></samp> directory
in buildbot's library area. You can override these templates by creating
alternate versions in a <samp><span class="file">templates/</span></samp> directory within the buildmaster's
base directory.

   <p>The first time a buildmaster is created, the <samp><span class="file">public_html/</span></samp>
directory is populated with some sample files, which you will probably
want to customize for your own project. These files are all static:
the buildbot does not modify them in any way as it serves them to HTTP
clients.

   <p>Note that templates in <samp><span class="file">templates/</span></samp> take precedence over static files in
<samp><span class="file">public_html/</span></samp>.

<pre class="example">     from buildbot.status.html import WebStatus
     c['status'].append(WebStatus(8080))
</pre>
   <p>Note that the initial robots.txt file has Disallow lines for all of
the dynamically-generated buildbot pages, to discourage web spiders
and search engines from consuming a lot of CPU time as they crawl
through the entire history of your buildbot. If you are running the
buildbot behind a reverse proxy, you'll probably need to put the
robots.txt file somewhere else (at the top level of the parent web
server), and replace the URL prefixes in it with more suitable values.

   <p>If you would like to use an alternative root directory, add the
<code>public_html=..</code> option to the <code>WebStatus</code> creation:

<pre class="example">     c['status'].append(WebStatus(8080, public_html="/var/www/buildbot"))
</pre>
   <p>In addition, if you are familiar with twisted.web <em>Resource
Trees</em>, you can write code to add additional pages at places inside
this web space. Just use <code>webstatus.putChild</code> to place these
resources.

   <p>The following section describes the special URLs and the status views
they provide.

<ul class="menu">
<li><a accesskey="1" href="#Buildbot-Web-Resources">Buildbot Web Resources</a>
<li><a accesskey="2" href="#WebStatus-Configuration-Parameters">WebStatus Configuration Parameters</a>
<li><a accesskey="3" href="#Change-Hooks">Change Hooks</a>
</ul>

<div class="node">
<a name="Buildbot-Web-Resources"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#WebStatus-Configuration-Parameters">WebStatus Configuration Parameters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#WebStatus">WebStatus</a>

</div>

<h5 class="subsubsection">4.14.1.1 Buildbot Web Resources</h5>

<p>Certain URLs are &ldquo;magic&rdquo;, and the pages they serve are created by
code in various classes in the <samp><span class="file">buildbot.status.web</span></samp> package
instead of being read from disk. The most common way to access these
pages is for the buildmaster admin to write or modify the
<samp><span class="file">index.html</span></samp> page to contain links to them. Of course other
project web pages can contain links to these buildbot pages as well.

   <p>Many pages can be modified by adding query arguments to the URL. For
example, a page which shows the results of the most recent build
normally does this for all builders at once. But by appending
&ldquo;?builder=i386&rdquo; to the end of the URL, the page will show only the
results for the &ldquo;i386&rdquo; builder. When used in this way, you can add
multiple &ldquo;builder=&rdquo; arguments to see multiple builders. Remembering
that URL query arguments are separated <em>from each other</em> with
ampersands, a URL that ends in &ldquo;?builder=i386&amp;builder=ppc&rdquo; would
show builds for just those two Builders.

   <p>The <code>branch=</code> query argument can be used on some pages. This
filters the information displayed by that page down to only the builds
or changes which involved the given branch. Use <code>branch=trunk</code> to
reference the trunk: if you aren't intentionally using branches,
you're probably using trunk. Multiple <code>branch=</code> arguments can be
used to examine multiple branches at once (so appending
<code>?branch=foo&amp;branch=bar</code> to the URL will show builds involving
either branch). No <code>branch=</code> arguments means to show builds and
changes for all branches.

   <p>Some pages may include the Builder name or the build number in the
main part of the URL itself. For example, a page that describes Build
#7 of the &ldquo;i386&rdquo; builder would live at <samp><span class="file">/builders/i386/builds/7</span></samp>.

   <p>The table below lists all of the internal pages and the URLs that can
be used to access them.

     <dl>
<dt><code>/waterfall</code><dd>
This provides a chronologically-oriented display of the activity of
all builders. It is the same display used by the Waterfall display.

     <p>By adding one or more &ldquo;builder=&rdquo; query arguments, the Waterfall is
restricted to only showing information about the given Builders. By
adding one or more &ldquo;branch=&rdquo; query arguments, the display is
restricted to showing information about the given branches. In
addition, adding one or more &ldquo;category=&rdquo; query arguments to the URL
will limit the display to Builders that were defined with one of the
given categories.

     <p>A 'show_events=true' query argument causes the display to include
non-Build events, like slaves attaching and detaching, as well as
reconfiguration events. 'show_events=false' hides these events. The
default is to show them.

     <p>By adding the 'failures_only=true' query argument, the Waterfall is
restricted to only showing information about the builders that
are currently failing. A builder is considered failing if the
last finished build was not successful, a step in the current
build(s) is failing, or if the builder is offline.

     <p>The <code>last_time=</code>, <code>first_time=</code>, and <code>show_time=</code>
arguments will control what interval of time is displayed. The default
is to show the latest events, but these can be used to look at earlier
periods in history. The <code>num_events=</code> argument also provides a
limit on the size of the displayed page.

     <p>The Waterfall has references to resources many of the other portions
of the URL space: <samp><span class="file">/builders</span></samp> for access to individual builds,
<samp><span class="file">/changes</span></samp> for access to information about source code changes,
etc.

     <br><dt><code>/grid</code><dd>
This provides a chronologically oriented display of builders, by
revision.  The builders are listed down the left side of the page,
and the revisions are listed across the top.

     <p>By adding one ore more &ldquo;category=&rdquo; arguments the grid will be
restricted to revisions in those categories.

     <p>A &ldquo;width=N&rdquo; argument will limit the number of revisions shown to N,
defaulting to 5.

     <p>A &ldquo;branch=BRANCHNAME&rdquo; argument will limit the grid to revisions on
branch BRANCHNAME.

     <br><dt><code>/tgrid</code><dd>
The Transposed Grid is similar to the standard grid, but, as the name
implies, transposes the grid: the revisions are listed down the left side
of the page, and the build hosts are listed across the top.  It accepts
the same query arguments. The exception being that instead of &ldquo;width&rdquo;
the argument is named &ldquo;length.&rdquo;

     <p>This page also has a &ldquo;rev_order=&rdquo; query argument that
lets you change in what order revisions are shown. 
Valid values are &ldquo;asc&rdquo; (ascending, oldest revision first)
and &ldquo;desc&rdquo; (descending, newest revision first).

     <br><dt><code>/console</code><dd>
EXPERIMENTAL: This provides a developer-oriented display of the the last
changes and how they affected the builders.

     <p>It allows a developer to quickly see the status of each builder for the
first build including his or her change. A green box means that the change
succeeded for all the steps for a given builder. A red box means that
the changed introduced a new regression on a builder. An orange box
means that at least one of the test failed, but it was also failing
in the previous build, so it is not possible to see if there was any
regressions from this change. Finally a yellow box means that the test
is in progress.

     <p>By adding one or more &ldquo;builder=&rdquo; query arguments, the Console view is
restricted to only showing information about the given Builders. Adding a
&ldquo;repository=&rdquo; argument will limit display to a given repository. By
adding a &ldquo;branch=&rdquo; query argument, the display is
restricted to showing information about the given branch. In
addition, adding one or more &ldquo;category=&rdquo; query arguments to the URL
will limit the display to Builders that were defined with one of the
given categories.

     <p>By adding one or more &ldquo;name=&rdquo; query arguments to the URL, the console view is
restricted to only showing changes made by the given users.

     <p>NOTE: To use this page, your buildbot.css file in public_html must be the one
found in <samp><span class="file">master/buildbot/status/web/files/default.css</span></samp>.  This is the
default for new installs, but upgrades of very old installs of Buildbot may
need to manually fix the CSS file.

     <p>The console view is still in development. At this moment by default the view
sorts revisions lexically, which can lead to odd behavior with non-integer
revisions (e.g., git), or with integer revisions of different length (e.g., 999
and 1000).  It also has some issues with displaying multiple braches at the
same time. If you do have multiple branches, you should use the &ldquo;branch=&rdquo;
query argument.  The <code>order_console_by_time</code> option may help sorting
revisions, although it depends on the date being set correctly in each commit:

     <pre class="example">          w = html.WebStatus(http_port=8080, order_console_by_time=True)
</pre>
     <br><dt><code>/rss</code><dd>
This provides a rss feed summarizing all failed builds. The same
query-arguments used by 'waterfall' can be added to filter the
feed output.

     <br><dt><code>/atom</code><dd>
This provides an atom feed summarizing all failed builds. The same
query-arguments used by 'waterfall' can be added to filter the feed
output.

     <br><dt><code>/json</code><dd>
This view provides quick access to Buildbot status information in a form that
is easiliy digested from other programs, including JavaScript.  See
<code>/json/help</code> for detailed interactive documentation of the output formats
for this view.

     <br><dt><code>/buildstatus?builder=$BUILDERNAME&amp;number=$BUILDNUM</code><dd>
This displays a waterfall-like chronologically-oriented view of all the
steps for a given build number on a given builder.

     <br><dt><code>/builders/$BUILDERNAME</code><dd>
This describes the given Builder, and provides buttons to force a
build.  A <code>numbuilds=</code> argument will control how many build lines
are displayed (5 by default).

     <br><dt><code>/builders/$BUILDERNAME/builds/$BUILDNUM</code><dd>
This describes a specific Build.

     <br><dt><code>/builders/$BUILDERNAME/builds/$BUILDNUM/steps/$STEPNAME</code><dd>
This describes a specific BuildStep.

     <br><dt><code>/builders/$BUILDERNAME/builds/$BUILDNUM/steps/$STEPNAME/logs/$LOGNAME</code><dd>
This provides an HTML representation of a specific logfile.

     <br><dt><code>/builders/$BUILDERNAME/builds/$BUILDNUM/steps/$STEPNAME/logs/$LOGNAME/text</code><dd>
This returns the logfile as plain text, without any HTML coloring
markup. It also removes the &ldquo;headers&rdquo;, which are the lines that
describe what command was run and what the environment variable
settings were like. This maybe be useful for saving to disk and
feeding to tools like 'grep'.

     <br><dt><code>/changes</code><dd>
This provides a brief description of the ChangeSource in use
(see <a href="#Change-Sources">Change Sources</a>).

     <br><dt><code>/changes/NN</code><dd>
This shows detailed information about the numbered Change: who was the
author, what files were changed, what revision number was represented,
etc.

     <br><dt><code>/buildslaves</code><dd>
This summarizes each BuildSlave, including which Builders are
configured to use it, whether the buildslave is currently connected or
not, and host information retrieved from the buildslave itself.

     <p>A &ldquo;no_builders=1&ldquo; URL argument will omit the builders column.  This is
useful if each buildslave is assigned to a large number of builders.

     <br><dt><code>/one_line_per_build</code><dd>
This page shows one line of text for each build, merging information
from all Builders<a rel="footnote" href="#fn-11" name="fnd-11"><sup>11</sup></a>. Each line specifies
the name of the Builder, the number of the Build, what revision it
used, and a summary of the results. Successful builds are in green,
while failing builds are in red. The date and time of the build are
added to the right-hand edge of the line. The lines are ordered by
build finish timestamp.

     <p>One or more <code>builder=</code> or <code>branch=</code> arguments can be used to
restrict the list. In addition, a <code>numbuilds=</code> argument will
control how many lines are displayed (20 by default).

     <br><dt><code>/builders</code><dd>
This page shows a small table, with one box for each Builder,
containing the results of the most recent Build. It does not show the
individual steps, or the current status. This is a simple summary of
buildbot status: if this page is green, then all tests are passing.

     <p>As with <code>/one_line_per_build</code>, this page will also honor
<code>builder=</code> and <code>branch=</code> arguments.

     <br><dt><code>/about</code><dd>
This page gives a brief summary of the Buildbot itself: software
version, versions of some libraries that the Buildbot depends upon,
etc. It also contains a link to the buildbot.net home page.

   </dl>

   <p>There are also a set of web-status resources that are intended for use
by other programs, rather than humans.

     <dl>
<dt><code>/change_hook</code><dd>
This provides an endpoint for web-based source change notification. 
It is used by github and contrib/post_build_request.py. 
See <a href="#Change-Hooks">Change Hooks</a> for more details.

   </dl>

<div class="node">
<a name="WebStatus-Configuration-Parameters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Change-Hooks">Change Hooks</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Buildbot-Web-Resources">Buildbot Web Resources</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#WebStatus">WebStatus</a>

</div>

<h5 class="subsubsection">4.14.1.2 WebStatus Configuration Parameters</h5>

<h3 class="heading">HTTP Connection</h3>

<p>The most common way to run a <code>WebStatus</code> is on a regular TCP
port. To do this, just pass in the TCP port number when you create the
<code>WebStatus</code> instance; this is called the <code>http_port</code> argument:

<pre class="example">     from buildbot.status.html import WebStatus
     c['status'].append(http_port=WebStatus(http_port=8080))
</pre>
   <p>The <code>http_port</code> argument is actually a &ldquo;strports specification&rdquo; for the
port that the web server should listen on. This can be a simple port number, or
a string like <code>http_port="tcp:8080:interface=127.0.0.1"</code> (to limit
connections to the loopback interface, and therefore to clients running on the
same host)<a rel="footnote" href="#fn-12" name="fnd-12"><sup>12</sup></a>.

   <p>If instead (or in addition) you provide the <code>distrib_port</code>
argument, a twisted.web distributed server will be started either on a
TCP port (if <code>distrib_port</code> is like <code>"tcp:12345"</code>) or more
likely on a UNIX socket (if <code>distrib_port</code> is like
<code>"unix:/path/to/socket"</code>).

   <p>The <code>public_html</code> option gives the path to a regular directory of HTML
files that will be displayed alongside the various built-in URLs buildbot
supplies.  This is most often used to supply CSS files (<code>/buildbot.css</code>)
and a top-level navigational file (<code>/index.html</code>), but can also serve any
other files required - even build results!

<h3 class="heading">Authorization</h3>

<p>The buildbot web status is, by default, read-only.  It displays lots of
information, but users are not allowed to affect the operation of the
buildmaster.  However, there are a number of supported activities that can
be enabled, and Buildbot can also perform rudimentary username/password
authentication.  The actions are:

     <dl>
<dt><code>forceBuild</code><dd>
force a particular builder to begin building, optionally with a specific revision, branch, etc.

     <br><dt><code>forceAllBuilds</code><dd>
force <i>all</i> builders to start building

     <br><dt><code>pingBuilder</code><dd>
"ping" a builder's buildslaves to check that they are alive

     <br><dt><code>gracefulShutdown</code><dd>
gracefully shut down a slave when it is finished with its current build

     <br><dt><code>stopBuild</code><dd>
stop a running build

     <br><dt><code>stopAllBuilds</code><dd>
stop all running builds

     <br><dt><code>cancelPendingBuild</code><dd>
cancel a build that has not yet started

     <br><dt><code>stopChange</code><dd>
cancel builds that include a given change number

     <br><dt><code>cleanShutdown</code><dd>
shut down the master gracefully, without interrupting builds

   </dl>

   <p>For each of these actions, you can configure buildbot to never allow the
action, always allow the action, allow the action to any authenticated user, or
check with a function of your creation to determine whether the action is OK.

   <p>This is all configured with the <code>Authz</code> class:

<pre class="example">     from buildbot.status.html import WebStatus
     from buildbot.status.web.authz import Authz
     authz = Authz(
         forceBuild=True,
         stopBuild=True)
     c['status'].append(http_port=WebStatus(http_port=8080, authz=authz))
</pre>
   <p>Each of the actions listed above is an option to <code>Authz</code>.  You can specify
<code>False</code> (the default) to prohibit that action or <code>True</code> to enable it.

<h3 class="heading">Authentication</h3>

<p>If you do not wish to allow strangers to perform actions, but do want
developers to have such access, you will need to add some authentication
support.  Pass an instance of <code>status.web.auth.IAuth</code> as a <code>auth</code>
keyword argument to <code>Authz</code>, and specify the action as <code>"auth"</code>.

<pre class="example">     from buildbot.status.html import WebStatus
     from buildbot.status.web.authz import Authz
     from buildbot.status.web.auth import BasicAuth
     users = [('bob', 'secret-pass'), ('jill', 'super-pass')]
     authz = Authz(auth=BasicAuth(users),
         forceBuild='auth', # only authenticated users
         pingBuilder=True, # but anyone can do this
     )
     c['status'].append(WebStatus(http_port=8080, authz=authz))
     # or
     from buildbot.status.web.auth import HTPasswdAuth
     auth = (HTPasswdAuth('/path/to/htpasswd'))
</pre>
   <p>The class <code>BasicAuth</code> implements a basic authentication mechanism using a
list of user/password tuples provided from the configuration file.  The class
<code>HTPasswdAuth</code> implements an authentication against an <samp><span class="file">.htpasswd</span></samp>
file.

   <p>If you need still-more flexibility, pass a function for the authentication
action.  That function will be called with an authenticated username and some
action-specific arguments, and should return true if the action is authorized.

<pre class="example">     def canForceBuild(username, builder_status):
         if builder_status.getName() == 'smoketest':
             return True # any authenticated user can run smoketest
         elif username == 'releng':
             return True # releng can force whatever they want
         else:
             return False # otherwise, no way.
     
     authz = Authz(auth=BasicAuth(users),
         forceBuild=canForceBuild)
</pre>
   <p>The <code>forceBuild</code> and <code>pingBuilder</code> actions both supply a
BuilderStatus object.  The <code>stopBuild</code> action supplies a BuildStatus
object.  The <code>cancelPendingBuild</code> action supplies a <code>BuildRequest</code>. 
The remainder do not supply any extra arguments.

<h3 class="heading">Logging configuration</h3>

<p>The WebStatus uses a separate log file (http.log) to avoid clutter
buildbot's default log (twistd.log) with request/response messages. 
This log is also, by default, rotated in the same way as the twistd.log
file, but you can also customize the rotation logic with the following
parameters if you need a different behaviour.

<h4 class="subheading">rotateLength</h4>

<p>An integer defining the file size at which log files are rotated.

<h4 class="subheading">maxRotatedFiles</h4>

<p>The maximum number of old log files to keep.

<h3 class="heading">URL-decorating options</h3>

<p>These arguments adds an URL link to various places in the WebStatus,
such as revisions, repositories, projects and, optionally, ticket/bug references
in change comments.

<h4 class="subheading">revlink</h4>

<p>The <code>revlink</code> is used to create links from revision IDs in the web status
to a web-view of your source control system. The parameter's value must be a
format string, a dict mapping a string (repository name) to format strings, or a callable.

   <p>The format string should use '%s' to insert the revision id in the url.  For
example, for Buildbot on github:
<code>revlink='http://github.com/buildbot/buildbot/tree/%s'</code> (The revision ID
will be URL encoded before inserted in the replacement string)

   <p>The callable takes the revision id and repository argument, and should return
an URL to the revision.  Note that the revision id may not always be in the
form you expect, so code defensively.  In particular, a revision of "??" may be
supplied when no other information is available.

   <p>Note that SourceStamps that are not created from version-control changes (e.g.,
those created by a Nightly or Periodic scheduler) will have an empty repository
string, as the respository is not known.

<h4 class="subheading">changecommentlink</h4>

<p>The <code>changecommentlink</code> argument can be used to create links to
ticket-ids from change comments (i.e. #123).

   <p>The argument can either be a tuple of three strings, a dictionary mapping
strings (project names) to tuples or a callable taking a changetext
(a <code>jinja2.Markup</code> instance) and a project name, returning a the
same change text with additional links/html tags added to it.

   <p>If the tuple is used, it should contain three strings where the first
element is a regex that
searches for strings (with match groups), the second is a replace-string
that, when substituted with \1 etc, yields the URL and the third
is the title attribute of the link. 
(The <code>&lt;a href="" title=""&gt;&lt;/a&gt;</code> is added by the system.) 
So, for Trac tickets (#42, etc):
<code>changecommentlink(r"#(\d+)", r"http://buildbot.net/trac/ticket/\1", r"Ticket \g&lt;0&gt;")</code> .

<h4 class="subheading">projects</h4>

<p>A dictionary from strings to strings, mapping project names to URLs,
or a callable taking a project name and returning an URL.

<h4 class="subheading">repositories</h4>

<p>Same as the projects arg above, a dict or callable mapping project names
to URLs.

<h3 class="heading">Display-Specific Options</h3>

<p>The <code>order_console_by_time</code> option affects the rendering of the console;
see the description of the console above.

   <p>The <code>numbuilds</code> option determines the number of builds that most status
displays will show.  It can usually be overriden in the URL, e.g.,
<code>?numbuilds=13</code>.

   <p>The <code>num_events</code> option gives the default number of events that the
waterfall will display.  The <code>num_events_max</code> gives the maximum number of
events displayed, even if the web browser requests more.

<div class="node">
<a name="Change-Hooks"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#WebStatus-Configuration-Parameters">WebStatus Configuration Parameters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#WebStatus">WebStatus</a>

</div>

<h5 class="subsubsection">4.14.1.3 Change Hooks</h5>

<p>The /change_hook url is a magic URL which will accept HTTP requests and translate
them into changes for buildbot. Implementations (such as a trivial json-based endpoint
and a github implementation) can be found in <code>master/buildbot/status/web/hooks</code>. 
The format of the url is /change_hook/DIALECT where DIALECT is a package within the
hooks directory. Change_hook is disabled by default and each DIALECT has to be enabled
separately, for security reasons

   <p>An example WebStatus configuration line which enables change_hook and two DIALECTS:

<pre class="example">     c['status'].append(html.WebStatus(http_port=8010,allowForce=True,
                             change_hook_dialects={
                                     'base': True,
                                     'somehook': {'option1':True,
                                                 'option2':False}}))
</pre>
   <p>Within the WebStatus arguments, the <code>change_hook</code> key enables/disables the module
and <code>change_hook_dialects</code> whitelists DIALECTs where the keys are the module names
and the values are optional arguments which will be passed to the hooks.

   <p>The <samp><span class="file">post_build_request.py</span></samp> script in <samp><span class="file">master/contrib</span></samp> allows for the
submission of an arbitrary change request. Run <code>post_build_request.py
--help</code> for more information.  The 'base' dialect must be enabled for this to
work.

<h3 class="heading">github hook</h3>

<p>The github hook is simple and takes no options.

<pre class="example">     c['status'].append(html.WebStatus(..
                         change_hook_dialects={ 'github' : True }))
</pre>
   <p>With this set up, add a Post-Receive URL for the project in the Github
administrative interface, pointing to <code>/change_hook/github</code> relative to
the root of the web status.  For example, if the grid URL is
<code>http://builds.mycompany.com/bbot/grid</code>, then point Github to
<code>http://builds.mycompany.com/bbot/change_hook/github</code>. To specify a project
assoicated to the repository, append <code>?project=name</code> to the URL.

   <p>Note that there is a standalone HTTP server available for receiving github
notifications, as well: <code>contrib/github_buildbot.py</code>.  This script may be
useful in cases where you cannot expose the WebStatus for public consumption.

<div class="node">
<a name="MailNotifier"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#IRC-Bot">IRC Bot</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#WebStatus">WebStatus</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Status-Targets">Status Targets</a>

</div>

<h4 class="subsection">4.14.2 MailNotifier</h4>

<p><a name="index-email-142"></a><a name="index-mail-143"></a><a name="index-buildbot_002estatus_002email_002eMailNotifier-144"></a>
The buildbot can also send email when builds finish. The most common
use of this is to tell developers when their change has caused the
build to fail. It is also quite common to send a message to a mailing
list (usually named &ldquo;builds&rdquo; or similar) about every build.

   <p>The <code>MailNotifier</code> status target is used to accomplish this. You
configure it by specifying who mail should be sent to, under what
circumstances mail should be sent, and how to deliver the mail. It can
be configured to only send out mail for certain builders, and only
send messages when the build fails, or when the builder transitions
from success to failure. It can also be configured to include various
build logs in each message.

   <p>By default, the message will be sent to the Interested Users list (see <a href="#Doing-Things-With-Users">Doing Things With Users</a>), which includes all developers who made changes in the
build. You can add additional recipients with the extraRecipients argument. 
You can also add interested users by setting the <code>owners</code> build property
to a list of users in the scheduler constructor (see <a href="#Configuring-Schedulers">Configuring Schedulers</a>).

   <p>Each MailNotifier sends mail to a single set of recipients. To send
different kinds of mail to different recipients, use multiple
MailNotifiers.

   <p>The following simple example will send an email upon the completion of
each build, to just those developers whose Changes were included in
the build. The email contains a description of the Build, its results,
and URLs where more information can be obtained.

<pre class="example">     from buildbot.status.mail import MailNotifier
     mn = MailNotifier(fromaddr="buildbot@example.org", lookup="example.org")
     c['status'].append(mn)
</pre>
   <p>To get a simple one-message-per-build (say, for a mailing list), use
the following form instead. This form does not send mail to individual
developers (and thus does not need the <code>lookup=</code> argument,
explained below), instead it only ever sends mail to the &ldquo;extra
recipients&rdquo; named in the arguments:

<pre class="example">     mn = MailNotifier(fromaddr="buildbot@example.org",
                       sendToInterestedUsers=False,
                       extraRecipients=['listaddr@example.org'])
</pre>
   <p>If your SMTP host requires authentication before it allows you to send emails,
this can also be done by specifying &ldquo;smtpUser&rdquo; and &ldquo;smptPassword&rdquo;:

<pre class="example">     mn = MailNotifier(fromaddr="myuser@gmail.com",
                       sendToInterestedUsers=False,
                       extraRecipients=["listaddr@example.org"],
                       relayhost="smtp.gmail.com", smtpPort=587,
                       smtpUser="myuser@gmail.com", smtpPassword="mypassword")
</pre>
   <p>If you want to require Transport Layer Security (TLS), then you can also
set &ldquo;useTls&rdquo;:

<pre class="example">     mn = MailNotifier(fromaddr="myuser@gmail.com",
                       sendToInterestedUsers=False,
                       extraRecipients=["listaddr@example.org"],
                       useTls=True, relayhost="smtp.gmail.com", smtpPort=587,
                       smtpUser="myuser@gmail.com", smtpPassword="mypassword")
</pre>
   <p>Note that if you see <code>twisted.mail.smtp.TLSRequiredError</code> exceptions in
the log while using TLS, this can be due <i>either</i> to the server not
supporting TLS or to a missing pyopenssl package on the buildmaster system.

   <p>In some cases it is desirable to have different information then what is
provided in a standard MailNotifier message. For this purpose MailNotifier
provides the argument <code>messageFormatter</code> (a function) which allows for the
creation of messages with unique content.

   <p>For example, if only short emails are desired (e.g., for delivery to phones)

<pre class="example">     from buildbot.status.builder import Results
     def messageFormatter(mode, name, build, results, master_status):
         result = Results[results]
     
         text = list()
         text.append("STATUS: %s" % result.title())
         return {
             'body' : "\n".join(text),
             'type' : 'plain'
         }
     
     mn = MailNotifier(fromaddr="buildbot@example.org",
                       sendToInterestedUsers=False,
                       mode='problem',
                       extraRecipients=['listaddr@example.org'],
                       messageFormatter=messageFormatter)
</pre>
   <p>Another example of a function delivering a customized html email
containing the last 80 log lines of the last build step is given
below:

<pre class="example">     from buildbot.status.builder import Results
     
     def html_message_formatter(mode, name, build, results, master_status):
         """Provide a customized message to BuildBot's MailNotifier.
     
         The last 80 lines of the log are provided as well as the changes
         relevant to the build.  Message content is formatted as html.
         """
         result = Results[results]
     
         limit_lines = 80
         text = list()
         text.append(u'&lt;h4&gt;Build status: %s&lt;/h4&gt;' % result.upper())
         text.append(u'&lt;table cellspacing="10"&gt;&lt;tr&gt;')
         text.append(u"&lt;td&gt;Buildslave for this Build:&lt;/td&gt;&lt;td&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;" % build.getSlavename())
         if master_status.getURLForThing(build):
             text.append(u'&lt;tr&gt;&lt;td&gt;Complete logs for all build steps:&lt;/td&gt;&lt;td&gt;&lt;a href="%s"&gt;%s&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;'
                         % (master_status.getURLForThing(build),
                            master_status.getURLForThing(build))
                         )
             text.append(u'&lt;tr&gt;&lt;td&gt;Build Reason:&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;' % build.getReason())
             source = u""
             ss = build.getSourceStamp()
             if ss.branch:
                 source += u"[branch %s] " % ss.branch
             if ss.revision:
                 source +=  ss.revision
             else:
                 source += u"HEAD"
             if ss.patch:
                 source += u" (plus patch)"
             text.append(u"&lt;tr&gt;&lt;td&gt;Build Source Stamp:&lt;/td&gt;&lt;td&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;" % source)
             text.append(u"&lt;tr&gt;&lt;td&gt;Blamelist:&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;" % ",".join(build.getResponsibleUsers()))
             text.append(u'&lt;/table&gt;')
             if ss.changes:
                 text.append(u'&lt;h4&gt;Recent Changes:&lt;/h4&gt;')
                 for c in ss.changes:
                     cd = c.asDict()
                     when = datetime.datetime.fromtimestamp(cd['when'] ).ctime()
                     text.append(u'&lt;table cellspacing="10"&gt;')
                     text.append(u'&lt;tr&gt;&lt;td&gt;Repository:&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;' % cd['repository'] )
                     text.append(u'&lt;tr&gt;&lt;td&gt;Project:&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;' % cd['project'] )
                     text.append(u'&lt;tr&gt;&lt;td&gt;Time:&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;' % when)
                     text.append(u'&lt;tr&gt;&lt;td&gt;Changed by:&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;' % cd['who'] )
                     text.append(u'&lt;tr&gt;&lt;td&gt;Comments:&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;' % cd['comments'] )
                     text.append(u'&lt;/table&gt;')
                     files = cd['files']
                     if files:
                         text.append(u'&lt;table cellspacing="10"&gt;&lt;tr&gt;&lt;th align="left"&gt;Files&lt;/th&gt;&lt;th&gt;URL&lt;/th&gt;&lt;/tr&gt;')
                         for file in files:
                             text.append(u'&lt;tr&gt;&lt;td&gt;%s:&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;' % (file['name'], file['url']))
                         text.append(u'&lt;/table&gt;')
             text.append(u'&lt;br&gt;')
             # get log for last step
             logs = build.getLogs()
             # logs within a step are in reverse order. Search back until we find stdio
             for log in reversed(logs):
                 if log.getName() == 'stdio':
                     break
             name = "%s.%s" % (log.getStep().getName(), log.getName())
             status, dummy = log.getStep().getResults()
             content = log.getText().splitlines() # Note: can be VERY LARGE
             url = u'%s/steps/%s/logs/%s' % (master_status.getURLForThing(build),
                                            log.getStep().getName(),
                                            log.getName())
     
             text.append(u'&lt;i&gt;Detailed log of last build step:&lt;/i&gt; &lt;a href="%s"&gt;%s&lt;/a&gt;'
                         % (url, url))
             text.append(u'&lt;br&gt;')
             text.append(u'&lt;h4&gt;Last %d lines of "%s"&lt;/h4&gt;' % (limit_lines, name))
             unilist = list()
             for line in content[-limit_lines:]:
                 unilist.append(cgi.escape(unicode(line,'utf-8')))
             text.append(u'&lt;pre&gt;'.join([uniline for uniline in unilist]))
             text.append(u'&lt;/pre&gt;')
             text.append(u'&lt;br&gt;&lt;br&gt;')
             text.append(u'&lt;b&gt;-The BuildBot&lt;/b&gt;')
             return {
                 'body': u"\n".join(text),
                 'type': 'html'
                 }
     
     mn = MailNotifier(fromaddr="buildbot@example.org",
                       sendToInterestedUsers=False,
                       mode='failing',
                       extraRecipients=['listaddr@example.org'],
                       messageFormatter=message_formatter)
</pre>
   <h3 class="heading">MailNotifier arguments</h3>

     <dl>
<dt><code>fromaddr</code><dd>The email address to be used in the 'From' header.

     <br><dt><code>sendToInterestedUsers</code><dd>(boolean). If True (the default), send mail to all of the Interested
Users. If False, only send mail to the extraRecipients list.

     <br><dt><code>extraRecipients</code><dd>(list of strings). A list of email addresses to which messages should
be sent (in addition to the InterestedUsers list, which includes any
developers who made Changes that went into this build). It is a good
idea to create a small mailing list and deliver to that, then let
subscribers come and go as they please.

     <br><dt><code>subject</code><dd>(string). A string to be used as the subject line of the message. 
<code>%(builder)s</code> will be replaced with the name of the builder which
provoked the message.

     <br><dt><code>mode</code><dd>(string). Default to 'all'. One of:
          <dl>
<dt><code>all</code><dd>Send mail about all builds, both passing and failing
<br><dt><code>change</code><dd>Only send mail about builds which change status
<br><dt><code>failing</code><dd>Only send mail about builds which fail
<br><dt><code>warning</code><dd>Only send mail about builds which fail or generate warnings
<br><dt><code>passing</code><dd>Only send mail about builds which succeed
<br><dt><code>problem</code><dd>Only send mail about a build which failed when the previous build has passed. 
If your builds usually pass, then this will only send mail when a problem
occurs. 
</dl>

     <br><dt><code>builders</code><dd>(list of strings). A list of builder names for which mail should be
sent. Defaults to None (send mail for all builds). Use either builders
or categories, but not both.

     <br><dt><code>categories</code><dd>(list of strings). A list of category names to serve status
information for. Defaults to None (all categories). Use either
builders or categories, but not both.

     <br><dt><code>addLogs</code><dd>(boolean). If True, include all build logs as attachments to the
messages. These can be quite large. This can also be set to a list of
log names, to send a subset of the logs. Defaults to False.

     <br><dt><code>addPatch</code><dd>(boolean). If True, include the patch content if a patch was present. 
Patches are usually used on a Try server. 
Defaults to True.

     <br><dt><code>buildSetSummary</code><dd>(boolean). If True, send a single summary email consisting of the concatenation of all build completion messages rather than a completion message for each build.  Defaults to False.

     <br><dt><code>relayhost</code><dd>(string). The host to which the outbound SMTP connection should be
made. Defaults to 'localhost'

     <br><dt><code>smtpPort</code><dd>(int). The port that will be used on outbound SMTP
connections. Defaults to 25.

     <br><dt><code>useTls</code><dd>(boolean). When this argument is <code>True</code> (default is <code>False</code>)
<code>MailNotifier</code> sends emails using TLS and authenticates with the
<code>relayhost</code>. When using TLS the arguments <code>smtpUser</code> and
<code>smtpPassword</code> must also be specified.

     <br><dt><code>smtpUser</code><dd>(string). The user name to use when authenticating with the
<code>relayhost</code>.

     <br><dt><code>smtpPassword</code><dd>(string). The password that will be used when authenticating with the
<code>relayhost</code>.

     <br><dt><code>lookup</code><dd>(implementor of <code>IEmailLookup</code>). Object which provides
IEmailLookup, which is responsible for mapping User names (which come
from the VC system) into valid email addresses. If not provided, the
notifier will only be able to send mail to the addresses in the
extraRecipients list. Most of the time you can use a simple Domain
instance. As a shortcut, you can pass as string: this will be treated
as if you had provided Domain(str). For example,
lookup='twistedmatrix.com' will allow mail to be sent to all
developers whose SVN usernames match their twistedmatrix.com account
names. See buildbot/status/mail.py for more details.

     <br><dt><code>messageFormatter</code><dd>
This is a optional function that can be used to generate a custom mail message. 
A <code>messageFormatter</code> function takes the mail mode (<code>mode</code>), builder
name (<code>name</code>), the build status (<code>build</code>), the result code
(<code>results</code>), and the BuildMaster status (<code>master_status</code>).  It
returns a dictionary. The <code>body</code> key gives a string that is the complete
text of the message. The <code>type</code> key is the message type ('plain' or
'html'). The 'html' type should be used when generating an HTML message.  The
<code>subject</code> key is optional, but gives the subject for the email.

     <br><dt><code>extraHeaders</code><dd>(dictionary) A dictionary containing key/value pairs of extra headers to add
to sent e-mails. If buildSetStatus is False, both the keys and the values may be
a WithProperties instance.

</dl>

   <p>As a help to those writing <code>messageFormatter</code> functions, the following
table describes how to get some useful pieces of information from the various
status objects:

     <dl>
<dt>&bull;Name of the builder that generated this event<dd><code>name</code>
<br><dt>&bull;Name of the project<dd><code>master_status.getTitle()</code>
<br><dt>&bull;MailNotifier mode<dd><code>mode</code> (one of <code>all, failing, problem, change, passing</code>)
<br><dt>&bull;Builder result as a string<dd>
     <pre class="example">          from buildbot.status.builder import Results
          result_str = Results[results]
          # one of 'success', 'warnings', 'failure', 'skipped', or 'exception'
</pre>
     <br><dt>&bull;URL to build page<dd><code>master_status.getURLForThing(build)</code>
<br><dt>&bull;URL to buildbot main page.<dd><code>master_status.getBuildbotURL()</code>
<br><dt>&bull;Build text<dd><code>build.getText()</code>
<br><dt>&bull;Mapping of property names to values<dd><code>build.getProperties()</code> (a <code>Properties</code> instance)
<br><dt>&bull;Slave name<dd><code>build.getSlavename()</code>
<br><dt>&bull;Build reason (from a forced build)<dd><code>build.getReason()</code>
<br><dt>&bull;List of responsible users<dd><code>build.getResponsibleUsers()</code>
<br><dt>&bull;Source information (only valid if ss is not None)<dd>
     <pre class="example">          ss = build.getSourceStamp()
          if ss:
              branch = ss.branch
              revision = ss.revision
              patch = ss.patch
              changes = ss.changes # list
</pre>
     <p>A change object has the following useful information:
          <dl>
<dt><code>who</code><dd>(str) who made this change
<br><dt><code>revision</code><dd>(str) what VC revision is this change
<br><dt><code>branch</code><dd>(str) on what branch did this change occur
<br><dt><code>when</code><dd>(str) when did this change occur
<br><dt><code>files</code><dd>(list of str) what files were affected in this change
<br><dt><code>comments</code><dd>(str) comments reguarding the change. 
</dl>
     The <code>Change</code> methods asText and asDict can be used to format the
information above.  asText returns a list of strings and asDict returns
a dictonary suitable for html/mail rendering. 
<br><dt>&bull;Log information<dd>
     <pre class="example">          logs = list()
          for log in build.getLogs():
              log_name = "%s.%s" % (log.getStep().getName(), log.getName())
              log_status, dummy = log.getStep().getResults()
              log_body = log.getText().splitlines() # Note: can be VERY LARGE
              log_url = '%s/steps/%s/logs/%s' % (master_status.getURLForThing(build),
                                                 log.getStep().getName(),
                                                 log.getName())
              logs.append((log_name, log_url, log_body, log_status))
</pre>
     </dl>

<div class="node">
<a name="IRC-Bot"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#PBListener">PBListener</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#MailNotifier">MailNotifier</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Status-Targets">Status Targets</a>

</div>

<h4 class="subsection">4.14.3 IRC Bot</h4>

<p><a name="index-IRC-145"></a><a name="index-buildbot_002estatus_002ewords_002eIRC-146"></a>

   <p>The <code>buildbot.status.words.IRC</code> status target creates an IRC bot
which will attach to certain channels and be available for status
queries. It can also be asked to announce builds as they occur, or be
told to shut up.

<pre class="example">     from buildbot.status import words
     irc = words.IRC("irc.example.org", "botnickname",
                     channels=[{"channel": "#example1"},
                               {"channel": "#example2",
                                "password": "somesecretpassword"}],
                     password="mysecretnickservpassword",
                     notify_events={
                       'exception': 1,
                       'successToFailure': 1,
                       'failureToSuccess': 1,
                     })
     c['status'].append(irc)
</pre>
   <p>Take a look at the docstring for <code>words.IRC</code> for more details on
configuring this service. Note that the <code>useSSL</code> option requires
<code>PyOpenSSL</code>.  The <code>password</code> argument, if provided, will be sent to
Nickserv to claim the nickname: some IRC servers will not allow clients to send
private messages until they have logged in with a password. We can also specify
a different <code>port</code> number. Defalut values is 6667.

   <p>To use the service, you address messages at the buildbot, either
normally (<code>botnickname: status</code>) or with private messages
(<code>/msg botnickname status</code>). The buildbot will respond in kind.

   <p>If you issue a command that is currently not available, the buildbot
will respond with an error message. If the <code>noticeOnChannel=True</code>
option was used, error messages will be sent as channel notices instead
of messaging. The default value is <code>noticeOnChannel=False</code>.

   <p>Some of the commands currently available:

     <dl>
<dt><code>list builders</code><dd>Emit a list of all configured builders
<br><dt><code>status BUILDER</code><dd>Announce the status of a specific Builder: what it is doing right now. 
<br><dt><code>status all</code><dd>Announce the status of all Builders
<br><dt><code>watch BUILDER</code><dd>If the given Builder is currently running, wait until the Build is
finished and then announce the results. 
<br><dt><code>last BUILDER</code><dd>Return the results of the last build to run on the given Builder. 
<br><dt><code>notify on|off|list EVENT</code><dd>Report events relating to builds.  If the command is issued as a
private message, then the report will be sent back as a private
message to the user who issued the command.  Otherwise, the report
will be sent to the channel.  Available events to be notified are:

          <dl>
<dt><code>started</code><dd>A build has started
<br><dt><code>finished</code><dd>A build has finished
<br><dt><code>success</code><dd>A build finished successfully
<br><dt><code>failure</code><dd>A build failed
<br><dt><code>exception</code><dd>A build generated and exception
<br><dt><code>xToY</code><dd>The previous build was x, but this one is Y, where x and Y are each
one of success, warnings, failure, exception (except Y is
capitalized).  For example: successToFailure will notify if the
previous build was successful, but this one failed
</dl>

     <br><dt><code>help COMMAND</code><dd>Describe a command. Use <code>help commands</code> to get a list of known
commands. 
<br><dt><code>source</code><dd>Announce the URL of the Buildbot's home page. 
<br><dt><code>version</code><dd>Announce the version of this Buildbot. 
</dl>

   <p>Additionally, the config file may specify default notification options
as shown in the example earlier.

   <p>If the <code>allowForce=True</code> option was used, some addtional commands
will be available:

     <dl>
<dt><code>force build [--branch=BRANCH] [--revision=REVISION] BUILDER REASON</code><dd>Tell the given Builder to start a build of the latest code. The user
requesting the build and REASON are recorded in the Build status. The
buildbot will announce the build's status when it finishes. The user
can specify a branch and/or revision with the optional parameters
<code>--branch=BRANCH</code> and <code>--revision=REVISION</code>.

     <br><dt><code>stop build BUILDER REASON</code><dd>Terminate any running build in the given Builder. REASON will be added
to the build status to explain why it was stopped. You might use this
if you committed a bug, corrected it right away, and don't want to
wait for the first build (which is destined to fail) to complete
before starting the second (hopefully fixed) build. 
</dl>

   <p>If the <code>categories</code> is set to a category of builders (see categories
option in <a href="#Builder-Configuration">Builder Configuration</a>) changes related to only that
category of builders will be sent to the channel.

<div class="node">
<a name="PBListener"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#StatusPush">StatusPush</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#IRC-Bot">IRC Bot</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Status-Targets">Status Targets</a>

</div>

<h4 class="subsection">4.14.4 PBListener</h4>

<p><a name="index-PBListener-147"></a><a name="index-buildbot_002estatus_002eclient_002ePBListener-148"></a>

<pre class="example">     import buildbot.status.client
     pbl = buildbot.status.client.PBListener(port=int, user=str,
                                             passwd=str)
     c['status'].append(pbl)
</pre>
   <p>This sets up a PB listener on the given TCP port, to which a PB-based
status client can connect and retrieve status information. 
<code>buildbot statusgui</code> (see <a href="#statusgui">statusgui</a>) is an example of such a
status client. The <code>port</code> argument can also be a strports
specification string.

<div class="node">
<a name="StatusPush"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#HttpStatusPush">HttpStatusPush</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#PBListener">PBListener</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Status-Targets">Status Targets</a>

</div>

<h4 class="subsection">4.14.5 StatusPush</h4>

<p><a name="index-StatusPush-149"></a><a name="index-buildbot_002estatus_002estatus_005fpush_002eStatusPush-150"></a>

<pre class="example">     def Process(self):
       print str(self.queue.popChunk())
       self.queueNextServerPush()
     
     import buildbot.status.status_push
     sp = buildbot.status.status_push.StatusPush(serverPushCb=Process,
                                                 bufferDelay=0.5,
                                                 retryDelay=5)
     c['status'].append(sp)
</pre>
   <p>StatusPush batches events normally processed and sends it to the
serverPushCb callback every bufferDelay seconds. The callback
should pop items from the queue and then queue the next callback. 
If no items were poped from self.queue, retryDelay seconds will be
waited instead.

<div class="node">
<a name="HttpStatusPush"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#GerritStatusPush">GerritStatusPush</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#StatusPush">StatusPush</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Status-Targets">Status Targets</a>

</div>

<h4 class="subsection">4.14.6 HttpStatusPush</h4>

<p><a name="index-HttpStatusPush-151"></a><a name="index-buildbot_002estatus_002estatus_005fpush_002eHttpStatusPush-152"></a>

<pre class="example">     import buildbot.status.status_push
     sp = buildbot.status.status_push.HttpStatusPush(
             serverUrl="http://example.com/submit")
     c['status'].append(sp)
</pre>
   <p>HttpStatusPush builds on StatusPush and sends HTTP requests to
serverUrl, with all the items json-encoded. It is useful to create a
status front end outside of buildbot for better scalability.

<div class="node">
<a name="GerritStatusPush"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Writing-New-Status-Plugins">Writing New Status Plugins</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#HttpStatusPush">HttpStatusPush</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Status-Targets">Status Targets</a>

</div>

<h4 class="subsection">4.14.7 GerritStatusPush</h4>

<p><a name="index-GerritStatusPush-153"></a><a name="index-buildbot_002estatus_002estatus_005fgerrit_002eGerritStatusPush-154"></a>

<pre class="example">     from buildbot.status.status_gerrit import GerritStatusPush
     
     def gerritReviewCB(builderName, build, result, arg):
         message =  "Buildbot finished compiling your patchset\n"
         message += "on configuration: %s\n" % builderName
         message += "The result is: %s\n" % Results[result].upper()
     
         if arg:
             message += "\nFor more details visit:\n"
             message += "%sbuilders/%s/builds/%d\n" % (arg, builderName, build.getNumber())
     
         # message, verified, reviewed
         return message, (result == 0 or -1), 0
     
     c['buildbotURL'] = 'http://buildbot.example.com/'
     c['status'].append(GerritStatusPush('127.0.0.1', 'buildbot',
                                         reviewCB=gerritReviewCB,
                                         reviewArg=c['buildbotURL']))
</pre>
   <p>GerritStatusPush sends review of the Change back to the Gerrit server.

<div class="node">
<a name="Writing-New-Status-Plugins"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Status-Target-Index">Status Target Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#GerritStatusPush">GerritStatusPush</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Status-Targets">Status Targets</a>

</div>

<h4 class="subsection">4.14.8 Writing New Status Plugins</h4>

<p>TODO: this needs a lot more examples

   <p>Each status plugin is an object which provides the
<code>twisted.application.service.IService</code> interface, which creates a
tree of Services with the buildmaster at the top [not strictly true]. 
The status plugins are all children of an object which implements
<code>buildbot.interfaces.IStatus</code>, the main status object. From this
object, the plugin can retrieve anything it wants about current and
past builds. It can also subscribe to hear about new and upcoming
builds.

   <p>Status plugins which only react to human queries (like the Waterfall
display) never need to subscribe to anything: they are idle until
someone asks a question, then wake up and extract the information they
need to answer it, then they go back to sleep. Plugins which need to
act spontaneously when builds complete (like the MailNotifier plugin)
need to subscribe to hear about new builds.

   <p>If the status plugin needs to run network services (like the HTTP
server used by the Waterfall plugin), they can be attached as Service
children of the plugin itself, using the <code>IServiceCollection</code>
interface.

<div class="node">
<a name="Status-Target-Index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Writing-New-Status-Plugins">Writing New Status Plugins</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Status-Targets">Status Targets</a>

</div>

<h4 class="subsection">4.14.9 Status Target Index</h4>



<ul class="index-st" compact>
<li><a href="#index-buildbot_002estatus_002eclient_002ePBListener-148"><code>buildbot.status.client.PBListener</code></a>: <a href="#PBListener">PBListener</a></li>
<li><a href="#index-buildbot_002estatus_002email_002eMailNotifier-144"><code>buildbot.status.mail.MailNotifier</code></a>: <a href="#MailNotifier">MailNotifier</a></li>
<li><a href="#index-buildbot_002estatus_002estatus_005fgerrit_002eGerritStatusPush-154"><code>buildbot.status.status_gerrit.GerritStatusPush</code></a>: <a href="#GerritStatusPush">GerritStatusPush</a></li>
<li><a href="#index-buildbot_002estatus_002estatus_005fpush_002eHttpStatusPush-152"><code>buildbot.status.status_push.HttpStatusPush</code></a>: <a href="#HttpStatusPush">HttpStatusPush</a></li>
<li><a href="#index-buildbot_002estatus_002estatus_005fpush_002eStatusPush-150"><code>buildbot.status.status_push.StatusPush</code></a>: <a href="#StatusPush">StatusPush</a></li>
<li><a href="#index-buildbot_002estatus_002eweb_002ebaseweb_002eWebStatus-141"><code>buildbot.status.web.baseweb.WebStatus</code></a>: <a href="#WebStatus">WebStatus</a></li>
<li><a href="#index-buildbot_002estatus_002ewords_002eIRC-146"><code>buildbot.status.words.IRC</code></a>: <a href="#IRC-Bot">IRC Bot</a></li>
   </ul><div class="node">
<a name="Configuration-Index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Status-Targets">Status Targets</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration">Configuration</a>

</div>

<h3 class="section">4.15 Configuration Index</h3>



<ul class="index-bc" compact>
<li><a href="#index-c_005b_0027buildbotURL_0027_005d-21"><code>c['buildbotURL']</code></a>: <a href="#Site-Definition">Site Definition</a></li>
<li><a href="#index-c_005b_0027buildCacheSize_0027_005d-28"><code>c['buildCacheSize']</code></a>: <a href="#Data-Lifetime">Data Lifetime</a></li>
<li><a href="#index-c_005b_0027builders_0027_005d-69"><code>c['builders']</code></a>: <a href="#Builder-Configuration">Builder Configuration</a></li>
<li><a href="#index-c_005b_0027buildHorizon_0027_005d-30"><code>c['buildHorizon']</code></a>: <a href="#Data-Lifetime">Data Lifetime</a></li>
<li><a href="#index-c_005b_0027caches_0027_005d-26"><code>c['caches']</code></a>: <a href="#Data-Lifetime">Data Lifetime</a></li>
<li><a href="#index-c_005b_0027change_005fsource_0027_005d-40"><code>c['change_source']</code></a>: <a href="#Configuring-Change-Sources">Configuring Change Sources</a></li>
<li><a href="#index-c_005b_0027changeCacheSize_0027_005d-32"><code>c['changeCacheSize']</code></a>: <a href="#Data-Lifetime">Data Lifetime</a></li>
<li><a href="#index-c_005b_0027changeHorizon_0027_005d-29"><code>c['changeHorizon']</code></a>: <a href="#Data-Lifetime">Data Lifetime</a></li>
<li><a href="#index-c_005b_0027debugPassword_0027_005d-38"><code>c['debugPassword']</code></a>: <a href="#Debug-Options">Debug Options</a></li>
<li><a href="#index-c_005b_0027eventHorizon_0027_005d-31"><code>c['eventHorizon']</code></a>: <a href="#Data-Lifetime">Data Lifetime</a></li>
<li><a href="#index-c_005b_0027logCompressionLimit_0027_005d-22"><code>c['logCompressionLimit']</code></a>: <a href="#Log-Handling">Log Handling</a></li>
<li><a href="#index-c_005b_0027logCompressionMethod_0027_005d-23"><code>c['logCompressionMethod']</code></a>: <a href="#Log-Handling">Log Handling</a></li>
<li><a href="#index-c_005b_0027logHorizon_0027_005d-27"><code>c['logHorizon']</code></a>: <a href="#Data-Lifetime">Data Lifetime</a></li>
<li><a href="#index-c_005b_0027logMaxSize_0027_005d-24"><code>c['logMaxSize']</code></a>: <a href="#Log-Handling">Log Handling</a></li>
<li><a href="#index-c_005b_0027logMaxTailSize_0027_005d-25"><code>c['logMaxTailSize']</code></a>: <a href="#Log-Handling">Log Handling</a></li>
<li><a href="#index-c_005b_0027manhole_0027_005d-39"><code>c['manhole']</code></a>: <a href="#Debug-Options">Debug Options</a></li>
<li><a href="#index-c_005b_0027mergeRequests_0027_005d-33"><code>c['mergeRequests']</code></a>: <a href="#Merging-Build-Requests-_0028global-option_0029">Merging Build Requests (global option)</a></li>
<li><a href="#index-c_005b_0027prioritizeBuilders_0027_005d-34"><code>c['prioritizeBuilders']</code></a>: <a href="#Prioritizing-Builders">Prioritizing Builders</a></li>
<li><a href="#index-c_005b_0027properties_0027_005d-36"><code>c['properties']</code></a>: <a href="#Defining-Global-Properties">Defining Global Properties</a></li>
<li><a href="#index-c_005b_0027schedulers_0027_005d-50"><code>c['schedulers']</code></a>: <a href="#Configuring-Schedulers">Configuring Schedulers</a></li>
<li><a href="#index-c_005b_0027slavePortnum_0027_005d-35"><code>c['slavePortnum']</code></a>: <a href="#Setting-the-PB-Port-for-Slaves">Setting the PB Port for Slaves</a></li>
<li><a href="#index-c_005b_0027slaves_0027_005d-67"><code>c['slaves']</code></a>: <a href="#Buildslaves">Buildslaves</a></li>
<li><a href="#index-c_005b_0027status_0027_005d-139"><code>c['status']</code></a>: <a href="#Status-Targets">Status Targets</a></li>
<li><a href="#index-c_005b_0027title_0027_005d-19"><code>c['title']</code></a>: <a href="#Site-Definition">Site Definition</a></li>
<li><a href="#index-c_005b_0027titleURL_0027_005d-20"><code>c['titleURL']</code></a>: <a href="#Site-Definition">Site Definition</a></li>
   </ul><div class="node">
<a name="Customization"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Command_002dline-Tools">Command-line Tools</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configuration">Configuration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">5 Customization</h2>

<p>For advanced users, Buildbot acts as a framework supporting a customized build
framework.  For the most part, such configurations consist of subclasses set up
for use in a regular Buildbot configuration file.

   <p>This chapter describes the varieties of subclasses that are supported, and how
to write them.  For the most part, the interfaces themselves are documented in
the API documentation.

<ul class="menu">
<li><a accesskey="1" href="#Writing-Change-Sources">Writing Change Sources</a>
</ul>

<div class="node">
<a name="Writing-Change-Sources"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#Customization">Customization</a>

</div>

<h3 class="section">5.1 Writing Change Sources</h3>

<p>For some version-control systems, making Bulidbot aware of new changes can be a
challenge.  If the pre-supplied classes in see <a href="#Change-Sources">Change Sources</a> are not
sufficient, then you will need to write your own.

   <p>There are three approaches, one of which is not even a change source. 
The first option is to write a change source that exposes some service to
which the version control system can "push" changes.  This can be more
complicated, since it requires implementing a new service, but delivers changes
to Buildbot immediately on commit.

   <p>The second option is often preferable to the first: implement a notification
service in an external process (perhaps one that is started directly by the
version control system, or by an email server) and delivers changes to Buildbot
via see <a href="#PBChangeSource">PBChangeSource</a>.  This section does not describe this particular
approach, since it requires no customization within the buildmaster process.

   <p>The third option is to write a change source which polls for changes -
repeatedly connecting to an external service to check for new changes.  This
works well in many cases, but can produce a high load on the version control
system if polling is too frequent, and can take too long to notice changes if
the polling is not frequent enough.

<ul class="menu">
<li><a accesskey="1" href="#Writing-a-Change-Source">Writing a Change Source</a>
<li><a accesskey="2" href="#Writing-a-Change-Poller">Writing a Change Poller</a>
</ul>

<div class="node">
<a name="Writing-a-Change-Source"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Writing-a-Change-Poller">Writing a Change Poller</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Writing-Change-Sources">Writing Change Sources</a>

</div>

<h4 class="subsection">5.1.1 Writing a Change Source</h4>

<p><a name="index-buildbot_002echanges_002ebase_002eChangeSource-155"></a>
A custom change source must implement <code>buildbot.interfaces.IChangeSource</code>.

   <p>The easiest way to do this is to subclass
<code>buildbot.changes.base.ChangeSource</code>, implementing the <code>describe</code>
method to describe the instance.  <code>ChangeSource</code> is a Twisted service, so
you will need to implement the <code>startService</code> and <code>stopService</code>
methods to control the means by which your change source receives
notifications.

   <p>When the class does receive a change, it should call
<code>self.master.addChange(..)</code> to submit it to the buildmaster.  This method
shares the same parameters as <code>master.db.changes.addChange</code>, so consult
the API documentation for that function for details on the available arguments.

   <p>You will probably also want to set <code>compare_attrs</code> to the list of object
attributes which Buildbot will use to compare one change source to another when
reconfiguring.  During reconfiguration, if the new change source is different
from the old, then the old will be stopped and the new started.

<div class="node">
<a name="Writing-a-Change-Poller"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Writing-a-Change-Source">Writing a Change Source</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Writing-Change-Sources">Writing Change Sources</a>

</div>

<h4 class="subsection">5.1.2 Writing a Change Poller</h4>

<p><a name="index-buildbot_002echanges_002ebase_002ePollingChangeSource-156"></a>
Polilng is a very common means of seeking changes, so Buildbot supplies a
utility parent class to make it easier.  A poller should subclass
<code>buildbot.changes.base.PollingChangeSource</code>, which is a subclass of
<code>ChangeSource</code>.  This subclass implements the <code>Service</code> methods, and
causes the <code>poll</code> method to be called every <code>self.pollInterval</code>
seconds.  This method should return a Deferred to signal its completion.

   <p>Aside from the service methods, the other concerns in the previous section
apply here, too.

<div class="node">
<a name="Command-line-Tools"></a>
<a name="Command_002dline-Tools"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Resources">Resources</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Customization">Customization</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">6 Command-line Tools</h2>

<p>This section describes command-line tools available after buildbot
installation. Since version 0.8 the one-for-all <samp><span class="command">buildbot</span></samp>
command-line tool was divided into two parts namely <samp><span class="command">buildbot</span></samp>
and <samp><span class="command">buildslave</span></samp>. The last one was separated from main
command-line tool to minimize dependencies required for running a
buildslave while leaving all other functions to <samp><span class="command">buildbot</span></samp> tool.

   <p>Every command-line tool has a list of global options and a set of commands
which have their own options. One can run these tools in the following way:

<pre class="example">     buildbot [global options] <var>command</var> [command options]
</pre>
   <p>Global options are the same for both tools which perform the following
actions:
     <dl>
<dt><code>--help</code><dd>Print general help about available commands and global options and exit. 
All subsequent arguments are ignored.

     <br><dt><code>--verbose</code><dd>Set verbose output.

     <br><dt><code>--version</code><dd>Print current buildbot version and exit. All subsequent arguments are
ignored. 
</dl>

   <p>One can also get help on any command by specifying <var>&ndash;help</var> as a
command option:

<pre class="example">     buildbot <var>command</var> --help
</pre>
   <p>You can also use manual pages for <samp><span class="command">buildbot</span></samp> and
<samp><span class="command">buildslave</span></samp> for quick reference on command-line options.

<ul class="menu">
<li><a accesskey="1" href="#buildbot">buildbot</a>
<li><a accesskey="2" href="#buildslave">buildslave</a>
</ul>

<div class="node">
<a name="buildbot"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#buildslave">buildslave</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Command_002dline-Tools">Command-line Tools</a>

</div>

<h3 class="section">6.1 buildbot</h3>

<p>The <samp><span class="command">buildbot</span></samp> command-line tool can be used to start or stop a
buildmaster and to interact with a running buildmaster. Some of its
subcommands are intended for buildmaster admins, while some are for
developers who are editing the code that the buildbot is monitoring.

<ul class="menu">
<li><a accesskey="1" href="#Administrator-Tools">Administrator Tools</a>
<li><a accesskey="2" href="#Developer-Tools">Developer Tools</a>
<li><a accesskey="3" href="#Other-Tools">Other Tools</a>
<li><a accesskey="4" href="#g_t_002ebuildbot-config-directory">.buildbot config directory</a>
</ul>

<div class="node">
<a name="Administrator-Tools"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Developer-Tools">Developer Tools</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#buildbot">buildbot</a>

</div>

<h4 class="subsection">6.1.1 Administrator Tools</h4>

<p>The following <samp><span class="command">buildbot</span></samp> sub-commands are intended for
buildmaster administrators:

<ul class="menu">
<li><a accesskey="1" href="#create_002dmaster">create-master</a>
<li><a accesskey="2" href="#start-_0028buildbot_0029">start</a>
<li><a accesskey="3" href="#stop-_0028buildbot_0029">stop</a>
<li><a accesskey="4" href="#sighup">sighup</a>
</ul>

<div class="node">
<a name="create-master"></a>
<a name="create_002dmaster"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#start-_0028buildbot_0029">start (buildbot)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Administrator-Tools">Administrator Tools</a>

</div>

<h5 class="subsubsection">6.1.1.1 create-master</h5>

<p>This creates a new directory and populates it with files that allow it
to be used as a buildmaster's base directory.

   <p>You will usually want to use the <code>-r</code> option to create a relocatable
<code>buildbot.tac</code>.  This allows you to move the master directory without
editing this file.

<pre class="example">     buildbot create-master -r BASEDIR
</pre>
   <div class="node">
<a name="start-(buildbot)"></a>
<a name="start-_0028buildbot_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stop-_0028buildbot_0029">stop (buildbot)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#create_002dmaster">create-master</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Administrator-Tools">Administrator Tools</a>

</div>

<h5 class="subsubsection">6.1.1.2 start</h5>

<p>This starts a buildmaster which was already created in the given base
directory. The daemon is launched in the background, with events logged
to a file named <samp><span class="file">twistd.log</span></samp>.

<pre class="example">     buildbot start BASEDIR
</pre>
   <div class="node">
<a name="stop-(buildbot)"></a>
<a name="stop-_0028buildbot_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sighup">sighup</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#start-_0028buildbot_0029">start (buildbot)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Administrator-Tools">Administrator Tools</a>

</div>

<h5 class="subsubsection">6.1.1.3 stop</h5>

<p>This terminates the buildmaster running in the given directory.

<pre class="example">     buildbot stop BASEDIR
</pre>
   <div class="node">
<a name="sighup"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stop-_0028buildbot_0029">stop (buildbot)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Administrator-Tools">Administrator Tools</a>

</div>

<h5 class="subsubsection">6.1.1.4 sighup</h5>

<p>This sends a SIGHUP to the buildmaster running in the given directory,
which causes it to re-read its <samp><span class="file">master.cfg</span></samp> file.

<pre class="example">     buildbot sighup BASEDIR
</pre>
   <div class="node">
<a name="Developer-Tools"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Other-Tools">Other Tools</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Administrator-Tools">Administrator Tools</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#buildbot">buildbot</a>

</div>

<h4 class="subsection">6.1.2 Developer Tools</h4>

<p>These tools are provided for use by the developers who are working on
the code that the buildbot is monitoring.

<ul class="menu">
<li><a accesskey="1" href="#statuslog">statuslog</a>
<li><a accesskey="2" href="#statusgui">statusgui</a>
<li><a accesskey="3" href="#try">try</a>
</ul>

<div class="node">
<a name="statuslog"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#statusgui">statusgui</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Tools">Developer Tools</a>

</div>

<h5 class="subsubsection">6.1.2.1 statuslog</h5>

<pre class="example">     buildbot statuslog --master <var>MASTERHOST</var>:<var>PORT</var>
</pre>
   <p>This command starts a simple text-based status client, one which just
prints out a new line each time an event occurs on the buildmaster.

   <p>The <samp><span class="option">--master</span></samp> option provides the location of the
<code>buildbot.status.client.PBListener</code> status port, used to deliver
build information to realtime status clients. The option is always in
the form of a string, with hostname and port number separated by a
colon (<code>HOSTNAME:PORTNUM</code>). Note that this port is <em>not</em> the
same as the slaveport (although a future version may allow the same
port number to be used for both purposes). If you get an error message
to the effect of &ldquo;Failure: twisted.cred.error.UnauthorizedLogin:&rdquo;,
this may indicate that you are connecting to the slaveport rather than
a <code>PBListener</code> port.

   <p>The <samp><span class="option">--master</span></samp> option can also be provided by the
<code>masterstatus</code> name in <samp><span class="file">.buildbot/options</span></samp> (see <a href="#g_t_002ebuildbot-config-directory">.buildbot config directory</a>).

<div class="node">
<a name="statusgui"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#try">try</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#statuslog">statuslog</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Tools">Developer Tools</a>

</div>

<h5 class="subsubsection">6.1.2.2 statusgui</h5>

<p><a name="index-statusgui-157"></a>
If you have set up a PBListener (see <a href="#PBListener">PBListener</a>), you will be able
to monitor your Buildbot using a simple Gtk+ application invoked with
the <code>buildbot statusgui</code> command:

<pre class="example">     buildbot statusgui --master <var>MASTERHOST</var>:<var>PORT</var>
</pre>
   <p>This command starts a simple Gtk+-based status client, which contains a few
boxes for each Builder that change color as events occur. It uses the same
<samp><span class="option">--master</span></samp> argument and <code>masterstatus</code> option as the
<samp><span class="command">buildbot statuslog</span></samp> command (see <a href="#statuslog">statuslog</a>).

<div class="node">
<a name="try"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#statusgui">statusgui</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Tools">Developer Tools</a>

</div>

<h5 class="subsubsection">6.1.2.3 try</h5>

<p>This lets a developer to ask the question &ldquo;What would happen if I
committed this patch right now?&rdquo;. It runs the unit test suite (across
multiple build platforms) on the developer's current code, allowing
them to make sure they will not break the tree when they finally
commit their changes.

   <p>The <samp><span class="command">buildbot try</span></samp> command is meant to be run from within a
developer's local tree, and starts by figuring out the base revision
of that tree (what revision was current the last time the tree was
updated), and a patch that can be applied to that revision of the tree
to make it match the developer's copy. This (revision, patch) pair is
then sent to the buildmaster, which runs a build with that
SourceStamp. If you want, the tool will emit status messages as the
builds run, and will not terminate until the first failure has been
detected (or the last success).

   <p>There is an alternate form which accepts a pre-made patch file
(typically the output of a command like 'svn diff'). This &ldquo;&ndash;diff&rdquo;
form does not require a local tree to run from. See See <a href="#try">try</a>, concerning
the &ldquo;&ndash;diff&rdquo; command option.

   <p>For this command to work, several pieces must be in place: the See <a href="#Try-Schedulers">Try Schedulers</a>, as well as some client-side configuration.

<h3 class="heading">locating the master</h3>

<p>The <samp><span class="command">try</span></samp> command needs to be told how to connect to the
try scheduler, and must know which of the authentication
approaches described above is in use by the buildmaster. You specify
the approach by using <samp><span class="option">--connect=ssh</span></samp> or <samp><span class="option">--connect=pb</span></samp>
(or <code>try_connect = 'ssh'</code> or <code>try_connect = 'pb'</code> in
<samp><span class="file">.buildbot/options</span></samp>).

   <p>For the PB approach, the command must be given a <samp><span class="option">--master</span></samp>
argument (in the form HOST:PORT) that points to TCP port that you picked
in the <code>Try_Userpass</code> scheduler. It also takes a
<samp><span class="option">--username</span></samp> and <samp><span class="option">--passwd</span></samp> pair of arguments that match
one of the entries in the buildmaster's <code>userpass</code> list. These
arguments can also be provided as <code>try_master</code>,
<code>try_username</code>, and <code>try_password</code> entries in the
<samp><span class="file">.buildbot/options</span></samp> file.

   <p>For the SSH approach, the command must be given <samp><span class="option">--host</span></samp> and
<samp><span class="option">--username</span></samp> to get to the buildmaster host. It must also be
given <samp><span class="option">--jobdir</span></samp>, which points to the inlet directory configured
above. The jobdir can be relative to the user's home directory, but most
of the time you will use an explicit path like
<samp><span class="file">~buildbot/project/jobdir</span></samp>. These arguments can be provided in
<samp><span class="file">.buildbot/options</span></samp> as <code>try_host</code>, <code>try_username</code>, and
<code>try_jobdir</code>.

   <p>In addition, the SSH approach needs to connect to a PBListener status
port, so it can retrieve and report the results of the build (the PB
approach uses the existing connection to retrieve status information,
so this step is not necessary). This requires a <samp><span class="option">--masterstatus</span></samp>
argument, or a <code>try_masterstatus</code> entry in <samp><span class="file">.buildbot/options</span></samp>,
in the form of a HOSTNAME:PORT string.

   <p>The following command line arguments are deprecated, but retained for
backward compatibility:

     <ul>
<li><samp><span class="option">--tryhost</span></samp> is replaced by <samp><span class="option">--host</span></samp>
<li><samp><span class="option">--trydir</span></samp> is replaced by <samp><span class="option">--jobdir</span></samp>
<li><samp><span class="option">--master</span></samp> is replaced by <samp><span class="option">--masterstatus</span></samp>
</ul>

   <p>Likewise, the following <samp><span class="file">.buildbot/options</span></samp> file entries are
deprecated, but retained for backward compatibility:

     <ul>
<li><code>try_dir</code> is replaced by <code>try_jobdir</code>
<li><code>masterstatus</code> is replaced by <code>try_masterstatus</code>
</ul>

<h3 class="heading">choosing the Builders</h3>

<p>A trial build is performed on multiple Builders at the same time, and
the developer gets to choose which Builders are used (limited to a set
selected by the buildmaster admin with the TryScheduler's
<code>builderNames=</code> argument). The set you choose will depend upon
what your goals are: if you are concerned about cross-platform
compatibility, you should use multiple Builders, one from each
platform of interest. You might use just one builder if that platform
has libraries or other facilities that allow better test coverage than
what you can accomplish on your own machine, or faster test runs.

   <p>The set of Builders to use can be specified with multiple
<samp><span class="option">--builder</span></samp> arguments on the command line. It can also be
specified with a single <code>try_builders</code> option in
<samp><span class="file">.buildbot/options</span></samp> that uses a list of strings to specify all
the Builder names:

<pre class="example">     try_builders = ["full-OSX", "full-win32", "full-linux"]
</pre>
   <p>If you are using the PB approach, you can get the names of the builders
that are configured for the try scheduler using the <code>get-builder-names</code>
argument:

<pre class="example">     buildbot try --get-builder-names --connect=pb --master=... --username=... --passwd=...
</pre>
   <h3 class="heading">specifying the VC system</h3>

<p>The <samp><span class="command">try</span></samp> command also needs to know how to take the
developer's current tree and extract the (revision, patch)
source-stamp pair. Each VC system uses a different process, so you
start by telling the <samp><span class="command">try</span></samp> command which VC system you are
using, with an argument like <samp><span class="option">--vc=cvs</span></samp> or <samp><span class="option">--vc=git</span></samp>. 
This can also be provided as <code>try_vc</code> in
<samp><span class="file">.buildbot/options</span></samp>.

   <p>The following names are recognized: <code>bzr</code> <code>cvs</code>
<code>darcs</code> <code>git</code> <code>hg</code> <code>mtn</code> <code>p4</code> <code>svn</code>

<h3 class="heading">finding the top of the tree</h3>

<p>Some VC systems (notably CVS and SVN) track each directory
more-or-less independently, which means the <samp><span class="command">try</span></samp> command
needs to move up to the top of the project tree before it will be able
to construct a proper full-tree patch. To accomplish this, the
<samp><span class="command">try</span></samp> command will crawl up through the parent directories
until it finds a marker file. The default name for this marker file is
<samp><span class="file">.buildbot-top</span></samp>, so when you are using CVS or SVN you should
<code>touch .buildbot-top</code> from the top of your tree before running
<samp><span class="command">buildbot try</span></samp>. Alternatively, you can use a filename like
<samp><span class="file">ChangeLog</span></samp> or <samp><span class="file">README</span></samp>, since many projects put one of
these files in their top-most directory (and nowhere else). To set
this filename, use <samp><span class="option">--topfile=ChangeLog</span></samp>, or set it in the
options file with <code>try_topfile = 'ChangeLog'</code>.

   <p>You can also manually set the top of the tree with
<samp><span class="option">--topdir=~/trees/mytree</span></samp>, or <code>try_topdir =
'~/trees/mytree'</code>. If you use <code>try_topdir</code>, in a
<samp><span class="file">.buildbot/options</span></samp> file, you will need a separate options file
for each tree you use, so it may be more convenient to use the
<code>try_topfile</code> approach instead.

   <p>Other VC systems which work on full projects instead of individual
directories (darcs, mercurial, git, monotone) do not require
<samp><span class="command">try</span></samp> to know the top directory, so the <samp><span class="option">--topfile</span></samp>
and <samp><span class="option">--topdir</span></samp> arguments will be ignored.

   <p>If the <samp><span class="command">try</span></samp> command cannot find the top directory, it will
abort with an error message.

   <p>The following command line arguments are deprecated, but retained for
backward compatibility:

     <ul>
<li><samp><span class="option">--try-topdir</span></samp> is replaced by <samp><span class="option">--topdir</span></samp>
<li><samp><span class="option">--try-topfile</span></samp> is replaced by <samp><span class="option">--topfile</span></samp>
</ul>

<h3 class="heading">determining the branch name</h3>

<p>Some VC systems record the branch information in a way that &ldquo;try&rdquo;
can locate it.  For the others, if you are using something other than
the default branch, you will have to tell the buildbot which branch
your tree is using. You can do this with either the <samp><span class="option">--branch</span></samp>
argument, or a <samp><span class="option">try_branch</span></samp> entry in the
<samp><span class="file">.buildbot/options</span></samp> file.

<h3 class="heading">determining the revision and patch</h3>

<p>Each VC system has a separate approach for determining the tree's base
revision and computing a patch.

     <dl>
    <dt><code>CVS</code><dd>
<samp><span class="command">try</span></samp> pretends that the tree is up to date. It converts the
current time into a <code>-D</code> time specification, uses it as the base
revision, and computes the diff between the upstream tree as of that
point in time versus the current contents. This works, more or less,
but requires that the local clock be in reasonably good sync with the
repository.

     <br><dt><code>SVN</code><dd><samp><span class="command">try</span></samp> does a <code>svn status -u</code> to find the latest
repository revision number (emitted on the last line in the &ldquo;Status
against revision: NN&rdquo; message). It then performs an <code>svn diff
-rNN</code> to find out how your tree differs from the repository version,
and sends the resulting patch to the buildmaster. If your tree is not
up to date, this will result in the &ldquo;try&rdquo; tree being created with
the latest revision, then <em>backwards</em> patches applied to bring it
&ldquo;back&rdquo; to the version you actually checked out (plus your actual
code changes), but this will still result in the correct tree being
used for the build.

     <br><dt><code>bzr</code><dd><samp><span class="command">try</span></samp> does a <code>bzr revision-info</code> to find the base revision,
then a <code>bzr diff -r$base..</code> to obtain the patch.

     <br><dt><code>Mercurial</code><dd><code>hg identify --debug</code> emits the full revision id (as opposed to
the common 12-char truncated) which is a SHA1 hash of the current
revision's contents. This is used as the base revision. 
<code>hg diff</code> then provides the patch relative to that
revision. For <samp><span class="command">try</span></samp> to work, your working directory must only
have patches that are available from the same remotely-available
repository that the build process' <code>source.Mercurial</code> will use.

     <br><dt><code>Perforce</code><dd><samp><span class="command">try</span></samp> does a <code>p4 changes -m1 ...</code> to determine the latest
changelist and implicitly assumes that the local tree is synched to this
revision. This is followed by a <code>p4 diff -du</code> to obtain the patch. 
A p4 patch differs sligtly from a normal diff. It contains full depot
paths and must be converted to paths relative to the branch top. To convert
the following restriction is imposed. The p4base (see see <a href="#P4Source">P4Source</a>)
 is assumed to be <code>//depot</code>

     <br><dt><code>Darcs</code><dd><samp><span class="command">try</span></samp> does a <code>darcs changes --context</code> to find the list
of all patches back to and including the last tag that was made. This text
file (plus the location of a repository that contains all these
patches) is sufficient to re-create the tree. Therefore the contents
of this &ldquo;context&rdquo; file <em>are</em> the revision stamp for a
Darcs-controlled source tree.  It then does a <code>darcs diff
-u</code> to compute the patch relative to that revision.

     <br><dt><code>Git</code><dd><code>git branch -v</code> lists all the branches available in the local
repository along with the revision ID it points to and a short summary
of the last commit. The line containing the currently checked out
branch begins with '* ' (star and space) while all the others start
with '  ' (two spaces). <samp><span class="command">try</span></samp> scans for this line and extracts
the branch name and revision from it. Then it generates a diff against
the base revision. 
<!-- TODO: I'm not sure if this actually works the way it's intended -->
<!-- since the extracted base revision might not actually exist in the -->
<!-- upstream repository. Perhaps we need to add a -remote option to -->
<!-- specify the remote tracking branch to generate a diff against. -->

     <br><dt><code>Monotone</code><dd><code>mtn automate get_base_revision_id</code> emits the full revision id
which is a SHA1 hash of the current revision's contents. This is used as
the base revision. 
<code>mtn diff</code> then provides the patch relative to that revision.  For
<samp><span class="command">try</span></samp> to work, your working directory must only have patches
that are available from the same remotely-available repository that the
build process' <code>source.Monotone</code> will use.

   </dl>

<h3 class="heading">showing who built</h3>

<p>You can provide the <samp><span class="option">--who=dev</span></samp> to designate who is running the
try build. This will add the <code>dev</code> to the Reason field on the try
build's status web page. You can also set <code>try_who = dev</code> in the
<samp><span class="file">.buildbot/options</span></samp> file. Note that <samp><span class="option">--who=dev</span></samp> will not
work on version 0.8.3 or earlier masters.

<h3 class="heading">waiting for results</h3>

<p>If you provide the <samp><span class="option">--wait</span></samp> option (or <code>try_wait = True</code>
in <samp><span class="file">.buildbot/options</span></samp>), the <samp><span class="command">buildbot try</span></samp> command will
wait until your changes have either been proven good or bad before
exiting. Unless you use the <samp><span class="option">--quiet</span></samp> option (or
<code>try_quiet=True</code>), it will emit a progress message every 60
seconds until the builds have completed.

   <p>Sometimes you might have a patch from someone else that you want to
submit to the buildbot. For example, a user may have created a patch
to fix some specific bug and sent it to you by email. You've inspected
the patch and suspect that it might do the job (and have at least
confirmed that it doesn't do anything evil). Now you want to test it
out.

   <p>One approach would be to check out a new local tree, apply the patch,
run your local tests, then use &ldquo;buildbot try&rdquo; to run the tests on
other platforms. An alternate approach is to use the <samp><span class="command">buildbot
try --diff</span></samp> form to have the buildbot test the patch without using a
local tree.

   <p>This form takes a <samp><span class="option">--diff</span></samp> argument which points to a file that
contains the patch you want to apply. By default this patch will be
applied to the TRUNK revision, but if you give the optional
<samp><span class="option">--baserev</span></samp> argument, a tree of the given revision will be used
as a starting point instead of TRUNK.

   <p>You can also use <samp><span class="command">buildbot try --diff=-</span></samp> to read the patch
from stdin.

   <p>Each patch has a &ldquo;patchlevel&rdquo; associated with it. This indicates the
number of slashes (and preceding pathnames) that should be stripped
before applying the diff. This exactly corresponds to the <samp><span class="option">-p</span></samp>
or <samp><span class="option">--strip</span></samp> argument to the <samp><span class="command">patch</span></samp> utility. By
default <samp><span class="command">buildbot try --diff</span></samp> uses a patchlevel of 0, but you
can override this with the <samp><span class="option">-p</span></samp> argument.

   <p>When you use <samp><span class="option">--diff</span></samp>, you do not need to use any of the other
options that relate to a local tree, specifically <samp><span class="option">--vc</span></samp>,
<samp><span class="option">--topfile</span></samp>, or <samp><span class="option">--topdir</span></samp>. These options will
be ignored. Of course you must still specify how to get to the
buildmaster (with <samp><span class="option">--connect</span></samp>, <samp><span class="option">--host</span></samp>, etc).

<div class="node">
<a name="Other-Tools"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002ebuildbot-config-directory">.buildbot config directory</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Developer-Tools">Developer Tools</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#buildbot">buildbot</a>

</div>

<h4 class="subsection">6.1.3 Other Tools</h4>

<p>These tools are generally used by buildmaster administrators.

<ul class="menu">
<li><a accesskey="1" href="#sendchange">sendchange</a>
<li><a accesskey="2" href="#debugclient">debugclient</a>
</ul>

<div class="node">
<a name="sendchange"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#debugclient">debugclient</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Other-Tools">Other Tools</a>

</div>

<h5 class="subsubsection">6.1.3.1 sendchange</h5>

<p>This command is used to tell the buildmaster about source changes. It
is intended to be used from within a commit script, installed on the
VC server. It requires that you have a PBChangeSource
(see <a href="#PBChangeSource">PBChangeSource</a>) running in the buildmaster (by being set in
<code>c['change_source']</code>).

<pre class="example">     buildbot sendchange --master <var>MASTERHOST</var>:<var>PORT</var> --auth <var>USER</var>:<var>PASS</var> \
             --who <var>COMMITTER</var> <var>FILENAMES..</var>
</pre>
   <p>The <code>auth</code> option specifies the credentials to use to connect to the
master, in the form <code>user:pass</code>.  If the password is omitted, then
sendchange will prompt for it.  If both are omitted, the old default (username
"change" and password "changepw") will be used.  Note that this password is
well-known, and should not be used on an internet-accessible port.

   <p>The <code>master</code> and <code>who</code> arguments can also be given in the
options file (see <a href="#g_t_002ebuildbot-config-directory">.buildbot config directory</a>).  There are other (optional)
arguments which can influence the <code>Change</code> that gets submitted:

     <dl>
<dt><code>--branch</code><dd>(or option <code>branch</code>) This provides the (string) branch specifier. If
omitted, it defaults to None, indicating the &ldquo;default branch&rdquo;. All files
included in this Change must be on the same branch.

     <br><dt><code>--category</code><dd>(or option <code>category</code>) This provides the (string) category specifier. If
omitted, it defaults to None, indicating &ldquo;no category&rdquo;. The category property
can be used by Schedulers to filter what changes they listen to.

     <br><dt><code>--project</code><dd>(or option <code>project</code>) This provides the (string) project to which this
change applies, and defaults to &rdquo;.  The project can be used by schedulers to
decide which builders should respond to a particular change.

     <br><dt><code>--repository</code><dd>(or option <code>repository</code>) This provides the repository from which this
change came, and defaults to &rdquo;.

     <br><dt><code>--revision</code><dd>This provides a revision specifier, appropriate to the VC system in use.

     <br><dt><code>--revision_file</code><dd>This provides a filename which will be opened and the contents used as
the revision specifier. This is specifically for Darcs, which uses the
output of <samp><span class="command">darcs changes --context</span></samp> as a revision specifier. 
This context file can be a couple of kilobytes long, spanning a couple
lines per patch, and would be a hassle to pass as a command-line
argument.

     <br><dt><code>--property</code><dd>This parameter is used to set a property on the Change generated by sendchange. 
Properties are specified as a name:value pair, separated by a colon. You may
specify many properties by passing this parameter multiple times.

     <br><dt><code>--comments</code><dd>This provides the change comments as a single argument. You may want
to use <samp><span class="option">--logfile</span></samp> instead.

     <br><dt><code>--logfile</code><dd>This instructs the tool to read the change comments from the given
file. If you use <code>-</code> as the filename, the tool will read the
change comments from stdin.

     <br><dt><code>--encoding</code><dd>Specifies the character encoding for all other parameters, defaulting to 'utf8'.

   </dl>

<div class="node">
<a name="debugclient"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendchange">sendchange</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Other-Tools">Other Tools</a>

</div>

<h5 class="subsubsection">6.1.3.2 debugclient</h5>

<pre class="example">     buildbot debugclient --master <var>MASTERHOST</var>:<var>PORT</var> --passwd <var>DEBUGPW</var>
</pre>
   <p>This launches a small Gtk+/Glade-based debug tool, connecting to the
buildmaster's &ldquo;debug port&rdquo;. This debug port shares the same port
number as the slaveport (see <a href="#Setting-the-PB-Port-for-Slaves">Setting the PB Port for Slaves</a>), but the
<code>debugPort</code> is only enabled if you set a debug password in the
buildmaster's config file (see <a href="#Debug-Options">Debug Options</a>). The
<samp><span class="option">--passwd</span></samp> option must match the <code>c['debugPassword']</code>
value.

   <p><samp><span class="option">--master</span></samp> can also be provided in <samp><span class="file">.debug/options</span></samp> by the
<code>master</code> key. <samp><span class="option">--passwd</span></samp> can be provided by the
<code>debugPassword</code> key.  See <a href="#g_t_002ebuildbot-config-directory">.buildbot config directory</a>.

   <p>The <code>Connect</code> button must be pressed before any of the other
buttons will be active. This establishes the connection to the
buildmaster. The other sections of the tool are as follows:

     <dl>
<dt><code>Reload .cfg</code><dd>Forces the buildmaster to reload its <samp><span class="file">master.cfg</span></samp> file. This is
equivalent to sending a SIGHUP to the buildmaster, but can be done
remotely through the debug port. Note that it is a good idea to be
watching the buildmaster's <samp><span class="file">twistd.log</span></samp> as you reload the config
file, as any errors which are detected in the config file will be
announced there.

     <br><dt><code>Rebuild .py</code><dd>(not yet implemented). The idea here is to use Twisted's &ldquo;rebuild&rdquo;
facilities to replace the buildmaster's running code with a new
version. Even if this worked, it would only be used by buildbot
developers.

     <br><dt><code>poke IRC</code><dd>This locates a <code>words.IRC</code> status target and causes it to emit a
message on all the channels to which it is currently connected. This
was used to debug a problem in which the buildmaster lost the
connection to the IRC server and did not attempt to reconnect.

     <br><dt><code>Commit</code><dd>This allows you to inject a Change, just as if a real one had been
delivered by whatever VC hook you are using. You can set the name of
the committed file and the name of the user who is doing the commit. 
Optionally, you can also set a revision for the change. If the
revision you provide looks like a number, it will be sent as an
integer, otherwise it will be sent as a string.

     <br><dt><code>Force Build</code><dd>This lets you force a Builder (selected by name) to start a build of
the current source tree.

     <br><dt><code>Currently</code><dd>(obsolete). This was used to manually set the status of the given
Builder, but the status-assignment code was changed in an incompatible
way and these buttons are no longer meaningful.

   </dl>

<div class="node">
<a name=".buildbot-config-directory"></a>
<a name="g_t_002ebuildbot-config-directory"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Other-Tools">Other Tools</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#buildbot">buildbot</a>

</div>

<h4 class="subsection">6.1.4 .buildbot config directory</h4>

<p>Many of the <samp><span class="command">buildbot</span></samp> tools must be told how to contact the
buildmaster that they interact with. This specification can be
provided as a command-line argument, but most of the time it will be
easier to set them in an &ldquo;options&rdquo; file. The <samp><span class="command">buildbot</span></samp>
command will look for a special directory named <samp><span class="file">.buildbot</span></samp>,
starting from the current directory (where the command was run) and
crawling upwards, eventually looking in the user's home directory. It
will look for a file named <samp><span class="file">options</span></samp> in this directory, and will
evaluate it as a python script, looking for certain names to be set. 
You can just put simple <code>name = 'value'</code> pairs in this file to
set the options.

   <p>For a description of the names used in this file, please see the
documentation for the individual <samp><span class="command">buildbot</span></samp> sub-commands. The
following is a brief sample of what this file's contents could be.

<pre class="example">     # for status-reading tools
     masterstatus = 'buildbot.example.org:12345'
     # for 'sendchange' or the debug port
     master = 'buildbot.example.org:18990'
     debugPassword = 'eiv7Po'
</pre>
   <p>Note carefully that the names in the <code>options</code> file usually do not match
the command-line option name.

     <dl>
<dt><code>masterstatus</code><dd>Equivalent to <code>--master</code> for <a href="#statuslog">statuslog</a> and <a href="#statusgui">statusgui</a>, this
gives the location of the <code>client.PBListener</code> status port.

     <br><dt><code>master</code><dd>Equivalent to <code>--master</code> for <a href="#debugclient">debugclient</a> and <a href="#sendchange">sendchange</a>. 
This option is used for two purposes.  It is the location of the
<code>debugPort</code> for <samp><span class="command">debugclient</span></samp> and the location of the
<code>pb.PBChangeSource</code> for <samp><span class="command">sendchange</span></samp>.  Generally these are the
same port.

     <br><dt><code>debugPassword</code><dd>Equivalent to <code>--passwd</code> for <a href="#debugclient">debugclient</a>.

     <p>XXX Must match the value of <code>c['debugPassword']</code>, used to protect the
debug port, for the <samp><span class="command">debugclient</span></samp> command.

     <br><dt><code>username</code><dd>Equivalent to <code>--username</code> for the <a href="#sendchange">sendchange</a> command.

     <br><dt><code>branch</code><dd>Equivalent to <code>--branch</code> for the <a href="#sendchange">sendchange</a> command.

     <br><dt><code>category</code><dd>Equivalent to <code>--category</code> for the <a href="#sendchange">sendchange</a> command.

     <br><dt><code>try_connect</code><dd>Equivalent to <code>--connect</code>, this specifies how the <a href="#try">try</a> command should
deliver its request to the buildmaster. The currently accepted values are
&ldquo;ssh&rdquo; and &ldquo;pb&rdquo;.

     <br><dt><code>try_builders</code><dd>Equivalent to <code>--builders</code>, specifies which builders should be used for
the <a href="#try">try</a> build.

     <br><dt><code>try_vc</code><dd>Equivalent to <code>--vc</code> for <a href="#try">try</a>, this specifies the version control
system being used.

     <br><dt><code>try_branch</code><dd>Equivlanent to <code>--branch</code>, this indicates that the current tree is on a non-trunk branch.

     <br><dt><code>try_topdir</code><br><dt><code>try_topfile</code><dd>Use <code>try_topdir</code>, equivalent to <code>--try-topdir</code>, to explicitly
indicate the top of your working tree, or <code>try_topfile</code>, equivalent to
<code>--try-topfile</code> to name a file that will only be found in that top-most
directory.

     <br><dt><code>try_host</code><br><dt><code>try_username</code><br><dt><code>try_dir</code><dd>When <code>try_connect</code> is &ldquo;ssh&rdquo;, the command will use <code>try_host</code> for
<code>--tryhost</code>, <code>try_username</code> for <code>--username</code>, and <code>try_dir</code>
for <code>--trydir</code>.  Apologies for the confusing presence and absence of
'try'.

     <br><dt><code>try_username</code><br><dt><code>try_password</code><br><dt><code>try_master</code><dd>Similarly, when <code>try_connect</code> is &ldquo;pb&rdquo;, the command will pay attention to
<code>try_username</code> for <code>--username</code>, <code>try_password</code> for
<code>--passwd</code>, and <code>try_master</code> for <code>--master</code>.

     <br><dt><code>try_wait</code><br><dt><code>masterstatus</code><dd><code>try_wait</code> and <code>masterstatus</code> (equivalent to <code>--wait</code> and
<code>master</code>, respectively) are used to ask the <a href="#try">try</a> command to wait for
the requested build to complete.

   </dl>

<div class="node">
<a name="buildslave"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#buildbot">buildbot</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Command_002dline-Tools">Command-line Tools</a>

</div>

<h3 class="section">6.2 buildslave</h3>

<p><samp><span class="command">buildslave</span></samp> command-line tool is used for buildslave management
only and does not provide any additional functionality. One can create,
start, stop and restart the buildslave.

<ul class="menu">
<li><a accesskey="1" href="#create_002dslave">create-slave</a>
<li><a accesskey="2" href="#start-_0028buildslave_0029">start</a>
<li><a accesskey="3" href="#stop-_0028buildslave_0029">stop</a>
</ul>

<div class="node">
<a name="create-slave"></a>
<a name="create_002dslave"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#start-_0028buildslave_0029">start (buildslave)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#buildslave">buildslave</a>

</div>

<h4 class="subsection">6.2.1 create-slave</h4>

<p>This creates a new directory and populates it with files that let it
be used as a buildslave's base directory. You must provide several
arguments, which are used to create the initial <samp><span class="file">buildbot.tac</span></samp>
file.

   <p>The <code>-r</code> option is advisable here, just like for <code>create-master</code>.

<pre class="example">     buildslave create-slave -r <var>BASEDIR</var> <var>MASTERHOST</var>:<var>PORT</var> <var>SLAVENAME</var> <var>PASSWORD</var>
</pre>
   <p>The create-slave options are described in See <a href="#Buildslave-Options">Buildslave Options</a>.

<div class="node">
<a name="start-(buildslave)"></a>
<a name="start-_0028buildslave_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stop-_0028buildslave_0029">stop (buildslave)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#create_002dslave">create-slave</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#buildslave">buildslave</a>

</div>

<h4 class="subsection">6.2.2 start</h4>

<p>This starts a buildslave which was already created in the given base
directory. The daemon is launched in the background, with events logged
to a file named <samp><span class="file">twistd.log</span></samp>.

<pre class="example">     buildbot start BASEDIR
</pre>
   <div class="node">
<a name="stop-(buildslave)"></a>
<a name="stop-_0028buildslave_0029"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#start-_0028buildslave_0029">start (buildslave)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#buildslave">buildslave</a>

</div>

<h4 class="subsection">6.2.3 stop</h4>

<p>This terminates the daemon buildslave running in the given directory.

<pre class="example">     buildbot stop BASEDIR
</pre>
   <div class="node">
<a name="Resources"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Developer-Information">Developer Information</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Command_002dline-Tools">Command-line Tools</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">7 Resources</h2>

<p>The Buildbot home page is <a href="http://buildbot.net/">http://buildbot.net/</a>.

   <p>For configuration questions and general discussion, please use the
<code>buildbot-devel</code> mailing list. The subscription instructions and
archives are available at
<a href="http://lists.sourceforge.net/lists/listinfo/buildbot-devel">http://lists.sourceforge.net/lists/listinfo/buildbot-devel</a>

   <p>The #buildbot channel on Freenode's IRC servers hosts development discussion, and
often folks are available to answer questions there, as well.

<div class="node">
<a name="Developer-Information"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Index">Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Resources">Resources</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">8 Developer Information</h2>

<p>This chapter is the official repository for the collected wisdom of the
Buildbot hackers.

   <p>It contains some sparse documentation of the inner workings of Buildbot, but of
course, the final reference for that is the source itself.

   <p>More importantly, this chapter represents the official repository of all
agreed-on patterns for use in Buildbot.  In this case, the source is a
<i>terrible</i> reference, because much of it is old and crusty.  But we are
trying to do things the new, better way, and those new, better ways are
described here.

<ul class="menu">
<li><a accesskey="1" href="#Buildmaster-Service-Hierarchy">Buildmaster Service Hierarchy</a>
<li><a accesskey="2" href="#Access-to-Configuration">Access to Configuration</a>
<li><a accesskey="3" href="#Utilities">Utilities</a>
<li><a accesskey="4" href="#The-Database">The Database</a>
<li><a accesskey="5" href="#Log-File-Format">Log File Format</a>
<li><a accesskey="6" href="#Web-Status">Web Status</a>
<li><a accesskey="7" href="#Obfuscating-Passwords">Obfuscating Passwords</a>
<li><a accesskey="8" href="#Master_002dSlave-API">Master-Slave API</a>
<li><a accesskey="9" href="#Twisted-Idioms">Twisted Idioms</a>
<li><a href="#Buildbot-Tests">Buildbot Tests</a>
<li><a href="#String-Encodings">String Encodings</a>
<li><a href="#Metrics">Metrics</a>
<li><a href="#Developer-Class-Index">Developer Class Index</a>
</ul>

<div class="node">
<a name="Buildmaster-Service-Hierarchy"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Access-to-Configuration">Access to Configuration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.1 Buildmaster Service Hierarchy</h3>

<p>Buildbot uses Twisted's service hierarchy heavily.  The hierarchy looks like
this:

     <ul>
<li>BuildMaster
<a name="index-buildbot_002emaster_002eBuildMaster-158"></a>
This is the top-level service.

          <ul>
<li>BotMaster
<a name="index-buildbot_002eprocess_002ebotmaster_002eBotMaster-159"></a>
The BotMaster manages all of the slaves.  BuildSlave instances are added as
child services of the BotMaster.

          <li>ChangeManager
<a name="index-buildbot_002echanges_002emanager_002eChangeManager-160"></a>
The ChangeManager manages the active change sources, as well as the stream of
changes received from those sources.

          <li>SchedulerManager
<a name="index-buildbot_002eschedulers_002emanager_002eSchedulerManager-161"></a>
The SchedulerManager manages the active schedulers and handles inter-scheduler
notifications.

          <li>IStatusReceiver implementations

          <p>Objects from the 'status' configuration key are attached directly to the
buildmaster. These classes should inherit from StatusReceiver or
StatusReceiverMultiService and include an 'implements(IStatusReceiver)' stanza.

     </ul>

   </ul>

<div class="node">
<a name="Access-to-Configuration"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Utilities">Utilities</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Buildmaster-Service-Hierarchy">Buildmaster Service Hierarchy</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.2 Access to Configuration</h3>

<p>The master object makes much of the configuration available from an object
named <code>master.config</code>.  Configuration is stored as attributes of this
object.  Where possible, components should access this configuration directly
and not cache the configuration values anywhere else.  This avoids the need to
ensure that update-from-configuration methods are called on a reconfig.

   <p>The available attributes are listed in the docstring for the
<code>buildbot.config.MasterConfig</code> class.

<div class="node">
<a name="Utilities"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-Database">The Database</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Access-to-Configuration">Access to Configuration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.3 Utilities</h3>

<ul class="menu">
<li><a accesskey="1" href="#buildbot_002eutil_002ebbcollections">buildbot.util.bbcollections</a>
<li><a accesskey="2" href="#buildbot_002eutil_002eeventual">buildbot.util.eventual</a>
<li><a accesskey="3" href="#buildbot_002eutil_002ejson">buildbot.util.json</a>
</ul>

<p>Several small utilities are available at the top-level <code>buildbot.util</code>
package.  As always, see the API documentation for more information.

     <dl>
<dt><code>natualSort</code><dd>
This function sorts strings "naturally", with embedded numbers sorted
numerically.  This ordering is good for objects which might have a numeric
suffix, e.g., <code>winslave1</code>, <code>winslave2</code>, ..

     <br><dt><code>formatInterval</code><dd>
This function will return a human-readable string describing a length of time,
given a number of seconds.

     <br><dt><code>ComparableMixin</code><dd>
This mixin class adds comparability to a subclass.  Use it like this:

     <pre class="example">          class Widget(FactoryProduct, ComparableMixin):
              compare_attrs = [ 'radius', 'thickness' ]
              # ...
</pre>
     <p>Any attributes not in <code>compare_attrs</code> will not be considered when
comparing objects.  This is particularly useful in implementing buildbot's
reconfig logic, where a simple comparison between the new and existing objects
can determine whether the new object should replace the existing object.

     <br><dt><code>safeTranslate</code><dd>
This function will filter out some inappropriate characters for filenames; it
is suitable for adapting strings from the configuration for use as filenames. 
It is not suitable for use with strings from untrusted sources.

     <br><dt><code>AsyncLRUCache</code><dd>
This is a least-recently-used cache.  Its constructor takes a maximum size. 
When the cache grows beyond this size, the least-recently used items will be
automatically removed from the cache.  The class has a <code>get</code> method that
takes a key and a function to call (with the key) when the key is not in the
cache.  Both <code>get</code> and the miss function return Deferreds.

     <br><dt><code>deferredLocked</code><dd>
This is a decorator to wrap an event-driven method (one returning a
<code>Deferred</code>) in an acquire/release pair of a designated
<code>DeferredLock</code>.  For simple functions with a static lock, this is as easy as

     <pre class="example">          someLock = defer.DeferredLock()
          @util.deferredLocked(someLock)
          def someLockedFunction(..):
              # ..
              return d
</pre>
     <p>for class methods which must access a lock that is an instance attribute, the
lock can be specified by a string, which will be dynamically resolved to the
specific instance at runtime:

     <pre class="example">              def __init__(self):
                  self.someLock = defer.DeferredLock()
          
              @util.deferredLocked('someLock')
              def someLockedFunction(..):
                  # ..
                  return d
</pre>
     <br><dt><code>epoch2datetime</code><dd>
Convert a UNIX epoch timestamp (an integer) to a Python datetime object, in the
UTC timezone.  Note that timestamps specify UTC time (modulo leap seconds and a
few other minor details).

     <br><dt><code>datetime2epoch</code><dd>
Convert an arbitrary Python datetime object into a UNIX epoch timestamp.

     <br><dt><code>UTC</code><dd>
A <code>datetime.tzinfo</code> subclass representing UTC time.  A similar class has
finally been added to Python in version 3.2, but the implementation is simple
enough to include here.  This is mostly used in tests to create timezeon-aware
datetime objects in UTC:

     <pre class="example">          dt = datetime.datetime(1978, 6, 15, 12, 31, 15, tzinfo=UTC)
</pre>
     </dl>

<div class="node">
<a name="buildbot.util.bbcollections"></a>
<a name="buildbot_002eutil_002ebbcollections"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#buildbot_002eutil_002eeventual">buildbot.util.eventual</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Utilities">Utilities</a>

</div>

<h4 class="subsection">8.3.1 buildbot.util.bbcollections</h4>

<p>This package provides a few useful collection objects.  Note that it used to be
named <code>collections</code>, but without absolute imports (PEP 328), this
precluded using the standard library's <code>collections</code> module.

   <p>For compatibility, it provides a clone of the Python
<code>bbcollections.defaultdict</code> for use in Python-2.4.  In later versions, this
is simply a reference to the built-in <code>defaultdict</code>, so buildbot code can
simply use <code>buildbot.util.collections.defaultdict</code> everywhere.

   <p>It also provides a <code>KeyedSets</code> class that can represent any numbers of
sets, keyed by name (or anything hashable, really).  The object is specially
tuned to contain many different keys over its lifetime without wasting memory. 
See the docstring for more information.

<div class="node">
<a name="buildbot.util.eventual"></a>
<a name="buildbot_002eutil_002eeventual"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#buildbot_002eutil_002ejson">buildbot.util.json</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#buildbot_002eutil_002ebbcollections">buildbot.util.bbcollections</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Utilities">Utilities</a>

</div>

<h4 class="subsection">8.3.2 buildbot.util.eventual</h4>

<p>This package provides a simple way to say "please do this later":

<pre class="example">     from buildbot.util.eventual import eventually
     def do_what_I_say(what, where):
         # ...
     eventually(do_what_I_say, "clean up", "your bedroom")
</pre>
   <p>The package defines "later" as "next time the reactor has control", so this is
a good way to avoid long loops that block other activity in the reactor. 
Callables given to <code>eventually</code> are guaranteed to be called in the same
order as the calls to <code>eventually</code>.  Any errors from the callable are
logged, but will not affect other callables.

   <p>If you need a deferred that will fire "later", use <code>fireEventually</code>.  This
function returns a deferred that will not errback.

<div class="node">
<a name="buildbot.util.json"></a>
<a name="buildbot_002eutil_002ejson"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#buildbot_002eutil_002eeventual">buildbot.util.eventual</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Utilities">Utilities</a>

</div>

<h4 class="subsection">8.3.3 buildbot.util.json</h4>

<p>This package is just an import of the best available JSON module.  Use it
instead of a more complex conditional import of <code>simplejson</code> or
<code>json</code>.

<div class="node">
<a name="The-Database"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Log-File-Format">Log File Format</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Utilities">Utilities</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.4 The Database</h3>

<p><a name="index-buildbot_002edb_002econnector_002eDBConnector-162"></a>
TODO

<ul class="menu">
<li><a accesskey="1" href="#Database-Schema">Database Schema</a>
<li><a accesskey="2" href="#Changing-the-Schema">Changing the Schema</a>
</ul>

<div class="node">
<a name="Database-Schema"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Changing-the-Schema">Changing the Schema</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Database">The Database</a>

</div>

<h4 class="subsection">8.4.1 Database Schema</h4>

<p><a name="index-buildbot_002edb_002eschema_002eDBSchemaManager-163"></a>
The SQL for the database schema is available in
<code>buildbot/db/schema/tables.sql</code>.  However, note that this file is not used
for new installations or upgrades of the Buildbot database.

   <p>Instead, the <code>buildbot.db.schema.DBSchemaManager</code> handles this task.  The
operation of this class centers around a linear sequence of database versions. 
Versions start at 0, which is the old pickle-file format.  The manager has
methods to query the version of the database, and the current version from the
source code.  It also has an <code>upgrade</code> method which will upgrade the
database to the latest version.  This operation is currently irreversible.

   <p>There is no operation to "install" the latest schema.  Instead, a fresh install
of buildbot begins with an (empty) version-0 database, and upgrades to the
current version.  This trades a bit of efficiency at install time for
assurances that the upgrade code is well-tested.

<div class="node">
<a name="Changing-the-Schema"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Database-Schema">Database Schema</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Database">The Database</a>

</div>

<h4 class="subsection">8.4.2 Changing the Schema</h4>

<p>To make a change to the database schema, follow these steps:

     <ol type=1 start=1>

     <li>
Increment <code>CURRENT_VERSION</code> in <code>buildbot/db/schema/manager.py</code> by
one.  This is your new version number.

     <li>
Create <samp><span class="file">buildbot/db/schema/vN.py</span></samp>, where N is your version number, by
copying the previous script and stripping it down.  This script should define a
subclass of <code>buildbot.db.schema.base.Updater</code> named <code>Updater</code>.

     <p>The class must define the method <code>upgrade</code>, which takes no arguments.  It
should upgrade the database from the previous version to your version,
including incrementing the number in the <code>VERSION</code> table, probably with an
<code>UPDATE</code> query.

     <p>Consult the API documentation for the base class for information on the
attributes that are available.

     <li>
Edit <samp><span class="file">buildbot/test/unit/test_db_schema_master.py</span></samp>.  If your upgrade
involves moving data from the basedir into the database proper, then edit
<code>fill_basedir</code> to add some test data.

     <p>Add code to <code>assertDatabaseOKEmpty</code> to check that your upgrade works on an
empty database.

     <p>Add code to <code>assertDatabaseOKFull</code> to check that your upgrade works on a
database with pre-existing data.  Do this even if your changes do not move any
data from the basedir.

     <p>Run the tests to find the bugs you introduced in step 2.

     <li>
Increment the version number in the <code>test_get_current_version</code> test in the
same file.  Only do this after you've finished the previous step - a failure of
this test is a good reminder that testing isn't done yet.

     <li>
Updated the version number in <samp><span class="file">buildbot/db/schema/tables.sql</span></samp>, too.

     <li>
Finally, make the corresponding changes to <samp><span class="file">buildbot/db/schema/tables.sql</span></samp>.

        </ol>

<div class="node">
<a name="Log-File-Format"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Web-Status">Web Status</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Database">The Database</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.5 Log File Format</h3>

<p><a name="index-buildbot_002estatus_002elogfile_002eLogFile-164"></a>
The master currently stores each logfile in a single file, which may have a
standard compression applied.

   <p>The format is a special case of the netstrings protocol - see
<a href="http://cr.yp.to/proto/netstrings.txt">http://cr.yp.to/proto/netstrings.txt</a>.  The text in each netstring
consists of a one-digit channel identifier followed by the data from that
channel.

   <p>The formatting is implemented in the LogFile class in
<samp><span class="file">buildbot/status/logfile.py</span></samp>, and in particular by the <code>merge</code>
method.

<div class="node">
<a name="Web-Status"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Obfuscating-Passwords">Obfuscating Passwords</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Log-File-Format">Log File Format</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.6 Web Status</h3>

<ul class="menu">
<li><a accesskey="1" href="#Jinja-Web-Templates">Jinja Web Templates</a>
<li><a accesskey="2" href="#Web-Authorization-Framework">Web Authorization Framework</a>
</ul>

<div class="node">
<a name="Jinja-Web-Templates"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Web-Authorization-Framework">Web Authorization Framework</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Web-Status">Web Status</a>

</div>

<h4 class="subsection">8.6.1 Jinja Web Templates</h4>

<p>Buildbot uses Jinja2 to render its web interface.  The authoritative source for
this templating engine is <a href="http://jinja.pocoo.org/2/documentation/">its own documentation</a>, of course, but a few notes are in order for those who are
making only minor modifications.

<h3 class="heading">Whitespace</h3>

<p>Jinja directives are enclosed in <code>{% .. %}</code>, and sometimes also have
dashes.  These dashes strip whitespace in the output.  For example:

<pre class="example">     {% for entry in entries %}
       &lt;li&gt;{{ entry }}&lt;/li&gt;
     {% endfor %}
</pre>
   <p>will produce output with too much whitespace:

<pre class="example">     
       &lt;li&gt;pigs&lt;/li&gt;
     
     
       &lt;li&gt;cows&lt;/li&gt;
     
</pre>
   <p>But adding the dashes will collapse that whitespace completely:

<pre class="example">     {% for entry in entries -%}
       &lt;li&gt;{{ entry }}&lt;/li&gt;
     {%- endfor %}
</pre>
   <p>yields

<pre class="example">     &lt;li&gt;pigs&lt;/li&gt;&lt;li&gt;cows&lt;/li&gt;
</pre>
   <div class="node">
<a name="Web-Authorization-Framework"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Jinja-Web-Templates">Jinja Web Templates</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Web-Status">Web Status</a>

</div>

<h4 class="subsection">8.6.2 Web Authorization Framework</h4>

<p>Whenever any part of the web framework wants to perform some action on the
buildmaster, it should check the user's authorization first.

   <p>Always check authorization twice: once to decide whether to show the option to
the user (link, button, form, whatever); and once before actually performing
the action.

   <p>To check whether to display the option, you'll usually want to pass an authz
object to the Jinja template in your HtmlResource subclass:

<pre class="example">         def content(self, req, cxt):
             # ...
             cxt['authz'] = self.getAuthz(req)
             template = ...
             return template.render(**cxt)
</pre>
   <p>and then determine whether to advertise the action in th template:

<pre class="example">     {{ if authz.advertiseAction('myNewTrick') }}
       &lt;form action="{{ myNewTrick_url }}"&gt; ...
     {{ endif }}
</pre>
   <p>Actions can optionally require authentication, so use <code>needAuthForm</code> to
determine whether to require a 'username' and 'passwd' field in the generated
form.  These fields are usually generated by the <code>auth()</code> form:

<pre class="example">     {% if authz.needAuthForm('myNewTrick') %}
       {{ auth() }}
     {% endif %}
</pre>
   <p>Once the POST request comes in, it's time to check authorization again. 
This usually looks something like

<pre class="example">     if not self.getAuthz(req).actionAllowed('myNewTrick', req, someExtraArg):
         return Redirect(path_to_authfail(req))
</pre>
   <p>The <code>someExtraArg</code> is optional (it's handled with <code>*args</code>, so you can
have several if you want), and is given to the user's authorization function. 
For example, a build-related action should pass the build status, so that the
user's authorization function could ensure that devs can only operate on their
own builds.

   <p>The available actions are listed in see <a href="#WebStatus-Configuration-Parameters">WebStatus Configuration Parameters</a>.

<div class="node">
<a name="Obfuscating-Passwords"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Master_002dSlave-API">Master-Slave API</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Web-Status">Web Status</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.7 Obfuscating Passwords</h3>

<p><a name="index-buildslave_002eutil_002eObfuscated-165"></a>
It's often necessary to pass passwords to commands on the slave, but it's no
fun to see those passwords appear for everyone else in the build log.  The
<code>Obfuscated</code> class can help here.  Instantiate it with a real string and a
fake string that should appear in logfiles.  You can then use the
<code>Obfuscated.get_real</code> and <code>Obfuscated.get_fake</code> static methods to
convert a list of command words to the real or fake equivalent.

   <p>The <code>RunProcess</code> implementation in the buildslave will apply these methods
automatically, so just feed it a list of strings and <code>Obfuscated</code> objects.

<div class="node">
<a name="Master-Slave-API"></a>
<a name="Master_002dSlave-API"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Twisted-Idioms">Twisted Idioms</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Obfuscating-Passwords">Obfuscating Passwords</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.8 Master-Slave API</h3>

<p>This section is a (very incomplete) description of the master-slave interface. 
The interface is based on Twisted's Perspective Broker.

<h3 class="heading">Connection</h3>

<p>The slave connects to the master, using the parameters supplied to
<code>buildslave create-slave</code>.  It uses a reconnecting process with an
exponential backoff, and will automatically reconnect on disconnection.

   <p><a name="index-buildslave_002ebot_002eBot-166"></a>
Once connected, the slave authenticates with the Twisted Cred (newcred)
mechanism, using the username and password supplied to <code>buildslave
create-slave</code>.  The "mind" is the slave bot instance (class
<code>buildslave.bot.Bot</code>).

   <p><a name="index-buildbot_002emaster_002eDispatcher-167"></a><a name="index-buildbot_002ebuildslave_002eBuildSlave-168"></a>
On the master side, the realm is implemented by
<code>buildbot.master.Dispatcher</code>, which examines the username of incoming
avatar requests.  There are special cases for <code>change</code>, <code>debug</code>, and
<code>statusClient</code>, which are not discussed here.  For all other usernames,
the botmaster is consulted, and if a slave with that name is configured, its
<code>buildbot.buildslave.BuildSlave</code> instance is returned as the perspective.

<h3 class="heading">Build Slaves</h3>

<p>At this point, the master-side BuildSlave object has a pointer to the remote,
slave-side Bot object in <code>self.slave</code>, and the slave-side Bot object has a
reference to the master-side BuildSlave object in <code>self.perspective</code>.

<h4 class="subheading">Bot methods</h4>

<p>The slave-side object has the following remote methods:

     <dl>
<dt><code>remote_getCommands</code><dd>Returns a list of <code>(name, version)</code> for all commands the slave recognizes

     <br><dt><code>remote_setBuilderList</code><dd>Given a list of builders and their build directories, ensures that those
builders, and only those builders, are running.  This can be called after the
initial connection is established, with a new list, to add or remove builders.

     <p>This method returns a dictionary of <code>SlaveBuilder</code> objects - see below

     <br><dt><code>remote_print</code><dd>Adds a message to the slave logfile

     <br><dt><code>remote_getSlaveInfo</code><dd>Returns the contents of the slave's <samp><span class="file">info/</span></samp> directory. Also contains the keys

          <dl>
<dt><code>environ</code><dd>copy of the slaves environment
<br><dt><code>system</code><dd>OS the slave is running (extracted from pythons os.name)
<br><dt><code>basedir</code><dd>base directory where slave is running
</dl>

     <br><dt><code>remote_getVersion</code><dd>Returns the slave's version

   </dl>

<h4 class="subheading">BuildSlave methods</h4>

<p>The master-side object has the following method:

     <dl>
<dt><code>perspective_keepalive</code><dd>Does nothing - used to keep traffic flowing over the TCP connection

   </dl>

<h3 class="heading">Slave Builders</h3>

<p><a name="index-buildslave_002ebot_002eSlaveBuilder-169"></a><a name="index-buildbot_002eprocess_002ebuilder_002eBuilder-170"></a><a name="index-buildbot_002eprocess_002eslavebuilder_002eSlaveBuilder-171"></a>
Each build slave has a set of builders which can run on it.  These are represented
by distinct classes on the master and slave, just like the BuildSlave and Bot objects
described above.

   <p>On the slave side, builders are represented as instances of the
<code>buildslave.bot.SlaveBuilder</code> class.  On the master side, they are
represented by the <code>buildbot.process.slavebuilder.SlaveBuilder</code> class.  The
following will refer to these as the slave-side and master-side SlaveBuilder
classes.  Each object keeps a reference to its opposite in <code>self.remote</code>.

<h4 class="subheading">slave-side SlaveBuilder methods</h4>

     <dl>
<dt><code>remote_setMaster</code><dd>Provides a reference to the master-side SlaveBuilder

     <br><dt><code>remote_print</code><dd>Adds a message to the slave logfile; used to check round-trip connectivity

     <br><dt><code>remote_startBuild</code><dd>Indicates that a build is about to start, and that any subsequent
commands are part of that build

     <br><dt><code>remote_startCommand</code><dd>Invokes a command on the slave side

     <br><dt><code>remote_interruptCommand</code><dd>Interrupts the currently-running command

     <br><dt><code>remote_shutdown</code><dd>Shuts down the slave cleanly

</dl>

<h4 class="subheading">master-side SlaveBuilder methods</h4>

<p>The master side does not have any remotely-callable methods.

<h3 class="heading">Setup</h3>

<p>After the initial connection and trading of a mind (Bot) for an avatar
(BuildSlave), the master calls the Bot's <code>setBuilderList</code> method to set up
the proper slave builders on the slave side.  This method returns a reference to
each of the new slave-side SlaveBuilder objects.  Each of these is handed to the
corresponding master-side SlaveBuilder object.  This immediately calls the remote
<code>setMaster</code> method, then the <code>print</code> method.

<h3 class="heading">Pinging</h3>

<p>To ping a remote SlaveBuilder, the master calls the <code>print</code> method.

<h3 class="heading">Building</h3>

<p>When a build starts, the msater calls the slave's <code>startBuild</code> method. 
Each BuildStep instance will subsequently call the <code>startCommand</code> method,
passing a reference to itself as the <code>stepRef</code> parameter.  The
<code>startCommand</code> method returns immediately, and the end of the command is
signalled with a call to a method on the master-side BuildStep object.

<h4 class="subheading">master-side BuildStep methods</h4>

     <dl>
<dt><code>remote_update</code><dd>Update information about the running command.  See below for the format.

     <br><dt><code>remote_complete</code><dd>Signal that the command is complete, either successfully or with a Twisted failure.

</dl>

   <p>Updates from the slave are a list of individual update elements.  Each update
element is, in turn, a list of the form <code>[data, 0]</code> where the 0 is present
for historical reasons.  The data is a dictionary, with keys describing the
contents, e.g., <code>header</code>, <code>stdout</code>, or the name of a logfile.  If the
key is <code>rc</code>, then the value is the exit status of the command.  No further
updates should be sent after an <code>rc</code>.

<div class="node">
<a name="Twisted-Idioms"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Buildbot-Tests">Buildbot Tests</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Master_002dSlave-API">Master-Slave API</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.9 Twisted Idioms</h3>

<ul class="menu">
<li><a accesskey="1" href="#Helpful-Twisted-Classes">Helpful Twisted Classes</a>
</ul>

<div class="node">
<a name="Helpful-Twisted-Classes"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#Twisted-Idioms">Twisted Idioms</a>

</div>

<h4 class="subsection">8.9.1 Helpful Twisted Classes</h4>

<p>Twisted has some useful, but little-known classes.  They are listed here with
brief descriptions, but you should consult the API documentation or source code
for the full details.

     <ul>
<li>twisted.internet.task.LoopingCall

     <p>Calls an asynchronous function repeatedly at set intervals.

     <li>twisted.application.internet.TimerService

     <p>Similar to <code>t.i.t.LoopingCall</code>, but implemented as a service that will
automatically start an dstop the function calls when the service is started and
stopped.

   </ul>

<div class="node">
<a name="Buildbot-Tests"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#String-Encodings">String Encodings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Twisted-Idioms">Twisted Idioms</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.10 Buildbot Tests</h3>

<ul class="menu">
<li><a accesskey="1" href="#Toward-Better-Buildbot-Tests">Toward Better Buildbot Tests</a>
<li><a accesskey="2" href="#Keeping-State-in-Tests">Keeping State in Tests</a>
<li><a accesskey="3" href="#Better-Debugging-through-Monkeypatching">Better Debugging through Monkeypatching</a>
</ul>

<div class="node">
<a name="Toward-Better-Buildbot-Tests"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Keeping-State-in-Tests">Keeping State in Tests</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Buildbot-Tests">Buildbot Tests</a>

</div>

<h4 class="subsection">8.10.1 Toward Better Buildbot Tests</h4>

<p>In general, we are trying to ensure that new tests are <i>good</i>.  So what makes a good test?

<h3 class="heading">Independent of Time</h3>

<p>Tests that depend on wall time will fail. As a bonus, they run very slowly. Do
not use <code>reactor.callLater</code> to wait "long enough" for something to happen.

   <p>For testing things that themselves depend on time, consider using
<code>twisted.internet.tasks.Clock</code>.  This may mean passing a clock instance to
the code under test, and propagating that instance as necessary to ensure that
all of the code using <code>callLater</code> uses it.  Refactoring code for
testability is difficult, but wortwhile.

   <p>For testing things that do not depend on time, but for which you cannot detect
the "end" of an operation: add a way to detect the end of the operation!

<h3 class="heading">Clean Code</h3>

<p>Make your tests readable. This is no place to skimp on comments! Others will
attempt to learn about the expected behavior of your class by reading the
tests. As a side note, if you use a <code>Deferred</code> chain in your test, write
the callbacks as nested functions, rather than using object methods with funny
names:

<pre class="example">     def testSomething(self):
       d = doThisFirst()
       def andThisNext(res):
         pass # ...
       d.addCallback(andThisNext)
       return d
</pre>
   <p>This isolates the entire test into one indented block. It is OK to add methods
for common functionality, but give them real names and explain in detail what
they do.

<h3 class="heading">Good Name</h3>

<p>Your test module should be named after the package or class it tests, replacing
<code>.</code> with <code>_</code> and omitting the buildbot_. For example,
<code>test_status_web_authz_Authz.py</code> tests the Authz class in
<code>buildbot/status/web/authz.py</code>. Modules with only one class, or a few
trivial classes, can be tested in a single test module. For more complex
situations, prefer to use multiple test modules.

   <p>Test method names should follow the pattern test_METHOD_CONDITION where METHOD
is the method being tested, and CONDITION is the condition under which it's
tested. Since we can't always test a single method, this is not a hard-and-fast
rule.

<h3 class="heading">Assert Only One Thing</h3>

<p>Each test should have a single assertion. This may require a little bit of work
to get several related pieces of information into a single Python object for
comparison. The problem with multiple assertions is that, if the first
assertion fails, the remainder are not tested.  The test results then do not
tell the entire story.

   <p>If you need to make two unrelated assertions, you should be running two tests.

<h3 class="heading">Use Mocks and Stubs</h3>

<p>Mocks assert that they are called correctly. Stubs provide a predictable base
on which to run the code under test. See
<a href="http://en.wikipedia.org/wiki/Mock_object">Mock Object</a> and
<a href="http://en.wikipedia.org/wiki/Method_stub">Method Stub</a>.

   <p>Mock objects can be constructed easily using the aptly-named
<a href="http://www.voidspace.org.uk/python/mock/">mock</a> module, which is a
requirement for Buildbot's tests.

   <p>One of the difficulties with Buildbot is that interfaces are unstable and
poorly documented, which makes it difficult to design stubs.  A common
repository for stubs, however, will allow any interface changes to be reflected
in only one place in the test code.

<h3 class="heading">Small Tests</h3>

<p>The shorter each test is, the better. Test as little code as possible in each test.

   <p>It is fine, and in fact encouraged, to write the code under test in such a way
as to facilitate this. As an illustrative example, if you are testing a new
Step subclass, but your tests require instantiating a BuildMaster, you're
probably doing something wrong! (Note that this rule is almost universally
violated in the existing buildbot tests).

   <p>This also applies to test modules.  Several short, easily-digested test modules
are preferred over a 1000-line monster.

<h3 class="heading">Isolation</h3>

<p>Each test should be maximally independent of other tests. Do not leave files
laying around after your test has finished, and do not assume that some other
test has run beforehand. It's fine to use caching techniques to avoid repeated,
lengthy setup times.

<h3 class="heading">Be Correct</h3>

<p>Tests should be as robust as possible, which at a basic level means using the
available frameworks correctly. All deferreds should have callbacks and be
chained properly. Error conditions should be checked properly. Race conditions
should not exist (see "Independent of Time", above).

<h3 class="heading">Be Helpful</h3>

<p>Note that tests will pass most of the time, but the moment when they are most
useful is when they fail.

   <p>When the test fails, it should produce output that is helpful to the person
chasing it down. This is particularly important when the tests are run
remotely, in which case the person chasing down the bug does not have access to
the system on which the test fails. A test which fails sporadically with no
more information than "AssertionFailed?" is a prime candidate for deletion if
the error isn't obvious. Making the error obvious also includes adding comments
describing the ways a test might fail.

<h3 class="heading">Mixins</h3>

<p>Do not define setUp and tearDown directly in a mixin. This is the path to
madness. Instead, define a <code>myMixinNameSetUp</code> and
<code>myMixinNameTearDown</code>, and call them explicitlyi from the subclass's
<code>setUp</code> and <code>tearDown</code>. This makes it perfectly clear what is being
set up and torn down from a simple analysis of the test case.

<div class="node">
<a name="Keeping-State-in-Tests"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Better-Debugging-through-Monkeypatching">Better Debugging through Monkeypatching</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Toward-Better-Buildbot-Tests">Toward Better Buildbot Tests</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Buildbot-Tests">Buildbot Tests</a>

</div>

<h4 class="subsection">8.10.2 Keeping State in Tests</h4>

<p>Python does not allow assignment to anything but the innermost local scope or
the global scope with the <code>global</code> keyword.  This presents a problem when
creating nested functions:

<pre class="example">     def test_localVariable(self):
         cb_called = False
         def cb():
             cb_called = True
         cb()
         self.assertTrue(cb_called) # will fail!
</pre>
   <p>The <code>cb_called = True</code> assigns to a <i>different variable</i> than
<code>cb_called = False</code>.  In production code, it's usually best to work around
such problems, but in tests this is often the clearest way to express the
behavior under test.

   <p>The solution is to change something in a common mutable object.  While a simple
list can serve as such a mutable object, this leads to code that is hard to
read.  Instead, use <code>State</code>:

<pre class="example">     from buildbot.test.state import State
     
     def test_localVariable(self):
         state = State(cb_called=False)
         def cb():
             state.cb_called = True
         cb()
         self.assertTrue(state.cb_called) # passes
</pre>
   <p>This is almost as readable as the first example, but it actually works.

<div class="node">
<a name="Better-Debugging-through-Monkeypatching"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Keeping-State-in-Tests">Keeping State in Tests</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Buildbot-Tests">Buildbot Tests</a>

</div>

<h4 class="subsection">8.10.3 Better Debugging through Monkeypatching</h4>

<p><a name="index-buildbot_002etest_002eutil_002emonkeypatches-172"></a>
The module <code>buildbot.test.util.monkeypatches</code> contains a few
monkey-patches to Twisted that detect errors a bit better.  These patches
shouldn't affect correct behavior, so it's worthwhile including something like
this in the header of every test file:

<pre class="example">     from buildbot.test.util.monkeypatches import monkeypatch
     monkeypatch()
</pre>
   <div class="node">
<a name="String-Encodings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Metrics">Metrics</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Buildbot-Tests">Buildbot Tests</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.11 String Encodings</h3>

<p>Buildbot expects all strings used internally to be valid Unicode strings - not
bytestrings.

   <p>Note that Buildbot rarely feeds strings back into external tools in such a way
that those strings must match.  For example, Buildbot does not attempt to
access the filenames specified in a Change.  So it is more important to store
strings in a manner that will be most useful to a human reader (e.g., in
logfiles, web status, etc.) than to store them in a lossless format.

<h3 class="heading">Inputs</h3>

<p>On input, strings should be decoded, if their encoding is known.  Where
necessary, the assumed input encoding should be configurable.  In some cases,
such as filenames, this encoding is not known or not well-defined (e.g., a
utf-8 encoded filename in a latin-1 directory).  In these cases, the input
mechanisms should make a best effort at decoding, and use e.g., the
<code>errors='replace'</code> option to fail gracefully on un-decodable characters.

<h3 class="heading">Outputs</h3>

<p>At most points where Buildbot outputs a string, the target encoding is known. 
For example, the web status can encode to utf-8.  In cases where it is not
known, it should be configurable, with a safe fallback (e.g., ascii with
<code>errors='replace'</code>).

<div class="node">
<a name="Metrics"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Developer-Class-Index">Developer Class Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#String-Encodings">String Encodings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.12 Metrics</h3>

<ul class="menu">
<li><a accesskey="1" href="#Metric-Events">Metric Events</a>
<li><a accesskey="2" href="#Metric-Handlers">Metric Handlers</a>
<li><a accesskey="3" href="#Metric-Watchers">Metric Watchers</a>
<li><a accesskey="4" href="#Metric-Helpers">Metric Helpers</a>
</ul>

<p>New in buildbot 0.8.4 is support for tracking various performance metrics inside the buildbot master process. Currently these are logged periodically according to the <code>log_interval</code> configuration setting of the <a href="#Metrics-Options">Metrics Options</a> configuration.

   <p>If <a href="#Web-Status">Web Status</a> is enabled, the metrics data is also available via /json/metrics.

   <p>The metrics subsystem is implemented in <code>buildbot.process.metrics</code>. It makes use of twisted's logging system to pass metrics data from all over buildbot's code to a central <code>MetricsLogObserver</code> object, which is available at <code>BuildMaster.metrics</code> or via <code>Status.getMetrics()</code>.

<div class="node">
<a name="Metric-Events"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Metric-Handlers">Metric Handlers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Metrics">Metrics</a>

</div>

<h4 class="subsection">8.12.1 Metric Events</h4>

<p><code>MetricEvent</code> objects represent individual items to monitor. There are three sub-classes implemented:

     <dl>
<dt><code>MetricCountEvent</code><dd>Records incremental increase or decrease of some value, or an absolute measure of some value.
     <pre class="example">          from buildbot.process.metrics import MetricCountEvent
          
          # We got a new widget!
          MetricCountEvent.log('num_widgets', 1)
          
          # We have exactly 10 widgets
          MetricCountEvent.log('num_widgets', 10, absolute=True)
</pre>
     <br><dt><code>MetricTimeEvent</code><dd>Measures how long things take. By default the average of the last 10 times will be reported.
     <pre class="example">          from buildbot.process.metrics import MetricTimeEvent
          
          # function took 0.001s
          MetricTimeEvent.log('time_function', 0.001)
</pre>
     <br><dt><code>MetricAlarmEvent</code><dd>Indicates the health of various metrics.
     <pre class="example">          from buildbot.process.metrics import MetricAlarmEvent, ALARM_OK
          
          # num_slaves looks ok
          MetricAlarmEvent.log('num_slaves', level=ALARM_OK)
</pre>
     </dl>

<div class="node">
<a name="Metric-Handlers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Metric-Watchers">Metric Watchers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Metric-Events">Metric Events</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Metrics">Metrics</a>

</div>

<h4 class="subsection">8.12.2 Metric Handlers</h4>

<p><code>MetricsHandler</code> objects are responsble for collecting <code>MetricEvent</code>s of a specific type and keeping track of their values for future reporting. There are <code>MetricsHandler</code> classes corresponding to each of the <code>MetricEvent</code> types.

<div class="node">
<a name="Metric-Watchers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Metric-Helpers">Metric Helpers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Metric-Handlers">Metric Handlers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Metrics">Metrics</a>

</div>

<h4 class="subsection">8.12.3 Metric Watchers</h4>

<p>Watcher objects can be added to <code>MetricsHandlers</code> to be called when metric events of a certain type are received. Watchers are generally used to record alarm events in response to count or time events.

<div class="node">
<a name="Metric-Helpers"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Metric-Watchers">Metric Watchers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Metrics">Metrics</a>

</div>

<h4 class="subsection">8.12.4 Metric Helpers</h4>

     <dl>
<dt><code>countMethod(name)</code><dd>A function decorator that counts how many times the function is called.
     <pre class="example">          from buildbot.process.metrics import countMethod
          
          @countMethod('foo_called')
          def foo():
              return "foo!"
</pre>
     <br><dt><code>Timer(name)</code><dd><code>Timer</code> objects can be used to make timing events easier. When <code>Timer.stop()</code> is called, a <code>MetricTimeEvent</code> is logged with the elapsed time since <code>timer.start()</code> was called.
     <pre class="example">          from buildbot.process.metrics import Timer
          
          def foo():
              t = Timer('time_foo')
              t.start()
              try:
                  for i in range(1000):
                      calc(i)
                  return "foo!"
              finally:
                  t.stop()
</pre>
     <p><code>Timer</code> objects also provide a pair of decorators, <code>startTimer</code>/<code>stopTimer</code> to decorate other functions.
     <pre class="example">          from buildbot.process.metrics import Timer
          
          t = Timer('time_thing')
          
          @t.startTimer
          def foo():
              return "foo!"
          
          @t.stopTimer
          def bar():
              return "bar!"
          
          foo()
          bar()
</pre>
     <br><dt><code>timeMethod(name)</code><dd>A function decorator that measures how long a function takes to execute. Note that many functions in buildbot return deferreds, so may return before all the work they set up has completed. Using an explicit <code>Timer</code> is better in this case.
     <pre class="example">          from buildbot.process.metrics import timeMethod
          
          @timeMethod('time_foo')
          def foo():
              for i in range(1000):
                  calc(i)
              return "foo!"
</pre>
     </dl>

<div class="node">
<a name="Developer-Class-Index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Metrics">Metrics</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Developer-Information">Developer Information</a>

</div>

<h3 class="section">8.13 Developer Class Index</h3>



<ul class="index-dv" compact>
<li><a href="#index-buildbot_002ebuildslave_002eBuildSlave-168"><code>buildbot.buildslave.BuildSlave</code></a>: <a href="#Master_002dSlave-API">Master-Slave API</a></li>
<li><a href="#index-buildbot_002echanges_002ebase_002eChangeSource-155"><code>buildbot.changes.base.ChangeSource</code></a>: <a href="#Writing-a-Change-Source">Writing a Change Source</a></li>
<li><a href="#index-buildbot_002echanges_002ebase_002ePollingChangeSource-156"><code>buildbot.changes.base.PollingChangeSource</code></a>: <a href="#Writing-a-Change-Poller">Writing a Change Poller</a></li>
<li><a href="#index-buildbot_002echanges_002emanager_002eChangeManager-160"><code>buildbot.changes.manager.ChangeManager</code></a>: <a href="#Buildmaster-Service-Hierarchy">Buildmaster Service Hierarchy</a></li>
<li><a href="#index-buildbot_002edb_002econnector_002eDBConnector-162"><code>buildbot.db.connector.DBConnector</code></a>: <a href="#The-Database">The Database</a></li>
<li><a href="#index-buildbot_002edb_002eschema_002eDBSchemaManager-163"><code>buildbot.db.schema.DBSchemaManager</code></a>: <a href="#Database-Schema">Database Schema</a></li>
<li><a href="#index-buildbot_002emaster_002eBuildMaster-158"><code>buildbot.master.BuildMaster</code></a>: <a href="#Buildmaster-Service-Hierarchy">Buildmaster Service Hierarchy</a></li>
<li><a href="#index-buildbot_002emaster_002eDispatcher-167"><code>buildbot.master.Dispatcher</code></a>: <a href="#Master_002dSlave-API">Master-Slave API</a></li>
<li><a href="#index-buildbot_002eprocess_002ebotmaster_002eBotMaster-159"><code>buildbot.process.botmaster.BotMaster</code></a>: <a href="#Buildmaster-Service-Hierarchy">Buildmaster Service Hierarchy</a></li>
<li><a href="#index-buildbot_002eprocess_002ebuilder_002eBuilder-170"><code>buildbot.process.builder.Builder</code></a>: <a href="#Master_002dSlave-API">Master-Slave API</a></li>
<li><a href="#index-buildbot_002eprocess_002eslavebuilder_002eSlaveBuilder-171"><code>buildbot.process.slavebuilder.SlaveBuilder</code></a>: <a href="#Master_002dSlave-API">Master-Slave API</a></li>
<li><a href="#index-buildbot_002eschedulers_002emanager_002eSchedulerManager-161"><code>buildbot.schedulers.manager.SchedulerManager</code></a>: <a href="#Buildmaster-Service-Hierarchy">Buildmaster Service Hierarchy</a></li>
<li><a href="#index-buildbot_002estatus_002elogfile_002eLogFile-164"><code>buildbot.status.logfile.LogFile</code></a>: <a href="#Log-File-Format">Log File Format</a></li>
<li><a href="#index-buildbot_002etest_002eutil_002emonkeypatches-172"><code>buildbot.test.util.monkeypatches</code></a>: <a href="#Better-Debugging-through-Monkeypatching">Better Debugging through Monkeypatching</a></li>
<li><a href="#index-buildslave_002ebot_002eBot-166"><code>buildslave.bot.Bot</code></a>: <a href="#Master_002dSlave-API">Master-Slave API</a></li>
<li><a href="#index-buildslave_002ebot_002eSlaveBuilder-169"><code>buildslave.bot.SlaveBuilder</code></a>: <a href="#Master_002dSlave-API">Master-Slave API</a></li>
<li><a href="#index-buildslave_002eutil_002eObfuscated-165"><code>buildslave.util.Obfuscated</code></a>: <a href="#Obfuscating-Passwords">Obfuscating Passwords</a></li>
   </ul><div class="node">
<a name="Index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Developer-Information">Developer Information</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="unnumbered">Index</h2>



<ul class="index-cp" compact>
<li><a href="#index-addURL-137">addURL</a>: <a href="#BuildStep-URLs">BuildStep URLs</a></li>
<li><a href="#index-BitKeeper-Checkout-95">BitKeeper Checkout</a>: <a href="#BitKeeper">BitKeeper</a></li>
<li><a href="#index-Build-14">Build</a>: <a href="#Build">Build</a></li>
<li><a href="#index-Builder-11">Builder</a>: <a href="#Builder">Builder</a></li>
<li><a href="#index-BuildFactory-12">BuildFactory</a>: <a href="#Builder">Builder</a></li>
<li><a href="#index-BuildRequest-10">BuildRequest</a>: <a href="#BuildRequest">BuildRequest</a></li>
<li><a href="#index-BuildSet-9">BuildSet</a>: <a href="#BuildSet">BuildSet</a></li>
<li><a href="#index-BuildSlave-13">BuildSlave</a>: <a href="#Builder">Builder</a></li>
<li><a href="#index-BuildStep-15">BuildStep</a>: <a href="#Build">Build</a></li>
<li><a href="#index-BuildStep-URLs-136">BuildStep URLs</a>: <a href="#BuildStep-URLs">BuildStep URLs</a></li>
<li><a href="#index-Bzr-Checkout-89">Bzr Checkout</a>: <a href="#Bzr">Bzr</a></li>
<li><a href="#index-Configuration-18">Configuration</a>: <a href="#Configuration">Configuration</a></li>
<li><a href="#index-CVS-Checkout-81">CVS Checkout</a>: <a href="#CVS">CVS</a></li>
<li><a href="#index-Darcs-Checkout-85">Darcs Checkout</a>: <a href="#Darcs">Darcs</a></li>
<li><a href="#index-Dependencies-58">Dependencies</a>: <a href="#Dependent-Scheduler">Dependent Scheduler</a></li>
<li><a href="#index-Dependent-57">Dependent</a>: <a href="#Dependent-Scheduler">Dependent Scheduler</a></li>
<li><a href="#index-email-142">email</a>: <a href="#MailNotifier">MailNotifier</a></li>
<li><a href="#index-File-Transfer-121">File Transfer</a>: <a href="#Transferring-Files">Transferring Files</a></li>
<li><a href="#index-GerritStatusPush-153">GerritStatusPush</a>: <a href="#GerritStatusPush">GerritStatusPush</a></li>
<li><a href="#index-Git-Checkout-93">Git Checkout</a>: <a href="#Git">Git</a></li>
<li><a href="#index-HttpStatusPush-151">HttpStatusPush</a>: <a href="#HttpStatusPush">HttpStatusPush</a></li>
<li><a href="#index-Installation-4">Installation</a>: <a href="#Installing-the-code">Installing the code</a></li>
<li><a href="#index-introduction-1">introduction</a>: <a href="#Introduction">Introduction</a></li>
<li><a href="#index-IRC-145">IRC</a>: <a href="#IRC-Bot">IRC Bot</a></li>
<li><a href="#index-links-135">links</a>: <a href="#BuildStep-URLs">BuildStep URLs</a></li>
<li><a href="#index-locks-138">locks</a>: <a href="#Interlocks">Interlocks</a></li>
<li><a href="#index-logfiles-6">logfiles</a>: <a href="#Logfiles">Logfiles</a></li>
<li><a href="#index-LogLineObserver-134">LogLineObserver</a>: <a href="#Adding-LogObservers">Adding LogObservers</a></li>
<li><a href="#index-LogObserver-133">LogObserver</a>: <a href="#Adding-LogObservers">Adding LogObservers</a></li>
<li><a href="#index-mail-143">mail</a>: <a href="#MailNotifier">MailNotifier</a></li>
<li><a href="#index-Mercurial-Checkout-87">Mercurial Checkout</a>: <a href="#Mercurial">Mercurial</a></li>
<li><a href="#index-Monotone-Checkout-99">Monotone Checkout</a>: <a href="#Monotone">Monotone</a></li>
<li><a href="#index-Packages-3">Packages</a>: <a href="#Installing-the-code">Installing the code</a></li>
<li><a href="#index-PBListener-147">PBListener</a>: <a href="#PBListener">PBListener</a></li>
<li><a href="#index-Perforce-Update-91">Perforce Update</a>: <a href="#P4">P4</a></li>
<li><a href="#index-Philosophy-of-operation-2">Philosophy of operation</a>: <a href="#History-and-Philosophy">History and Philosophy</a></li>
<li><a href="#index-Properties-78">Properties</a>: <a href="#Using-Build-Properties">Using Build Properties</a></li>
<li><a href="#index-Properties-68">Properties</a>: <a href="#Buildslaves">Buildslaves</a></li>
<li><a href="#index-Properties-51">Properties</a>: <a href="#Configuring-Schedulers">Configuring Schedulers</a></li>
<li><a href="#index-Properties-37">Properties</a>: <a href="#Defining-Global-Properties">Defining Global Properties</a></li>
<li><a href="#index-Properties-17">Properties</a>: <a href="#Build-Properties">Build Properties</a></li>
<li><a href="#index-Property-79">Property</a>: <a href="#Property">Property</a></li>
<li><a href="#index-PyPI-5">PyPI</a>: <a href="#Installing-the-code">Installing the code</a></li>
<li><a href="#index-Repo-init-sync-97">Repo init sync</a>: <a href="#Repo">Repo</a></li>
<li><a href="#index-Scheduler-8">Scheduler</a>: <a href="#Scheduling-Builds">Scheduling Builds</a></li>
<li><a href="#index-statusgui-157">statusgui</a>: <a href="#statusgui">statusgui</a></li>
<li><a href="#index-StatusPush-149">StatusPush</a>: <a href="#StatusPush">StatusPush</a></li>
<li><a href="#index-String-Transfer-125">String Transfer</a>: <a href="#Transferring-Strings">Transferring Strings</a></li>
<li><a href="#index-SVN-Checkout-83">SVN Checkout</a>: <a href="#SVN">SVN</a></li>
<li><a href="#index-Triggers-65">Triggers</a>: <a href="#Triggerable-Scheduler">Triggerable Scheduler</a></li>
<li><a href="#index-Users-16">Users</a>: <a href="#Users">Users</a></li>
<li><a href="#index-Version-Control-7">Version Control</a>: <a href="#Version-Control-Systems">Version Control Systems</a></li>
<li><a href="#index-WebStatus-140">WebStatus</a>: <a href="#WebStatus">WebStatus</a></li>
<li><a href="#index-WithProperties-80">WithProperties</a>: <a href="#WithProperties">WithProperties</a></li>
   </ul><div class="footnote">
<hr>
<a name="texinfo-footnotes-in-document"></a><h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> this
@reboot syntax is understood by Vixie cron, which is the flavor
usually provided with linux systems. Other unices may have a cron that
doesn't understand @reboot</p>

   <p class="footnote"><small>[<a name="fn-2" href="#fnd-2">2</a>]</small> except Darcs, but
since the Buildbot never modifies its local source tree we can ignore
the fact that Darcs uses a less centralized model</p>

   <p class="footnote"><small>[<a name="fn-3" href="#fnd-3">3</a>]</small> many VC
systems provide more complexity than this: in particular the local
views that P4 and ClearCase can assemble out of various source
directories are more complex than we're prepared to take advantage of
here</p>

   <p class="footnote"><small>[<a name="fn-4" href="#fnd-4">4</a>]</small> this <code>checkoutDelay</code> defaults
to half the tree-stable timer, but it can be overridden with an
argument to the Source Step</p>

   <p class="footnote"><small>[<a name="fn-5" href="#fnd-5">5</a>]</small> Build properties are serialized along with the
build results, so they must be serializable. For this reason, the
value of any build property should be simple inert data: strings,
numbers, lists, tuples, and dictionaries. They should not contain
class instances.</p>

   <p class="footnote"><small>[<a name="fn-6" href="#fnd-6">6</a>]</small> framboozle.com is still available. Remember, I get 10%
:).</p>

   <p class="footnote"><small>[<a name="fn-7" href="#fnd-7">7</a>]</small> Framboozle gets very excited about running unit
tests.</p>

   <p class="footnote"><small>[<a name="fn-8" href="#fnd-8">8</a>]</small> See
http://en.wikipedia.org/wiki/Read/write_lock_pattern for more information.</p>

   <p class="footnote"><small>[<a name="fn-9" href="#fnd-9">9</a>]</small> Deadlock is the situation where two or more slaves each
hold a lock in exclusive mode, and in addition want to claim the lock held by
the other slave exclusively as well. Since locks allow at most one exclusive
user, both slaves will wait forever.</p>

   <p class="footnote"><small>[<a name="fn-10" href="#fnd-10">10</a>]</small> Starving is the
situation that only a few locks are available, and they are immediately grabbed
by another build. As a result, it may take a long time before all locks needed
by the starved build are free at the same time.</p>

   <p class="footnote"><small>[<a name="fn-11" href="#fnd-11">11</a>]</small> Apparently this is the same way
http://buildd.debian.org displays build status</p>

   <p class="footnote"><small>[<a name="fn-12" href="#fnd-12">12</a>]</small> It may even be possible to provide SSL access by using a
specification like <code>"ssl:12345:privateKey=mykey.pen:certKey=cert.pem"</code>,
but this is completely untested</p>

   <hr></div>

</body></html>

