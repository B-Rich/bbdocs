<html lang="en">
<head>
<title>Web Authorization Framework - BuildBot Manual - 0.8.4</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="BuildBot Manual - 0.8.4">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Web-Status.html#Web-Status" title="Web Status">
<link rel="prev" href="Jinja-Web-Templates.html#Jinja-Web-Templates" title="Jinja Web Templates">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This is the BuildBot manual for Buildbot version 0.8.4.

Copyright (C) 2005, 2006, 2009, 2010 Brian Warner

Copying and distribution of this file, with or without
modification, are permitted in any medium without royalty
provided the copyright notice and this notice are preserved.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
<!-- GA-TRACKING-START -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-12313843-4");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
<!-- GA-TRACKING-END -->
</head>
<body>
<div class="node">
<a name="Web-Authorization-Framework"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Jinja-Web-Templates.html#Jinja-Web-Templates">Jinja Web Templates</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Web-Status.html#Web-Status">Web Status</a>
<hr>
</div>

<h4 class="subsection">8.6.2 Web Authorization Framework</h4>

<p>Whenever any part of the web framework wants to perform some action on the
buildmaster, it should check the user's authorization first.

   <p>Always check authorization twice: once to decide whether to show the option to
the user (link, button, form, whatever); and once before actually performing
the action.

   <p>To check whether to display the option, you'll usually want to pass an authz
object to the Jinja template in your HtmlResource subclass:

<pre class="example">         def content(self, req, cxt):
             # ...
             cxt['authz'] = self.getAuthz(req)
             template = ...
             return template.render(**cxt)
</pre>
   <p>and then determine whether to advertise the action in th template:

<pre class="example">     {{ if authz.advertiseAction('myNewTrick') }}
       &lt;form action="{{ myNewTrick_url }}"&gt; ...
     {{ endif }}
</pre>
   <p>Actions can optionally require authentication, so use <code>needAuthForm</code> to
determine whether to require a 'username' and 'passwd' field in the generated
form.  These fields are usually generated by the <code>auth()</code> form:

<pre class="example">     {% if authz.needAuthForm('myNewTrick') %}
       {{ auth() }}
     {% endif %}
</pre>
   <p>Once the POST request comes in, it's time to check authorization again. 
This usually looks something like

<pre class="example">     if not self.getAuthz(req).actionAllowed('myNewTrick', req, someExtraArg):
         return Redirect(path_to_authfail(req))
</pre>
   <p>The <code>someExtraArg</code> is optional (it's handled with <code>*args</code>, so you can
have several if you want), and is given to the user's authorization function. 
For example, a build-related action should pass the build status, so that the
user's authorization function could ensure that devs can only operate on their
own builds.

   <p>The available actions are listed in see <a href="WebStatus-Configuration-Parameters.html#WebStatus-Configuration-Parameters">WebStatus Configuration Parameters</a>.

   </body></html>

